{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/avatar.png","path":"images/avatar.png","modified":0,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.all-contributorsrc","hash":"e32dc4075e304af04b98d0726d489081bea722c0","modified":1546231107841},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1546231107841},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1546231107841},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1546231107841},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1546231107841},{"_id":"themes/next/.gitignore","hash":"a18c2e83bb20991b899b58e6aeadcb87dd8aa16e","modified":1546231107842},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1546231107842},{"_id":"themes/next/.travis.yml","hash":"3d1dc928c4a97933e64379cfde749dedf62f252c","modified":1546231107842},{"_id":"themes/next/README.md","hash":"b4f780a96b0e5d3737eb93bc00da6de91f042c4b","modified":1546231107843},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1546231107842},{"_id":"themes/next/bower.json","hash":"1c22c2003163799cb919f8e9dc1e3d20bd79151d","modified":1546231107843},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1546231107843},{"_id":"themes/next/_config.yml","hash":"f1ed097ad542abd2debf59a6e4cbb295040cc2c5","modified":1546264902735},{"_id":"themes/next/gulpfile.coffee","hash":"48d2f9fa88a4210308fc41cc7d3f6d53989f71b7","modified":1546231107847},{"_id":"themes/next/package.json","hash":"f86ddeeddc0b5c6aff7de1e0101b1f64e7f29476","modified":1546231107868},{"_id":"source/_posts/Android自动打包.md","hash":"ddb9e55e0f79fed2601ff181c1a19dc583b467e7","modified":1544255066089},{"_id":"source/_posts/Jenkins.md","hash":"d622420dc01064bbcd76bf3bc007536348e6f3b8","modified":1544333867949},{"_id":"source/_posts/LNMP环境部署.md","hash":"9f0f6f47e4749d5df51a0eabad5b48b01914cefa","modified":1544259598388},{"_id":"source/_posts/Redis主从.md","hash":"4195f9e0b3eb3a07ba4e56b3509e1b4a31e6462b","modified":1539780336200},{"_id":"source/_posts/Redis持久化.md","hash":"403f2687d03844eb7755878c8d1342da1dc56219","modified":1539868655825},{"_id":"source/_posts/ceph.md","hash":"ad207726902217fe90668478b414a246369df4cb","modified":1496583484000},{"_id":"source/_posts/docker-registry.md","hash":"94ef955d017c6e916ea3d8c1739e895b34f18325","modified":1504019617000},{"_id":"source/_posts/docker安装.md","hash":"9d0b0e52fb725f62273e41f350954cc4f32121d5","modified":1496583484417},{"_id":"source/_posts/docker容器.md","hash":"f290e06bc158dac633c8c54e972baddf57706768","modified":1489412097010},{"_id":"source/_posts/docker镜像.md","hash":"332c1da3649d26f70d97c74c17a849436e576901","modified":1489412097010},{"_id":"source/_posts/git-bisect.md","hash":"f49ca2ba2ceb0df675c3aae90d0aad38e265c055","modified":1504102253000},{"_id":"source/_posts/git-cherry-pick.md","hash":"41fc97f2aaf762ae2dd28cdbd6b487745bc9bd9b","modified":1484371652000},{"_id":"source/_posts/git-tag操作.md","hash":"2977744ea7cc2921a3b49d160f1e1ddcbca93c8f","modified":1521759510001},{"_id":"source/_posts/git-分支操作.md","hash":"d08f524eee253adfc35a083a67e0fc2196e24f50","modified":1484211104000},{"_id":"source/_posts/git-基本操作.md","hash":"9f98e1917d4abfa7ed65bbf77b6ee92deca933c9","modified":1484211070000},{"_id":"source/_posts/hello-world.md","hash":"c8f2a85bdd14c35bb58009fbd6c9697247119e29","modified":1489412560000},{"_id":"source/_posts/linux添加swap.md","hash":"d3977166b9e8df5012730da908fa2800b600af0a","modified":1487136138000},{"_id":"source/_posts/linux系统监控基本命令.md","hash":"3a3c23e29f186d2febc354fb809074073aabd075","modified":1490621105932},{"_id":"source/_posts/mediawiki.md","hash":"9930ae96281ceb965a9ef456b746cde9feb6840d","modified":1544262661658},{"_id":"source/_posts/mongodb主从.md","hash":"2c27dd8b4b9c5dee1196791e83e9b46224747b4c","modified":1544773351460},{"_id":"source/_posts/mysql配置项修改.md","hash":"d48381881299c9451f237ac872c69069ccb984fc","modified":1546085702733},{"_id":"source/_posts/nginx编译安装lua模块.md","hash":"9311996f1bc88656b43bccb5969bcc2c93f84460","modified":1544317820192},{"_id":"source/_posts/python使用和导入模块.md","hash":"f34813ada37ca9e7a862c19612679f2ceeea0fea","modified":1490102184321},{"_id":"source/_posts/python字符串处理.md","hash":"ce081f291f0fae295023d4920edf613d5b17daeb","modified":1490279398262},{"_id":"source/_posts/python字符串对齐.md","hash":"d19e30ef788ce14f60ba809cd7b0f72d0363f2b4","modified":1539780321072},{"_id":"source/_posts/python字符编码.md","hash":"d4c64755303251b538fbf974215d2634b8938993","modified":1490102184321},{"_id":"source/_posts/python指定字符编码.md","hash":"f9fc5e9df2bc530abe71dabd1b4831597c82cde5","modified":1486444111000},{"_id":"source/_posts/python文件处理.md","hash":"692b4b7be540bda2769ea752ec91ea1bcc487866","modified":1490276962090},{"_id":"source/_posts/python用户交互.md","hash":"b5c8c328bb602d8b3fabbd5ab98a781a67517f02","modified":1490102184321},{"_id":"source/_posts/shell-style-guide.md","hash":"7f51bcb819e0bedc14763d022275ce21929b6ad8","modified":1484201396000},{"_id":"source/_posts/tmux安装配置使用.md","hash":"f8d8d24915b8aef9f46effc41aa258253aa29793","modified":1484815576000},{"_id":"source/_posts/ubuntu修改网卡名称.md","hash":"3705ec83390a2ca45ea5be8c5a301f578923c314","modified":1486444310000},{"_id":"source/_posts/ubuntu发送邮件.md","hash":"09ac879615f66051fe4115fec4a28a594c0df065","modified":1544430776275},{"_id":"source/_posts/ubuntu安装powerline字体.md","hash":"ae134616335c9551bd615bda372ca17cb06dca06","modified":1485245733000},{"_id":"source/_posts/ubuntu安装为知笔记.md","hash":"29f8c7fe40ae9b4cb4d35bd34b3b0522b1cf32c1","modified":1484899227000},{"_id":"source/_posts/ubuntu指定默认编辑器.md","hash":"89f566f7f81ad1f478befc36f47ac6dab5e63e47","modified":1486445825000},{"_id":"source/_posts/vim-surround插件.md","hash":"17f156d4b2e8a32bb5c27b1f03e8d7985e6ce62a","modified":1484198725000},{"_id":"source/_posts/修改最后一次commit.md","hash":"47829c0ebdd0ea4f35768fd8b9969f7c0ab51453","modified":1484183915000},{"_id":"source/_posts/启用ssl.md","hash":"c155bba340e0bd875f5f644f5980d871dcf5de6a","modified":1544333625165},{"_id":"source/_posts/安装配置gitlab.md","hash":"81e770e848f44445e8010daee93c36df9e9ef6c8","modified":1544322457781},{"_id":"source/_posts/开源项目管理系统-zentao.md","hash":"dbddf619a6e41f35e7d8aa8a2b70436c538295a0","modified":1544262676655},{"_id":"source/_posts/更换linux系统的home磁盘.md","hash":"b1eba0e5dca3320f7267d77c1c94477e1ee924cc","modified":1544257872262},{"_id":"source/_posts/通过supervisor管理服务.md","hash":"b1e2411869a6f49e219cc844abdf1b97c5ec95e1","modified":1544590679938},{"_id":"source/about/index.md","hash":"bcfdc42a9bd51573e409bdf6d509eafb21cdb804","modified":1483083342000},{"_id":"source/categories/index.md","hash":"43303bb688fd53bab69c2f397d6a3213b197d380","modified":1483083299000},{"_id":"source/images/avatar.png","hash":"9e0f60789104d5f16fccfded12209468e5166a6b","modified":1484378050000},{"_id":"source/tags/index.md","hash":"4479854a1626b60e213c264b61dd30ab0142d5dd","modified":1483083321000},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1546231107835},{"_id":"themes/next/.git/config","hash":"e78135eac1ede2f3ca79747839db482790e54b3c","modified":1546231107836},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1546231095313},{"_id":"themes/next/.git/index","hash":"23c61590738ed75d4c694bb8648add84fd62521d","modified":1546231319723},{"_id":"themes/next/.git/packed-refs","hash":"cc7940153e3ec874e6da1e242ca4755ccb0e512e","modified":1546231107834},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"b63696d41f022525e40d7e7870c3785b6bc7536b","modified":1546231107841},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"a5335a99377069ae76fd993d488bc3eaf48f3a05","modified":1546231107841},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"00c25366764e6b9ccb40b877c60dc13b2916bbf7","modified":1546231107842},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"7abbb4c8a29b2c14e576a00f53dbc0b4f5669c13","modified":1546231107842},{"_id":"themes/next/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1546231107842},{"_id":"themes/next/.github/stale.yml","hash":"a782ac925201a8fe07959bba0d7696c7b2b5fd2d","modified":1546231107842},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1546231107844},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"141e989844d0b5ae2e09fb162a280715afb39b0d","modified":1546231107844},{"_id":"themes/next/docs/AUTHORS.md","hash":"7b24be2891167bdedb9284a682c2344ec63e50b5","modified":1546231107844},{"_id":"themes/next/docs/DATA-FILES.md","hash":"8e1962dd3e1b700169b3ae5bba43992f100651ce","modified":1546231107844},{"_id":"themes/next/docs/INSTALLATION.md","hash":"2bbdd6c1751b2b42ce9b9335da420c6026a483e9","modified":1546231107844},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"120750c03ec30ccaa470b113bbe39f3d423c67f0","modified":1546231107844},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1546231107844},{"_id":"themes/next/docs/MATH.md","hash":"e6023505dcccaef0b856102543585a13fc6af0b1","modified":1546231107845},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"ad57c168d12ba01cf144a1ea0627b2ffd1847d3e","modified":1546231107845},{"_id":"themes/next/layout/_layout.swig","hash":"2c53b282edb0c7aa2a96cbd7e09ab66f05015394","modified":1546231107851},{"_id":"themes/next/layout/archive.swig","hash":"2b6450c6b6d2bcbcd123ad9f59922a5e323d77a5","modified":1546231107867},{"_id":"themes/next/layout/category.swig","hash":"5d955284a42f802a48560b4452c80906a5d1da02","modified":1546231107867},{"_id":"themes/next/layout/index.swig","hash":"c2a3896c64e96790edc10426ef586b6186a87f46","modified":1546231107867},{"_id":"themes/next/layout/page.swig","hash":"2d0e80e8a4dcba665704882b9dc5858c187acc31","modified":1546231107867},{"_id":"themes/next/layout/post.swig","hash":"f74929fd792541916eb25c2addfb35431be071ba","modified":1546231107867},{"_id":"themes/next/layout/schedule.swig","hash":"3268dd3d90d8b0e142cfa1a2ebb23355baeda148","modified":1546231107867},{"_id":"themes/next/layout/tag.swig","hash":"ba402ce8fd55e80b240e019e8d8c48949b194373","modified":1546231107868},{"_id":"themes/next/languages/de.yml","hash":"fb478c5040a4e58a4c1ad5fb52a91e5983d65a3a","modified":1546231107847},{"_id":"themes/next/languages/default.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1546231107848},{"_id":"themes/next/languages/en.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1546231107848},{"_id":"themes/next/languages/fr.yml","hash":"0162a85ae4175e66882a9ead1249fedb89200467","modified":1546231107848},{"_id":"themes/next/languages/id.yml","hash":"e7fb582e117a0785036dcdbb853a6551263d6aa6","modified":1546231107848},{"_id":"themes/next/languages/it.yml","hash":"62ef41d0a9a3816939cb4d93a524e6930ab9c517","modified":1546231107848},{"_id":"themes/next/languages/ja.yml","hash":"e331b15b1fda0f2285d25853f834682ab8dc3c39","modified":1546231107848},{"_id":"themes/next/languages/ko.yml","hash":"fae155018ae0efdf68669b2c7dd3f959c2e45cc9","modified":1546231107848},{"_id":"themes/next/languages/nl.yml","hash":"bb9ce8adfa5ee94bc6b5fac6ad24ba4605d180d3","modified":1546231107849},{"_id":"themes/next/languages/pt-BR.yml","hash":"bfc80c8a363fa2e8dde38ea2bc85cd19e15ab653","modified":1546231107849},{"_id":"themes/next/languages/pt.yml","hash":"3cb51937d13ff12fcce747f972ccb664840a9ef3","modified":1546231107849},{"_id":"themes/next/languages/ru.yml","hash":"db0644e738d2306ac38567aa183ca3e859a3980f","modified":1546231107849},{"_id":"themes/next/languages/tr.yml","hash":"c5f0c20743b1dd52ccb256050b1397d023e6bcd9","modified":1546231107849},{"_id":"themes/next/languages/uk.yml","hash":"1eb59e581568da9a81d6e20541b4ada5fc1c55c0","modified":1546231107850},{"_id":"themes/next/languages/vi.yml","hash":"8da921dd8335dd676efce31bf75fdd4af7ce6448","modified":1546231107850},{"_id":"themes/next/languages/zh-CN.yml","hash":"fbbf3a0b664ae8e927c700b0a813692b94345156","modified":1546231107850},{"_id":"themes/next/languages/zh-HK.yml","hash":"7903b96912c605e630fb695534012501b2fad805","modified":1546231107850},{"_id":"themes/next/languages/zh-TW.yml","hash":"6e6d2cd8f4244cb1b349b94904cb4770935acefd","modified":1546231107851},{"_id":"themes/next/scripts/merge-configs.js","hash":"33afe97284d34542015d358a720823feeebef120","modified":1546231107868},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1546231107869},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1546231107898},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1546231107898},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1546231107899},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107886},{"_id":"source/_posts/Jenkins/1.add_new_credentials.png","hash":"8f48dffe9f4b9c9d996c07345784c5c4960d38d7","modified":1544330906076},{"_id":"source/_posts/Jenkins/10.see_the_commit_status_in_gitlab.png","hash":"f25ba8562c7571c67ca22fcec6af501bcab504cb","modified":1544330906077},{"_id":"source/_posts/Jenkins/3.gitlab_add_api_token.png","hash":"7f68767b710d63d296c9ee00f016138bad5bd1d6","modified":1544330906077},{"_id":"source/_posts/Jenkins/2.global_credentials_list.png","hash":"c8258744c87a5cd1e52f52dc70c60b26d6685889","modified":1544330906077},{"_id":"source/_posts/Jenkins/4.jenkins_add_api_token.png","hash":"3563a5a37dc9502c8148f416987567e253f7404e","modified":1544330906078},{"_id":"source/_posts/Jenkins/5.jenkins_conn_gitlab.png","hash":"e71dadb25619d5d4f01303061e7f6def28c79e8d","modified":1544331039921},{"_id":"source/_posts/Jenkins/8.add_post-build_action.png","hash":"d8a0bf68b63ed37c20d6f2a50725276c86139a60","modified":1544330906079},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1546231095314},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1546231095314},{"_id":"themes/next/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1546231095314},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1546231095315},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1546231095315},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"33729ad4ce51acda35094e581e4088f3167a0af8","modified":1546231095314},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1546231095315},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1546231095314},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1546231095315},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1546231095315},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1546231095315},{"_id":"themes/next/.git/info/exclude","hash":"bb5a85730dcf100facee799c05cc4f6affec0745","modified":1546231095313},{"_id":"themes/next/.git/logs/HEAD","hash":"f6467222a37b816f79e447943eb7ae060cbc7222","modified":1546231107836},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"d6d20f60f77a76c77f8e65d0c9adbd79d0274557","modified":1546231107845},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"6c5d69e94961c793da156217ecf1179e868d7ba1","modified":1546231107845},{"_id":"themes/next/docs/ru/README.md","hash":"953deb732e0b3b22c423122a189d6847d908c4b8","modified":1546231107845},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"b1dd18d9b890b21718883ea1832e7e02a773104a","modified":1546231107845},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"6855402e2ef59aae307e8bd2a990647d3a605eb8","modified":1546231107846},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"a45a791b49954331390d548ac34169d573ea5922","modified":1546231107846},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"f3eec572a7d83542e2710a7404082014aaa1a5e7","modified":1546231107846},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"bd2c955d9b7b1b45bd74a4536717d547e03fcde3","modified":1546231107846},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"b19a6e0ae96eb7c756fb5b1ba03934c7f9cbb3c3","modified":1546231107846},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"24cf2618d164440b047bb9396263de83bee5b993","modified":1546231107846},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"8ac2f5d2a023211d8d8ea626cbf6b8dea67ac201","modified":1546231107847},{"_id":"themes/next/docs/zh-CN/README.md","hash":"15e55eb77616500fa4c64982d6bad9ac17a46e2a","modified":1546231107847},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"5da70d7fa0c988a66a469b9795d33d471a4a4433","modified":1546231107847},{"_id":"themes/next/layout/_custom/head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1546231107851},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1546231107851},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1546231107851},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"35affac8c523f399e59fcc4d3905e03e4e1ed9aa","modified":1546231107852},{"_id":"themes/next/layout/_macro/post.swig","hash":"d1cf93a757768e8fb9bfb7183daad64667ef3544","modified":1546231107852},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"a1ded7ba92354ed55ae20a0b6bcc15bbb4b801c2","modified":1546231107853},{"_id":"themes/next/layout/_partials/comments.swig","hash":"dce2938bb54c3cef3319f09f2621b93bc41117a0","modified":1546231107853},{"_id":"themes/next/layout/_partials/footer.swig","hash":"07f88421bda86d9d5ff32d130b1cb1196b99a326","modified":1546231107853},{"_id":"themes/next/layout/_partials/github-banner.swig","hash":"11128d3fbe195d7d105e43cf774a1a70b2c1de24","modified":1546231107853},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"dbe321bcf3cf45917cc11a3e3f50d8572bac2c70","modified":1546231107856},{"_id":"themes/next/layout/_partials/post-edit.swig","hash":"06dac109504812b63766a80ede9ddacbd42d227d","modified":1546231107856},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"d01881f8056203c4b6920328db8c2ae8fa662a08","modified":1546231107858},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"d66bc7ec3cc03f60fcc7d555368a5b9b010f7f11","modified":1546231107859},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"edaff4766e0c05fd5c889d9dd32884d376bef9d9","modified":1546231107859},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"c4c58ea2bd4cf10372a5e46dbec1b9a2e0e69f0f","modified":1546231107860},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"10b61a8bac671e375916a4d234c120117098a78f","modified":1546231107862},{"_id":"themes/next/layout/_third-party/copy-code.swig","hash":"01056ad0e5ad73885e02244943544d7b740bc3bb","modified":1546231107864},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"d359e638a86bd9664101c48e9344f21ec96e6a15","modified":1546231107864},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"2c4a66be4677d3e4dec3f169ac8a769098dad1fe","modified":1546231107864},{"_id":"themes/next/layout/_third-party/pangu.swig","hash":"c28f9dc96ab735daeb7f599f86470aa5a83c03cf","modified":1546231107864},{"_id":"themes/next/layout/_third-party/pdf.swig","hash":"5453d76e00bfcd1d732fc5f41828a90eb681f645","modified":1546231107864},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"cbe40cb67dad15ade967b0f396c1a95b6871f76a","modified":1546231107865},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"272c46f03766ea0c169163342bb98f09f561cf4c","modified":1546231107865},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"1b250c1b7945cb1029b9e855edb09854f7c8250a","modified":1546231107865},{"_id":"themes/next/source/css/main.styl","hash":"c26ca6e7b5bd910b9046d6722c8e00be672890e0","modified":1546231107886},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1546231107886},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1546231107887},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1546231107887},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1546231107887},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1546231107887},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1546231107887},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1546231107887},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1546231107888},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1546231107888},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1546231107888},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1546231107888},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1546231107888},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1546231107888},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1546231107888},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1546231107889},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1546231107889},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1546231107889},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1546231107889},{"_id":"themes/next/scripts/helpers/engine.js","hash":"60eb1554456d9d0e5afc4a2d16f1580a0aa02da8","modified":1546231107868},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"15582e823d228c0b2288543c1eb460c40afad29b","modified":1546231107868},{"_id":"themes/next/scripts/tags/button.js","hash":"4b12c376bea894d23cca0f9fcb3d6518b6db279d","modified":1546231107869},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1546231107869},{"_id":"themes/next/scripts/tags/full-image.js","hash":"5f2f4c6e15b3197f26a26926876af70ef6390fc4","modified":1546231107869},{"_id":"themes/next/scripts/tags/exturl.js","hash":"7ded3e7a78380b32de3e12f156e0978ef5c2890a","modified":1546231107869},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"981e01aaf45a1f0f23ce0796d03134f9e437aaca","modified":1546231107869},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"5db59d56f4f4082382bf1c16722e6c383892b0c5","modified":1546231107870},{"_id":"themes/next/scripts/tags/label.js","hash":"f0ecd3b5773b19a6bd93a819dfe0c49ee418e4de","modified":1546231107870},{"_id":"themes/next/scripts/tags/note.js","hash":"adb945ba93ac487d46b969ca4e59d3681b8f8d1c","modified":1546231107870},{"_id":"themes/next/scripts/tags/tabs.js","hash":"e37761253d68a29593fe9ed2fe403f49b6e971de","modified":1546231107870},{"_id":"source/_posts/Jenkins/6.source_code_manage.png","hash":"7c9fe2459162fa77fcdeeff7f0d862e669221a1f","modified":1544331085520},{"_id":"source/_posts/Jenkins/7.build_trigger.png","hash":"f51067b35b3948a1572a530ffda2899c2beabefe","modified":1544331113687},{"_id":"source/_posts/Jenkins/9.add_web_hook.png","hash":"978715d0a48cb5af939779271b554620fbe99297","modified":1544331140044},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107859},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107859},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107881},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107881},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107881},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107885},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1546231107886},{"_id":"themes/next/.git/refs/heads/master","hash":"1b485fe9b77d8a72cbb13828a30e2d868a7f812d","modified":1546231107836},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"65c5e585982dae7ae1542cada71858b4ea1f73d6","modified":1546231107852},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"fb33f499022cd02722f834fcef1a0e193362cfde","modified":1546231107852},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"fc6bafc8c633afadc538c5afa5620ea2a1cdcb84","modified":1546231107854},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"dc53a41196b675268bfd2a944f6258c57ed44e91","modified":1546231107854},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"6a825ce9412339ec4a128d9714804994cb85522c","modified":1546231107854},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"58e2e153e8b67e643b24453a1e1cceaae3323647","modified":1546231107855},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"2082f5077551123e695e8afec471c9c44b436acb","modified":1546231107855},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"3db735d0cd2d449edf2674310ac1e7c0043cb357","modified":1546231107855},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"5adc60100e129c1d0307bdcaa0c7b8e8375a6ea4","modified":1546231107855},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"69722be16ce5eae5c027168f9b2fded4776e1b53","modified":1546231107855},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"2940df694fff28e8bf71b6546b4162f1e38227db","modified":1546231107855},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"2f73cc9ffb63534f0b6d8f0e9ee853c1af1b1244","modified":1546231107856},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"eea95b785c9c36d28e1839619793f66e89773bee","modified":1546231107856},{"_id":"themes/next/layout/_partials/post/reward.swig","hash":"64d65d9ad0cc94734ac6ded279e2b5dc870a1cab","modified":1546231107856},{"_id":"themes/next/layout/_partials/post/wechat-subscriber.swig","hash":"d63208ee20529450c35de8fe80ef41fffa831dc9","modified":1546231107857},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"a33b29ccbdc2248aedff23b04e0627f435824406","modified":1546231107857},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1546231107857},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a5587bd1f60d35e58618576cec45e662aa44ea1f","modified":1546231107857},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1546231107858},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1546231107858},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1546231107858},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d5bfb363a1154e6505f0cccbd811fa71db133e3d","modified":1546231107858},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"c7f2855f19dfdf18aba8c58d55b7489e631ed035","modified":1546231107859},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"94e106755c5fb6f40431b621beeba0bd33877e57","modified":1546231107859},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"94e106755c5fb6f40431b621beeba0bd33877e57","modified":1546231107860},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"98df9d72e37dd071e882f2d5623c9d817815b139","modified":1546231107860},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"798d67e4a736613ab899eabe6529091bbcda7850","modified":1546231107860},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"591b2ccd9713ccb922b9fcf5e278b6de9c5ec30b","modified":1546231107861},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"07307f1f0e0e9858f2c7143cbdfcb2a9a92149ab","modified":1546231107861},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"08cd47ef8572121b7811342d3c9a84a338a18191","modified":1546231107861},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"050ea01f25cfe492be9bb77b409644d623fdf2dc","modified":1546231107861},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"fae69a0e1a1d42f7bb44e594a29857d94594698b","modified":1546231107861},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"529db1ff4b6c18822d6cf77f644a7f7b39c80870","modified":1546231107861},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"9e576f12a294b14bd262f59c309a50cbf7003827","modified":1546231107862},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"438c6f5e6665d72f4ea7ee206011d669246f6102","modified":1546231107862},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"c28f3f4aa31d7f996d26a97df6cd7ffa9bfd2cec","modified":1546231107862},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"f240a50cd9b627620d9a374a29cf95f0c5e99d7c","modified":1546231107862},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"41b4644f7264b16336154ac842f35278e3bb09b8","modified":1546231107862},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"cbf620cf2a78e3ac736cdd7e768513cfd6946e83","modified":1546231107862},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"aea70f5ec17917b75812020d8bf2aeabd434e8bc","modified":1546231107863},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"c4c50a646254a186413bb5e4e320af4071a8b072","modified":1546231107863},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"3fee34fc9620195b1152e96f126c516a7175fdbb","modified":1546231107863},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"d34e054a6d5c8a5fb4dd4b4671e666891e4c9adf","modified":1546231107863},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"9809d63a4234c5f268ff0b489579149b849728fc","modified":1546231107863},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"607a60588ad3d226eb0fb50df601e2f2ff6d627c","modified":1546231107863},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"9eb881107c407d8d9e759d10d247f2ade412c2d9","modified":1546231107863},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"a7e304b05a44279d3e4f611908d7faef9dc14d7c","modified":1546231107864},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"c2cb2f384bc30d31cdccf9794a729c03e687b45c","modified":1546231107864},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"42c88baf4a1a2a6dd907bb87441c8339d8e6e243","modified":1546231107864},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1546231107866},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"b3eaab6a269aa3fcbafe24fd06f0c9206dc12716","modified":1546231107866},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1546231107866},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"323ccd05bf8befb7d33de443cf3ac6a4195c3554","modified":1546231107867},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1546231107881},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1546231107881},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"2640a54fa63bdd4c547eab7ce2fc1192cf0ccec8","modified":1546231107881},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"086f5979b3de091c3378512e6c5c2f8fcb4f6298","modified":1546231107881},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"df538021b8a56d739a11079a3b3acf2d8e8c90ca","modified":1546231107885},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1546231107885},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"5a1608920d2d2b154290c1ed1992a62c0eab1c40","modified":1546231107886},{"_id":"themes/next/source/css/_variables/base.styl","hash":"91affa9545a2e49c5ba02088be6bd13d5afa84ae","modified":1546231107886},{"_id":"themes/next/source/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1546231107889},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1546231107889},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1546231107890},{"_id":"themes/next/source/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1546231107890},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1546231107890},{"_id":"themes/next/source/js/src/motion.js","hash":"3acaae96da453dcd03e4cbd301d81748f86ae95a","modified":1546231107890},{"_id":"themes/next/source/js/src/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1546231107890},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1546231107891},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1546231107891},{"_id":"themes/next/source/js/src/utils.js","hash":"cac98e1d497673f7a5bb665c90cd5db6164547d1","modified":1546231107891},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1546231107891},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1546231107891},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1546231107892},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1546231107892},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1546231107892},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1546231107898},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1546231107898},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1546231107898},{"_id":"themes/next/scripts/filters/after_post_render/exturl.js","hash":"9c9f61b7bfb3349b03b1e61355f20232044b5fd8","modified":1546231107868},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1546231107896},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"f6467222a37b816f79e447943eb7ae060cbc7222","modified":1546231107836},{"_id":"themes/next/.git/objects/pack/pack-ecd92cf59c8ce1394e15a67f9f9c30322bc6fc99.idx","hash":"7d01e031b0d0df8aaf8be6169b44c05655c783f8","modified":1546231107827},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1546231107835},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"cd86bed852fec6e6933898067122a03755bc17f0","modified":1546231107865},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1546231107866},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"b8087dd80d07b78d00b6fb4c07f415eb2771c883","modified":1546231107870},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1546231107871},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"7e509c7c28c59f905b847304dd3d14d94b6f3b8e","modified":1546231107871},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1546231107871},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1546231107871},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"c5d48863f332ff8ce7c88dec2c893f709d7331d3","modified":1546231107873},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1546231107877},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"aebbd86500d819c4532ab290c62b6f432bc2f878","modified":1546231107880},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"d33420ef9a655ecaa1c70af6d9bfed0740d8a5bf","modified":1546231107880},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1546231107880},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"efc40a32487e0ac7b94b1ca81bdbdcc4ec8f2924","modified":1546231107880},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1546231107880},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1546231107880},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"02d138ed65060e98f20bc5b1dd59a791222b7156","modified":1546231107880},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"8dfd4d744e664a97df7a96d045bcfde282ab2dff","modified":1546231107881},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"0bef9f0dc134215bc4d0984ba3a16a1a0b6f87ec","modified":1546231107882},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1546231107882},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1546231107882},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"fe2dc74726a515549956d233becda188da64f948","modified":1546231107882},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"2212511ae14258d93bec57993c0385e5ffbb382b","modified":1546231107882},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1546231107882},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"5e12572b18846250e016a872a738026478ceef37","modified":1546231107883},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1546231107883},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"fc160583f742c94316a0fee05c18468033173534","modified":1546231107883},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"936132428a0d35b3947ccedd4c379940abcf223a","modified":1546231107883},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1546231107884},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"d5e8ea6336bc2e237d501ed0d5bbcbbfe296c832","modified":1546231107884},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"09b5054ae34ba83c0d614821e574da265af55a14","modified":1546231107884},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"215d8e943540d17bafabb14c2bf7707956b0ee92","modified":1546231107884},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"74c7dccf0a3ee9fc2ca25ad8e998243191813a0e","modified":1546231107884},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1546231107885},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e7afdb343f9502f433f49044e42fe347719ce330","modified":1546231107885},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"b5b936dddb7b4de4720cd1e8428b30a2f06d63fb","modified":1546231107885},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"5779cc8086b1cfde9bc4f1afdd85223bdc45f0a0","modified":1546231107885},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"958f3a70ea684264f23054d37d5e744a32c2e68a","modified":1546231107890},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1546231107893},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1546231107893},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1546231107893},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1546231107896},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1546231107896},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1546231107895},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1546231107895},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1546231107897},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"f6467222a37b816f79e447943eb7ae060cbc7222","modified":1546231107835},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"39dee82d481dd9d44e33658960ec63e47cd0a715","modified":1546231107871},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"ee37e6c465b9b2a7e39175fccfcbed14f2db039b","modified":1546231107871},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"7cc3f36222494c9a1325c5347d7eb9ae53755a32","modified":1546231107871},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1546231107872},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"05e68adae13f4d99a6ac6493daab39c92e39a6bd","modified":1546231107872},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"c0d9e18a9210fdcaf33e488518b3b288eb58c0a1","modified":1546231107872},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1546231107872},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1546231107872},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"2dfa5fde3df69fba8282627e592fe637c2cbac6b","modified":1546231107872},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1546231107872},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"7dd9a0378ccff3e4a2003f486b1a34e74c20dac6","modified":1546231107873},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"6904fd7ea6455e008d9884558b68254608af9a3c","modified":1546231107873},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1546231107873},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"fb451dc4cc0355b57849c27d3eb110c73562f794","modified":1546231107873},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"f2911a048e5c20ca2a059bd1087d98ac1c51681c","modified":1546231107873},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1546231107873},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1546231107874},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"3b5a37ba5e70f92c1ee707c8053524e38adbb710","modified":1546231107874},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"2356226157e8068b0e9bbe2f7d0f74e1ab49199b","modified":1546231107874},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1546231107874},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"ca89b167d368eac50a4f808fa53ba67e69cbef94","modified":1546231107874},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1546231107874},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"417f05ff12a2aaca6ceeac8b7e7eb26e9440c4c3","modified":1546231107874},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"1cf64afd4b49143972f7617869539be3adb91a5e","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"f4e9f870baa56eae423a123062f00e24cc780be1","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"5f964ef8a38b9901ac8f87e3f5c93e0c44ec947a","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"578bb2d5f24cad39205bbafb4c39c7e9962b9fa9","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"8e058c99dd7d41f0bd34c7c28b6ac9fbb17dcb5e","modified":1546231107875},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"3039df53b94b0847b0c451d2d227270b479cc184","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"35c0350096921dd8e2222ec41b6c17a4ea6b44f2","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"e18b90c97aaff027e795f5a0cb10476a71bf1c3a","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"b34bb2ea4d16e47e6fdc06cd4feb32d93ccbd779","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"4427ed3250483ed5b7baad74fa93474bd1eda729","modified":1546231107876},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1546231107877},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"43bc58daa8d35d5d515dc787ceb21dd77633fe49","modified":1546231107877},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1546231107877},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1546231107877},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"6ec8ea7b11a146777b6b8da0f71f0cc1dbd129df","modified":1546231107877},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1546231107877},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1546231107878},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"ee7528900578ef4753effe05b346381c40de5499","modified":1546231107878},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1546231107878},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1546231107878},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"5e340ee2407a4e39cd708794cfcc718a5f398d7b","modified":1546231107878},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"090018c4467a5cc056bdceebd2517a87e3cb7835","modified":1546231107878},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1546231107878},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"34935b40237c074be5f5e8818c14ccfd802b7439","modified":1546231107879},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"ac7753d536341aa824d7bce0332735e838916995","modified":1546231107879},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"6157665b8fc26ce4635c926128ffbd831a2fdd46","modified":1546231107879},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1546231107879},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"76937db9702053d772f6758d9cea4088c2a6e2a3","modified":1546231107879},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"a5e3e6b4b4b814a9fe40b34d784fed67d6d977fa","modified":1546231107879},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"d4fefad868498adff03321b9dc38e75c61e08def","modified":1546231107879},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1546231107883},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1546231107883},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1546231107884},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1546231107894},{"_id":"themes/next/.git/objects/pack/pack-ecd92cf59c8ce1394e15a67f9f9c30322bc6fc99.pack","hash":"dc82ac84979d498138bf84f2927492cd51aad1bc","modified":1546231107826},{"_id":"public/baidusitemap.xml","hash":"5ac985ee1347f61beadae816332539aaf1109a5c","modified":1546264830803},{"_id":"public/atom.xml","hash":"086c5850ee615d9bc42c58cbfd1c18c7f6e9f05e","modified":1546264830803},{"_id":"public/sitemap.xml","hash":"b6295ef37bb5b2417f639bd43ab721ec1f102cbe","modified":1546264830845},{"_id":"public/search.xml","hash":"f67f51916a3ab9f6692271b6a9b278f4865126fb","modified":1546264830845},{"_id":"public/about/index.html","hash":"c5290c79c59e9c75d90ea3dd534865f197ac7a77","modified":1546264912382},{"_id":"public/categories/index.html","hash":"a03fb015824323d06c63cb697b710eca321f4ae0","modified":1546264912382},{"_id":"public/tags/index.html","hash":"ce2d960e1d5a4a3eea17be03d7ec7d5fb5f24299","modified":1546264912382},{"_id":"public/2018/12/11/mongodb主从/index.html","hash":"1e600d150cb36e97f0d03fccfcefdfa568b2b496","modified":1546264912382},{"_id":"public/2018/10/17/Redis主从/index.html","hash":"41972e79f284eaf24559c9cea88a11b251c8a6ce","modified":1546264912382},{"_id":"public/2018/10/16/Redis持久化/index.html","hash":"bda617f97589c370195f91b7301a86726827a486","modified":1546264912382},{"_id":"public/2018/10/13/python字符串对齐/index.html","hash":"518e3ccdd6482224d207fd639023fb63184b69b6","modified":1546264912382},{"_id":"public/2018/05/09/通过supervisor管理服务/index.html","hash":"c91ef25104d80fb366dd637144d0e7d234610720","modified":1546264912382},{"_id":"public/2017/09/15/nginx编译安装lua模块/index.html","hash":"aaaa4fbce54790d98d7f12ea4f720c36b01b45a5","modified":1546264912382},{"_id":"public/2017/08/30/git-bisect/index.html","hash":"8727d4b56404fd616dfd70ccda2bdb39f313f55b","modified":1546264912383},{"_id":"public/2017/08/18/开源项目管理系统-zentao/index.html","hash":"2e569eb8ee40c982bf79c8629823d6fed4c038c1","modified":1546264912383},{"_id":"public/2017/08/18/mediawiki/index.html","hash":"320146cb3edf16c3d89db9e16980014e8bda21ae","modified":1546264912383},{"_id":"public/2017/08/10/Jenkins/index.html","hash":"c7a0836d839dde0fed924e3b9e17b8698812ed9c","modified":1546264912383},{"_id":"public/2017/08/17/mysql配置项修改/index.html","hash":"b8aa3427402ae6f0f136cd50839bb9c4db6d1b4f","modified":1546264912383},{"_id":"public/2017/08/17/LNMP环境部署/index.html","hash":"4ac30581f1fba3b54d7cc0da6b0ebee786677537","modified":1546264912383},{"_id":"public/2017/08/09/启用ssl/index.html","hash":"8872b71969a87315677e9cceb97c011515bb2426","modified":1546264912383},{"_id":"public/2017/08/07/Android自动打包/index.html","hash":"6c01546628bee7c1e331b6c0bd878f19c58235a2","modified":1546264912383},{"_id":"public/2017/08/02/安装配置gitlab/index.html","hash":"3ae3176ba6e577e9ad75c4eafcf5fa9bbad21475","modified":1546264912383},{"_id":"public/2017/05/16/ubuntu发送邮件/index.html","hash":"3344603086f75ee6b242d6901355506dd708b677","modified":1546264912383},{"_id":"public/2017/04/01/更换linux系统的home磁盘/index.html","hash":"d37d8113ee590cde510903dd459b626389d0612f","modified":1546264912383},{"_id":"public/2017/03/25/linux系统监控基本命令/index.html","hash":"54a60d70bf8251c65c0c2c630bdc546df72e28fe","modified":1546264912383},{"_id":"public/2017/03/23/python字符串处理/index.html","hash":"ae73038a64d9ddeb2f57534296517c29ab1d7484","modified":1546264912383},{"_id":"public/2017/03/22/python文件处理/index.html","hash":"cb173dbeb495b1e868534da2d9b70f36f0783ee4","modified":1546264912383},{"_id":"public/2017/03/22/git-tag操作/index.html","hash":"b4ae1137e31f4e94161cce2691e2f4363eec2cae","modified":1546264912383},{"_id":"public/2017/03/20/python用户交互/index.html","hash":"2987b96b29948ed9f404dd436434e7f6ea20b36d","modified":1546264912383},{"_id":"public/2017/03/20/python使用和导入模块/index.html","hash":"6a3fbb57f5859e2330c7a091f0c369da3ae970b4","modified":1546264912384},{"_id":"public/2017/03/20/python字符编码/index.html","hash":"d9050d227d655087e893430c0e7120ee1f6a65f0","modified":1546264912384},{"_id":"public/2017/03/13/ceph/index.html","hash":"3d6c05e6723e30fea97a373aed94648fe8658d1d","modified":1546264912384},{"_id":"public/2017/02/27/docker-registry/index.html","hash":"3e221d00dadff76cf4aa06fa55994e953e119516","modified":1546264912384},{"_id":"public/2017/02/27/docker容器/index.html","hash":"ca40868d4a87483336625fb29259e443cce48015","modified":1546264912384},{"_id":"public/2017/02/27/docker镜像/index.html","hash":"cc38b08f0c66c3d8f911f0210e43eb1e8ccaa40d","modified":1546264912384},{"_id":"public/2017/02/27/docker安装/index.html","hash":"222148e4b08777853947902511532676ce657c5f","modified":1546264912384},{"_id":"public/2017/02/07/ubuntu指定默认编辑器/index.html","hash":"7632844ce4d33a56806001511f3666c3a608e78d","modified":1546264912384},{"_id":"public/2017/02/07/ubuntu修改网卡名称/index.html","hash":"913208c2cdc3b7fe15dd6d5fb82b31a5938edbe4","modified":1546264912384},{"_id":"public/2017/02/14/linux添加swap/index.html","hash":"edb5eb84fd2c087026ee42850b09b3c6c9d9b553","modified":1546264912384},{"_id":"public/2017/02/07/python指定字符编码/index.html","hash":"d3cbe0083f1dff2cbd8bde82896dd35dd3fe5286","modified":1546264912384},{"_id":"public/2017/01/22/ubuntu安装powerline字体/index.html","hash":"96cd2e53a0c967e91e222f1e773bfd66c62f83bc","modified":1546264912384},{"_id":"public/2017/01/20/ubuntu安装为知笔记/index.html","hash":"2985ae88f5b14eaa3f5fa85266167df6bcf69d99","modified":1546264912384},{"_id":"public/2017/01/19/tmux安装配置使用/index.html","hash":"c1eef1048c2e9e7b0d77d4a29c13a399110f106d","modified":1546264912384},{"_id":"public/2017/01/14/git-cherry-pick/index.html","hash":"12bd4afc79794bca57616c0a62cf9ac295cbf96c","modified":1546264912384},{"_id":"public/2017/01/12/git-分支操作/index.html","hash":"50a80f6611ac8cfa020a35ae1c6b49bb11812be1","modified":1546264912384},{"_id":"public/2017/01/12/shell-style-guide/index.html","hash":"1a21c64d8c9be2179bf4aa17de384572fc9e6851","modified":1546264912384},{"_id":"public/2017/01/12/vim-surround插件/index.html","hash":"f15b87544f75d0c7bf8d0f0330125cd5716a53cd","modified":1546264912384},{"_id":"public/2017/01/11/修改最后一次commit/index.html","hash":"c20e5414024ff39316f73a904a86a2305be2c784","modified":1546264912385},{"_id":"public/2017/01/11/git-基本操作/index.html","hash":"a35fb7a2859c4802677ce7823cd5ea03dcf08ace","modified":1546264912385},{"_id":"public/2017/01/11/hello-world/index.html","hash":"6eb5525d7701ea3b68590be721aee91c0d4d9033","modified":1546264912385},{"_id":"public/archives/index.html","hash":"3b2b3788656cdda04fcee507b0f134c4906271ef","modified":1546264912385},{"_id":"public/archives/page/2/index.html","hash":"eb035646ffad4cf543ec7199c60cf3bf1b54033c","modified":1546264912385},{"_id":"public/archives/page/3/index.html","hash":"1fa52220bd97d0cd4424c008003f450fbd1f9e3a","modified":1546264912385},{"_id":"public/archives/page/4/index.html","hash":"c3a68cd66f1078104c96cb57c2e090eb1b0c8c28","modified":1546264912385},{"_id":"public/archives/page/5/index.html","hash":"dc2bee6d70257ddc2bbdc2aca02ef150c8d4a052","modified":1546264912385},{"_id":"public/archives/2017/index.html","hash":"a9af463ab550ade5aabd47bfcdaf3b88e406a941","modified":1546264912385},{"_id":"public/archives/2017/page/2/index.html","hash":"656b217881d71854458e2d77c9ec27cfd187198b","modified":1546264912385},{"_id":"public/archives/2017/page/3/index.html","hash":"752934328a1873f2b621753ad40e484a07b34085","modified":1546264912385},{"_id":"public/archives/2017/page/4/index.html","hash":"e80b48f11524080f07b3f3e86b6ec15aa651c977","modified":1546264912385},{"_id":"public/archives/2017/01/index.html","hash":"0320b929432623d46b8b96af261a79b7b8665348","modified":1546264912385},{"_id":"public/archives/2017/02/index.html","hash":"95e9cc42542d7fb3547d9fe258ecd76aa132a670","modified":1546264912385},{"_id":"public/archives/2017/03/index.html","hash":"0dc746fba84b0ef3b61070148498b3a4a2517bf6","modified":1546264912385},{"_id":"public/archives/2017/04/index.html","hash":"ba1fdca1e98a42399af8b67ccd24513ac26c7272","modified":1546264912385},{"_id":"public/archives/2017/05/index.html","hash":"926f798613b28015aa3342702cf9e699def02da6","modified":1546264912386},{"_id":"public/archives/2017/08/index.html","hash":"3b95921c2ea2d35872cb7af35ca0c441899ce02b","modified":1546264912386},{"_id":"public/archives/2017/09/index.html","hash":"f6c8408196c205b91bde2f842cd5387321f5f3ca","modified":1546264912386},{"_id":"public/archives/2018/index.html","hash":"ab8ae20236b69fa6c46735b00c96fbc09836a6bb","modified":1546264912386},{"_id":"public/archives/2018/05/index.html","hash":"be7be15d51f32ad8201a001a1f5331339369ab3c","modified":1546264912386},{"_id":"public/archives/2018/10/index.html","hash":"057f495e6343333f1b1c860a8120a0ba517fd676","modified":1546264912386},{"_id":"public/archives/2018/12/index.html","hash":"80948449af123d53915d235408442d870c3cc66b","modified":1546264912386},{"_id":"public/categories/git/index.html","hash":"bf612b20b95ada40364f8f159896c1028545e51e","modified":1546264912386},{"_id":"public/categories/ceph/index.html","hash":"bd8a2fbb41f1d221b6832405c0a2c2db01c0826e","modified":1546264912386},{"_id":"public/categories/shell/index.html","hash":"0347390b17b5d512b1d863cd7cc829cd5938371d","modified":1546264912386},{"_id":"public/categories/vim/index.html","hash":"42089eb87fc21fc696daee225bb301ac0ecda0d8","modified":1546264912386},{"_id":"public/index.html","hash":"c7f3c534e4d63f84f7aff8feabe74a94807774ce","modified":1546264912386},{"_id":"public/page/2/index.html","hash":"408c763f9edb355d60301d62c0c4f1f35d8314c3","modified":1546264912386},{"_id":"public/page/3/index.html","hash":"749eb15d071764a028e5ba04d94aaed342cb8532","modified":1546264912386},{"_id":"public/page/4/index.html","hash":"ea27ca589c88daa0ae50739ded48513110587f8e","modified":1546264912386},{"_id":"public/page/5/index.html","hash":"dbacbe7642fe21f274d77ef040e195793fce2f16","modified":1546264912386},{"_id":"public/tags/android/index.html","hash":"37f122c8cd9d9cbd213848f96182bfd70c204edf","modified":1546264912387},{"_id":"public/tags/ceph/index.html","hash":"1553389b8cc5e1117b6bbf1e71123cb9e29df8f9","modified":1546264912387},{"_id":"public/tags/Redis/index.html","hash":"252c266b81c24d3f7a839135afe154778ad412a9","modified":1546264912387},{"_id":"public/tags/docker/index.html","hash":"06c0967e7f4ddd428a3021eefedf3fedd26c5e02","modified":1546264912387},{"_id":"public/tags/git/index.html","hash":"8cdd1e6f43dfcede5368cc464e3561a0703c442f","modified":1546264912387},{"_id":"public/tags/linux/index.html","hash":"961af95dd7633ecb682c62a0b0625bcf61935796","modified":1546264912387},{"_id":"public/tags/模拟/index.html","hash":"2f459a27da21e55436db7966f1d7c9718dadfa2b","modified":1546264912387},{"_id":"public/tags/mysql/index.html","hash":"a01af74e61a0c18bc2224dbb759c4f974530c1ad","modified":1546264912387},{"_id":"public/tags/nginx/index.html","hash":"b9ca0c9eab5d5822f2f9854c5e82cbed037e9c7f","modified":1546264912387},{"_id":"public/tags/python/index.html","hash":"898c93c763dafef49855fd29691b7c8035c6cbee","modified":1546264912387},{"_id":"public/tags/tmux/index.html","hash":"c7216333349759f4e4843c5448b1f7166dbf0a1b","modified":1546264912387},{"_id":"public/tags/ubuntu/index.html","hash":"2ed21c7cc39205546e1c5afff156db0131e81b58","modified":1546264912387},{"_id":"public/tags/shell/index.html","hash":"9770193689acec4598f43709cd40d407589bbc6c","modified":1546264912387},{"_id":"public/tags/vim插件/index.html","hash":"496981890451d96b8fb151687b59fdf2d8e65e28","modified":1546264912387},{"_id":"public/tags/ssl/index.html","hash":"cd574e97c9c9baa2acab8cc06768d5711f7c8501","modified":1546264912387},{"_id":"public/tags/gitlab/index.html","hash":"6d9c808e8c1f6ba7919a75f1e64fd03f108aa41f","modified":1546264912387},{"_id":"public/tags/supervisor/index.html","hash":"c7b7e57f6e2600b2770cc3da8b0bc74446315c33","modified":1546264912387},{"_id":"public/images/avatar.png","hash":"9e0f60789104d5f16fccfded12209468e5166a6b","modified":1546264830907},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1546264830907},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1546264830907},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1546264830907},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1546264830907},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1546264830907},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1546264830907},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1546264830907},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1546264830907},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1546264830908},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1546264830908},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1546264830908},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1546264830908},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1546264830908},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1546264830908},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1546264830908},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1546264830908},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1546264830908},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1546264830908},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1546264830908},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1546264830908},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1546264831271},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1546264831273},{"_id":"public/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1546264831314},{"_id":"public/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1546264831314},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1546264831315},{"_id":"public/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1546264831315},{"_id":"public/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1546264831315},{"_id":"public/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1546264831315},{"_id":"public/js/src/motion.js","hash":"3acaae96da453dcd03e4cbd301d81748f86ae95a","modified":1546264831315},{"_id":"public/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1546264831315},{"_id":"public/js/src/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1546264831315},{"_id":"public/js/src/utils.js","hash":"cac98e1d497673f7a5bb665c90cd5db6164547d1","modified":1546264831315},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1546264831315},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1546264831315},{"_id":"public/js/src/schemes/pisces.js","hash":"958f3a70ea684264f23054d37d5e744a32c2e68a","modified":1546264831315},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1546264831315},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1546264831316},{"_id":"public/css/main.css","hash":"9c21789942b9201d7eed3826012e58d49c0150a7","modified":1546264831316},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1546264831316},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1546264831316},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1546264831316},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1546264831316},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1546264831316},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1546264831316},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1546264831316}],"Category":[{"name":"ceph","_id":"cjqce5j4m000czahi75wtzw1e"},{"name":"git","_id":"cjqce5j4s000qzahii20ck74e"},{"name":"shell","_id":"cjqce5j59001zzahi50bsal3u"},{"name":"vim","_id":"cjqce5j5d002bzahiiz6cjbj5"}],"Data":[],"Page":[{"title":"about","date":"2016-12-30T07:35:29.000Z","type":"about","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2016-12-30 15:35:29\ntype: about\n---\n","updated":"2016-12-30T07:35:42.000Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjqce5j4e0001zahibg34hsau","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"categories","date":"2016-12-30T07:34:38.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-12-30 15:34:38\ntype: categories\n---\n","updated":"2016-12-30T07:34:59.000Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjqce5j4g0003zahi1c58qj4a","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2016-12-30T07:35:06.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-12-30 15:35:06\ntype: tags\n---\n","updated":"2016-12-30T07:35:21.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjqce5j9r003mzahiqx64bnj1","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Android自动打包","date":"2017-08-07T12:19:01.000Z","_content":"\n## 1. 配置Java环境\n### 1.1 自行从网络下载jdk并配置环境变量\n```\n:~$ vi .bashrc\n# set oracle jdk environment\nexport JAVA_HOME=/home/USERNAME/opt/jdk-1.8.0\nexport CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$CLASSPATH\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\n```\n\n### 1.2 生效配置\n```\n:~$ source ~/.bashrc\n```\n\n### 1.3 验证\n```\n:~$ java -version\njava version \"1.8.0_181\"\nJava(TM) SE Runtime Environment (build 1.8.0_181-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)\n```\n\n## 2. 配置命令行工具\n你可以使用命令行工具里的sdkmanager下载其他的SDK包。\n\n### 2.1 下载\n默认tools已经包含在Android Studio里了，如果你没有使用Android Studio，请访问[studio](https://developer.android.com/studio/index.html)下载相应的命令行工具包。\n[linux版](https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip)\n\n```\n:~$ mkdir opt/android/\n:~$ cd opt/android\n:~/opt/android$ wget https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip\n```\n\n### 2.2 解压\n```\n:~/opt/android$ unzip sdk-tools-linux-3859397.zip\n:~/opt/android$ cd tools/bin/\n:~/opt/android/tools/bin$ \n```\n\n### 2.3 安装SDK\n```\n:~/opt/android/tools/bin$ mkdir /home/USERNAME/opt/android/sdk\n:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk \"build-tools;23.0.2\"\n:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk \"platforms;android-23\"\n```\n命令成功执行后  \n会在`/home/USERNAME/opt/android/sdk`目录下，生成`build-tools`目录  \n会在`/home/USERNAME/opt/android/sdk`目录下，生成`platforms`目录\n\n```\n:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/build-tools\n23.0.2\n:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/platforms\nandroid-23\n```\n\n### 2.4 添加环境变量\n```\n:~/opt/android/tools/bin$ vi ~/.bashrc\n```\n添加如下内容\n```\n# set android SDK environment\nexport ANDROID_HOME=/home/USERNAME/opt/android\nexport PATH=$PATH:$ANDROID_HOME/tools\n```\n\n## 3. 安装gradle\n\n### 3.1 下载gradle\n[distributions链接](http://services.gradle.org/distributions/)  \n[gradle-3.3-all链接](http://downloads.gradle.org/distributions/gradle-3.3-all.zip)\n\n```\n:~$ cd opt\n:~/opt$ wget http://downloads.gradle.org/distributions/gradle-3.3-all.zip\n```\n\n### 3.2 解压gradle\n```\n~/opt$ unzip gradle-3.3-all.zip\n```\n\n### 3.3 配置环境变量\n```\n~/opt$ vi ~/.bashrc\n```\n添加如下内容\n```\n# set gradle environment\nexport GRADLE_HOME=/home/USERNAME/opt/gradle-3.3\nexport PATH=$GRADLE_HOME/bin:$PATH\n```\n\n### 3.4 生效配置\n```\n~/opt$ source ~/.bashrc\n```\n\n## 4. 打包应用\n进入android项目所在目录，执行`gradle assembleRelease`即可自动打包应用。  \ngradle在打包的过程中会自动下载所需要的依赖(默认会下载到`~/.gradle`目录)，速度可能比较慢，尤其是第一次执行，耐心等待即可。\n\n另外，在执行过程中可能会报如下错误\n```\nFAILURE: Build failed with an exception.\n\n* What went wrong:\nA problem occurred configuring project ':app'.\n> Could not resolve all dependencies for configuration ':app:_debugApk'.\n   > A problem occurred configuring project ':weexplugin'.\n      > Could not resolve all dependencies for configuration ':weexplugin:_debugCompileCopy'.\n         > Could not find com.android.support:support-v4:23.1.1.\n           Required by:\n               project :weexplugin\n               project :weexplugin > com.android.support:appcompat-v7:23.1.1\n\n* Try:\nRun with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.\n\nBUILD FAILED\n```\n执行如下命令接受证书，即可解决\n```\n:~/opt/android/tools/bin$ ./sdkmanager --licenses\n```\n\n## 5. 加固app\n使用各个android软件平台的加固工具或者脚本上传到对应的平台进行加固即可\n```\n:~/opt$ cd /home/USERNAME/platforms/xxx.mobile.web/platforms/android\n:android$ bash jiagu.sh\n:android$ cd /home/USERNAME/opt/android/apk\n:~/opt/android/apk$ ls\napp-release_101_jiagu_sign.apk\n```\n加固完成，即可进行发布上架。\n\n","source":"_posts/Android自动打包.md","raw":"---\ntitle: Android自动打包\ndate: 2017-08-07 20:19:01\ntags: android\n---\n\n## 1. 配置Java环境\n### 1.1 自行从网络下载jdk并配置环境变量\n```\n:~$ vi .bashrc\n# set oracle jdk environment\nexport JAVA_HOME=/home/USERNAME/opt/jdk-1.8.0\nexport CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$CLASSPATH\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\n```\n\n### 1.2 生效配置\n```\n:~$ source ~/.bashrc\n```\n\n### 1.3 验证\n```\n:~$ java -version\njava version \"1.8.0_181\"\nJava(TM) SE Runtime Environment (build 1.8.0_181-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)\n```\n\n## 2. 配置命令行工具\n你可以使用命令行工具里的sdkmanager下载其他的SDK包。\n\n### 2.1 下载\n默认tools已经包含在Android Studio里了，如果你没有使用Android Studio，请访问[studio](https://developer.android.com/studio/index.html)下载相应的命令行工具包。\n[linux版](https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip)\n\n```\n:~$ mkdir opt/android/\n:~$ cd opt/android\n:~/opt/android$ wget https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip\n```\n\n### 2.2 解压\n```\n:~/opt/android$ unzip sdk-tools-linux-3859397.zip\n:~/opt/android$ cd tools/bin/\n:~/opt/android/tools/bin$ \n```\n\n### 2.3 安装SDK\n```\n:~/opt/android/tools/bin$ mkdir /home/USERNAME/opt/android/sdk\n:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk \"build-tools;23.0.2\"\n:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk \"platforms;android-23\"\n```\n命令成功执行后  \n会在`/home/USERNAME/opt/android/sdk`目录下，生成`build-tools`目录  \n会在`/home/USERNAME/opt/android/sdk`目录下，生成`platforms`目录\n\n```\n:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/build-tools\n23.0.2\n:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/platforms\nandroid-23\n```\n\n### 2.4 添加环境变量\n```\n:~/opt/android/tools/bin$ vi ~/.bashrc\n```\n添加如下内容\n```\n# set android SDK environment\nexport ANDROID_HOME=/home/USERNAME/opt/android\nexport PATH=$PATH:$ANDROID_HOME/tools\n```\n\n## 3. 安装gradle\n\n### 3.1 下载gradle\n[distributions链接](http://services.gradle.org/distributions/)  \n[gradle-3.3-all链接](http://downloads.gradle.org/distributions/gradle-3.3-all.zip)\n\n```\n:~$ cd opt\n:~/opt$ wget http://downloads.gradle.org/distributions/gradle-3.3-all.zip\n```\n\n### 3.2 解压gradle\n```\n~/opt$ unzip gradle-3.3-all.zip\n```\n\n### 3.3 配置环境变量\n```\n~/opt$ vi ~/.bashrc\n```\n添加如下内容\n```\n# set gradle environment\nexport GRADLE_HOME=/home/USERNAME/opt/gradle-3.3\nexport PATH=$GRADLE_HOME/bin:$PATH\n```\n\n### 3.4 生效配置\n```\n~/opt$ source ~/.bashrc\n```\n\n## 4. 打包应用\n进入android项目所在目录，执行`gradle assembleRelease`即可自动打包应用。  \ngradle在打包的过程中会自动下载所需要的依赖(默认会下载到`~/.gradle`目录)，速度可能比较慢，尤其是第一次执行，耐心等待即可。\n\n另外，在执行过程中可能会报如下错误\n```\nFAILURE: Build failed with an exception.\n\n* What went wrong:\nA problem occurred configuring project ':app'.\n> Could not resolve all dependencies for configuration ':app:_debugApk'.\n   > A problem occurred configuring project ':weexplugin'.\n      > Could not resolve all dependencies for configuration ':weexplugin:_debugCompileCopy'.\n         > Could not find com.android.support:support-v4:23.1.1.\n           Required by:\n               project :weexplugin\n               project :weexplugin > com.android.support:appcompat-v7:23.1.1\n\n* Try:\nRun with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.\n\nBUILD FAILED\n```\n执行如下命令接受证书，即可解决\n```\n:~/opt/android/tools/bin$ ./sdkmanager --licenses\n```\n\n## 5. 加固app\n使用各个android软件平台的加固工具或者脚本上传到对应的平台进行加固即可\n```\n:~/opt$ cd /home/USERNAME/platforms/xxx.mobile.web/platforms/android\n:android$ bash jiagu.sh\n:android$ cd /home/USERNAME/opt/android/apk\n:~/opt/android/apk$ ls\napp-release_101_jiagu_sign.apk\n```\n加固完成，即可进行发布上架。\n\n","slug":"Android自动打包","published":1,"updated":"2018-12-08T07:44:26.089Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4b0000zahik44qqs11","content":"<h2 id=\"1-配置Java环境\"><a href=\"#1-配置Java环境\" class=\"headerlink\" title=\"1. 配置Java环境\"></a>1. 配置Java环境</h2><h3 id=\"1-1-自行从网络下载jdk并配置环境变量\"><a href=\"#1-1-自行从网络下载jdk并配置环境变量\" class=\"headerlink\" title=\"1.1 自行从网络下载jdk并配置环境变量\"></a>1.1 自行从网络下载jdk并配置环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ vi .bashrc</span><br><span class=\"line\"># set oracle jdk environment</span><br><span class=\"line\">export JAVA_HOME=/home/USERNAME/opt/jdk-1.8.0</span><br><span class=\"line\">export CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$CLASSPATH</span><br><span class=\"line\">export PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-生效配置\"><a href=\"#1-2-生效配置\" class=\"headerlink\" title=\"1.2 生效配置\"></a>1.2 生效配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ source ~/.bashrc</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-3-验证\"><a href=\"#1-3-验证\" class=\"headerlink\" title=\"1.3 验证\"></a>1.3 验证</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ java -version</span><br><span class=\"line\">java version &quot;1.8.0_181&quot;</span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-配置命令行工具\"><a href=\"#2-配置命令行工具\" class=\"headerlink\" title=\"2. 配置命令行工具\"></a>2. 配置命令行工具</h2><p>你可以使用命令行工具里的sdkmanager下载其他的SDK包。</p>\n<h3 id=\"2-1-下载\"><a href=\"#2-1-下载\" class=\"headerlink\" title=\"2.1 下载\"></a>2.1 下载</h3><p>默认tools已经包含在Android Studio里了，如果你没有使用Android Studio，请访问<a href=\"https://developer.android.com/studio/index.html\" target=\"_blank\" rel=\"noopener\">studio</a>下载相应的命令行工具包。<br><a href=\"https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip\" target=\"_blank\" rel=\"noopener\">linux版</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ mkdir opt/android/</span><br><span class=\"line\">:~$ cd opt/android</span><br><span class=\"line\">:~/opt/android$ wget https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-解压\"><a href=\"#2-2-解压\" class=\"headerlink\" title=\"2.2 解压\"></a>2.2 解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android$ unzip sdk-tools-linux-3859397.zip</span><br><span class=\"line\">:~/opt/android$ cd tools/bin/</span><br><span class=\"line\">:~/opt/android/tools/bin$</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-安装SDK\"><a href=\"#2-3-安装SDK\" class=\"headerlink\" title=\"2.3 安装SDK\"></a>2.3 安装SDK</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ mkdir /home/USERNAME/opt/android/sdk</span><br><span class=\"line\">:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk &quot;build-tools;23.0.2&quot;</span><br><span class=\"line\">:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk &quot;platforms;android-23&quot;</span><br></pre></td></tr></table></figure>\n<p>命令成功执行后<br>会在<code>/home/USERNAME/opt/android/sdk</code>目录下，生成<code>build-tools</code>目录<br>会在<code>/home/USERNAME/opt/android/sdk</code>目录下，生成<code>platforms</code>目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/build-tools</span><br><span class=\"line\">23.0.2</span><br><span class=\"line\">:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/platforms</span><br><span class=\"line\">android-23</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-添加环境变量\"><a href=\"#2-4-添加环境变量\" class=\"headerlink\" title=\"2.4 添加环境变量\"></a>2.4 添加环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ vi ~/.bashrc</span><br></pre></td></tr></table></figure>\n<p>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set android SDK environment</span><br><span class=\"line\">export ANDROID_HOME=/home/USERNAME/opt/android</span><br><span class=\"line\">export PATH=$PATH:$ANDROID_HOME/tools</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-安装gradle\"><a href=\"#3-安装gradle\" class=\"headerlink\" title=\"3. 安装gradle\"></a>3. 安装gradle</h2><h3 id=\"3-1-下载gradle\"><a href=\"#3-1-下载gradle\" class=\"headerlink\" title=\"3.1 下载gradle\"></a>3.1 下载gradle</h3><p><a href=\"http://services.gradle.org/distributions/\" target=\"_blank\" rel=\"noopener\">distributions链接</a><br><a href=\"http://downloads.gradle.org/distributions/gradle-3.3-all.zip\" target=\"_blank\" rel=\"noopener\">gradle-3.3-all链接</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ cd opt</span><br><span class=\"line\">:~/opt$ wget http://downloads.gradle.org/distributions/gradle-3.3-all.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-解压gradle\"><a href=\"#3-2-解压gradle\" class=\"headerlink\" title=\"3.2 解压gradle\"></a>3.2 解压gradle</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/opt$ unzip gradle-3.3-all.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-配置环境变量\"><a href=\"#3-3-配置环境变量\" class=\"headerlink\" title=\"3.3 配置环境变量\"></a>3.3 配置环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/opt$ vi ~/.bashrc</span><br></pre></td></tr></table></figure>\n<p>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set gradle environment</span><br><span class=\"line\">export GRADLE_HOME=/home/USERNAME/opt/gradle-3.3</span><br><span class=\"line\">export PATH=$GRADLE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-4-生效配置\"><a href=\"#3-4-生效配置\" class=\"headerlink\" title=\"3.4 生效配置\"></a>3.4 生效配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/opt$ source ~/.bashrc</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-打包应用\"><a href=\"#4-打包应用\" class=\"headerlink\" title=\"4. 打包应用\"></a>4. 打包应用</h2><p>进入android项目所在目录，执行<code>gradle assembleRelease</code>即可自动打包应用。<br>gradle在打包的过程中会自动下载所需要的依赖(默认会下载到<code>~/.gradle</code>目录)，速度可能比较慢，尤其是第一次执行，耐心等待即可。</p>\n<p>另外，在执行过程中可能会报如下错误<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FAILURE: Build failed with an exception.</span><br><span class=\"line\"></span><br><span class=\"line\">* What went wrong:</span><br><span class=\"line\">A problem occurred configuring project &apos;:app&apos;.</span><br><span class=\"line\">&gt; Could not resolve all dependencies for configuration &apos;:app:_debugApk&apos;.</span><br><span class=\"line\">   &gt; A problem occurred configuring project &apos;:weexplugin&apos;.</span><br><span class=\"line\">      &gt; Could not resolve all dependencies for configuration &apos;:weexplugin:_debugCompileCopy&apos;.</span><br><span class=\"line\">         &gt; Could not find com.android.support:support-v4:23.1.1.</span><br><span class=\"line\">           Required by:</span><br><span class=\"line\">               project :weexplugin</span><br><span class=\"line\">               project :weexplugin &gt; com.android.support:appcompat-v7:23.1.1</span><br><span class=\"line\"></span><br><span class=\"line\">* Try:</span><br><span class=\"line\">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</span><br><span class=\"line\"></span><br><span class=\"line\">BUILD FAILED</span><br></pre></td></tr></table></figure></p>\n<p>执行如下命令接受证书，即可解决<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ ./sdkmanager --licenses</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"5-加固app\"><a href=\"#5-加固app\" class=\"headerlink\" title=\"5. 加固app\"></a>5. 加固app</h2><p>使用各个android软件平台的加固工具或者脚本上传到对应的平台进行加固即可<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt$ cd /home/USERNAME/platforms/xxx.mobile.web/platforms/android</span><br><span class=\"line\">:android$ bash jiagu.sh</span><br><span class=\"line\">:android$ cd /home/USERNAME/opt/android/apk</span><br><span class=\"line\">:~/opt/android/apk$ ls</span><br><span class=\"line\">app-release_101_jiagu_sign.apk</span><br></pre></td></tr></table></figure></p>\n<p>加固完成，即可进行发布上架。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-配置Java环境\"><a href=\"#1-配置Java环境\" class=\"headerlink\" title=\"1. 配置Java环境\"></a>1. 配置Java环境</h2><h3 id=\"1-1-自行从网络下载jdk并配置环境变量\"><a href=\"#1-1-自行从网络下载jdk并配置环境变量\" class=\"headerlink\" title=\"1.1 自行从网络下载jdk并配置环境变量\"></a>1.1 自行从网络下载jdk并配置环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ vi .bashrc</span><br><span class=\"line\"># set oracle jdk environment</span><br><span class=\"line\">export JAVA_HOME=/home/USERNAME/opt/jdk-1.8.0</span><br><span class=\"line\">export CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$CLASSPATH</span><br><span class=\"line\">export PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-生效配置\"><a href=\"#1-2-生效配置\" class=\"headerlink\" title=\"1.2 生效配置\"></a>1.2 生效配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ source ~/.bashrc</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-3-验证\"><a href=\"#1-3-验证\" class=\"headerlink\" title=\"1.3 验证\"></a>1.3 验证</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ java -version</span><br><span class=\"line\">java version &quot;1.8.0_181&quot;</span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-配置命令行工具\"><a href=\"#2-配置命令行工具\" class=\"headerlink\" title=\"2. 配置命令行工具\"></a>2. 配置命令行工具</h2><p>你可以使用命令行工具里的sdkmanager下载其他的SDK包。</p>\n<h3 id=\"2-1-下载\"><a href=\"#2-1-下载\" class=\"headerlink\" title=\"2.1 下载\"></a>2.1 下载</h3><p>默认tools已经包含在Android Studio里了，如果你没有使用Android Studio，请访问<a href=\"https://developer.android.com/studio/index.html\" target=\"_blank\" rel=\"noopener\">studio</a>下载相应的命令行工具包。<br><a href=\"https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip\" target=\"_blank\" rel=\"noopener\">linux版</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ mkdir opt/android/</span><br><span class=\"line\">:~$ cd opt/android</span><br><span class=\"line\">:~/opt/android$ wget https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-解压\"><a href=\"#2-2-解压\" class=\"headerlink\" title=\"2.2 解压\"></a>2.2 解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android$ unzip sdk-tools-linux-3859397.zip</span><br><span class=\"line\">:~/opt/android$ cd tools/bin/</span><br><span class=\"line\">:~/opt/android/tools/bin$</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-安装SDK\"><a href=\"#2-3-安装SDK\" class=\"headerlink\" title=\"2.3 安装SDK\"></a>2.3 安装SDK</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ mkdir /home/USERNAME/opt/android/sdk</span><br><span class=\"line\">:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk &quot;build-tools;23.0.2&quot;</span><br><span class=\"line\">:~/opt/android/tools/bin$ ./sdkmanager --sdk_root=/home/USERNAME/opt/android/sdk &quot;platforms;android-23&quot;</span><br></pre></td></tr></table></figure>\n<p>命令成功执行后<br>会在<code>/home/USERNAME/opt/android/sdk</code>目录下，生成<code>build-tools</code>目录<br>会在<code>/home/USERNAME/opt/android/sdk</code>目录下，生成<code>platforms</code>目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/build-tools</span><br><span class=\"line\">23.0.2</span><br><span class=\"line\">:~/opt/android/tools/bin$ ls /home/USERNAME/opt/android/sdk/platforms</span><br><span class=\"line\">android-23</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-添加环境变量\"><a href=\"#2-4-添加环境变量\" class=\"headerlink\" title=\"2.4 添加环境变量\"></a>2.4 添加环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ vi ~/.bashrc</span><br></pre></td></tr></table></figure>\n<p>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set android SDK environment</span><br><span class=\"line\">export ANDROID_HOME=/home/USERNAME/opt/android</span><br><span class=\"line\">export PATH=$PATH:$ANDROID_HOME/tools</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-安装gradle\"><a href=\"#3-安装gradle\" class=\"headerlink\" title=\"3. 安装gradle\"></a>3. 安装gradle</h2><h3 id=\"3-1-下载gradle\"><a href=\"#3-1-下载gradle\" class=\"headerlink\" title=\"3.1 下载gradle\"></a>3.1 下载gradle</h3><p><a href=\"http://services.gradle.org/distributions/\" target=\"_blank\" rel=\"noopener\">distributions链接</a><br><a href=\"http://downloads.gradle.org/distributions/gradle-3.3-all.zip\" target=\"_blank\" rel=\"noopener\">gradle-3.3-all链接</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ cd opt</span><br><span class=\"line\">:~/opt$ wget http://downloads.gradle.org/distributions/gradle-3.3-all.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-解压gradle\"><a href=\"#3-2-解压gradle\" class=\"headerlink\" title=\"3.2 解压gradle\"></a>3.2 解压gradle</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/opt$ unzip gradle-3.3-all.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-配置环境变量\"><a href=\"#3-3-配置环境变量\" class=\"headerlink\" title=\"3.3 配置环境变量\"></a>3.3 配置环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/opt$ vi ~/.bashrc</span><br></pre></td></tr></table></figure>\n<p>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set gradle environment</span><br><span class=\"line\">export GRADLE_HOME=/home/USERNAME/opt/gradle-3.3</span><br><span class=\"line\">export PATH=$GRADLE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-4-生效配置\"><a href=\"#3-4-生效配置\" class=\"headerlink\" title=\"3.4 生效配置\"></a>3.4 生效配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/opt$ source ~/.bashrc</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-打包应用\"><a href=\"#4-打包应用\" class=\"headerlink\" title=\"4. 打包应用\"></a>4. 打包应用</h2><p>进入android项目所在目录，执行<code>gradle assembleRelease</code>即可自动打包应用。<br>gradle在打包的过程中会自动下载所需要的依赖(默认会下载到<code>~/.gradle</code>目录)，速度可能比较慢，尤其是第一次执行，耐心等待即可。</p>\n<p>另外，在执行过程中可能会报如下错误<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FAILURE: Build failed with an exception.</span><br><span class=\"line\"></span><br><span class=\"line\">* What went wrong:</span><br><span class=\"line\">A problem occurred configuring project &apos;:app&apos;.</span><br><span class=\"line\">&gt; Could not resolve all dependencies for configuration &apos;:app:_debugApk&apos;.</span><br><span class=\"line\">   &gt; A problem occurred configuring project &apos;:weexplugin&apos;.</span><br><span class=\"line\">      &gt; Could not resolve all dependencies for configuration &apos;:weexplugin:_debugCompileCopy&apos;.</span><br><span class=\"line\">         &gt; Could not find com.android.support:support-v4:23.1.1.</span><br><span class=\"line\">           Required by:</span><br><span class=\"line\">               project :weexplugin</span><br><span class=\"line\">               project :weexplugin &gt; com.android.support:appcompat-v7:23.1.1</span><br><span class=\"line\"></span><br><span class=\"line\">* Try:</span><br><span class=\"line\">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</span><br><span class=\"line\"></span><br><span class=\"line\">BUILD FAILED</span><br></pre></td></tr></table></figure></p>\n<p>执行如下命令接受证书，即可解决<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt/android/tools/bin$ ./sdkmanager --licenses</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"5-加固app\"><a href=\"#5-加固app\" class=\"headerlink\" title=\"5. 加固app\"></a>5. 加固app</h2><p>使用各个android软件平台的加固工具或者脚本上传到对应的平台进行加固即可<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~/opt$ cd /home/USERNAME/platforms/xxx.mobile.web/platforms/android</span><br><span class=\"line\">:android$ bash jiagu.sh</span><br><span class=\"line\">:android$ cd /home/USERNAME/opt/android/apk</span><br><span class=\"line\">:~/opt/android/apk$ ls</span><br><span class=\"line\">app-release_101_jiagu_sign.apk</span><br></pre></td></tr></table></figure></p>\n<p>加固完成，即可进行发布上架。</p>\n"},{"title":"Jenkins","date":"2017-08-10T13:47:34.000Z","_content":"Jenkins是一个开源的、提供友好操作界面的持续集成(CI)工具，起源于Hudson（Hudson是商用的），主要用于持续、自动的构建/测试软件项目。\n## 1. 安装\n\n### 1.1 配置Java环境\n- [下载jdk](https://www.oracle.com/technetwork/java/javase/downloads/index.html)\n- 解压\n- 配置环境变量`PATH`\n\n### 1.2 下载Jenkins\n[下载地址](https://jenkins.io/download/)\n\n### 1.2 配置安装Jenkins\n- `Jenkins`默认将数据存放到`～/.jenkins`，在环境变量配置文件中添加`export JENKINS_HOME=/mnt/data/jenkins/`即可修改。\n- 在终端中执行`java -jar jenkins.war [--httpPort|--httpsPort=PortNumber]`,默认端口为8080。\n- 浏览器访问http://localhost:8080根据提示配置即可。\n\n\n## 2. 配置发布\njenkins可以将`build`之后的状态反馈回到gitlab上，以便于开发人员及时知道自己的提交的代码的状态。\n### 2.1 添加一个新的credential\n`Jenkins` >> `Credentials` >> `System` >> `Global credentials(unrestricted)` >> `Add Credentials`  \n如下图所示：  \n![](1.add_new_credentials.png)\n设置完成后，可以看到`credentials`列表  \n\n![](2.global_credentials_list.png)\n\n### 2.2 在gitlab中生成API Token\n设置了私钥，Jenkins就可以通过ssh连接git的host,我们还需要为Jenkins设置gitlab的`API Access Token`  \n点击用户头像-> `setting` -> `Profile` -> `Access Tokens` \n\n![](3.gitlab_add_api_token.png)\n\n### 2.3 在Jenkins中添加刚才生成的API Token\n![](4.jenkins_add_api_token.png)\n\n### 2.4 配置Jenkins和gitlab之间的连接\n在Jenkins中`Manage Jenkins` -> `Configure System`设置  \n\n![](5.jenkins_conn_gitlab.png)  \n配置完成，点击`Test Connection`测试下，出现如图所示的Success表示成功。\n\n### 2.5 新建一个FreeStyle的Job\n![](6.source_code_manage.png)  \n\nRefspec的值填写如下内容\n```\n+refs/heads/*:refs/remotes/origin/* +refs/merge-requests/*/head:refs/remotes/origin/merge-requests/*\n```\nBranch to build可以填写\n```\norigin/${gitlabSourceBranch}\n```\n也可以填写具体的某一个分支。\n\n### 2.6 设置build触发器\n设置某一种build触发方式  \n![](7.build_trigger.png)\n红色框起来的内容就是要在gitlab配置webhook时填写的链接。\n\n### 2.7 添加build完成之后的动作\n需要gitlab 8.1以上的版本  \n![](8.add_post-build_action.png)\n\n### 2.8 在gitlab上添加webhook\n![](9.add_web_hook.png)\n\n\n### 2.9 提交代码之后 可以查看代码的状态\n![](10.see_the_commit_status_in_gitlab.png)\n\n\n### 2.10 配置Jenkins \n通过Gitlab Authentication/Authorization策略\n\n### 2.10.1 在Gitlab里配置OAuth Provider \n[oauth provider](https://docs.gitlab.com/ce/integration/oauth_provider.html)\n- Name 随便写\n- Redirect URI 填写`https://jenkins.xxx.cn/securityRealm/finishLogin`\n点击`Submit`会生成`Application Id`和`Secret`\n\n### 2.10.2 在Jenkins里配置Authentication Strategy为Gitlab\n在`Jenkins` > `configureSecurity` > `Security Realm`选择`Gitlab Authentication Plugin`\n- GitLab Web URI 填写 https://gitlab.xxx.cn\n- GitLab API URI 填写 https://gitlab.xxx.cn\n- Client ID 填写上一步生成的`Application Id`\n- Client Secret 填写上一步生成的`Secret`\n\n### 2.10.3 开启ssl\nJenkins所在`java jetty server`需要开启SSL否则生成的`redirect_url`为`http`协议，并非`https`, 这样会导致OAuth失败，因为是无效的redirect url\n\n### 2.10.4 导入自签名证书\n因为使用的是自签名证书，Jenkins所使用的JVM需要将自签名证书导入到`certication trust store`中, 注意，证书的生成需要将`subject`与`hostname`关联起来，否则仍旧无法通过`ssl handshake`\n- 生成自签名证书参考《启用ssl》\n- 导入到证书\n```\ncd ~/opt/jdk-1.8.0 \n./bin/keytool --importcert -file /home/USERNAME/opt/nginx-1.9/conf/etc/xxx.crt -alias 'USERNAME-self-signed-crt'  -keystore /home/USERNAME/opt/jdk-1.8.0/jre/lib/security/cacert\n```\n\n## 3.日志\nJenkins的日志在`/var/log/USERNAME/jenkins.log`\n","source":"_posts/Jenkins.md","raw":"---\ntitle: Jenkins\ndate: 2017-08-10 21:47:34\ntags:\n---\nJenkins是一个开源的、提供友好操作界面的持续集成(CI)工具，起源于Hudson（Hudson是商用的），主要用于持续、自动的构建/测试软件项目。\n## 1. 安装\n\n### 1.1 配置Java环境\n- [下载jdk](https://www.oracle.com/technetwork/java/javase/downloads/index.html)\n- 解压\n- 配置环境变量`PATH`\n\n### 1.2 下载Jenkins\n[下载地址](https://jenkins.io/download/)\n\n### 1.2 配置安装Jenkins\n- `Jenkins`默认将数据存放到`～/.jenkins`，在环境变量配置文件中添加`export JENKINS_HOME=/mnt/data/jenkins/`即可修改。\n- 在终端中执行`java -jar jenkins.war [--httpPort|--httpsPort=PortNumber]`,默认端口为8080。\n- 浏览器访问http://localhost:8080根据提示配置即可。\n\n\n## 2. 配置发布\njenkins可以将`build`之后的状态反馈回到gitlab上，以便于开发人员及时知道自己的提交的代码的状态。\n### 2.1 添加一个新的credential\n`Jenkins` >> `Credentials` >> `System` >> `Global credentials(unrestricted)` >> `Add Credentials`  \n如下图所示：  \n![](1.add_new_credentials.png)\n设置完成后，可以看到`credentials`列表  \n\n![](2.global_credentials_list.png)\n\n### 2.2 在gitlab中生成API Token\n设置了私钥，Jenkins就可以通过ssh连接git的host,我们还需要为Jenkins设置gitlab的`API Access Token`  \n点击用户头像-> `setting` -> `Profile` -> `Access Tokens` \n\n![](3.gitlab_add_api_token.png)\n\n### 2.3 在Jenkins中添加刚才生成的API Token\n![](4.jenkins_add_api_token.png)\n\n### 2.4 配置Jenkins和gitlab之间的连接\n在Jenkins中`Manage Jenkins` -> `Configure System`设置  \n\n![](5.jenkins_conn_gitlab.png)  \n配置完成，点击`Test Connection`测试下，出现如图所示的Success表示成功。\n\n### 2.5 新建一个FreeStyle的Job\n![](6.source_code_manage.png)  \n\nRefspec的值填写如下内容\n```\n+refs/heads/*:refs/remotes/origin/* +refs/merge-requests/*/head:refs/remotes/origin/merge-requests/*\n```\nBranch to build可以填写\n```\norigin/${gitlabSourceBranch}\n```\n也可以填写具体的某一个分支。\n\n### 2.6 设置build触发器\n设置某一种build触发方式  \n![](7.build_trigger.png)\n红色框起来的内容就是要在gitlab配置webhook时填写的链接。\n\n### 2.7 添加build完成之后的动作\n需要gitlab 8.1以上的版本  \n![](8.add_post-build_action.png)\n\n### 2.8 在gitlab上添加webhook\n![](9.add_web_hook.png)\n\n\n### 2.9 提交代码之后 可以查看代码的状态\n![](10.see_the_commit_status_in_gitlab.png)\n\n\n### 2.10 配置Jenkins \n通过Gitlab Authentication/Authorization策略\n\n### 2.10.1 在Gitlab里配置OAuth Provider \n[oauth provider](https://docs.gitlab.com/ce/integration/oauth_provider.html)\n- Name 随便写\n- Redirect URI 填写`https://jenkins.xxx.cn/securityRealm/finishLogin`\n点击`Submit`会生成`Application Id`和`Secret`\n\n### 2.10.2 在Jenkins里配置Authentication Strategy为Gitlab\n在`Jenkins` > `configureSecurity` > `Security Realm`选择`Gitlab Authentication Plugin`\n- GitLab Web URI 填写 https://gitlab.xxx.cn\n- GitLab API URI 填写 https://gitlab.xxx.cn\n- Client ID 填写上一步生成的`Application Id`\n- Client Secret 填写上一步生成的`Secret`\n\n### 2.10.3 开启ssl\nJenkins所在`java jetty server`需要开启SSL否则生成的`redirect_url`为`http`协议，并非`https`, 这样会导致OAuth失败，因为是无效的redirect url\n\n### 2.10.4 导入自签名证书\n因为使用的是自签名证书，Jenkins所使用的JVM需要将自签名证书导入到`certication trust store`中, 注意，证书的生成需要将`subject`与`hostname`关联起来，否则仍旧无法通过`ssl handshake`\n- 生成自签名证书参考《启用ssl》\n- 导入到证书\n```\ncd ~/opt/jdk-1.8.0 \n./bin/keytool --importcert -file /home/USERNAME/opt/nginx-1.9/conf/etc/xxx.crt -alias 'USERNAME-self-signed-crt'  -keystore /home/USERNAME/opt/jdk-1.8.0/jre/lib/security/cacert\n```\n\n## 3.日志\nJenkins的日志在`/var/log/USERNAME/jenkins.log`\n","slug":"Jenkins","published":1,"updated":"2018-12-09T05:37:47.949Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4f0002zahianqqsgh1","content":"<p>Jenkins是一个开源的、提供友好操作界面的持续集成(CI)工具，起源于Hudson（Hudson是商用的），主要用于持续、自动的构建/测试软件项目。</p>\n<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><h3 id=\"1-1-配置Java环境\"><a href=\"#1-1-配置Java环境\" class=\"headerlink\" title=\"1.1 配置Java环境\"></a>1.1 配置Java环境</h3><ul>\n<li><a href=\"https://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">下载jdk</a></li>\n<li>解压</li>\n<li>配置环境变量<code>PATH</code></li>\n</ul>\n<h3 id=\"1-2-下载Jenkins\"><a href=\"#1-2-下载Jenkins\" class=\"headerlink\" title=\"1.2 下载Jenkins\"></a>1.2 下载Jenkins</h3><p><a href=\"https://jenkins.io/download/\" target=\"_blank\" rel=\"noopener\">下载地址</a></p>\n<h3 id=\"1-2-配置安装Jenkins\"><a href=\"#1-2-配置安装Jenkins\" class=\"headerlink\" title=\"1.2 配置安装Jenkins\"></a>1.2 配置安装Jenkins</h3><ul>\n<li><code>Jenkins</code>默认将数据存放到<code>～/.jenkins</code>，在环境变量配置文件中添加<code>export JENKINS_HOME=/mnt/data/jenkins/</code>即可修改。</li>\n<li>在终端中执行<code>java -jar jenkins.war [--httpPort|--httpsPort=PortNumber]</code>,默认端口为8080。</li>\n<li>浏览器访问<a href=\"http://localhost:8080根据提示配置即可。\" target=\"_blank\" rel=\"noopener\">http://localhost:8080根据提示配置即可。</a></li>\n</ul>\n<h2 id=\"2-配置发布\"><a href=\"#2-配置发布\" class=\"headerlink\" title=\"2. 配置发布\"></a>2. 配置发布</h2><p>jenkins可以将<code>build</code>之后的状态反馈回到gitlab上，以便于开发人员及时知道自己的提交的代码的状态。</p>\n<h3 id=\"2-1-添加一个新的credential\"><a href=\"#2-1-添加一个新的credential\" class=\"headerlink\" title=\"2.1 添加一个新的credential\"></a>2.1 添加一个新的credential</h3><p><code>Jenkins</code> &gt;&gt; <code>Credentials</code> &gt;&gt; <code>System</code> &gt;&gt; <code>Global credentials(unrestricted)</code> &gt;&gt; <code>Add Credentials</code><br>如下图所示：<br><img src=\"1.add_new_credentials.png\" alt=\"\"><br>设置完成后，可以看到<code>credentials</code>列表  </p>\n<p><img src=\"2.global_credentials_list.png\" alt=\"\"></p>\n<h3 id=\"2-2-在gitlab中生成API-Token\"><a href=\"#2-2-在gitlab中生成API-Token\" class=\"headerlink\" title=\"2.2 在gitlab中生成API Token\"></a>2.2 在gitlab中生成API Token</h3><p>设置了私钥，Jenkins就可以通过ssh连接git的host,我们还需要为Jenkins设置gitlab的<code>API Access Token</code><br>点击用户头像-&gt; <code>setting</code> -&gt; <code>Profile</code> -&gt; <code>Access Tokens</code> </p>\n<p><img src=\"3.gitlab_add_api_token.png\" alt=\"\"></p>\n<h3 id=\"2-3-在Jenkins中添加刚才生成的API-Token\"><a href=\"#2-3-在Jenkins中添加刚才生成的API-Token\" class=\"headerlink\" title=\"2.3 在Jenkins中添加刚才生成的API Token\"></a>2.3 在Jenkins中添加刚才生成的API Token</h3><p><img src=\"4.jenkins_add_api_token.png\" alt=\"\"></p>\n<h3 id=\"2-4-配置Jenkins和gitlab之间的连接\"><a href=\"#2-4-配置Jenkins和gitlab之间的连接\" class=\"headerlink\" title=\"2.4 配置Jenkins和gitlab之间的连接\"></a>2.4 配置Jenkins和gitlab之间的连接</h3><p>在Jenkins中<code>Manage Jenkins</code> -&gt; <code>Configure System</code>设置  </p>\n<p><img src=\"5.jenkins_conn_gitlab.png\" alt=\"\"><br>配置完成，点击<code>Test Connection</code>测试下，出现如图所示的Success表示成功。</p>\n<h3 id=\"2-5-新建一个FreeStyle的Job\"><a href=\"#2-5-新建一个FreeStyle的Job\" class=\"headerlink\" title=\"2.5 新建一个FreeStyle的Job\"></a>2.5 新建一个FreeStyle的Job</h3><p><img src=\"6.source_code_manage.png\" alt=\"\">  </p>\n<p>Refspec的值填写如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+refs/heads/*:refs/remotes/origin/* +refs/merge-requests/*/head:refs/remotes/origin/merge-requests/*</span><br></pre></td></tr></table></figure></p>\n<p>Branch to build可以填写<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">origin/$&#123;gitlabSourceBranch&#125;</span><br></pre></td></tr></table></figure></p>\n<p>也可以填写具体的某一个分支。</p>\n<h3 id=\"2-6-设置build触发器\"><a href=\"#2-6-设置build触发器\" class=\"headerlink\" title=\"2.6 设置build触发器\"></a>2.6 设置build触发器</h3><p>设置某一种build触发方式<br><img src=\"7.build_trigger.png\" alt=\"\"><br>红色框起来的内容就是要在gitlab配置webhook时填写的链接。</p>\n<h3 id=\"2-7-添加build完成之后的动作\"><a href=\"#2-7-添加build完成之后的动作\" class=\"headerlink\" title=\"2.7 添加build完成之后的动作\"></a>2.7 添加build完成之后的动作</h3><p>需要gitlab 8.1以上的版本<br><img src=\"8.add_post-build_action.png\" alt=\"\"></p>\n<h3 id=\"2-8-在gitlab上添加webhook\"><a href=\"#2-8-在gitlab上添加webhook\" class=\"headerlink\" title=\"2.8 在gitlab上添加webhook\"></a>2.8 在gitlab上添加webhook</h3><p><img src=\"9.add_web_hook.png\" alt=\"\"></p>\n<h3 id=\"2-9-提交代码之后-可以查看代码的状态\"><a href=\"#2-9-提交代码之后-可以查看代码的状态\" class=\"headerlink\" title=\"2.9 提交代码之后 可以查看代码的状态\"></a>2.9 提交代码之后 可以查看代码的状态</h3><p><img src=\"10.see_the_commit_status_in_gitlab.png\" alt=\"\"></p>\n<h3 id=\"2-10-配置Jenkins\"><a href=\"#2-10-配置Jenkins\" class=\"headerlink\" title=\"2.10 配置Jenkins\"></a>2.10 配置Jenkins</h3><p>通过Gitlab Authentication/Authorization策略</p>\n<h3 id=\"2-10-1-在Gitlab里配置OAuth-Provider\"><a href=\"#2-10-1-在Gitlab里配置OAuth-Provider\" class=\"headerlink\" title=\"2.10.1 在Gitlab里配置OAuth Provider\"></a>2.10.1 在Gitlab里配置OAuth Provider</h3><p><a href=\"https://docs.gitlab.com/ce/integration/oauth_provider.html\" target=\"_blank\" rel=\"noopener\">oauth provider</a></p>\n<ul>\n<li>Name 随便写</li>\n<li>Redirect URI 填写<code>https://jenkins.xxx.cn/securityRealm/finishLogin</code><br>点击<code>Submit</code>会生成<code>Application Id</code>和<code>Secret</code></li>\n</ul>\n<h3 id=\"2-10-2-在Jenkins里配置Authentication-Strategy为Gitlab\"><a href=\"#2-10-2-在Jenkins里配置Authentication-Strategy为Gitlab\" class=\"headerlink\" title=\"2.10.2 在Jenkins里配置Authentication Strategy为Gitlab\"></a>2.10.2 在Jenkins里配置Authentication Strategy为Gitlab</h3><p>在<code>Jenkins</code> &gt; <code>configureSecurity</code> &gt; <code>Security Realm</code>选择<code>Gitlab Authentication Plugin</code></p>\n<ul>\n<li>GitLab Web URI 填写 <a href=\"https://gitlab.xxx.cn\" target=\"_blank\" rel=\"noopener\">https://gitlab.xxx.cn</a></li>\n<li>GitLab API URI 填写 <a href=\"https://gitlab.xxx.cn\" target=\"_blank\" rel=\"noopener\">https://gitlab.xxx.cn</a></li>\n<li>Client ID 填写上一步生成的<code>Application Id</code></li>\n<li>Client Secret 填写上一步生成的<code>Secret</code></li>\n</ul>\n<h3 id=\"2-10-3-开启ssl\"><a href=\"#2-10-3-开启ssl\" class=\"headerlink\" title=\"2.10.3 开启ssl\"></a>2.10.3 开启ssl</h3><p>Jenkins所在<code>java jetty server</code>需要开启SSL否则生成的<code>redirect_url</code>为<code>http</code>协议，并非<code>https</code>, 这样会导致OAuth失败，因为是无效的redirect url</p>\n<h3 id=\"2-10-4-导入自签名证书\"><a href=\"#2-10-4-导入自签名证书\" class=\"headerlink\" title=\"2.10.4 导入自签名证书\"></a>2.10.4 导入自签名证书</h3><p>因为使用的是自签名证书，Jenkins所使用的JVM需要将自签名证书导入到<code>certication trust store</code>中, 注意，证书的生成需要将<code>subject</code>与<code>hostname</code>关联起来，否则仍旧无法通过<code>ssl handshake</code></p>\n<ul>\n<li>生成自签名证书参考《启用ssl》</li>\n<li>导入到证书<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/jdk-1.8.0 </span><br><span class=\"line\">./bin/keytool --importcert -file /home/USERNAME/opt/nginx-1.9/conf/etc/xxx.crt -alias &apos;USERNAME-self-signed-crt&apos;  -keystore /home/USERNAME/opt/jdk-1.8.0/jre/lib/security/cacert</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"3-日志\"><a href=\"#3-日志\" class=\"headerlink\" title=\"3.日志\"></a>3.日志</h2><p>Jenkins的日志在<code>/var/log/USERNAME/jenkins.log</code></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Jenkins是一个开源的、提供友好操作界面的持续集成(CI)工具，起源于Hudson（Hudson是商用的），主要用于持续、自动的构建/测试软件项目。</p>\n<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><h3 id=\"1-1-配置Java环境\"><a href=\"#1-1-配置Java环境\" class=\"headerlink\" title=\"1.1 配置Java环境\"></a>1.1 配置Java环境</h3><ul>\n<li><a href=\"https://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">下载jdk</a></li>\n<li>解压</li>\n<li>配置环境变量<code>PATH</code></li>\n</ul>\n<h3 id=\"1-2-下载Jenkins\"><a href=\"#1-2-下载Jenkins\" class=\"headerlink\" title=\"1.2 下载Jenkins\"></a>1.2 下载Jenkins</h3><p><a href=\"https://jenkins.io/download/\" target=\"_blank\" rel=\"noopener\">下载地址</a></p>\n<h3 id=\"1-2-配置安装Jenkins\"><a href=\"#1-2-配置安装Jenkins\" class=\"headerlink\" title=\"1.2 配置安装Jenkins\"></a>1.2 配置安装Jenkins</h3><ul>\n<li><code>Jenkins</code>默认将数据存放到<code>～/.jenkins</code>，在环境变量配置文件中添加<code>export JENKINS_HOME=/mnt/data/jenkins/</code>即可修改。</li>\n<li>在终端中执行<code>java -jar jenkins.war [--httpPort|--httpsPort=PortNumber]</code>,默认端口为8080。</li>\n<li>浏览器访问<a href=\"http://localhost:8080根据提示配置即可。\" target=\"_blank\" rel=\"noopener\">http://localhost:8080根据提示配置即可。</a></li>\n</ul>\n<h2 id=\"2-配置发布\"><a href=\"#2-配置发布\" class=\"headerlink\" title=\"2. 配置发布\"></a>2. 配置发布</h2><p>jenkins可以将<code>build</code>之后的状态反馈回到gitlab上，以便于开发人员及时知道自己的提交的代码的状态。</p>\n<h3 id=\"2-1-添加一个新的credential\"><a href=\"#2-1-添加一个新的credential\" class=\"headerlink\" title=\"2.1 添加一个新的credential\"></a>2.1 添加一个新的credential</h3><p><code>Jenkins</code> &gt;&gt; <code>Credentials</code> &gt;&gt; <code>System</code> &gt;&gt; <code>Global credentials(unrestricted)</code> &gt;&gt; <code>Add Credentials</code><br>如下图所示：<br><img src=\"1.add_new_credentials.png\" alt=\"\"><br>设置完成后，可以看到<code>credentials</code>列表  </p>\n<p><img src=\"2.global_credentials_list.png\" alt=\"\"></p>\n<h3 id=\"2-2-在gitlab中生成API-Token\"><a href=\"#2-2-在gitlab中生成API-Token\" class=\"headerlink\" title=\"2.2 在gitlab中生成API Token\"></a>2.2 在gitlab中生成API Token</h3><p>设置了私钥，Jenkins就可以通过ssh连接git的host,我们还需要为Jenkins设置gitlab的<code>API Access Token</code><br>点击用户头像-&gt; <code>setting</code> -&gt; <code>Profile</code> -&gt; <code>Access Tokens</code> </p>\n<p><img src=\"3.gitlab_add_api_token.png\" alt=\"\"></p>\n<h3 id=\"2-3-在Jenkins中添加刚才生成的API-Token\"><a href=\"#2-3-在Jenkins中添加刚才生成的API-Token\" class=\"headerlink\" title=\"2.3 在Jenkins中添加刚才生成的API Token\"></a>2.3 在Jenkins中添加刚才生成的API Token</h3><p><img src=\"4.jenkins_add_api_token.png\" alt=\"\"></p>\n<h3 id=\"2-4-配置Jenkins和gitlab之间的连接\"><a href=\"#2-4-配置Jenkins和gitlab之间的连接\" class=\"headerlink\" title=\"2.4 配置Jenkins和gitlab之间的连接\"></a>2.4 配置Jenkins和gitlab之间的连接</h3><p>在Jenkins中<code>Manage Jenkins</code> -&gt; <code>Configure System</code>设置  </p>\n<p><img src=\"5.jenkins_conn_gitlab.png\" alt=\"\"><br>配置完成，点击<code>Test Connection</code>测试下，出现如图所示的Success表示成功。</p>\n<h3 id=\"2-5-新建一个FreeStyle的Job\"><a href=\"#2-5-新建一个FreeStyle的Job\" class=\"headerlink\" title=\"2.5 新建一个FreeStyle的Job\"></a>2.5 新建一个FreeStyle的Job</h3><p><img src=\"6.source_code_manage.png\" alt=\"\">  </p>\n<p>Refspec的值填写如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+refs/heads/*:refs/remotes/origin/* +refs/merge-requests/*/head:refs/remotes/origin/merge-requests/*</span><br></pre></td></tr></table></figure></p>\n<p>Branch to build可以填写<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">origin/$&#123;gitlabSourceBranch&#125;</span><br></pre></td></tr></table></figure></p>\n<p>也可以填写具体的某一个分支。</p>\n<h3 id=\"2-6-设置build触发器\"><a href=\"#2-6-设置build触发器\" class=\"headerlink\" title=\"2.6 设置build触发器\"></a>2.6 设置build触发器</h3><p>设置某一种build触发方式<br><img src=\"7.build_trigger.png\" alt=\"\"><br>红色框起来的内容就是要在gitlab配置webhook时填写的链接。</p>\n<h3 id=\"2-7-添加build完成之后的动作\"><a href=\"#2-7-添加build完成之后的动作\" class=\"headerlink\" title=\"2.7 添加build完成之后的动作\"></a>2.7 添加build完成之后的动作</h3><p>需要gitlab 8.1以上的版本<br><img src=\"8.add_post-build_action.png\" alt=\"\"></p>\n<h3 id=\"2-8-在gitlab上添加webhook\"><a href=\"#2-8-在gitlab上添加webhook\" class=\"headerlink\" title=\"2.8 在gitlab上添加webhook\"></a>2.8 在gitlab上添加webhook</h3><p><img src=\"9.add_web_hook.png\" alt=\"\"></p>\n<h3 id=\"2-9-提交代码之后-可以查看代码的状态\"><a href=\"#2-9-提交代码之后-可以查看代码的状态\" class=\"headerlink\" title=\"2.9 提交代码之后 可以查看代码的状态\"></a>2.9 提交代码之后 可以查看代码的状态</h3><p><img src=\"10.see_the_commit_status_in_gitlab.png\" alt=\"\"></p>\n<h3 id=\"2-10-配置Jenkins\"><a href=\"#2-10-配置Jenkins\" class=\"headerlink\" title=\"2.10 配置Jenkins\"></a>2.10 配置Jenkins</h3><p>通过Gitlab Authentication/Authorization策略</p>\n<h3 id=\"2-10-1-在Gitlab里配置OAuth-Provider\"><a href=\"#2-10-1-在Gitlab里配置OAuth-Provider\" class=\"headerlink\" title=\"2.10.1 在Gitlab里配置OAuth Provider\"></a>2.10.1 在Gitlab里配置OAuth Provider</h3><p><a href=\"https://docs.gitlab.com/ce/integration/oauth_provider.html\" target=\"_blank\" rel=\"noopener\">oauth provider</a></p>\n<ul>\n<li>Name 随便写</li>\n<li>Redirect URI 填写<code>https://jenkins.xxx.cn/securityRealm/finishLogin</code><br>点击<code>Submit</code>会生成<code>Application Id</code>和<code>Secret</code></li>\n</ul>\n<h3 id=\"2-10-2-在Jenkins里配置Authentication-Strategy为Gitlab\"><a href=\"#2-10-2-在Jenkins里配置Authentication-Strategy为Gitlab\" class=\"headerlink\" title=\"2.10.2 在Jenkins里配置Authentication Strategy为Gitlab\"></a>2.10.2 在Jenkins里配置Authentication Strategy为Gitlab</h3><p>在<code>Jenkins</code> &gt; <code>configureSecurity</code> &gt; <code>Security Realm</code>选择<code>Gitlab Authentication Plugin</code></p>\n<ul>\n<li>GitLab Web URI 填写 <a href=\"https://gitlab.xxx.cn\" target=\"_blank\" rel=\"noopener\">https://gitlab.xxx.cn</a></li>\n<li>GitLab API URI 填写 <a href=\"https://gitlab.xxx.cn\" target=\"_blank\" rel=\"noopener\">https://gitlab.xxx.cn</a></li>\n<li>Client ID 填写上一步生成的<code>Application Id</code></li>\n<li>Client Secret 填写上一步生成的<code>Secret</code></li>\n</ul>\n<h3 id=\"2-10-3-开启ssl\"><a href=\"#2-10-3-开启ssl\" class=\"headerlink\" title=\"2.10.3 开启ssl\"></a>2.10.3 开启ssl</h3><p>Jenkins所在<code>java jetty server</code>需要开启SSL否则生成的<code>redirect_url</code>为<code>http</code>协议，并非<code>https</code>, 这样会导致OAuth失败，因为是无效的redirect url</p>\n<h3 id=\"2-10-4-导入自签名证书\"><a href=\"#2-10-4-导入自签名证书\" class=\"headerlink\" title=\"2.10.4 导入自签名证书\"></a>2.10.4 导入自签名证书</h3><p>因为使用的是自签名证书，Jenkins所使用的JVM需要将自签名证书导入到<code>certication trust store</code>中, 注意，证书的生成需要将<code>subject</code>与<code>hostname</code>关联起来，否则仍旧无法通过<code>ssl handshake</code></p>\n<ul>\n<li>生成自签名证书参考《启用ssl》</li>\n<li>导入到证书<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/jdk-1.8.0 </span><br><span class=\"line\">./bin/keytool --importcert -file /home/USERNAME/opt/nginx-1.9/conf/etc/xxx.crt -alias &apos;USERNAME-self-signed-crt&apos;  -keystore /home/USERNAME/opt/jdk-1.8.0/jre/lib/security/cacert</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"3-日志\"><a href=\"#3-日志\" class=\"headerlink\" title=\"3.日志\"></a>3.日志</h2><p>Jenkins的日志在<code>/var/log/USERNAME/jenkins.log</code></p>\n"},{"title":"LNMP环境部署","date":"2017-08-17T12:36:39.000Z","_content":"## 0. 源由\n由于公司需要搭建一些项目，例如`zentao`和`mediawiki`，依赖`LNMP`环境。\n\n## 1. 安装Nginx \n\n```\n# 安装依赖\nsudo aptitude install libssl-dev libpcre3 libpcre3-dev zlib1g-dev  \ncd /home/USERNAME/opt\n# clone nginx源代码\ngit clone https://github.com/nginx/nginx.git nginx-releases\ncd ./nginx-releases  \ngit checkout -b release-1.9 release-1.9\n./auto/configure --prefix=../nginx-1.9  --with-http_ssl_module\nmake -j4  \nmake install  \n```\n\n\n## 2. 安装MySQL\n[Download link](https://cdn.mysql.com//Downloads/MySQL-5.5/mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz)  \n[Installing MySQL on Unix/Linux Using Generic Binaries](https://dev.mysql.com/doc/refman/5.5/en/binary-installation.html)\n\n### 2.1 安装依赖库\n```\nshell> apt-get install libaio1 # install library\n```\n\n### 2.2 安装mysql\n```\nshell> groupadd mysql\nshell> useradd -r -g mysql -s /bin/false mysql\nshell> cd /home/USERNAME/opt\nshell> tar zxvf mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz\nshell> mv mysql-5.5.57-linux-glibc2.12-x86_64 mysql-5.5.57\nshell> cd mysql-5.5.57\nshell> chown -R mysql .\nshell> chgrp -R mysql .\nshell> scripts/mysql_install_db --user=mysql\nshell> chown -R root .\nshell> chown -R mysql data\n# Next command is optional\nshell> cp support-files/my-medium.cnf /etc/my.cnf\nshell> bin/mysqld_safe --user=mysql &\n# Next command is optional\nshell> cp support-files/mysql.server /etc/init.d/mysql.server\n```\n到此mysql已经安装完成。\n\n\n## 3. 安装PHP\n[PHP 5.6.31下载链接](http://us1.php.net/distributions/php-5.6.31.tar.gz)\n\n### 3.1 解压安装包\n```\ntar -zxvf php-5.6.31.tar.gz\n```\n### 3.2 解决依赖\n```\nsudo apt-get install libxml2-dev\n```\n```\nsudo apt-get install libpng12-0 libpng12-dev\n```\n### 3.3 编译\n```\ncd /home/USERNAME/opt/php-5.6.31.src\n./configure --prefix=/home/USERNAME/opt/php-5.6.31 --with-gd --with-zlib --with-mysql=/home/USERNAME/opt/mysql-5.5.57 --with-config-file-path=/home/USERNAME/opt/php-5.6.31 --enable-mbstring --enable-fpm\n```\n### 3.4 安装\n```\nmake && make install\n```\n### 3.5 拷贝配置文件到指定位置\n```\ncd /home/USERNAME/opt/php-5.6.31\ncp -p /home/USERNAME/opt/php-5.6.31/php.ini-development ./php.ini\n\ncd /home/USERNAME/opt/php-5.6.31/etc/\ncp -p php-fpm.conf.default php-fpm.conf\n```\n\n### 3.6 修改php-fpm.conf\n```\nvi php-fpm.conf\n```\n修改为如下内容\n```\npid=run/php-fpm.pid\nuser = USERNAME\ngroup = USERNAME\npm.max_children = 50\npm.start_servers = 20\npm.min_spare_servers = 5\npm.max_spare_servers = 35\n```\n\n### 3.7 安装`pdo`模块\n```\ncd /home/USERNAME/opt/php-5.6.31.src/ext/pdo\n/home/USERNAME/opt/php-5.6.31/bin/phpize\n./configure --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config\nmake & make install\n```\n\n### 3.8 安装`pdo_mysql`模块\n``` \ncd /home/USERNAME/opt/php-5.6.31.src/ext/pdo_mysql\n/home/USERNAME/opt/php-5.6.31/bin/phpize\n./configure --with-php-config=/home/USERNAME/opt/php5/bin/php-config --with-pdo-mysql=/home/USERNAME/opt/mysql-5.5.57/\n```\n\n### 3.9 安装`openssl`模块\n```\ncd /home/USERNAME/opt/php-5.6.31.src/ext/openssl\ncp -p config0.m4 config.m4\n/home/USERNAME/opt/php-5.6.31/bin/phpize\nln -s /usr/lib/x86_64-linux-gnu/libssl.so  /usr/lib\n./configure --with-openssl --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config\nmake\nmake install\n```\n`--with-php-config`指定配置\n`--with-pdo-MySQL`指定mysql数据库的安装目录\n\n安装完成会出现如下内容\n```\nInstalling shared extensions:\t/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/\n```\n编辑php.ini文件，将出现的内容添加到配置文件里\n```\nextension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/pdo_mysql.so\nextension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/openssl.so\n```\n### 3.10 启动fpm\n```\ncd /home/USERNAME/opt/php-5.6.31/sbin\nsudo php-fpm\n```\n\n## 4. 编辑测试文件并测试\n```\ncd /home/USERNAME/opt/nginx-1.9/html/\necho \"<?php\nphpinfo();\n?>\n```\n修改nginx配置文件\n```\nserver {\n\tlisten  80;\n\tserver_name localhost;\n\t\n\tlocation ~ \\.php$ {\n             root   /home/USERNAME/opt/nginx-1.9/html;\n             fastcgi_pass 127.0.0.1:9000;\n             fastcgi_index index.php;\n             fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n             include fastcgi.conf;\n          }\n\n}\n```\n通过curl访问`localhost/index.php`即可查看到当前环境的php信息。\n\n\n","source":"_posts/LNMP环境部署.md","raw":"---\ntitle: LNMP环境部署\ndate: 2017-08-17 20:36:39\ntags:\n---\n## 0. 源由\n由于公司需要搭建一些项目，例如`zentao`和`mediawiki`，依赖`LNMP`环境。\n\n## 1. 安装Nginx \n\n```\n# 安装依赖\nsudo aptitude install libssl-dev libpcre3 libpcre3-dev zlib1g-dev  \ncd /home/USERNAME/opt\n# clone nginx源代码\ngit clone https://github.com/nginx/nginx.git nginx-releases\ncd ./nginx-releases  \ngit checkout -b release-1.9 release-1.9\n./auto/configure --prefix=../nginx-1.9  --with-http_ssl_module\nmake -j4  \nmake install  \n```\n\n\n## 2. 安装MySQL\n[Download link](https://cdn.mysql.com//Downloads/MySQL-5.5/mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz)  \n[Installing MySQL on Unix/Linux Using Generic Binaries](https://dev.mysql.com/doc/refman/5.5/en/binary-installation.html)\n\n### 2.1 安装依赖库\n```\nshell> apt-get install libaio1 # install library\n```\n\n### 2.2 安装mysql\n```\nshell> groupadd mysql\nshell> useradd -r -g mysql -s /bin/false mysql\nshell> cd /home/USERNAME/opt\nshell> tar zxvf mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz\nshell> mv mysql-5.5.57-linux-glibc2.12-x86_64 mysql-5.5.57\nshell> cd mysql-5.5.57\nshell> chown -R mysql .\nshell> chgrp -R mysql .\nshell> scripts/mysql_install_db --user=mysql\nshell> chown -R root .\nshell> chown -R mysql data\n# Next command is optional\nshell> cp support-files/my-medium.cnf /etc/my.cnf\nshell> bin/mysqld_safe --user=mysql &\n# Next command is optional\nshell> cp support-files/mysql.server /etc/init.d/mysql.server\n```\n到此mysql已经安装完成。\n\n\n## 3. 安装PHP\n[PHP 5.6.31下载链接](http://us1.php.net/distributions/php-5.6.31.tar.gz)\n\n### 3.1 解压安装包\n```\ntar -zxvf php-5.6.31.tar.gz\n```\n### 3.2 解决依赖\n```\nsudo apt-get install libxml2-dev\n```\n```\nsudo apt-get install libpng12-0 libpng12-dev\n```\n### 3.3 编译\n```\ncd /home/USERNAME/opt/php-5.6.31.src\n./configure --prefix=/home/USERNAME/opt/php-5.6.31 --with-gd --with-zlib --with-mysql=/home/USERNAME/opt/mysql-5.5.57 --with-config-file-path=/home/USERNAME/opt/php-5.6.31 --enable-mbstring --enable-fpm\n```\n### 3.4 安装\n```\nmake && make install\n```\n### 3.5 拷贝配置文件到指定位置\n```\ncd /home/USERNAME/opt/php-5.6.31\ncp -p /home/USERNAME/opt/php-5.6.31/php.ini-development ./php.ini\n\ncd /home/USERNAME/opt/php-5.6.31/etc/\ncp -p php-fpm.conf.default php-fpm.conf\n```\n\n### 3.6 修改php-fpm.conf\n```\nvi php-fpm.conf\n```\n修改为如下内容\n```\npid=run/php-fpm.pid\nuser = USERNAME\ngroup = USERNAME\npm.max_children = 50\npm.start_servers = 20\npm.min_spare_servers = 5\npm.max_spare_servers = 35\n```\n\n### 3.7 安装`pdo`模块\n```\ncd /home/USERNAME/opt/php-5.6.31.src/ext/pdo\n/home/USERNAME/opt/php-5.6.31/bin/phpize\n./configure --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config\nmake & make install\n```\n\n### 3.8 安装`pdo_mysql`模块\n``` \ncd /home/USERNAME/opt/php-5.6.31.src/ext/pdo_mysql\n/home/USERNAME/opt/php-5.6.31/bin/phpize\n./configure --with-php-config=/home/USERNAME/opt/php5/bin/php-config --with-pdo-mysql=/home/USERNAME/opt/mysql-5.5.57/\n```\n\n### 3.9 安装`openssl`模块\n```\ncd /home/USERNAME/opt/php-5.6.31.src/ext/openssl\ncp -p config0.m4 config.m4\n/home/USERNAME/opt/php-5.6.31/bin/phpize\nln -s /usr/lib/x86_64-linux-gnu/libssl.so  /usr/lib\n./configure --with-openssl --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config\nmake\nmake install\n```\n`--with-php-config`指定配置\n`--with-pdo-MySQL`指定mysql数据库的安装目录\n\n安装完成会出现如下内容\n```\nInstalling shared extensions:\t/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/\n```\n编辑php.ini文件，将出现的内容添加到配置文件里\n```\nextension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/pdo_mysql.so\nextension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/openssl.so\n```\n### 3.10 启动fpm\n```\ncd /home/USERNAME/opt/php-5.6.31/sbin\nsudo php-fpm\n```\n\n## 4. 编辑测试文件并测试\n```\ncd /home/USERNAME/opt/nginx-1.9/html/\necho \"<?php\nphpinfo();\n?>\n```\n修改nginx配置文件\n```\nserver {\n\tlisten  80;\n\tserver_name localhost;\n\t\n\tlocation ~ \\.php$ {\n             root   /home/USERNAME/opt/nginx-1.9/html;\n             fastcgi_pass 127.0.0.1:9000;\n             fastcgi_index index.php;\n             fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n             include fastcgi.conf;\n          }\n\n}\n```\n通过curl访问`localhost/index.php`即可查看到当前环境的php信息。\n\n\n","slug":"LNMP环境部署","published":1,"updated":"2018-12-08T08:59:58.388Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4i0005zahi1svr7uy6","content":"<h2 id=\"0-源由\"><a href=\"#0-源由\" class=\"headerlink\" title=\"0. 源由\"></a>0. 源由</h2><p>由于公司需要搭建一些项目，例如<code>zentao</code>和<code>mediawiki</code>，依赖<code>LNMP</code>环境。</p>\n<h2 id=\"1-安装Nginx\"><a href=\"#1-安装Nginx\" class=\"headerlink\" title=\"1. 安装Nginx\"></a>1. 安装Nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装依赖</span><br><span class=\"line\">sudo aptitude install libssl-dev libpcre3 libpcre3-dev zlib1g-dev  </span><br><span class=\"line\">cd /home/USERNAME/opt</span><br><span class=\"line\"># clone nginx源代码</span><br><span class=\"line\">git clone https://github.com/nginx/nginx.git nginx-releases</span><br><span class=\"line\">cd ./nginx-releases  </span><br><span class=\"line\">git checkout -b release-1.9 release-1.9</span><br><span class=\"line\">./auto/configure --prefix=../nginx-1.9  --with-http_ssl_module</span><br><span class=\"line\">make -j4  </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-安装MySQL\"><a href=\"#2-安装MySQL\" class=\"headerlink\" title=\"2. 安装MySQL\"></a>2. 安装MySQL</h2><p><a href=\"https://cdn.mysql.com//Downloads/MySQL-5.5/mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz\" target=\"_blank\" rel=\"noopener\">Download link</a><br><a href=\"https://dev.mysql.com/doc/refman/5.5/en/binary-installation.html\" target=\"_blank\" rel=\"noopener\">Installing MySQL on Unix/Linux Using Generic Binaries</a></p>\n<h3 id=\"2-1-安装依赖库\"><a href=\"#2-1-安装依赖库\" class=\"headerlink\" title=\"2.1 安装依赖库\"></a>2.1 安装依赖库</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell&gt; apt-get install libaio1 # install library</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-安装mysql\"><a href=\"#2-2-安装mysql\" class=\"headerlink\" title=\"2.2 安装mysql\"></a>2.2 安装mysql</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell&gt; groupadd mysql</span><br><span class=\"line\">shell&gt; useradd -r -g mysql -s /bin/false mysql</span><br><span class=\"line\">shell&gt; cd /home/USERNAME/opt</span><br><span class=\"line\">shell&gt; tar zxvf mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz</span><br><span class=\"line\">shell&gt; mv mysql-5.5.57-linux-glibc2.12-x86_64 mysql-5.5.57</span><br><span class=\"line\">shell&gt; cd mysql-5.5.57</span><br><span class=\"line\">shell&gt; chown -R mysql .</span><br><span class=\"line\">shell&gt; chgrp -R mysql .</span><br><span class=\"line\">shell&gt; scripts/mysql_install_db --user=mysql</span><br><span class=\"line\">shell&gt; chown -R root .</span><br><span class=\"line\">shell&gt; chown -R mysql data</span><br><span class=\"line\"># Next command is optional</span><br><span class=\"line\">shell&gt; cp support-files/my-medium.cnf /etc/my.cnf</span><br><span class=\"line\">shell&gt; bin/mysqld_safe --user=mysql &amp;</span><br><span class=\"line\"># Next command is optional</span><br><span class=\"line\">shell&gt; cp support-files/mysql.server /etc/init.d/mysql.server</span><br></pre></td></tr></table></figure>\n<p>到此mysql已经安装完成。</p>\n<h2 id=\"3-安装PHP\"><a href=\"#3-安装PHP\" class=\"headerlink\" title=\"3. 安装PHP\"></a>3. 安装PHP</h2><p><a href=\"http://us1.php.net/distributions/php-5.6.31.tar.gz\" target=\"_blank\" rel=\"noopener\">PHP 5.6.31下载链接</a></p>\n<h3 id=\"3-1-解压安装包\"><a href=\"#3-1-解压安装包\" class=\"headerlink\" title=\"3.1 解压安装包\"></a>3.1 解压安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf php-5.6.31.tar.gz</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-解决依赖\"><a href=\"#3-2-解决依赖\" class=\"headerlink\" title=\"3.2 解决依赖\"></a>3.2 解决依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libxml2-dev</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libpng12-0 libpng12-dev</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-编译\"><a href=\"#3-3-编译\" class=\"headerlink\" title=\"3.3 编译\"></a>3.3 编译</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src</span><br><span class=\"line\">./configure --prefix=/home/USERNAME/opt/php-5.6.31 --with-gd --with-zlib --with-mysql=/home/USERNAME/opt/mysql-5.5.57 --with-config-file-path=/home/USERNAME/opt/php-5.6.31 --enable-mbstring --enable-fpm</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-4-安装\"><a href=\"#3-4-安装\" class=\"headerlink\" title=\"3.4 安装\"></a>3.4 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-5-拷贝配置文件到指定位置\"><a href=\"#3-5-拷贝配置文件到指定位置\" class=\"headerlink\" title=\"3.5 拷贝配置文件到指定位置\"></a>3.5 拷贝配置文件到指定位置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31</span><br><span class=\"line\">cp -p /home/USERNAME/opt/php-5.6.31/php.ini-development ./php.ini</span><br><span class=\"line\"></span><br><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31/etc/</span><br><span class=\"line\">cp -p php-fpm.conf.default php-fpm.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-6-修改php-fpm-conf\"><a href=\"#3-6-修改php-fpm-conf\" class=\"headerlink\" title=\"3.6 修改php-fpm.conf\"></a>3.6 修改php-fpm.conf</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi php-fpm.conf</span><br></pre></td></tr></table></figure>\n<p>修改为如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pid=run/php-fpm.pid</span><br><span class=\"line\">user = USERNAME</span><br><span class=\"line\">group = USERNAME</span><br><span class=\"line\">pm.max_children = 50</span><br><span class=\"line\">pm.start_servers = 20</span><br><span class=\"line\">pm.min_spare_servers = 5</span><br><span class=\"line\">pm.max_spare_servers = 35</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-7-安装pdo模块\"><a href=\"#3-7-安装pdo模块\" class=\"headerlink\" title=\"3.7 安装pdo模块\"></a>3.7 安装<code>pdo</code>模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src/ext/pdo</span><br><span class=\"line\">/home/USERNAME/opt/php-5.6.31/bin/phpize</span><br><span class=\"line\">./configure --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config</span><br><span class=\"line\">make &amp; make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-8-安装pdo-mysql模块\"><a href=\"#3-8-安装pdo-mysql模块\" class=\"headerlink\" title=\"3.8 安装pdo_mysql模块\"></a>3.8 安装<code>pdo_mysql</code>模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src/ext/pdo_mysql</span><br><span class=\"line\">/home/USERNAME/opt/php-5.6.31/bin/phpize</span><br><span class=\"line\">./configure --with-php-config=/home/USERNAME/opt/php5/bin/php-config --with-pdo-mysql=/home/USERNAME/opt/mysql-5.5.57/</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-9-安装openssl模块\"><a href=\"#3-9-安装openssl模块\" class=\"headerlink\" title=\"3.9 安装openssl模块\"></a>3.9 安装<code>openssl</code>模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src/ext/openssl</span><br><span class=\"line\">cp -p config0.m4 config.m4</span><br><span class=\"line\">/home/USERNAME/opt/php-5.6.31/bin/phpize</span><br><span class=\"line\">ln -s /usr/lib/x86_64-linux-gnu/libssl.so  /usr/lib</span><br><span class=\"line\">./configure --with-openssl --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p><code>--with-php-config</code>指定配置<br><code>--with-pdo-MySQL</code>指定mysql数据库的安装目录</p>\n<p>安装完成会出现如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Installing shared extensions:\t/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/</span><br></pre></td></tr></table></figure></p>\n<p>编辑php.ini文件，将出现的内容添加到配置文件里<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">extension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/pdo_mysql.so</span><br><span class=\"line\">extension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/openssl.so</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-10-启动fpm\"><a href=\"#3-10-启动fpm\" class=\"headerlink\" title=\"3.10 启动fpm\"></a>3.10 启动fpm</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31/sbin</span><br><span class=\"line\">sudo php-fpm</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-编辑测试文件并测试\"><a href=\"#4-编辑测试文件并测试\" class=\"headerlink\" title=\"4. 编辑测试文件并测试\"></a>4. 编辑测试文件并测试</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/nginx-1.9/html/</span><br><span class=\"line\">echo &quot;&lt;?php</span><br><span class=\"line\">phpinfo();</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n<p>修改nginx配置文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">\tlisten  80;</span><br><span class=\"line\">\tserver_name localhost;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tlocation ~ \\.php$ &#123;</span><br><span class=\"line\">             root   /home/USERNAME/opt/nginx-1.9/html;</span><br><span class=\"line\">             fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">             fastcgi_index index.php;</span><br><span class=\"line\">             fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class=\"line\">             include fastcgi.conf;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>通过curl访问<code>localhost/index.php</code>即可查看到当前环境的php信息。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"0-源由\"><a href=\"#0-源由\" class=\"headerlink\" title=\"0. 源由\"></a>0. 源由</h2><p>由于公司需要搭建一些项目，例如<code>zentao</code>和<code>mediawiki</code>，依赖<code>LNMP</code>环境。</p>\n<h2 id=\"1-安装Nginx\"><a href=\"#1-安装Nginx\" class=\"headerlink\" title=\"1. 安装Nginx\"></a>1. 安装Nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装依赖</span><br><span class=\"line\">sudo aptitude install libssl-dev libpcre3 libpcre3-dev zlib1g-dev  </span><br><span class=\"line\">cd /home/USERNAME/opt</span><br><span class=\"line\"># clone nginx源代码</span><br><span class=\"line\">git clone https://github.com/nginx/nginx.git nginx-releases</span><br><span class=\"line\">cd ./nginx-releases  </span><br><span class=\"line\">git checkout -b release-1.9 release-1.9</span><br><span class=\"line\">./auto/configure --prefix=../nginx-1.9  --with-http_ssl_module</span><br><span class=\"line\">make -j4  </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-安装MySQL\"><a href=\"#2-安装MySQL\" class=\"headerlink\" title=\"2. 安装MySQL\"></a>2. 安装MySQL</h2><p><a href=\"https://cdn.mysql.com//Downloads/MySQL-5.5/mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz\" target=\"_blank\" rel=\"noopener\">Download link</a><br><a href=\"https://dev.mysql.com/doc/refman/5.5/en/binary-installation.html\" target=\"_blank\" rel=\"noopener\">Installing MySQL on Unix/Linux Using Generic Binaries</a></p>\n<h3 id=\"2-1-安装依赖库\"><a href=\"#2-1-安装依赖库\" class=\"headerlink\" title=\"2.1 安装依赖库\"></a>2.1 安装依赖库</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell&gt; apt-get install libaio1 # install library</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-安装mysql\"><a href=\"#2-2-安装mysql\" class=\"headerlink\" title=\"2.2 安装mysql\"></a>2.2 安装mysql</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell&gt; groupadd mysql</span><br><span class=\"line\">shell&gt; useradd -r -g mysql -s /bin/false mysql</span><br><span class=\"line\">shell&gt; cd /home/USERNAME/opt</span><br><span class=\"line\">shell&gt; tar zxvf mysql-5.5.57-linux-glibc2.12-x86_64.tar.gz</span><br><span class=\"line\">shell&gt; mv mysql-5.5.57-linux-glibc2.12-x86_64 mysql-5.5.57</span><br><span class=\"line\">shell&gt; cd mysql-5.5.57</span><br><span class=\"line\">shell&gt; chown -R mysql .</span><br><span class=\"line\">shell&gt; chgrp -R mysql .</span><br><span class=\"line\">shell&gt; scripts/mysql_install_db --user=mysql</span><br><span class=\"line\">shell&gt; chown -R root .</span><br><span class=\"line\">shell&gt; chown -R mysql data</span><br><span class=\"line\"># Next command is optional</span><br><span class=\"line\">shell&gt; cp support-files/my-medium.cnf /etc/my.cnf</span><br><span class=\"line\">shell&gt; bin/mysqld_safe --user=mysql &amp;</span><br><span class=\"line\"># Next command is optional</span><br><span class=\"line\">shell&gt; cp support-files/mysql.server /etc/init.d/mysql.server</span><br></pre></td></tr></table></figure>\n<p>到此mysql已经安装完成。</p>\n<h2 id=\"3-安装PHP\"><a href=\"#3-安装PHP\" class=\"headerlink\" title=\"3. 安装PHP\"></a>3. 安装PHP</h2><p><a href=\"http://us1.php.net/distributions/php-5.6.31.tar.gz\" target=\"_blank\" rel=\"noopener\">PHP 5.6.31下载链接</a></p>\n<h3 id=\"3-1-解压安装包\"><a href=\"#3-1-解压安装包\" class=\"headerlink\" title=\"3.1 解压安装包\"></a>3.1 解压安装包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf php-5.6.31.tar.gz</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-解决依赖\"><a href=\"#3-2-解决依赖\" class=\"headerlink\" title=\"3.2 解决依赖\"></a>3.2 解决依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libxml2-dev</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libpng12-0 libpng12-dev</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-编译\"><a href=\"#3-3-编译\" class=\"headerlink\" title=\"3.3 编译\"></a>3.3 编译</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src</span><br><span class=\"line\">./configure --prefix=/home/USERNAME/opt/php-5.6.31 --with-gd --with-zlib --with-mysql=/home/USERNAME/opt/mysql-5.5.57 --with-config-file-path=/home/USERNAME/opt/php-5.6.31 --enable-mbstring --enable-fpm</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-4-安装\"><a href=\"#3-4-安装\" class=\"headerlink\" title=\"3.4 安装\"></a>3.4 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-5-拷贝配置文件到指定位置\"><a href=\"#3-5-拷贝配置文件到指定位置\" class=\"headerlink\" title=\"3.5 拷贝配置文件到指定位置\"></a>3.5 拷贝配置文件到指定位置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31</span><br><span class=\"line\">cp -p /home/USERNAME/opt/php-5.6.31/php.ini-development ./php.ini</span><br><span class=\"line\"></span><br><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31/etc/</span><br><span class=\"line\">cp -p php-fpm.conf.default php-fpm.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-6-修改php-fpm-conf\"><a href=\"#3-6-修改php-fpm-conf\" class=\"headerlink\" title=\"3.6 修改php-fpm.conf\"></a>3.6 修改php-fpm.conf</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi php-fpm.conf</span><br></pre></td></tr></table></figure>\n<p>修改为如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pid=run/php-fpm.pid</span><br><span class=\"line\">user = USERNAME</span><br><span class=\"line\">group = USERNAME</span><br><span class=\"line\">pm.max_children = 50</span><br><span class=\"line\">pm.start_servers = 20</span><br><span class=\"line\">pm.min_spare_servers = 5</span><br><span class=\"line\">pm.max_spare_servers = 35</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-7-安装pdo模块\"><a href=\"#3-7-安装pdo模块\" class=\"headerlink\" title=\"3.7 安装pdo模块\"></a>3.7 安装<code>pdo</code>模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src/ext/pdo</span><br><span class=\"line\">/home/USERNAME/opt/php-5.6.31/bin/phpize</span><br><span class=\"line\">./configure --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config</span><br><span class=\"line\">make &amp; make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-8-安装pdo-mysql模块\"><a href=\"#3-8-安装pdo-mysql模块\" class=\"headerlink\" title=\"3.8 安装pdo_mysql模块\"></a>3.8 安装<code>pdo_mysql</code>模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src/ext/pdo_mysql</span><br><span class=\"line\">/home/USERNAME/opt/php-5.6.31/bin/phpize</span><br><span class=\"line\">./configure --with-php-config=/home/USERNAME/opt/php5/bin/php-config --with-pdo-mysql=/home/USERNAME/opt/mysql-5.5.57/</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-9-安装openssl模块\"><a href=\"#3-9-安装openssl模块\" class=\"headerlink\" title=\"3.9 安装openssl模块\"></a>3.9 安装<code>openssl</code>模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31.src/ext/openssl</span><br><span class=\"line\">cp -p config0.m4 config.m4</span><br><span class=\"line\">/home/USERNAME/opt/php-5.6.31/bin/phpize</span><br><span class=\"line\">ln -s /usr/lib/x86_64-linux-gnu/libssl.so  /usr/lib</span><br><span class=\"line\">./configure --with-openssl --with-php-config=/home/USERNAME/opt/php-5.6.31/bin/php-config</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p><code>--with-php-config</code>指定配置<br><code>--with-pdo-MySQL</code>指定mysql数据库的安装目录</p>\n<p>安装完成会出现如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Installing shared extensions:\t/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/</span><br></pre></td></tr></table></figure></p>\n<p>编辑php.ini文件，将出现的内容添加到配置文件里<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">extension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/pdo_mysql.so</span><br><span class=\"line\">extension=/home/USERNAME/opt/php-5.6.31/lib/php/extensions/no-debug-non-zts-20131226/openssl.so</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-10-启动fpm\"><a href=\"#3-10-启动fpm\" class=\"headerlink\" title=\"3.10 启动fpm\"></a>3.10 启动fpm</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/php-5.6.31/sbin</span><br><span class=\"line\">sudo php-fpm</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-编辑测试文件并测试\"><a href=\"#4-编辑测试文件并测试\" class=\"headerlink\" title=\"4. 编辑测试文件并测试\"></a>4. 编辑测试文件并测试</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/USERNAME/opt/nginx-1.9/html/</span><br><span class=\"line\">echo &quot;&lt;?php</span><br><span class=\"line\">phpinfo();</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n<p>修改nginx配置文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">\tlisten  80;</span><br><span class=\"line\">\tserver_name localhost;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tlocation ~ \\.php$ &#123;</span><br><span class=\"line\">             root   /home/USERNAME/opt/nginx-1.9/html;</span><br><span class=\"line\">             fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">             fastcgi_index index.php;</span><br><span class=\"line\">             fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class=\"line\">             include fastcgi.conf;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>通过curl访问<code>localhost/index.php</code>即可查看到当前环境的php信息。</p>\n"},{"title":"Redis主从","date":"2018-10-17T07:58:19.000Z","_content":"\nRedis支持简单且易用的主从复制功能\n\n## 1. Redis复制功能的几个重要方面\n- Redis使用异步复制。从服务器会以每秒一次的频率向主服务器报告复制流的处理进度。\n- 一个主服务器可以有多个从服务器。\n- 从服务器也可以有多个从服务器，多个从服务器之间可以构成一个图状结构。\n- 复制功能不会阻塞主服务器。即使一个或多个从服务器正在进行初次同步，主服务器也可以继续处理命令请求。\n- 复制功能也不会阻塞从服务器，只要在配置文件中进行了相应的配置，即使从服务器正在进行初次同步，服务器也可以使用旧版本的数据集来处理命令查询。   \n不过，在服务器删除旧版本数据集并载入新版本数据集的时间间隔内，连接请求会被阻塞。\n还可以配置从服务器，让它在与主服务器的连接断开时，向客户端发送一个错误。\n- 复制功能可以单纯地用于数据冗余，也可以通过让多个从服务器处理只读命令来提升扩展性：比如繁重的`SORT`命令可以交给附属节点去运行。\n- 可以通过复制功能来让主服务器免于执行持久化操作：只要关闭主服务器的持久化功能，然后由从服务器去执行持久化操作即可。\n\n## 2.复制功能的原理\n\n1. 无论是初次连接还是重新连接，当建立一个从服务器时，从服务器都将向主服务器发送一个`SYNC`命令。\n2. 接到`SYNC`命令的主服务器将开始执行`BGSAVE`，并在保存操作执行期间，将所有新执行的写入命令都保存到一个缓冲区里。\n3. 当`BGSAVE`执行完毕后，主服务器将执行保存操作所得的`.rdb`文件发送给从服务器，从服务器接收到`.rdb`文件后，将文件中的数据载入到内存中。\n4. 之后，主服务器会以Redis命令协议的格式，将写命令缓冲区中积累的所有内容都发送给从服务器。\n\n即使有多个从服务器同时向主服务器发送`SYNC`，主服务器也只需要执行一次`BGSAVE`命令就可以处理所有这些从服务器的同步请求。\n\n从服务器可以在主从服务器之间的连接断开时进行自动重连  \n在Redis 2.8之前，断线重连的从服务器总要执行一次完整重同步操作。  \n在Redis 2.8之后，从服务器可以根据主服务器的情况来选择执行完整重同步还是部分重同步。\n\n## 3. 部分重同步\n从Redis 2.8开始，在网络连接短暂断开后，主从服务器可以尝试继续执行原有的复制进程，而不一定要执行完整重同步操作。\n\n这个特性需要主服务器为被发送的复制流创建一个内存缓冲区，并且主服务器和所有从服务器之间都记录一个复制偏移量和一个主服务器ID，当出现网络断开时，从服务器将重新连接，并且向主服务器请求继续执行原来的复制进程。\n\n- 如果从服务器记录的主服务器ID和当前要连接的主服务器的ID相同，并且从服务器记录的偏移量所指定的数据仍然保存在主服务器的复制流缓冲区里，那么主服务器会向从服务器发送断线时缺失的那部分数据，然后复制工作可以继续进行。\n- 否则。从服务器要执行完整重同步操作。\n\nRedis的部分重同步特性会用到一个新增的`PSYNC`内部命令，而Redis 2.8之前的旧版本只有`SYNC`命令，不过只要从服务器是Redis 2.8或者以上的版本，它会根据主服务器的版本来决定到底是使用`PSYNC`还是`SYNC`\n\n- 主服务器 >= 2.8 从服务器使用`PSYNC`命令来进行同步。 \n- 主服务器 < 2.8 从服务器使用`SYNC`命令来进行同步。 \n\n## 4. 配置\n\n配置一个从服务器非常简单，只要在配置文件中增加以下一行就可以\n```\nslaveof 192.168.1.100 6379\n```\n当然，你需要将代码中的`192.168.1.100` 和`6379`替换成你的主服务器的IP和端口号。  \n另外一种方法是调用`SLAVEOF`命令，输入主服务器的IP和端口号，然后同步就会开始：\n```\n127.0.0.1:6379> SLAVEOF 192.168.1.100 6379\nOK\n```\n在从服务器上登录Redis客户端查询，可以看到数据已经从主服务器同步过来。\n\n## 5. 只读从服务器\n从Redis 2.6开始，从服务器支持只读模式，并且该模式为从服务器的默认模式。\n\n只读模式由配置文件中的 `slave-read-only`选项控制，也可以通过`CONFIG SET`命令来开启或者关闭这个模式。\n\n只读从服务器会拒绝执行任何写命令，所以不会出现因为操作失误而将数据不小心写到了从服务器的情况。\n\n即使从服务器是只读的，`DEBUG`和`CONFIG` 等管理命令仍然是可以使用的，所以我们还是不应该将服务器暴露给互联网或者任何不可信的网络。不过，使用配置中的命令改名选项，我们可以通过禁止执行某些命令来提升只读从服务器的安全性。\n\n既然从服务器上的写数据会被重同步数据覆盖，也可能在服务器重启时丢失，为什么要让一个从服务器变得可写呢？\n原因是，一些不重要的临时数据，仍然是可以保存在从服务器上的。\n\n## 6. 从服务器的相关配置\n如果主服务器通过`requirepass`选项设置了密码，那么为了让从服务器的同步操作可以顺利进行，我们也必须为从服务器进行相应的身份验证设置。\n\n对于一个正在运行的服务器，可以使用客户端输入以下命令\n```\n127.0.0.1:6379> config set masterauth <password>\n```\n要永久地设置这个密码，那么可以将它加入到配置文件中：\n``` \nmasterauth <password>\n```\n\n## 7. 主服务器只在有至少N个从服务器的情况下，才执行写操作\n\n从Redis 2.8开始，为了保证数据的安全性，可以通过配置，让主服务器只在有至少N个当前已连接从服务器的情况下，才执行写命令。\n不过，因为Redis使用异步复制，所以主服务器发送的写数据并不一定会被从服务器收到，因此，数据丢失的可能性仍然是存在的。\n\n以下是这个特性的原理：\n- 从服务器以每秒一次的频率`ping`主服务器一次，并报告复制流的处理情况。\n- 主服务器会记录各个从服务器最后一次向它发送`ping`的时间。\n- 用户可以通过配置，指定网络延迟的最大值`min-slaves-max-lag`，以及执行写操作所需的至少从服务器数量`min-slaves-to-write`.\n\n如果至少有`min-slaves-to-write`个服务器，并且这些服务器的延迟都少于`min-slaves-max-lag`秒，那么主服务器就会执行客户端请求的写操作。  \n尽管不能保证写操作的持久性，但起码丢失数据的窗口会被严格限制的指定的秒数中。  \n另一方面，如果条件达不到`min-slaves-to-write`和`min-slaves-max-lag`所指定的条件，那么写操作就不会被执行，主服务器会向请求执行写操作的客户端返回一个错误。  \n以下是这个特性的两个选项和它们所需的参数：\n- `min-slaves-to-write <number of slaves>`\n- `min-slaves-max-lag <number of second>`\n\n\n","source":"_posts/Redis主从.md","raw":"---\ntitle: Redis主从\ndate: 2018-10-17 15:58:19\ntags: Redis\n---\n\nRedis支持简单且易用的主从复制功能\n\n## 1. Redis复制功能的几个重要方面\n- Redis使用异步复制。从服务器会以每秒一次的频率向主服务器报告复制流的处理进度。\n- 一个主服务器可以有多个从服务器。\n- 从服务器也可以有多个从服务器，多个从服务器之间可以构成一个图状结构。\n- 复制功能不会阻塞主服务器。即使一个或多个从服务器正在进行初次同步，主服务器也可以继续处理命令请求。\n- 复制功能也不会阻塞从服务器，只要在配置文件中进行了相应的配置，即使从服务器正在进行初次同步，服务器也可以使用旧版本的数据集来处理命令查询。   \n不过，在服务器删除旧版本数据集并载入新版本数据集的时间间隔内，连接请求会被阻塞。\n还可以配置从服务器，让它在与主服务器的连接断开时，向客户端发送一个错误。\n- 复制功能可以单纯地用于数据冗余，也可以通过让多个从服务器处理只读命令来提升扩展性：比如繁重的`SORT`命令可以交给附属节点去运行。\n- 可以通过复制功能来让主服务器免于执行持久化操作：只要关闭主服务器的持久化功能，然后由从服务器去执行持久化操作即可。\n\n## 2.复制功能的原理\n\n1. 无论是初次连接还是重新连接，当建立一个从服务器时，从服务器都将向主服务器发送一个`SYNC`命令。\n2. 接到`SYNC`命令的主服务器将开始执行`BGSAVE`，并在保存操作执行期间，将所有新执行的写入命令都保存到一个缓冲区里。\n3. 当`BGSAVE`执行完毕后，主服务器将执行保存操作所得的`.rdb`文件发送给从服务器，从服务器接收到`.rdb`文件后，将文件中的数据载入到内存中。\n4. 之后，主服务器会以Redis命令协议的格式，将写命令缓冲区中积累的所有内容都发送给从服务器。\n\n即使有多个从服务器同时向主服务器发送`SYNC`，主服务器也只需要执行一次`BGSAVE`命令就可以处理所有这些从服务器的同步请求。\n\n从服务器可以在主从服务器之间的连接断开时进行自动重连  \n在Redis 2.8之前，断线重连的从服务器总要执行一次完整重同步操作。  \n在Redis 2.8之后，从服务器可以根据主服务器的情况来选择执行完整重同步还是部分重同步。\n\n## 3. 部分重同步\n从Redis 2.8开始，在网络连接短暂断开后，主从服务器可以尝试继续执行原有的复制进程，而不一定要执行完整重同步操作。\n\n这个特性需要主服务器为被发送的复制流创建一个内存缓冲区，并且主服务器和所有从服务器之间都记录一个复制偏移量和一个主服务器ID，当出现网络断开时，从服务器将重新连接，并且向主服务器请求继续执行原来的复制进程。\n\n- 如果从服务器记录的主服务器ID和当前要连接的主服务器的ID相同，并且从服务器记录的偏移量所指定的数据仍然保存在主服务器的复制流缓冲区里，那么主服务器会向从服务器发送断线时缺失的那部分数据，然后复制工作可以继续进行。\n- 否则。从服务器要执行完整重同步操作。\n\nRedis的部分重同步特性会用到一个新增的`PSYNC`内部命令，而Redis 2.8之前的旧版本只有`SYNC`命令，不过只要从服务器是Redis 2.8或者以上的版本，它会根据主服务器的版本来决定到底是使用`PSYNC`还是`SYNC`\n\n- 主服务器 >= 2.8 从服务器使用`PSYNC`命令来进行同步。 \n- 主服务器 < 2.8 从服务器使用`SYNC`命令来进行同步。 \n\n## 4. 配置\n\n配置一个从服务器非常简单，只要在配置文件中增加以下一行就可以\n```\nslaveof 192.168.1.100 6379\n```\n当然，你需要将代码中的`192.168.1.100` 和`6379`替换成你的主服务器的IP和端口号。  \n另外一种方法是调用`SLAVEOF`命令，输入主服务器的IP和端口号，然后同步就会开始：\n```\n127.0.0.1:6379> SLAVEOF 192.168.1.100 6379\nOK\n```\n在从服务器上登录Redis客户端查询，可以看到数据已经从主服务器同步过来。\n\n## 5. 只读从服务器\n从Redis 2.6开始，从服务器支持只读模式，并且该模式为从服务器的默认模式。\n\n只读模式由配置文件中的 `slave-read-only`选项控制，也可以通过`CONFIG SET`命令来开启或者关闭这个模式。\n\n只读从服务器会拒绝执行任何写命令，所以不会出现因为操作失误而将数据不小心写到了从服务器的情况。\n\n即使从服务器是只读的，`DEBUG`和`CONFIG` 等管理命令仍然是可以使用的，所以我们还是不应该将服务器暴露给互联网或者任何不可信的网络。不过，使用配置中的命令改名选项，我们可以通过禁止执行某些命令来提升只读从服务器的安全性。\n\n既然从服务器上的写数据会被重同步数据覆盖，也可能在服务器重启时丢失，为什么要让一个从服务器变得可写呢？\n原因是，一些不重要的临时数据，仍然是可以保存在从服务器上的。\n\n## 6. 从服务器的相关配置\n如果主服务器通过`requirepass`选项设置了密码，那么为了让从服务器的同步操作可以顺利进行，我们也必须为从服务器进行相应的身份验证设置。\n\n对于一个正在运行的服务器，可以使用客户端输入以下命令\n```\n127.0.0.1:6379> config set masterauth <password>\n```\n要永久地设置这个密码，那么可以将它加入到配置文件中：\n``` \nmasterauth <password>\n```\n\n## 7. 主服务器只在有至少N个从服务器的情况下，才执行写操作\n\n从Redis 2.8开始，为了保证数据的安全性，可以通过配置，让主服务器只在有至少N个当前已连接从服务器的情况下，才执行写命令。\n不过，因为Redis使用异步复制，所以主服务器发送的写数据并不一定会被从服务器收到，因此，数据丢失的可能性仍然是存在的。\n\n以下是这个特性的原理：\n- 从服务器以每秒一次的频率`ping`主服务器一次，并报告复制流的处理情况。\n- 主服务器会记录各个从服务器最后一次向它发送`ping`的时间。\n- 用户可以通过配置，指定网络延迟的最大值`min-slaves-max-lag`，以及执行写操作所需的至少从服务器数量`min-slaves-to-write`.\n\n如果至少有`min-slaves-to-write`个服务器，并且这些服务器的延迟都少于`min-slaves-max-lag`秒，那么主服务器就会执行客户端请求的写操作。  \n尽管不能保证写操作的持久性，但起码丢失数据的窗口会被严格限制的指定的秒数中。  \n另一方面，如果条件达不到`min-slaves-to-write`和`min-slaves-max-lag`所指定的条件，那么写操作就不会被执行，主服务器会向请求执行写操作的客户端返回一个错误。  \n以下是这个特性的两个选项和它们所需的参数：\n- `min-slaves-to-write <number of slaves>`\n- `min-slaves-max-lag <number of second>`\n\n\n","slug":"Redis主从","published":1,"updated":"2018-10-17T12:45:36.200Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4j0006zahiltwf7xez","content":"<p>Redis支持简单且易用的主从复制功能</p>\n<h2 id=\"1-Redis复制功能的几个重要方面\"><a href=\"#1-Redis复制功能的几个重要方面\" class=\"headerlink\" title=\"1. Redis复制功能的几个重要方面\"></a>1. Redis复制功能的几个重要方面</h2><ul>\n<li>Redis使用异步复制。从服务器会以每秒一次的频率向主服务器报告复制流的处理进度。</li>\n<li>一个主服务器可以有多个从服务器。</li>\n<li>从服务器也可以有多个从服务器，多个从服务器之间可以构成一个图状结构。</li>\n<li>复制功能不会阻塞主服务器。即使一个或多个从服务器正在进行初次同步，主服务器也可以继续处理命令请求。</li>\n<li>复制功能也不会阻塞从服务器，只要在配置文件中进行了相应的配置，即使从服务器正在进行初次同步，服务器也可以使用旧版本的数据集来处理命令查询。<br>不过，在服务器删除旧版本数据集并载入新版本数据集的时间间隔内，连接请求会被阻塞。<br>还可以配置从服务器，让它在与主服务器的连接断开时，向客户端发送一个错误。</li>\n<li>复制功能可以单纯地用于数据冗余，也可以通过让多个从服务器处理只读命令来提升扩展性：比如繁重的<code>SORT</code>命令可以交给附属节点去运行。</li>\n<li>可以通过复制功能来让主服务器免于执行持久化操作：只要关闭主服务器的持久化功能，然后由从服务器去执行持久化操作即可。</li>\n</ul>\n<h2 id=\"2-复制功能的原理\"><a href=\"#2-复制功能的原理\" class=\"headerlink\" title=\"2.复制功能的原理\"></a>2.复制功能的原理</h2><ol>\n<li>无论是初次连接还是重新连接，当建立一个从服务器时，从服务器都将向主服务器发送一个<code>SYNC</code>命令。</li>\n<li>接到<code>SYNC</code>命令的主服务器将开始执行<code>BGSAVE</code>，并在保存操作执行期间，将所有新执行的写入命令都保存到一个缓冲区里。</li>\n<li>当<code>BGSAVE</code>执行完毕后，主服务器将执行保存操作所得的<code>.rdb</code>文件发送给从服务器，从服务器接收到<code>.rdb</code>文件后，将文件中的数据载入到内存中。</li>\n<li>之后，主服务器会以Redis命令协议的格式，将写命令缓冲区中积累的所有内容都发送给从服务器。</li>\n</ol>\n<p>即使有多个从服务器同时向主服务器发送<code>SYNC</code>，主服务器也只需要执行一次<code>BGSAVE</code>命令就可以处理所有这些从服务器的同步请求。</p>\n<p>从服务器可以在主从服务器之间的连接断开时进行自动重连<br>在Redis 2.8之前，断线重连的从服务器总要执行一次完整重同步操作。<br>在Redis 2.8之后，从服务器可以根据主服务器的情况来选择执行完整重同步还是部分重同步。</p>\n<h2 id=\"3-部分重同步\"><a href=\"#3-部分重同步\" class=\"headerlink\" title=\"3. 部分重同步\"></a>3. 部分重同步</h2><p>从Redis 2.8开始，在网络连接短暂断开后，主从服务器可以尝试继续执行原有的复制进程，而不一定要执行完整重同步操作。</p>\n<p>这个特性需要主服务器为被发送的复制流创建一个内存缓冲区，并且主服务器和所有从服务器之间都记录一个复制偏移量和一个主服务器ID，当出现网络断开时，从服务器将重新连接，并且向主服务器请求继续执行原来的复制进程。</p>\n<ul>\n<li>如果从服务器记录的主服务器ID和当前要连接的主服务器的ID相同，并且从服务器记录的偏移量所指定的数据仍然保存在主服务器的复制流缓冲区里，那么主服务器会向从服务器发送断线时缺失的那部分数据，然后复制工作可以继续进行。</li>\n<li>否则。从服务器要执行完整重同步操作。</li>\n</ul>\n<p>Redis的部分重同步特性会用到一个新增的<code>PSYNC</code>内部命令，而Redis 2.8之前的旧版本只有<code>SYNC</code>命令，不过只要从服务器是Redis 2.8或者以上的版本，它会根据主服务器的版本来决定到底是使用<code>PSYNC</code>还是<code>SYNC</code></p>\n<ul>\n<li>主服务器 &gt;= 2.8 从服务器使用<code>PSYNC</code>命令来进行同步。 </li>\n<li>主服务器 &lt; 2.8 从服务器使用<code>SYNC</code>命令来进行同步。 </li>\n</ul>\n<h2 id=\"4-配置\"><a href=\"#4-配置\" class=\"headerlink\" title=\"4. 配置\"></a>4. 配置</h2><p>配置一个从服务器非常简单，只要在配置文件中增加以下一行就可以<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">slaveof 192.168.1.100 6379</span><br></pre></td></tr></table></figure></p>\n<p>当然，你需要将代码中的<code>192.168.1.100</code> 和<code>6379</code>替换成你的主服务器的IP和端口号。<br>另外一种方法是调用<code>SLAVEOF</code>命令，输入主服务器的IP和端口号，然后同步就会开始：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SLAVEOF 192.168.1.100 6379</span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure></p>\n<p>在从服务器上登录Redis客户端查询，可以看到数据已经从主服务器同步过来。</p>\n<h2 id=\"5-只读从服务器\"><a href=\"#5-只读从服务器\" class=\"headerlink\" title=\"5. 只读从服务器\"></a>5. 只读从服务器</h2><p>从Redis 2.6开始，从服务器支持只读模式，并且该模式为从服务器的默认模式。</p>\n<p>只读模式由配置文件中的 <code>slave-read-only</code>选项控制，也可以通过<code>CONFIG SET</code>命令来开启或者关闭这个模式。</p>\n<p>只读从服务器会拒绝执行任何写命令，所以不会出现因为操作失误而将数据不小心写到了从服务器的情况。</p>\n<p>即使从服务器是只读的，<code>DEBUG</code>和<code>CONFIG</code> 等管理命令仍然是可以使用的，所以我们还是不应该将服务器暴露给互联网或者任何不可信的网络。不过，使用配置中的命令改名选项，我们可以通过禁止执行某些命令来提升只读从服务器的安全性。</p>\n<p>既然从服务器上的写数据会被重同步数据覆盖，也可能在服务器重启时丢失，为什么要让一个从服务器变得可写呢？<br>原因是，一些不重要的临时数据，仍然是可以保存在从服务器上的。</p>\n<h2 id=\"6-从服务器的相关配置\"><a href=\"#6-从服务器的相关配置\" class=\"headerlink\" title=\"6. 从服务器的相关配置\"></a>6. 从服务器的相关配置</h2><p>如果主服务器通过<code>requirepass</code>选项设置了密码，那么为了让从服务器的同步操作可以顺利进行，我们也必须为从服务器进行相应的身份验证设置。</p>\n<p>对于一个正在运行的服务器，可以使用客户端输入以下命令<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; config set masterauth &lt;password&gt;</span><br></pre></td></tr></table></figure></p>\n<p>要永久地设置这个密码，那么可以将它加入到配置文件中：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">masterauth &lt;password&gt;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"7-主服务器只在有至少N个从服务器的情况下，才执行写操作\"><a href=\"#7-主服务器只在有至少N个从服务器的情况下，才执行写操作\" class=\"headerlink\" title=\"7. 主服务器只在有至少N个从服务器的情况下，才执行写操作\"></a>7. 主服务器只在有至少N个从服务器的情况下，才执行写操作</h2><p>从Redis 2.8开始，为了保证数据的安全性，可以通过配置，让主服务器只在有至少N个当前已连接从服务器的情况下，才执行写命令。<br>不过，因为Redis使用异步复制，所以主服务器发送的写数据并不一定会被从服务器收到，因此，数据丢失的可能性仍然是存在的。</p>\n<p>以下是这个特性的原理：</p>\n<ul>\n<li>从服务器以每秒一次的频率<code>ping</code>主服务器一次，并报告复制流的处理情况。</li>\n<li>主服务器会记录各个从服务器最后一次向它发送<code>ping</code>的时间。</li>\n<li>用户可以通过配置，指定网络延迟的最大值<code>min-slaves-max-lag</code>，以及执行写操作所需的至少从服务器数量<code>min-slaves-to-write</code>.</li>\n</ul>\n<p>如果至少有<code>min-slaves-to-write</code>个服务器，并且这些服务器的延迟都少于<code>min-slaves-max-lag</code>秒，那么主服务器就会执行客户端请求的写操作。<br>尽管不能保证写操作的持久性，但起码丢失数据的窗口会被严格限制的指定的秒数中。<br>另一方面，如果条件达不到<code>min-slaves-to-write</code>和<code>min-slaves-max-lag</code>所指定的条件，那么写操作就不会被执行，主服务器会向请求执行写操作的客户端返回一个错误。<br>以下是这个特性的两个选项和它们所需的参数：</p>\n<ul>\n<li><code>min-slaves-to-write &lt;number of slaves&gt;</code></li>\n<li><code>min-slaves-max-lag &lt;number of second&gt;</code></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>Redis支持简单且易用的主从复制功能</p>\n<h2 id=\"1-Redis复制功能的几个重要方面\"><a href=\"#1-Redis复制功能的几个重要方面\" class=\"headerlink\" title=\"1. Redis复制功能的几个重要方面\"></a>1. Redis复制功能的几个重要方面</h2><ul>\n<li>Redis使用异步复制。从服务器会以每秒一次的频率向主服务器报告复制流的处理进度。</li>\n<li>一个主服务器可以有多个从服务器。</li>\n<li>从服务器也可以有多个从服务器，多个从服务器之间可以构成一个图状结构。</li>\n<li>复制功能不会阻塞主服务器。即使一个或多个从服务器正在进行初次同步，主服务器也可以继续处理命令请求。</li>\n<li>复制功能也不会阻塞从服务器，只要在配置文件中进行了相应的配置，即使从服务器正在进行初次同步，服务器也可以使用旧版本的数据集来处理命令查询。<br>不过，在服务器删除旧版本数据集并载入新版本数据集的时间间隔内，连接请求会被阻塞。<br>还可以配置从服务器，让它在与主服务器的连接断开时，向客户端发送一个错误。</li>\n<li>复制功能可以单纯地用于数据冗余，也可以通过让多个从服务器处理只读命令来提升扩展性：比如繁重的<code>SORT</code>命令可以交给附属节点去运行。</li>\n<li>可以通过复制功能来让主服务器免于执行持久化操作：只要关闭主服务器的持久化功能，然后由从服务器去执行持久化操作即可。</li>\n</ul>\n<h2 id=\"2-复制功能的原理\"><a href=\"#2-复制功能的原理\" class=\"headerlink\" title=\"2.复制功能的原理\"></a>2.复制功能的原理</h2><ol>\n<li>无论是初次连接还是重新连接，当建立一个从服务器时，从服务器都将向主服务器发送一个<code>SYNC</code>命令。</li>\n<li>接到<code>SYNC</code>命令的主服务器将开始执行<code>BGSAVE</code>，并在保存操作执行期间，将所有新执行的写入命令都保存到一个缓冲区里。</li>\n<li>当<code>BGSAVE</code>执行完毕后，主服务器将执行保存操作所得的<code>.rdb</code>文件发送给从服务器，从服务器接收到<code>.rdb</code>文件后，将文件中的数据载入到内存中。</li>\n<li>之后，主服务器会以Redis命令协议的格式，将写命令缓冲区中积累的所有内容都发送给从服务器。</li>\n</ol>\n<p>即使有多个从服务器同时向主服务器发送<code>SYNC</code>，主服务器也只需要执行一次<code>BGSAVE</code>命令就可以处理所有这些从服务器的同步请求。</p>\n<p>从服务器可以在主从服务器之间的连接断开时进行自动重连<br>在Redis 2.8之前，断线重连的从服务器总要执行一次完整重同步操作。<br>在Redis 2.8之后，从服务器可以根据主服务器的情况来选择执行完整重同步还是部分重同步。</p>\n<h2 id=\"3-部分重同步\"><a href=\"#3-部分重同步\" class=\"headerlink\" title=\"3. 部分重同步\"></a>3. 部分重同步</h2><p>从Redis 2.8开始，在网络连接短暂断开后，主从服务器可以尝试继续执行原有的复制进程，而不一定要执行完整重同步操作。</p>\n<p>这个特性需要主服务器为被发送的复制流创建一个内存缓冲区，并且主服务器和所有从服务器之间都记录一个复制偏移量和一个主服务器ID，当出现网络断开时，从服务器将重新连接，并且向主服务器请求继续执行原来的复制进程。</p>\n<ul>\n<li>如果从服务器记录的主服务器ID和当前要连接的主服务器的ID相同，并且从服务器记录的偏移量所指定的数据仍然保存在主服务器的复制流缓冲区里，那么主服务器会向从服务器发送断线时缺失的那部分数据，然后复制工作可以继续进行。</li>\n<li>否则。从服务器要执行完整重同步操作。</li>\n</ul>\n<p>Redis的部分重同步特性会用到一个新增的<code>PSYNC</code>内部命令，而Redis 2.8之前的旧版本只有<code>SYNC</code>命令，不过只要从服务器是Redis 2.8或者以上的版本，它会根据主服务器的版本来决定到底是使用<code>PSYNC</code>还是<code>SYNC</code></p>\n<ul>\n<li>主服务器 &gt;= 2.8 从服务器使用<code>PSYNC</code>命令来进行同步。 </li>\n<li>主服务器 &lt; 2.8 从服务器使用<code>SYNC</code>命令来进行同步。 </li>\n</ul>\n<h2 id=\"4-配置\"><a href=\"#4-配置\" class=\"headerlink\" title=\"4. 配置\"></a>4. 配置</h2><p>配置一个从服务器非常简单，只要在配置文件中增加以下一行就可以<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">slaveof 192.168.1.100 6379</span><br></pre></td></tr></table></figure></p>\n<p>当然，你需要将代码中的<code>192.168.1.100</code> 和<code>6379</code>替换成你的主服务器的IP和端口号。<br>另外一种方法是调用<code>SLAVEOF</code>命令，输入主服务器的IP和端口号，然后同步就会开始：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SLAVEOF 192.168.1.100 6379</span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure></p>\n<p>在从服务器上登录Redis客户端查询，可以看到数据已经从主服务器同步过来。</p>\n<h2 id=\"5-只读从服务器\"><a href=\"#5-只读从服务器\" class=\"headerlink\" title=\"5. 只读从服务器\"></a>5. 只读从服务器</h2><p>从Redis 2.6开始，从服务器支持只读模式，并且该模式为从服务器的默认模式。</p>\n<p>只读模式由配置文件中的 <code>slave-read-only</code>选项控制，也可以通过<code>CONFIG SET</code>命令来开启或者关闭这个模式。</p>\n<p>只读从服务器会拒绝执行任何写命令，所以不会出现因为操作失误而将数据不小心写到了从服务器的情况。</p>\n<p>即使从服务器是只读的，<code>DEBUG</code>和<code>CONFIG</code> 等管理命令仍然是可以使用的，所以我们还是不应该将服务器暴露给互联网或者任何不可信的网络。不过，使用配置中的命令改名选项，我们可以通过禁止执行某些命令来提升只读从服务器的安全性。</p>\n<p>既然从服务器上的写数据会被重同步数据覆盖，也可能在服务器重启时丢失，为什么要让一个从服务器变得可写呢？<br>原因是，一些不重要的临时数据，仍然是可以保存在从服务器上的。</p>\n<h2 id=\"6-从服务器的相关配置\"><a href=\"#6-从服务器的相关配置\" class=\"headerlink\" title=\"6. 从服务器的相关配置\"></a>6. 从服务器的相关配置</h2><p>如果主服务器通过<code>requirepass</code>选项设置了密码，那么为了让从服务器的同步操作可以顺利进行，我们也必须为从服务器进行相应的身份验证设置。</p>\n<p>对于一个正在运行的服务器，可以使用客户端输入以下命令<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; config set masterauth &lt;password&gt;</span><br></pre></td></tr></table></figure></p>\n<p>要永久地设置这个密码，那么可以将它加入到配置文件中：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">masterauth &lt;password&gt;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"7-主服务器只在有至少N个从服务器的情况下，才执行写操作\"><a href=\"#7-主服务器只在有至少N个从服务器的情况下，才执行写操作\" class=\"headerlink\" title=\"7. 主服务器只在有至少N个从服务器的情况下，才执行写操作\"></a>7. 主服务器只在有至少N个从服务器的情况下，才执行写操作</h2><p>从Redis 2.8开始，为了保证数据的安全性，可以通过配置，让主服务器只在有至少N个当前已连接从服务器的情况下，才执行写命令。<br>不过，因为Redis使用异步复制，所以主服务器发送的写数据并不一定会被从服务器收到，因此，数据丢失的可能性仍然是存在的。</p>\n<p>以下是这个特性的原理：</p>\n<ul>\n<li>从服务器以每秒一次的频率<code>ping</code>主服务器一次，并报告复制流的处理情况。</li>\n<li>主服务器会记录各个从服务器最后一次向它发送<code>ping</code>的时间。</li>\n<li>用户可以通过配置，指定网络延迟的最大值<code>min-slaves-max-lag</code>，以及执行写操作所需的至少从服务器数量<code>min-slaves-to-write</code>.</li>\n</ul>\n<p>如果至少有<code>min-slaves-to-write</code>个服务器，并且这些服务器的延迟都少于<code>min-slaves-max-lag</code>秒，那么主服务器就会执行客户端请求的写操作。<br>尽管不能保证写操作的持久性，但起码丢失数据的窗口会被严格限制的指定的秒数中。<br>另一方面，如果条件达不到<code>min-slaves-to-write</code>和<code>min-slaves-max-lag</code>所指定的条件，那么写操作就不会被执行，主服务器会向请求执行写操作的客户端返回一个错误。<br>以下是这个特性的两个选项和它们所需的参数：</p>\n<ul>\n<li><code>min-slaves-to-write &lt;number of slaves&gt;</code></li>\n<li><code>min-slaves-max-lag &lt;number of second&gt;</code></li>\n</ul>\n"},{"title":"Redis持久化","date":"2018-10-16T12:46:09.000Z","_content":"\n\n## 1. Redis持久化 \n\nRedis提供了多种不同级别的持久化方式：\n- RDB持久化可以在指定的时间间隔内生成数据集的时间点快照。\n- AOF持久化记录服务器执行的所有写操作命令，并在服务器启动时，通过重新执行这些命令来还原数据集。  \n  AOF文件中的命令全部以Redis协议的格式来保存，新命令会被追加到文件的末尾。   \n  **Redis还可以在后台对AOF文件进行重写，使得AOF文件的体积不会超出保存数据集状态所需的实际大小。**\n- Redis还可以同时使用AOF持久化和RDB持久化。在这种情况下，当Redis重启时，它会优先使用AOF文件来还原数据集，因为AOF文件保存的数据集通常比 RDB 文件所保存的数据集更完整。\n- 你甚至可以关闭持久化功能，让数据只在服务器运行时存在。\n\n## 2. RDB的优点\n\n- RDB是一个非常紧凑的文件，它保存了Redis在某个时间点上的数据集。这种文件非常适合用于进行备份:比如说，你可以每小时备份一次RDB文件，这样的话，即使遇上问题，也可以随时将数据集还原到不同的版本。\n- RDB非常适用于灾难恢复：它只有一个文件，并且内容都非常紧凑。\n- RDB最大化Redis的性能：父进程在保存RDB文件时唯一要做的就是`fork`出一个子进程，然后这个子进程就会处理接下来的所有保存工作，父进程无须执行任何磁盘I/O操作。\n- RDB在恢复大数据集时的速度比AOF的恢复速度快。\n\n## 3. RDB的缺点\n- RDB不适用于尽量避免在服务器故障时丢失数据。虽然Redis允许你设置不同的保存点来控制保存RDB文件的频率，但是，因为RDB文件需要保存整个数据集的状态，所以它并不是一个轻松的操作。因此你可能会至少5分钟才保存一次RDB文件。在这种情况下，一旦发生故障停机，你就可能丢失好几分钟的数据。\n- 每次保存RDB文件的时候，Redis都要`fork()`出一个子进程，并由子进程来进行实际的持久化工作。在数据集比较庞大时，`fork()`可能会非常耗时，造成服务器在某某毫秒内停止处理客户端；如果数据集非常巨大，并且CPU时间非常紧张的话，那么这种停止时间甚至可能会长达整整一秒。虽然AOF重写也需要进行`fork()`,但无论AOF重写的执行间隔有多长，数据的耐久性都不会又任何损失。\n\n## 4. AOF的优点\n\n- 使用AOF持久化会让Redis变得非常耐久  \n你可以设置不同的`fsync`策略，比如：无`fsync`、每秒一次`fsync`或者每次执行写入命令时`fsync`\n**AOF默认策略为每秒钟`fsync`一次**，在这种配置下，Redis仍然可以保持良好的性能，并且就算发生故障停机，也最多只会丢失一秒钟的数据。（`fsync`会在后台线程执行，所以主线程可以继续努力地处理命令请求）\n- AOF文件是一个只进行追加操作的日志文件，因此对AOF文件的写入不需要进行`seek`，即使日志因为某些原因而包含了未写入完整的命令（比如写入时磁盘已满，写入中途停机等），`redis-check-aof`工具也可以轻易的修复这种问题。\n- Redis可以在AOF文件体积变得过大时，自动地在后台对AOF进行重写。重写后的新AOF文件包含了恢复当前数据集所需的最小命令集合。整个重写操作是绝对安全的，因为Redis在创建新AOF文件的过程中，会继续将命令追加到现有AOF文件里面，即使重写过程中发生停机，现有的AOF文件也不会丢失。而一旦新AOF文件创建完毕，Redis就会从旧AOF文件切换到新AOF文件，并开始对新AOF文件进行追加操作。\n- AOF文件有序地保存了对数据库执行的所有写入操作，这些写入操作以Redis协议的格式保存，因此，AOF文件的内容非常容易被人读懂，对文件进行分析也很轻松。导出AOF文件也非常简单：举个例子，如果你不小心执行了`FLUSHALL`命令，只要AOF文件没有被重写，那么只要停止服务器，移除AOF文件末尾的`FLUSHALL`命令，并重启Redis，就可以将数据集恢复到`FLUSHALL`执行之前的状态。\n\n## 5. AOF的缺点\n- 对于相同的数据集来说，AOF文件的要大于RDB文件。\n- 根据所使用的`fsync`策略，AOF的速度可能会慢于RDB。在一般情况下，每秒`fsync`的性能依然非常高，而关闭`fsync`可以让AOF的速度和RDB一样快，即使在高负荷之下也是如此。不过在处理巨大的写入载入时，RDB可以提供更有保证的最大延迟时间。\n- AOF在过去曾经发生过**因为个别命令的原因，导致AOF文件在重新载入时，无法将数据集恢复成保存时的原样**的bug.(例如：阻塞命令`BRPOPLPUSH`就曾经引起过这样的bug)测试套件里为这种情况添加了测试：它们会自动生成随机的、复杂的数据集，并通过重新载入这些数据来确保一切正常。虽然这种bug在AOF文件中并不常见，单对比来说，RDB几乎是不可能出现这种bug的。\n\n## 6. RDB和AOF的选择\n\n- 一般来说。如果想要达到足以媲美PostgreSQL的数据安全性，应该同时使用这两种持久化功能。\n- 如果非常关心数据，但是仍然可以承受数分钟以内的数据丢失，那么可以只使用RDB持久化。\n- 不推荐只使用AOF持久化，因为定时生成RDB快照非常便于进行数据库备份，并且RDB恢复数据集的速度也要比AOF恢复的速度要快，除此之外，使用RDB还可以避免之前提到的AOF相关的bug。\n将来可能将AOF和RDB整合成单个持久化模型。\n\n## 7. RDB快照\n默认情况下，Redis将数据库快照保存在名字为`dump.rdb`的二进制文件中。  \n可以对Redis进行设置，让它满足在**N 秒内数据集至少有M个改动**时自动保存一次数据集。  \n也可以通过调用`SAVE`或`BGSAVE`手动让Redis进行数据集保存操作。  \n比如，以下设置会让Redis在满足60秒内有至少1000个键被改动时自动保存一次数据集  \n`save 60 1000`  \n这种持久化方式被称为快照。\n\n## 8. 快照的运作方式\n当Redis需要保存`dump.rdb`文件时，服务器执行以下操作\n1. Redis调用`fork()`,同时拥有父进程和子进程。\n1. 子进程将数据集写入到一个临时RDB文件中。\n3. 当子进程完成对新RDB文件的写入时，Redis用新RDB文件替换原来的RDB文件，并删除旧的RDB文件。  \n这种工作方式使得Redis可以从写时复制机制中获益。\n\n\n## 9. 只进行追加操作的文件aof\n快照功能并不是非常耐久：如果Redis因为某些原因而造成故障停机，那么服务器将丢失最近写入且仍未保存到快照中的哪些数据。\n尽管对于某些程序来说，数据耐久性并不是最重要的考虑因素，但是对于那些追求完全耐久能力的程序来说，快照功能就不太适用了。  \n打开AOF功能\n```\nappendonly yes\n```\n从现在开始，每当Redis执行一个改变数据集的命令时，这个命令就会被追加到AOF文件的末尾。  \n这样的话，当Redis重新启动时，程序就可以通过重新执行AOF文件中的命令来达到重建数据集的目的。 \n\n\n## 10. AOF重写\n因为AOF的运作方式是不断地将命令追加到文件的末尾，所以随着写入命令的不断增加，AOF文件的体积也会变得越来越大。\n例如：如果你对一个计数器调用了100次`INCR`，那么仅仅是为了保存这个计数器的当前值，AOF文件就需要使用100条记录。\n然而实际上，只需要一条`SET`命令已经足以保存计数器的当前值了，其余99条记录实际上都是多余的。\n为了处理这种情况，Redis支持一种有趣的特性：可以在不打断服务客户端的情况下，对AOF文件进行重建。\n执行`BGREWRITEAOF`命令，Redis将生成一个新的AOF文件，这个文件包含重建当前数据集所需的最少命令。\n\n## 11. AOF有多耐久\n可以配置Redis多久才将数据`fsync`磁盘一次。  \n有三个选项：\n- 每次有新命令追加到AOF文件时就执行一次`fsync`:非常慢，也非常安全。\n- 每秒`fsync`一次：足够快（和使用RDB持久化差不多），并且在故障时只会丢失1秒的数据。\n- 从不`fsync`:将数据交给操作系统来处理。更快，也更不安全的选择。\n推荐并且默认的措施是每秒`fsync`一次，这种`fsync`策略可以兼顾速度和安全性。\n\n## 12. 如果AOF文件出错了，怎么办？\n服务器可能在程序正在对AOF文件进行写入是停机，如果停机造成了AOF文件出错，那么Redis在重启时会拒绝载入这个AOF文件，从而确保数据的一致性不会被破坏。  \n当发生这种情况时，可以使用以下方法来修复出错的AOF文件：\n1. 为现有的AOF文件创建一个备份\n2. 使用Redis附带的`Redis-check-aof`程序对原来的AOF文件进行修复。\n```\n$ redis-check-aof --fix\n```\n3. [可选] 使用`diff -u`对比修复后的AOF文件和原始AOF文件的备份。查看两个文件之间的不同之处。\n4. 重启Redis服务器，等待服务器载入修复后的AOF文件，并进行数据恢复。\n\n\n## 13. AOF的运作方式\nAOF重写和RDB创建快照一样，都巧妙地利用了写时复制。  \n以下是AOF重写的执行步骤：\n1. Redis执行`fork()`，现在同时拥有父进程和子进程。\n2. 子进程开始将新AOF文件的内容写入到临时文件。\n3. 对于所有新执行的写入命令，父进程一边将它们积累到一个内存缓存中，一边将这些改动追加到现有AOF文件的末尾：这样即使在重写的中途发生停机，现有的AOF文件也还是安全的。\n4. 当子进程完成重写工作时，它给父进程发送一个信号，父进程在接收到信号后，将内存缓存中的所有数据追加到新AOF文件的末尾。\n5. 现在Redis原子地用新文件替换旧文件，之后所有命令都会直接追加到新AOF文件的末尾。\n\n\n## 14. 怎么从RDB持久化切换到AOF持久化\n在Redis2.2或以上版本，可以在不重启的情况下，从RDB切换到AOF：  \n1. 为最新的`dump.rdb`文件创建一个备份。\n2. 将备份放到一个安全的地方。\n3. 执行以下两条命令：\n```\n开启AOF功能：Redis会阻塞直到初始AOF文件创建完成为止，之后Redis会继续处理命令请求，并开始将写入命令追加到AOF文件末尾  \nredis-cli> CONFIG SET appendonly yes  \n关闭RDB功能 这一步是可选的，如果愿意的话也可以同时使用RDB和AOF这两种持久化功能\nredis-cli> CONFIG SET save \" \"\n```\n4. 确保命令执行之后，数据库的键的数量没有改变。  \n5. 确保写命令会被正确地追加到AOF文件的末尾。  \n**别忘了在配置文件中打开AOF功能！否则，服务器重启之后，之前通过`CONFIG SET`设置的配置就会被遗忘，程序会按原来的配置启动服务器**\n**<font color=red>不可以直接修改配置文件重启服务，这样会从空的aof文件里读取，导致数据集被清空</font>**\n\n## 15. RDB和AOF之间的相互作用\n在版本号大于等于2.4的Redis中，`BGSAVE`执行的过程中，不可以执行`BGREWRITEAOF`  \n反过来，在`BGREWRITEAOF`执行的过程中，也不可以执行`BGSAVE`  \n这可以防止两个Redis后台进程同时对磁盘进行大量的I/O操作。\n如果`BGSAVE`正在执行，并且用户显式地调用`BGREWRITEAOF`命令，那么服务器将向用户回复一个OK状态，并告知用户。\n`BGREWRITEAOF`已经被预订执行：一旦`BGSAVE`执行完毕，`BGREWRITEAOF`就会正式开始。  \n当Redis启动时，如果RDB持久化和AOF持久化都被打开了，那么程序会优先使用AOF文件来恢复数据集，因为AOF文件所保存的数据通常是最完整的。\n\n## 16. 备份Redis数据\n一定要备份你的数据库！\n磁盘故障，节点失效，诸如此类的问题都可能让你的数据消失不见，不进行备份是非常危险的\nRedis对于数据备份是非常友好的，因为你可以在服务器运行时对RDB文件进行复制：RDB文件一旦被创建，就不会进行任何修改。当服务器要创建一个新的RDB文件时，它先将文件的内容保存在一个临时文件里面，当临时文件写入完毕时，程序才使用rename原子地用临时文件替换原来的RDB文件。  \n也就是说，无论何时，复制RDB文件都是绝对安全的。\n\n\n","source":"_posts/Redis持久化.md","raw":"---\ntitle: Redis持久化\ndate: 2018-10-16 20:46:09\ntags: Redis\n---\n\n\n## 1. Redis持久化 \n\nRedis提供了多种不同级别的持久化方式：\n- RDB持久化可以在指定的时间间隔内生成数据集的时间点快照。\n- AOF持久化记录服务器执行的所有写操作命令，并在服务器启动时，通过重新执行这些命令来还原数据集。  \n  AOF文件中的命令全部以Redis协议的格式来保存，新命令会被追加到文件的末尾。   \n  **Redis还可以在后台对AOF文件进行重写，使得AOF文件的体积不会超出保存数据集状态所需的实际大小。**\n- Redis还可以同时使用AOF持久化和RDB持久化。在这种情况下，当Redis重启时，它会优先使用AOF文件来还原数据集，因为AOF文件保存的数据集通常比 RDB 文件所保存的数据集更完整。\n- 你甚至可以关闭持久化功能，让数据只在服务器运行时存在。\n\n## 2. RDB的优点\n\n- RDB是一个非常紧凑的文件，它保存了Redis在某个时间点上的数据集。这种文件非常适合用于进行备份:比如说，你可以每小时备份一次RDB文件，这样的话，即使遇上问题，也可以随时将数据集还原到不同的版本。\n- RDB非常适用于灾难恢复：它只有一个文件，并且内容都非常紧凑。\n- RDB最大化Redis的性能：父进程在保存RDB文件时唯一要做的就是`fork`出一个子进程，然后这个子进程就会处理接下来的所有保存工作，父进程无须执行任何磁盘I/O操作。\n- RDB在恢复大数据集时的速度比AOF的恢复速度快。\n\n## 3. RDB的缺点\n- RDB不适用于尽量避免在服务器故障时丢失数据。虽然Redis允许你设置不同的保存点来控制保存RDB文件的频率，但是，因为RDB文件需要保存整个数据集的状态，所以它并不是一个轻松的操作。因此你可能会至少5分钟才保存一次RDB文件。在这种情况下，一旦发生故障停机，你就可能丢失好几分钟的数据。\n- 每次保存RDB文件的时候，Redis都要`fork()`出一个子进程，并由子进程来进行实际的持久化工作。在数据集比较庞大时，`fork()`可能会非常耗时，造成服务器在某某毫秒内停止处理客户端；如果数据集非常巨大，并且CPU时间非常紧张的话，那么这种停止时间甚至可能会长达整整一秒。虽然AOF重写也需要进行`fork()`,但无论AOF重写的执行间隔有多长，数据的耐久性都不会又任何损失。\n\n## 4. AOF的优点\n\n- 使用AOF持久化会让Redis变得非常耐久  \n你可以设置不同的`fsync`策略，比如：无`fsync`、每秒一次`fsync`或者每次执行写入命令时`fsync`\n**AOF默认策略为每秒钟`fsync`一次**，在这种配置下，Redis仍然可以保持良好的性能，并且就算发生故障停机，也最多只会丢失一秒钟的数据。（`fsync`会在后台线程执行，所以主线程可以继续努力地处理命令请求）\n- AOF文件是一个只进行追加操作的日志文件，因此对AOF文件的写入不需要进行`seek`，即使日志因为某些原因而包含了未写入完整的命令（比如写入时磁盘已满，写入中途停机等），`redis-check-aof`工具也可以轻易的修复这种问题。\n- Redis可以在AOF文件体积变得过大时，自动地在后台对AOF进行重写。重写后的新AOF文件包含了恢复当前数据集所需的最小命令集合。整个重写操作是绝对安全的，因为Redis在创建新AOF文件的过程中，会继续将命令追加到现有AOF文件里面，即使重写过程中发生停机，现有的AOF文件也不会丢失。而一旦新AOF文件创建完毕，Redis就会从旧AOF文件切换到新AOF文件，并开始对新AOF文件进行追加操作。\n- AOF文件有序地保存了对数据库执行的所有写入操作，这些写入操作以Redis协议的格式保存，因此，AOF文件的内容非常容易被人读懂，对文件进行分析也很轻松。导出AOF文件也非常简单：举个例子，如果你不小心执行了`FLUSHALL`命令，只要AOF文件没有被重写，那么只要停止服务器，移除AOF文件末尾的`FLUSHALL`命令，并重启Redis，就可以将数据集恢复到`FLUSHALL`执行之前的状态。\n\n## 5. AOF的缺点\n- 对于相同的数据集来说，AOF文件的要大于RDB文件。\n- 根据所使用的`fsync`策略，AOF的速度可能会慢于RDB。在一般情况下，每秒`fsync`的性能依然非常高，而关闭`fsync`可以让AOF的速度和RDB一样快，即使在高负荷之下也是如此。不过在处理巨大的写入载入时，RDB可以提供更有保证的最大延迟时间。\n- AOF在过去曾经发生过**因为个别命令的原因，导致AOF文件在重新载入时，无法将数据集恢复成保存时的原样**的bug.(例如：阻塞命令`BRPOPLPUSH`就曾经引起过这样的bug)测试套件里为这种情况添加了测试：它们会自动生成随机的、复杂的数据集，并通过重新载入这些数据来确保一切正常。虽然这种bug在AOF文件中并不常见，单对比来说，RDB几乎是不可能出现这种bug的。\n\n## 6. RDB和AOF的选择\n\n- 一般来说。如果想要达到足以媲美PostgreSQL的数据安全性，应该同时使用这两种持久化功能。\n- 如果非常关心数据，但是仍然可以承受数分钟以内的数据丢失，那么可以只使用RDB持久化。\n- 不推荐只使用AOF持久化，因为定时生成RDB快照非常便于进行数据库备份，并且RDB恢复数据集的速度也要比AOF恢复的速度要快，除此之外，使用RDB还可以避免之前提到的AOF相关的bug。\n将来可能将AOF和RDB整合成单个持久化模型。\n\n## 7. RDB快照\n默认情况下，Redis将数据库快照保存在名字为`dump.rdb`的二进制文件中。  \n可以对Redis进行设置，让它满足在**N 秒内数据集至少有M个改动**时自动保存一次数据集。  \n也可以通过调用`SAVE`或`BGSAVE`手动让Redis进行数据集保存操作。  \n比如，以下设置会让Redis在满足60秒内有至少1000个键被改动时自动保存一次数据集  \n`save 60 1000`  \n这种持久化方式被称为快照。\n\n## 8. 快照的运作方式\n当Redis需要保存`dump.rdb`文件时，服务器执行以下操作\n1. Redis调用`fork()`,同时拥有父进程和子进程。\n1. 子进程将数据集写入到一个临时RDB文件中。\n3. 当子进程完成对新RDB文件的写入时，Redis用新RDB文件替换原来的RDB文件，并删除旧的RDB文件。  \n这种工作方式使得Redis可以从写时复制机制中获益。\n\n\n## 9. 只进行追加操作的文件aof\n快照功能并不是非常耐久：如果Redis因为某些原因而造成故障停机，那么服务器将丢失最近写入且仍未保存到快照中的哪些数据。\n尽管对于某些程序来说，数据耐久性并不是最重要的考虑因素，但是对于那些追求完全耐久能力的程序来说，快照功能就不太适用了。  \n打开AOF功能\n```\nappendonly yes\n```\n从现在开始，每当Redis执行一个改变数据集的命令时，这个命令就会被追加到AOF文件的末尾。  \n这样的话，当Redis重新启动时，程序就可以通过重新执行AOF文件中的命令来达到重建数据集的目的。 \n\n\n## 10. AOF重写\n因为AOF的运作方式是不断地将命令追加到文件的末尾，所以随着写入命令的不断增加，AOF文件的体积也会变得越来越大。\n例如：如果你对一个计数器调用了100次`INCR`，那么仅仅是为了保存这个计数器的当前值，AOF文件就需要使用100条记录。\n然而实际上，只需要一条`SET`命令已经足以保存计数器的当前值了，其余99条记录实际上都是多余的。\n为了处理这种情况，Redis支持一种有趣的特性：可以在不打断服务客户端的情况下，对AOF文件进行重建。\n执行`BGREWRITEAOF`命令，Redis将生成一个新的AOF文件，这个文件包含重建当前数据集所需的最少命令。\n\n## 11. AOF有多耐久\n可以配置Redis多久才将数据`fsync`磁盘一次。  \n有三个选项：\n- 每次有新命令追加到AOF文件时就执行一次`fsync`:非常慢，也非常安全。\n- 每秒`fsync`一次：足够快（和使用RDB持久化差不多），并且在故障时只会丢失1秒的数据。\n- 从不`fsync`:将数据交给操作系统来处理。更快，也更不安全的选择。\n推荐并且默认的措施是每秒`fsync`一次，这种`fsync`策略可以兼顾速度和安全性。\n\n## 12. 如果AOF文件出错了，怎么办？\n服务器可能在程序正在对AOF文件进行写入是停机，如果停机造成了AOF文件出错，那么Redis在重启时会拒绝载入这个AOF文件，从而确保数据的一致性不会被破坏。  \n当发生这种情况时，可以使用以下方法来修复出错的AOF文件：\n1. 为现有的AOF文件创建一个备份\n2. 使用Redis附带的`Redis-check-aof`程序对原来的AOF文件进行修复。\n```\n$ redis-check-aof --fix\n```\n3. [可选] 使用`diff -u`对比修复后的AOF文件和原始AOF文件的备份。查看两个文件之间的不同之处。\n4. 重启Redis服务器，等待服务器载入修复后的AOF文件，并进行数据恢复。\n\n\n## 13. AOF的运作方式\nAOF重写和RDB创建快照一样，都巧妙地利用了写时复制。  \n以下是AOF重写的执行步骤：\n1. Redis执行`fork()`，现在同时拥有父进程和子进程。\n2. 子进程开始将新AOF文件的内容写入到临时文件。\n3. 对于所有新执行的写入命令，父进程一边将它们积累到一个内存缓存中，一边将这些改动追加到现有AOF文件的末尾：这样即使在重写的中途发生停机，现有的AOF文件也还是安全的。\n4. 当子进程完成重写工作时，它给父进程发送一个信号，父进程在接收到信号后，将内存缓存中的所有数据追加到新AOF文件的末尾。\n5. 现在Redis原子地用新文件替换旧文件，之后所有命令都会直接追加到新AOF文件的末尾。\n\n\n## 14. 怎么从RDB持久化切换到AOF持久化\n在Redis2.2或以上版本，可以在不重启的情况下，从RDB切换到AOF：  \n1. 为最新的`dump.rdb`文件创建一个备份。\n2. 将备份放到一个安全的地方。\n3. 执行以下两条命令：\n```\n开启AOF功能：Redis会阻塞直到初始AOF文件创建完成为止，之后Redis会继续处理命令请求，并开始将写入命令追加到AOF文件末尾  \nredis-cli> CONFIG SET appendonly yes  \n关闭RDB功能 这一步是可选的，如果愿意的话也可以同时使用RDB和AOF这两种持久化功能\nredis-cli> CONFIG SET save \" \"\n```\n4. 确保命令执行之后，数据库的键的数量没有改变。  \n5. 确保写命令会被正确地追加到AOF文件的末尾。  \n**别忘了在配置文件中打开AOF功能！否则，服务器重启之后，之前通过`CONFIG SET`设置的配置就会被遗忘，程序会按原来的配置启动服务器**\n**<font color=red>不可以直接修改配置文件重启服务，这样会从空的aof文件里读取，导致数据集被清空</font>**\n\n## 15. RDB和AOF之间的相互作用\n在版本号大于等于2.4的Redis中，`BGSAVE`执行的过程中，不可以执行`BGREWRITEAOF`  \n反过来，在`BGREWRITEAOF`执行的过程中，也不可以执行`BGSAVE`  \n这可以防止两个Redis后台进程同时对磁盘进行大量的I/O操作。\n如果`BGSAVE`正在执行，并且用户显式地调用`BGREWRITEAOF`命令，那么服务器将向用户回复一个OK状态，并告知用户。\n`BGREWRITEAOF`已经被预订执行：一旦`BGSAVE`执行完毕，`BGREWRITEAOF`就会正式开始。  \n当Redis启动时，如果RDB持久化和AOF持久化都被打开了，那么程序会优先使用AOF文件来恢复数据集，因为AOF文件所保存的数据通常是最完整的。\n\n## 16. 备份Redis数据\n一定要备份你的数据库！\n磁盘故障，节点失效，诸如此类的问题都可能让你的数据消失不见，不进行备份是非常危险的\nRedis对于数据备份是非常友好的，因为你可以在服务器运行时对RDB文件进行复制：RDB文件一旦被创建，就不会进行任何修改。当服务器要创建一个新的RDB文件时，它先将文件的内容保存在一个临时文件里面，当临时文件写入完毕时，程序才使用rename原子地用临时文件替换原来的RDB文件。  \n也就是说，无论何时，复制RDB文件都是绝对安全的。\n\n\n","slug":"Redis持久化","published":1,"updated":"2018-10-18T13:17:35.825Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4j0007zahiqq61z1kh","content":"<h2 id=\"1-Redis持久化\"><a href=\"#1-Redis持久化\" class=\"headerlink\" title=\"1. Redis持久化\"></a>1. Redis持久化</h2><p>Redis提供了多种不同级别的持久化方式：</p>\n<ul>\n<li>RDB持久化可以在指定的时间间隔内生成数据集的时间点快照。</li>\n<li>AOF持久化记录服务器执行的所有写操作命令，并在服务器启动时，通过重新执行这些命令来还原数据集。<br>AOF文件中的命令全部以Redis协议的格式来保存，新命令会被追加到文件的末尾。<br><strong>Redis还可以在后台对AOF文件进行重写，使得AOF文件的体积不会超出保存数据集状态所需的实际大小。</strong></li>\n<li>Redis还可以同时使用AOF持久化和RDB持久化。在这种情况下，当Redis重启时，它会优先使用AOF文件来还原数据集，因为AOF文件保存的数据集通常比 RDB 文件所保存的数据集更完整。</li>\n<li>你甚至可以关闭持久化功能，让数据只在服务器运行时存在。</li>\n</ul>\n<h2 id=\"2-RDB的优点\"><a href=\"#2-RDB的优点\" class=\"headerlink\" title=\"2. RDB的优点\"></a>2. RDB的优点</h2><ul>\n<li>RDB是一个非常紧凑的文件，它保存了Redis在某个时间点上的数据集。这种文件非常适合用于进行备份:比如说，你可以每小时备份一次RDB文件，这样的话，即使遇上问题，也可以随时将数据集还原到不同的版本。</li>\n<li>RDB非常适用于灾难恢复：它只有一个文件，并且内容都非常紧凑。</li>\n<li>RDB最大化Redis的性能：父进程在保存RDB文件时唯一要做的就是<code>fork</code>出一个子进程，然后这个子进程就会处理接下来的所有保存工作，父进程无须执行任何磁盘I/O操作。</li>\n<li>RDB在恢复大数据集时的速度比AOF的恢复速度快。</li>\n</ul>\n<h2 id=\"3-RDB的缺点\"><a href=\"#3-RDB的缺点\" class=\"headerlink\" title=\"3. RDB的缺点\"></a>3. RDB的缺点</h2><ul>\n<li>RDB不适用于尽量避免在服务器故障时丢失数据。虽然Redis允许你设置不同的保存点来控制保存RDB文件的频率，但是，因为RDB文件需要保存整个数据集的状态，所以它并不是一个轻松的操作。因此你可能会至少5分钟才保存一次RDB文件。在这种情况下，一旦发生故障停机，你就可能丢失好几分钟的数据。</li>\n<li>每次保存RDB文件的时候，Redis都要<code>fork()</code>出一个子进程，并由子进程来进行实际的持久化工作。在数据集比较庞大时，<code>fork()</code>可能会非常耗时，造成服务器在某某毫秒内停止处理客户端；如果数据集非常巨大，并且CPU时间非常紧张的话，那么这种停止时间甚至可能会长达整整一秒。虽然AOF重写也需要进行<code>fork()</code>,但无论AOF重写的执行间隔有多长，数据的耐久性都不会又任何损失。</li>\n</ul>\n<h2 id=\"4-AOF的优点\"><a href=\"#4-AOF的优点\" class=\"headerlink\" title=\"4. AOF的优点\"></a>4. AOF的优点</h2><ul>\n<li>使用AOF持久化会让Redis变得非常耐久<br>你可以设置不同的<code>fsync</code>策略，比如：无<code>fsync</code>、每秒一次<code>fsync</code>或者每次执行写入命令时<code>fsync</code><br><strong>AOF默认策略为每秒钟<code>fsync</code>一次</strong>，在这种配置下，Redis仍然可以保持良好的性能，并且就算发生故障停机，也最多只会丢失一秒钟的数据。（<code>fsync</code>会在后台线程执行，所以主线程可以继续努力地处理命令请求）</li>\n<li>AOF文件是一个只进行追加操作的日志文件，因此对AOF文件的写入不需要进行<code>seek</code>，即使日志因为某些原因而包含了未写入完整的命令（比如写入时磁盘已满，写入中途停机等），<code>redis-check-aof</code>工具也可以轻易的修复这种问题。</li>\n<li>Redis可以在AOF文件体积变得过大时，自动地在后台对AOF进行重写。重写后的新AOF文件包含了恢复当前数据集所需的最小命令集合。整个重写操作是绝对安全的，因为Redis在创建新AOF文件的过程中，会继续将命令追加到现有AOF文件里面，即使重写过程中发生停机，现有的AOF文件也不会丢失。而一旦新AOF文件创建完毕，Redis就会从旧AOF文件切换到新AOF文件，并开始对新AOF文件进行追加操作。</li>\n<li>AOF文件有序地保存了对数据库执行的所有写入操作，这些写入操作以Redis协议的格式保存，因此，AOF文件的内容非常容易被人读懂，对文件进行分析也很轻松。导出AOF文件也非常简单：举个例子，如果你不小心执行了<code>FLUSHALL</code>命令，只要AOF文件没有被重写，那么只要停止服务器，移除AOF文件末尾的<code>FLUSHALL</code>命令，并重启Redis，就可以将数据集恢复到<code>FLUSHALL</code>执行之前的状态。</li>\n</ul>\n<h2 id=\"5-AOF的缺点\"><a href=\"#5-AOF的缺点\" class=\"headerlink\" title=\"5. AOF的缺点\"></a>5. AOF的缺点</h2><ul>\n<li>对于相同的数据集来说，AOF文件的要大于RDB文件。</li>\n<li>根据所使用的<code>fsync</code>策略，AOF的速度可能会慢于RDB。在一般情况下，每秒<code>fsync</code>的性能依然非常高，而关闭<code>fsync</code>可以让AOF的速度和RDB一样快，即使在高负荷之下也是如此。不过在处理巨大的写入载入时，RDB可以提供更有保证的最大延迟时间。</li>\n<li>AOF在过去曾经发生过<strong>因为个别命令的原因，导致AOF文件在重新载入时，无法将数据集恢复成保存时的原样</strong>的bug.(例如：阻塞命令<code>BRPOPLPUSH</code>就曾经引起过这样的bug)测试套件里为这种情况添加了测试：它们会自动生成随机的、复杂的数据集，并通过重新载入这些数据来确保一切正常。虽然这种bug在AOF文件中并不常见，单对比来说，RDB几乎是不可能出现这种bug的。</li>\n</ul>\n<h2 id=\"6-RDB和AOF的选择\"><a href=\"#6-RDB和AOF的选择\" class=\"headerlink\" title=\"6. RDB和AOF的选择\"></a>6. RDB和AOF的选择</h2><ul>\n<li>一般来说。如果想要达到足以媲美PostgreSQL的数据安全性，应该同时使用这两种持久化功能。</li>\n<li>如果非常关心数据，但是仍然可以承受数分钟以内的数据丢失，那么可以只使用RDB持久化。</li>\n<li>不推荐只使用AOF持久化，因为定时生成RDB快照非常便于进行数据库备份，并且RDB恢复数据集的速度也要比AOF恢复的速度要快，除此之外，使用RDB还可以避免之前提到的AOF相关的bug。<br>将来可能将AOF和RDB整合成单个持久化模型。</li>\n</ul>\n<h2 id=\"7-RDB快照\"><a href=\"#7-RDB快照\" class=\"headerlink\" title=\"7. RDB快照\"></a>7. RDB快照</h2><p>默认情况下，Redis将数据库快照保存在名字为<code>dump.rdb</code>的二进制文件中。<br>可以对Redis进行设置，让它满足在<strong>N 秒内数据集至少有M个改动</strong>时自动保存一次数据集。<br>也可以通过调用<code>SAVE</code>或<code>BGSAVE</code>手动让Redis进行数据集保存操作。<br>比如，以下设置会让Redis在满足60秒内有至少1000个键被改动时自动保存一次数据集<br><code>save 60 1000</code><br>这种持久化方式被称为快照。</p>\n<h2 id=\"8-快照的运作方式\"><a href=\"#8-快照的运作方式\" class=\"headerlink\" title=\"8. 快照的运作方式\"></a>8. 快照的运作方式</h2><p>当Redis需要保存<code>dump.rdb</code>文件时，服务器执行以下操作</p>\n<ol>\n<li>Redis调用<code>fork()</code>,同时拥有父进程和子进程。</li>\n<li>子进程将数据集写入到一个临时RDB文件中。</li>\n<li>当子进程完成对新RDB文件的写入时，Redis用新RDB文件替换原来的RDB文件，并删除旧的RDB文件。<br>这种工作方式使得Redis可以从写时复制机制中获益。</li>\n</ol>\n<h2 id=\"9-只进行追加操作的文件aof\"><a href=\"#9-只进行追加操作的文件aof\" class=\"headerlink\" title=\"9. 只进行追加操作的文件aof\"></a>9. 只进行追加操作的文件aof</h2><p>快照功能并不是非常耐久：如果Redis因为某些原因而造成故障停机，那么服务器将丢失最近写入且仍未保存到快照中的哪些数据。<br>尽管对于某些程序来说，数据耐久性并不是最重要的考虑因素，但是对于那些追求完全耐久能力的程序来说，快照功能就不太适用了。<br>打开AOF功能<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">appendonly yes</span><br></pre></td></tr></table></figure></p>\n<p>从现在开始，每当Redis执行一个改变数据集的命令时，这个命令就会被追加到AOF文件的末尾。<br>这样的话，当Redis重新启动时，程序就可以通过重新执行AOF文件中的命令来达到重建数据集的目的。 </p>\n<h2 id=\"10-AOF重写\"><a href=\"#10-AOF重写\" class=\"headerlink\" title=\"10. AOF重写\"></a>10. AOF重写</h2><p>因为AOF的运作方式是不断地将命令追加到文件的末尾，所以随着写入命令的不断增加，AOF文件的体积也会变得越来越大。<br>例如：如果你对一个计数器调用了100次<code>INCR</code>，那么仅仅是为了保存这个计数器的当前值，AOF文件就需要使用100条记录。<br>然而实际上，只需要一条<code>SET</code>命令已经足以保存计数器的当前值了，其余99条记录实际上都是多余的。<br>为了处理这种情况，Redis支持一种有趣的特性：可以在不打断服务客户端的情况下，对AOF文件进行重建。<br>执行<code>BGREWRITEAOF</code>命令，Redis将生成一个新的AOF文件，这个文件包含重建当前数据集所需的最少命令。</p>\n<h2 id=\"11-AOF有多耐久\"><a href=\"#11-AOF有多耐久\" class=\"headerlink\" title=\"11. AOF有多耐久\"></a>11. AOF有多耐久</h2><p>可以配置Redis多久才将数据<code>fsync</code>磁盘一次。<br>有三个选项：</p>\n<ul>\n<li>每次有新命令追加到AOF文件时就执行一次<code>fsync</code>:非常慢，也非常安全。</li>\n<li>每秒<code>fsync</code>一次：足够快（和使用RDB持久化差不多），并且在故障时只会丢失1秒的数据。</li>\n<li>从不<code>fsync</code>:将数据交给操作系统来处理。更快，也更不安全的选择。<br>推荐并且默认的措施是每秒<code>fsync</code>一次，这种<code>fsync</code>策略可以兼顾速度和安全性。</li>\n</ul>\n<h2 id=\"12-如果AOF文件出错了，怎么办？\"><a href=\"#12-如果AOF文件出错了，怎么办？\" class=\"headerlink\" title=\"12. 如果AOF文件出错了，怎么办？\"></a>12. 如果AOF文件出错了，怎么办？</h2><p>服务器可能在程序正在对AOF文件进行写入是停机，如果停机造成了AOF文件出错，那么Redis在重启时会拒绝载入这个AOF文件，从而确保数据的一致性不会被破坏。<br>当发生这种情况时，可以使用以下方法来修复出错的AOF文件：</p>\n<ol>\n<li>为现有的AOF文件创建一个备份</li>\n<li><p>使用Redis附带的<code>Redis-check-aof</code>程序对原来的AOF文件进行修复。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ redis-check-aof --fix</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>[可选] 使用<code>diff -u</code>对比修复后的AOF文件和原始AOF文件的备份。查看两个文件之间的不同之处。</p>\n</li>\n<li>重启Redis服务器，等待服务器载入修复后的AOF文件，并进行数据恢复。</li>\n</ol>\n<h2 id=\"13-AOF的运作方式\"><a href=\"#13-AOF的运作方式\" class=\"headerlink\" title=\"13. AOF的运作方式\"></a>13. AOF的运作方式</h2><p>AOF重写和RDB创建快照一样，都巧妙地利用了写时复制。<br>以下是AOF重写的执行步骤：</p>\n<ol>\n<li>Redis执行<code>fork()</code>，现在同时拥有父进程和子进程。</li>\n<li>子进程开始将新AOF文件的内容写入到临时文件。</li>\n<li>对于所有新执行的写入命令，父进程一边将它们积累到一个内存缓存中，一边将这些改动追加到现有AOF文件的末尾：这样即使在重写的中途发生停机，现有的AOF文件也还是安全的。</li>\n<li>当子进程完成重写工作时，它给父进程发送一个信号，父进程在接收到信号后，将内存缓存中的所有数据追加到新AOF文件的末尾。</li>\n<li>现在Redis原子地用新文件替换旧文件，之后所有命令都会直接追加到新AOF文件的末尾。</li>\n</ol>\n<h2 id=\"14-怎么从RDB持久化切换到AOF持久化\"><a href=\"#14-怎么从RDB持久化切换到AOF持久化\" class=\"headerlink\" title=\"14. 怎么从RDB持久化切换到AOF持久化\"></a>14. 怎么从RDB持久化切换到AOF持久化</h2><p>在Redis2.2或以上版本，可以在不重启的情况下，从RDB切换到AOF：  </p>\n<ol>\n<li>为最新的<code>dump.rdb</code>文件创建一个备份。</li>\n<li>将备份放到一个安全的地方。</li>\n<li><p>执行以下两条命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">开启AOF功能：Redis会阻塞直到初始AOF文件创建完成为止，之后Redis会继续处理命令请求，并开始将写入命令追加到AOF文件末尾  </span><br><span class=\"line\">redis-cli&gt; CONFIG SET appendonly yes  </span><br><span class=\"line\">关闭RDB功能 这一步是可选的，如果愿意的话也可以同时使用RDB和AOF这两种持久化功能</span><br><span class=\"line\">redis-cli&gt; CONFIG SET save &quot; &quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>确保命令执行之后，数据库的键的数量没有改变。  </p>\n</li>\n<li>确保写命令会被正确地追加到AOF文件的末尾。<br><strong>别忘了在配置文件中打开AOF功能！否则，服务器重启之后，之前通过<code>CONFIG SET</code>设置的配置就会被遗忘，程序会按原来的配置启动服务器</strong><br><strong><font color=\"red\">不可以直接修改配置文件重启服务，这样会从空的aof文件里读取，导致数据集被清空</font></strong></li>\n</ol>\n<h2 id=\"15-RDB和AOF之间的相互作用\"><a href=\"#15-RDB和AOF之间的相互作用\" class=\"headerlink\" title=\"15. RDB和AOF之间的相互作用\"></a>15. RDB和AOF之间的相互作用</h2><p>在版本号大于等于2.4的Redis中，<code>BGSAVE</code>执行的过程中，不可以执行<code>BGREWRITEAOF</code><br>反过来，在<code>BGREWRITEAOF</code>执行的过程中，也不可以执行<code>BGSAVE</code><br>这可以防止两个Redis后台进程同时对磁盘进行大量的I/O操作。<br>如果<code>BGSAVE</code>正在执行，并且用户显式地调用<code>BGREWRITEAOF</code>命令，那么服务器将向用户回复一个OK状态，并告知用户。<br><code>BGREWRITEAOF</code>已经被预订执行：一旦<code>BGSAVE</code>执行完毕，<code>BGREWRITEAOF</code>就会正式开始。<br>当Redis启动时，如果RDB持久化和AOF持久化都被打开了，那么程序会优先使用AOF文件来恢复数据集，因为AOF文件所保存的数据通常是最完整的。</p>\n<h2 id=\"16-备份Redis数据\"><a href=\"#16-备份Redis数据\" class=\"headerlink\" title=\"16. 备份Redis数据\"></a>16. 备份Redis数据</h2><p>一定要备份你的数据库！<br>磁盘故障，节点失效，诸如此类的问题都可能让你的数据消失不见，不进行备份是非常危险的<br>Redis对于数据备份是非常友好的，因为你可以在服务器运行时对RDB文件进行复制：RDB文件一旦被创建，就不会进行任何修改。当服务器要创建一个新的RDB文件时，它先将文件的内容保存在一个临时文件里面，当临时文件写入完毕时，程序才使用rename原子地用临时文件替换原来的RDB文件。<br>也就是说，无论何时，复制RDB文件都是绝对安全的。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Redis持久化\"><a href=\"#1-Redis持久化\" class=\"headerlink\" title=\"1. Redis持久化\"></a>1. Redis持久化</h2><p>Redis提供了多种不同级别的持久化方式：</p>\n<ul>\n<li>RDB持久化可以在指定的时间间隔内生成数据集的时间点快照。</li>\n<li>AOF持久化记录服务器执行的所有写操作命令，并在服务器启动时，通过重新执行这些命令来还原数据集。<br>AOF文件中的命令全部以Redis协议的格式来保存，新命令会被追加到文件的末尾。<br><strong>Redis还可以在后台对AOF文件进行重写，使得AOF文件的体积不会超出保存数据集状态所需的实际大小。</strong></li>\n<li>Redis还可以同时使用AOF持久化和RDB持久化。在这种情况下，当Redis重启时，它会优先使用AOF文件来还原数据集，因为AOF文件保存的数据集通常比 RDB 文件所保存的数据集更完整。</li>\n<li>你甚至可以关闭持久化功能，让数据只在服务器运行时存在。</li>\n</ul>\n<h2 id=\"2-RDB的优点\"><a href=\"#2-RDB的优点\" class=\"headerlink\" title=\"2. RDB的优点\"></a>2. RDB的优点</h2><ul>\n<li>RDB是一个非常紧凑的文件，它保存了Redis在某个时间点上的数据集。这种文件非常适合用于进行备份:比如说，你可以每小时备份一次RDB文件，这样的话，即使遇上问题，也可以随时将数据集还原到不同的版本。</li>\n<li>RDB非常适用于灾难恢复：它只有一个文件，并且内容都非常紧凑。</li>\n<li>RDB最大化Redis的性能：父进程在保存RDB文件时唯一要做的就是<code>fork</code>出一个子进程，然后这个子进程就会处理接下来的所有保存工作，父进程无须执行任何磁盘I/O操作。</li>\n<li>RDB在恢复大数据集时的速度比AOF的恢复速度快。</li>\n</ul>\n<h2 id=\"3-RDB的缺点\"><a href=\"#3-RDB的缺点\" class=\"headerlink\" title=\"3. RDB的缺点\"></a>3. RDB的缺点</h2><ul>\n<li>RDB不适用于尽量避免在服务器故障时丢失数据。虽然Redis允许你设置不同的保存点来控制保存RDB文件的频率，但是，因为RDB文件需要保存整个数据集的状态，所以它并不是一个轻松的操作。因此你可能会至少5分钟才保存一次RDB文件。在这种情况下，一旦发生故障停机，你就可能丢失好几分钟的数据。</li>\n<li>每次保存RDB文件的时候，Redis都要<code>fork()</code>出一个子进程，并由子进程来进行实际的持久化工作。在数据集比较庞大时，<code>fork()</code>可能会非常耗时，造成服务器在某某毫秒内停止处理客户端；如果数据集非常巨大，并且CPU时间非常紧张的话，那么这种停止时间甚至可能会长达整整一秒。虽然AOF重写也需要进行<code>fork()</code>,但无论AOF重写的执行间隔有多长，数据的耐久性都不会又任何损失。</li>\n</ul>\n<h2 id=\"4-AOF的优点\"><a href=\"#4-AOF的优点\" class=\"headerlink\" title=\"4. AOF的优点\"></a>4. AOF的优点</h2><ul>\n<li>使用AOF持久化会让Redis变得非常耐久<br>你可以设置不同的<code>fsync</code>策略，比如：无<code>fsync</code>、每秒一次<code>fsync</code>或者每次执行写入命令时<code>fsync</code><br><strong>AOF默认策略为每秒钟<code>fsync</code>一次</strong>，在这种配置下，Redis仍然可以保持良好的性能，并且就算发生故障停机，也最多只会丢失一秒钟的数据。（<code>fsync</code>会在后台线程执行，所以主线程可以继续努力地处理命令请求）</li>\n<li>AOF文件是一个只进行追加操作的日志文件，因此对AOF文件的写入不需要进行<code>seek</code>，即使日志因为某些原因而包含了未写入完整的命令（比如写入时磁盘已满，写入中途停机等），<code>redis-check-aof</code>工具也可以轻易的修复这种问题。</li>\n<li>Redis可以在AOF文件体积变得过大时，自动地在后台对AOF进行重写。重写后的新AOF文件包含了恢复当前数据集所需的最小命令集合。整个重写操作是绝对安全的，因为Redis在创建新AOF文件的过程中，会继续将命令追加到现有AOF文件里面，即使重写过程中发生停机，现有的AOF文件也不会丢失。而一旦新AOF文件创建完毕，Redis就会从旧AOF文件切换到新AOF文件，并开始对新AOF文件进行追加操作。</li>\n<li>AOF文件有序地保存了对数据库执行的所有写入操作，这些写入操作以Redis协议的格式保存，因此，AOF文件的内容非常容易被人读懂，对文件进行分析也很轻松。导出AOF文件也非常简单：举个例子，如果你不小心执行了<code>FLUSHALL</code>命令，只要AOF文件没有被重写，那么只要停止服务器，移除AOF文件末尾的<code>FLUSHALL</code>命令，并重启Redis，就可以将数据集恢复到<code>FLUSHALL</code>执行之前的状态。</li>\n</ul>\n<h2 id=\"5-AOF的缺点\"><a href=\"#5-AOF的缺点\" class=\"headerlink\" title=\"5. AOF的缺点\"></a>5. AOF的缺点</h2><ul>\n<li>对于相同的数据集来说，AOF文件的要大于RDB文件。</li>\n<li>根据所使用的<code>fsync</code>策略，AOF的速度可能会慢于RDB。在一般情况下，每秒<code>fsync</code>的性能依然非常高，而关闭<code>fsync</code>可以让AOF的速度和RDB一样快，即使在高负荷之下也是如此。不过在处理巨大的写入载入时，RDB可以提供更有保证的最大延迟时间。</li>\n<li>AOF在过去曾经发生过<strong>因为个别命令的原因，导致AOF文件在重新载入时，无法将数据集恢复成保存时的原样</strong>的bug.(例如：阻塞命令<code>BRPOPLPUSH</code>就曾经引起过这样的bug)测试套件里为这种情况添加了测试：它们会自动生成随机的、复杂的数据集，并通过重新载入这些数据来确保一切正常。虽然这种bug在AOF文件中并不常见，单对比来说，RDB几乎是不可能出现这种bug的。</li>\n</ul>\n<h2 id=\"6-RDB和AOF的选择\"><a href=\"#6-RDB和AOF的选择\" class=\"headerlink\" title=\"6. RDB和AOF的选择\"></a>6. RDB和AOF的选择</h2><ul>\n<li>一般来说。如果想要达到足以媲美PostgreSQL的数据安全性，应该同时使用这两种持久化功能。</li>\n<li>如果非常关心数据，但是仍然可以承受数分钟以内的数据丢失，那么可以只使用RDB持久化。</li>\n<li>不推荐只使用AOF持久化，因为定时生成RDB快照非常便于进行数据库备份，并且RDB恢复数据集的速度也要比AOF恢复的速度要快，除此之外，使用RDB还可以避免之前提到的AOF相关的bug。<br>将来可能将AOF和RDB整合成单个持久化模型。</li>\n</ul>\n<h2 id=\"7-RDB快照\"><a href=\"#7-RDB快照\" class=\"headerlink\" title=\"7. RDB快照\"></a>7. RDB快照</h2><p>默认情况下，Redis将数据库快照保存在名字为<code>dump.rdb</code>的二进制文件中。<br>可以对Redis进行设置，让它满足在<strong>N 秒内数据集至少有M个改动</strong>时自动保存一次数据集。<br>也可以通过调用<code>SAVE</code>或<code>BGSAVE</code>手动让Redis进行数据集保存操作。<br>比如，以下设置会让Redis在满足60秒内有至少1000个键被改动时自动保存一次数据集<br><code>save 60 1000</code><br>这种持久化方式被称为快照。</p>\n<h2 id=\"8-快照的运作方式\"><a href=\"#8-快照的运作方式\" class=\"headerlink\" title=\"8. 快照的运作方式\"></a>8. 快照的运作方式</h2><p>当Redis需要保存<code>dump.rdb</code>文件时，服务器执行以下操作</p>\n<ol>\n<li>Redis调用<code>fork()</code>,同时拥有父进程和子进程。</li>\n<li>子进程将数据集写入到一个临时RDB文件中。</li>\n<li>当子进程完成对新RDB文件的写入时，Redis用新RDB文件替换原来的RDB文件，并删除旧的RDB文件。<br>这种工作方式使得Redis可以从写时复制机制中获益。</li>\n</ol>\n<h2 id=\"9-只进行追加操作的文件aof\"><a href=\"#9-只进行追加操作的文件aof\" class=\"headerlink\" title=\"9. 只进行追加操作的文件aof\"></a>9. 只进行追加操作的文件aof</h2><p>快照功能并不是非常耐久：如果Redis因为某些原因而造成故障停机，那么服务器将丢失最近写入且仍未保存到快照中的哪些数据。<br>尽管对于某些程序来说，数据耐久性并不是最重要的考虑因素，但是对于那些追求完全耐久能力的程序来说，快照功能就不太适用了。<br>打开AOF功能<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">appendonly yes</span><br></pre></td></tr></table></figure></p>\n<p>从现在开始，每当Redis执行一个改变数据集的命令时，这个命令就会被追加到AOF文件的末尾。<br>这样的话，当Redis重新启动时，程序就可以通过重新执行AOF文件中的命令来达到重建数据集的目的。 </p>\n<h2 id=\"10-AOF重写\"><a href=\"#10-AOF重写\" class=\"headerlink\" title=\"10. AOF重写\"></a>10. AOF重写</h2><p>因为AOF的运作方式是不断地将命令追加到文件的末尾，所以随着写入命令的不断增加，AOF文件的体积也会变得越来越大。<br>例如：如果你对一个计数器调用了100次<code>INCR</code>，那么仅仅是为了保存这个计数器的当前值，AOF文件就需要使用100条记录。<br>然而实际上，只需要一条<code>SET</code>命令已经足以保存计数器的当前值了，其余99条记录实际上都是多余的。<br>为了处理这种情况，Redis支持一种有趣的特性：可以在不打断服务客户端的情况下，对AOF文件进行重建。<br>执行<code>BGREWRITEAOF</code>命令，Redis将生成一个新的AOF文件，这个文件包含重建当前数据集所需的最少命令。</p>\n<h2 id=\"11-AOF有多耐久\"><a href=\"#11-AOF有多耐久\" class=\"headerlink\" title=\"11. AOF有多耐久\"></a>11. AOF有多耐久</h2><p>可以配置Redis多久才将数据<code>fsync</code>磁盘一次。<br>有三个选项：</p>\n<ul>\n<li>每次有新命令追加到AOF文件时就执行一次<code>fsync</code>:非常慢，也非常安全。</li>\n<li>每秒<code>fsync</code>一次：足够快（和使用RDB持久化差不多），并且在故障时只会丢失1秒的数据。</li>\n<li>从不<code>fsync</code>:将数据交给操作系统来处理。更快，也更不安全的选择。<br>推荐并且默认的措施是每秒<code>fsync</code>一次，这种<code>fsync</code>策略可以兼顾速度和安全性。</li>\n</ul>\n<h2 id=\"12-如果AOF文件出错了，怎么办？\"><a href=\"#12-如果AOF文件出错了，怎么办？\" class=\"headerlink\" title=\"12. 如果AOF文件出错了，怎么办？\"></a>12. 如果AOF文件出错了，怎么办？</h2><p>服务器可能在程序正在对AOF文件进行写入是停机，如果停机造成了AOF文件出错，那么Redis在重启时会拒绝载入这个AOF文件，从而确保数据的一致性不会被破坏。<br>当发生这种情况时，可以使用以下方法来修复出错的AOF文件：</p>\n<ol>\n<li>为现有的AOF文件创建一个备份</li>\n<li><p>使用Redis附带的<code>Redis-check-aof</code>程序对原来的AOF文件进行修复。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ redis-check-aof --fix</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>[可选] 使用<code>diff -u</code>对比修复后的AOF文件和原始AOF文件的备份。查看两个文件之间的不同之处。</p>\n</li>\n<li>重启Redis服务器，等待服务器载入修复后的AOF文件，并进行数据恢复。</li>\n</ol>\n<h2 id=\"13-AOF的运作方式\"><a href=\"#13-AOF的运作方式\" class=\"headerlink\" title=\"13. AOF的运作方式\"></a>13. AOF的运作方式</h2><p>AOF重写和RDB创建快照一样，都巧妙地利用了写时复制。<br>以下是AOF重写的执行步骤：</p>\n<ol>\n<li>Redis执行<code>fork()</code>，现在同时拥有父进程和子进程。</li>\n<li>子进程开始将新AOF文件的内容写入到临时文件。</li>\n<li>对于所有新执行的写入命令，父进程一边将它们积累到一个内存缓存中，一边将这些改动追加到现有AOF文件的末尾：这样即使在重写的中途发生停机，现有的AOF文件也还是安全的。</li>\n<li>当子进程完成重写工作时，它给父进程发送一个信号，父进程在接收到信号后，将内存缓存中的所有数据追加到新AOF文件的末尾。</li>\n<li>现在Redis原子地用新文件替换旧文件，之后所有命令都会直接追加到新AOF文件的末尾。</li>\n</ol>\n<h2 id=\"14-怎么从RDB持久化切换到AOF持久化\"><a href=\"#14-怎么从RDB持久化切换到AOF持久化\" class=\"headerlink\" title=\"14. 怎么从RDB持久化切换到AOF持久化\"></a>14. 怎么从RDB持久化切换到AOF持久化</h2><p>在Redis2.2或以上版本，可以在不重启的情况下，从RDB切换到AOF：  </p>\n<ol>\n<li>为最新的<code>dump.rdb</code>文件创建一个备份。</li>\n<li>将备份放到一个安全的地方。</li>\n<li><p>执行以下两条命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">开启AOF功能：Redis会阻塞直到初始AOF文件创建完成为止，之后Redis会继续处理命令请求，并开始将写入命令追加到AOF文件末尾  </span><br><span class=\"line\">redis-cli&gt; CONFIG SET appendonly yes  </span><br><span class=\"line\">关闭RDB功能 这一步是可选的，如果愿意的话也可以同时使用RDB和AOF这两种持久化功能</span><br><span class=\"line\">redis-cli&gt; CONFIG SET save &quot; &quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>确保命令执行之后，数据库的键的数量没有改变。  </p>\n</li>\n<li>确保写命令会被正确地追加到AOF文件的末尾。<br><strong>别忘了在配置文件中打开AOF功能！否则，服务器重启之后，之前通过<code>CONFIG SET</code>设置的配置就会被遗忘，程序会按原来的配置启动服务器</strong><br><strong><font color=\"red\">不可以直接修改配置文件重启服务，这样会从空的aof文件里读取，导致数据集被清空</font></strong></li>\n</ol>\n<h2 id=\"15-RDB和AOF之间的相互作用\"><a href=\"#15-RDB和AOF之间的相互作用\" class=\"headerlink\" title=\"15. RDB和AOF之间的相互作用\"></a>15. RDB和AOF之间的相互作用</h2><p>在版本号大于等于2.4的Redis中，<code>BGSAVE</code>执行的过程中，不可以执行<code>BGREWRITEAOF</code><br>反过来，在<code>BGREWRITEAOF</code>执行的过程中，也不可以执行<code>BGSAVE</code><br>这可以防止两个Redis后台进程同时对磁盘进行大量的I/O操作。<br>如果<code>BGSAVE</code>正在执行，并且用户显式地调用<code>BGREWRITEAOF</code>命令，那么服务器将向用户回复一个OK状态，并告知用户。<br><code>BGREWRITEAOF</code>已经被预订执行：一旦<code>BGSAVE</code>执行完毕，<code>BGREWRITEAOF</code>就会正式开始。<br>当Redis启动时，如果RDB持久化和AOF持久化都被打开了，那么程序会优先使用AOF文件来恢复数据集，因为AOF文件所保存的数据通常是最完整的。</p>\n<h2 id=\"16-备份Redis数据\"><a href=\"#16-备份Redis数据\" class=\"headerlink\" title=\"16. 备份Redis数据\"></a>16. 备份Redis数据</h2><p>一定要备份你的数据库！<br>磁盘故障，节点失效，诸如此类的问题都可能让你的数据消失不见，不进行备份是非常危险的<br>Redis对于数据备份是非常友好的，因为你可以在服务器运行时对RDB文件进行复制：RDB文件一旦被创建，就不会进行任何修改。当服务器要创建一个新的RDB文件时，它先将文件的内容保存在一个临时文件里面，当临时文件写入完毕时，程序才使用rename原子地用临时文件替换原来的RDB文件。<br>也就是说，无论何时，复制RDB文件都是绝对安全的。</p>\n"},{"title":"ceph","date":"2017-03-13T13:13:03.000Z","_content":"# ceph的搭建\n\n**注** 如果在安装过程中，想要重新安装，需要执行如下命令清除\n```\nsudo stop ceph-all  #停止所有CEPH进程\nceph-deploy uninstall  [{ceph-node}]   #卸载所有ceph程序\nceph-deploy purge   [[ceph-node} [{ceph-node}] #删除ceph相关的包\nceph-deploy purgedata {ceph-node} [{ceph-node}]   #删除ceph相关的包\nceph-deploy forgetkeys #删除key  \n```\n\n## 1. 安装前准备\n### 1.1 添加hosts解析\n```\nsudo vi /etc/hosts\n\n# 添加如下内容\n192.168.1.174\tnode1\n192.168.1.175\tnode2\n```\n**注:  <font color=red>node1 node2必须为hostname，因为在安装过程中会验证hostname是否为node{1,2}\n遇到这个错误，需要完全清理ceph软件和配置数据，从头再来\n</font>**\n\n\n### 1.2 免密码登录\n```\n# 生成密钥对\nssh-keygen -t rsa\n\n# admin节点需要通过密钥对登录到其他节点\nssh-copy-id ceph@node1\nssh-copy-id ceph@node2\n```\n\n在**每个Ceph节点**中为用户增加 root 权限\n```\necho \"ceph ALL = (root) NOPASSWD:ALL\" | sudo tee /etc/sudoers.d/ceph\nsudo chmod 0440 /etc/sudoers.d/ceph\n```\n\n### 1.3 安装ceph-deploy软件\n\n```\nwget -q -O- 'https://download.ceph.com/keys/release.asc' | sudo apt-key add -\n\n# 添加Ceph软件包源，用Ceph稳定版（如cuttlefish 、 dumpling 、 emperor 、 firefly 等等）替换掉 {ceph-stable-release}\n# echo deb http://download.ceph.com/debian-{ceph-stable-release}/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list\n# 例如：\necho deb http://download.ceph.com/debian-dumpling/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list\nsudo apt-get update\nsudo apt-get install ceph-deploy\n```\n\n## 2. 创建ceph目录\n\n我们使用ceph-deploy部署，**后续操作均在admin节点操作**。\n首先需要创建工作环境，该环境会保存所有的配置文件：\n```\nmkdir opt/ceph\ncd opt/ceph\n```\n\n## 3. 创建集群\n\n```\nceph@node1:~/opt/ceph$ ceph-deploy new node1\n```\n其中node1是mon节点，执行该命令会生成ceph配置文件、monitor密钥文件以及日志文件。\n```\nceph@node1:~/opt/ceph$ ls\nceph.conf  ceph.log  ceph.mon.keyring\n```\n\n## 4. 修改默认冗余份数\n\n### 4.1 设置osd冗余份数\n由于我们目前只有两个osd节点，而默认的冗余份数是3，因此我们需要设置为2，如果osd节点大于2，则此步骤省略。\n修改ceph.conf文件，在[global]下增加以下内容：\n```\nceph@node1:~/opt/ceph$ echo \"osd pool default size = 2\" >> ceph.conf\n```\n**如果有多块网卡需要配置使用哪块网卡**\n```\nmon_host = `对应网卡的IP地址`\n```\n\n### 4.2 在节点上安装ceph软件\n```\nceph@node1:~/opt/ceph$ ceph-deploy install node1 node2\n```\n如果失败会报如下错误\n```\n[node1][ERROR ] RuntimeError: command returned non-zero exit status: 100\n[ceph_deploy][ERROR ] RuntimeError: Failed to execute command: apt-get -q update\n```\n**解决方法**\n- 1.同步配置\n```\nceph@node1:~/opt/ceph$ rsync -avz ../ceph ceph@node2:~/opt/\n```\n- 2.在<font color=red>所有节点</font>分别安装ceph\n```\nceph@node1:~/opt/ceph$ sudo apt-get install ceph\n```\n\n## 5. 初始化mon节点和收集密钥信息\n```\nceph@node1:~/opt/ceph$ ceph-deploy mon create-initial\n```\n如果报如下错误\n```\n[node1][DEBUG ] get remote short hostname\n[node1][WARNIN] ********************************************************************************\n[node1][WARNIN] provided hostname must match remote hostname\n[node1][WARNIN] provided hostname: node1\n[node1][WARNIN] remote hostname: ubuntu\n[node1][WARNIN] monitors may not reach quorum and create-keys will not complete\n```\n因为/etc/hosts中解析的`ip地址 主机名`和远端的主机名不匹配所致，在/etc/hosts中修改为正确的hostname，清理下从头重新安装。\n\n执行完毕，目录应该有以下文件：\n```\n{cluster-name}.client.admin.keyring\n{cluster-name}.bootstrap-osd.keyring\n{cluster-name}.bootstrap-mds.keyring\n{cluster-name}.bootstrap-rgw.keyring\n```\n\n## 6. 配置osd节点\n首先格式化磁盘，注意我们使用的是/dev/sdb：\n```\nceph@node1:~/opt/ceph$ ceph-deploy disk zap node1:sdb\nceph@node1:~/opt/ceph$ ceph-deploy disk zap node2:sdb\n```\n以上步骤会<font color=red>清空磁盘的所有数据</font>。\n\n接下来创建osd，注意由于我们只是测试，故没有使用单独的磁盘作为journal\n(todo分析具体什么)\n实际在生产环境下，需要配备SSD分区作为journal，能够最大化IO吞吐量。\n```\nceph@node1:~/opt/ceph$ ceph-deploy osd create node1:sdb\nceph@node1:~/opt/ceph$ ceph-deploy osd create node2:sdb\n```\n在节点上执行`df -h`会得到如下结果\n```\n/dev/sdb1        35G   36M   35G   1% /var/lib/ceph/osd/ceph-0\n```\n\n\n## 7. 配置admin节点\nadmin节点同时也作为我们的client节点，需要拷贝其他节点的配置文件以及密钥，使得不需要指定mon地址以及用户信息就可以直接管理我们的ceph集群，执行以下命令即可：\n```\nceph@node1:~/opt/ceph$ ceph-deploy admin node1 node2\nceph@node1:~/opt/ceph$ sudo chmod +r /etc/ceph/ceph.client.admin.keyring # 保证具有读取的密钥的权限\n```\n\n## 8. 测试结果\n\n运行以下命令：\n```\nceph@node1:~/opt/ceph$ ceph health\nceph@node1:~/opt/ceph$ ceph -s\n```\n结果若返回active + clean状态，则说明部署成功！\n\n\n## 9. 配置mds\n[Adding MDS参考链接](http://docs.ceph.com/docs/master/install/manual-deployment/#adding-mds)\n### 9.1 安装mds\n```\nceph@node1:~/opt/ceph$ sudo apt-get install ceph-mds\n```\n\n### 9.2 配置\n{id}是一个任意的名字,例如可以是电脑的主机名\n\n编辑`ceph.conf`，添加MDS区域\n```\n[mds]\n  mds data = /var/lib/ceph/mds/mds.$id\n  keyring = /var/lib/ceph/mds/mds.$id/mds.$id.keyring\n\n[mds.0] # 0为id\n  host = 0 # {id}\n```\n\n### 9.3 创建目录\n```\nceph@node1:~/opt/ceph$ mkdir -p /var/lib/ceph/mds/{cluster-name}-{id}\n```\n\n### 9.4 生成keyring\n```\nceph@node1:~/opt/ceph$ ceph-authtool --create-keyring /var/lib/ceph/mds/{cluster-name}-{id}/keyring --gen-key -n mds.{id}\n```\n\nImport the keyring and set caps.:\n\n### 9.5 导入keyring\n```\nceph@node1:~/opt/ceph$ ceph auth add mds.{id} osd \"allow rwx\" mds \"allow\" mon \"allow profile mds\" -i /var/lib/ceph/mds/{cluster}-{id}/keyring\n```\n### 9.6 修改配置文件\nAdd to ceph.conf.:\n```\n[mds.{id}]\nhost = {id}\n```\n### 9.7 手动启动\nStart the daemon the manual way.:\n```\nceph@node1:~/opt/ceph$ ceph-mds --cluster {cluster-name} -i {id} -m {mon-hostname}:{mon-port} [-f]\n```\n```\nceph@node1:~/opt/ceph$ service ceph start\nceph@node1:~/opt/ceph$ sudo service ceph start mds\n```\n检查进程是否存在\n```\nceph@node1:~/opt/ceph$ ps -ef | grep ceph\nroot      4032     1  0 17:18 ?        00:00:00 /usr/bin/ceph-mon --cluster=ceph -i node1 -f\nroot      4687     1  0 17:19 ?        00:00:04 /usr/bin/ceph-osd --cluster=ceph -i 0 -f\nroot      5196     1  0 17:23 ?        00:00:00 ceph-mds --cluster mds -i 0 -m 192.168.1.176:6789\n```\n如果已经存在，下面步骤跳过，直接执行第10步的挂载\n\n如果mds起不来，可以执行如下命令，查看具体报错信息\n```\nceph@node1:~/opt/ceph$ sudo ceph-mds --cluster node1 -i 0 -m 192.168.1.176:6789 -f\nstarting mds.0 at :/0\n2017-03-13 15:15:49.485908 7f32b07bb800 -1 did not load config file, using default settings.\n2017-03-13 15:15:49.488414 7f32b07bb800 -1 monclient(hunting): ERROR: missing keyring, cannot use cephx for authentication\n2017-03-13 15:15:49.490934 7f32b07bb800 -1 mds.-1.0 ERROR: failed to authenticate: (95) Operation not supported\n```\n\n> If starting the daemon fails with this error:\n> mds.-1.0 ERROR: failed to authenticate: (22) Invalid argument\n> Then make sure you do not have a keyring set in ceph.conf in the global section; move it to the client section; or add a keyring setting specific to this mds daemon. And verify that you see the same key in the mds data directory and ceph auth get mds.{id} output.\n\n** 检查步骤 **  \n查看如下结果是否一致\n```\nceph@node1:~/opt/ceph$ ceph auth get mds.0\nexported keyring for mds.0\n[mds.0]\n        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==\n        caps mds = \"allow\"\n        caps mon = \"allow profile mds\"\n        caps osd = \"allow rwx\"\n\n\nceph@node1:~/opt/ceph$ cat /var/lib/ceph/mds/mds-0/keyring\n[mds.0]\n        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==\n```\n\n如果仍然报如上错误，可以尝试\n```\nceph@node1:~/opt/ceph$ sudo chown -R ceph:ceph /var/lib/ceph/mds/mds-0\n```\n重新生成认证文件应该就会成功,<font color=red>不过不确定对后续操作的影响</font>\n\n[也可以尝试这里的步骤，不过不保证会好使](https://www.sebastien-han.fr/blog/2013/05/13/deploy-a-ceph-mds-server/)\n\n\nNow you are ready to create a Ceph filesystem.\n\n## 10. 挂载\n\n```\nceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs\nceph@node1:~/opt/ceph$ sudo ceph-fuse -m {ip-address-of-monitor}:6789 /mnt/cephfs\nceph@node1:~/opt/ceph$ df -h\n```\n\n在node2上执行 安装ceph-fuse\n```\nceph@node1:~/opt/ceph$ sudo apt-get install ceph-fuse\nceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs\nceph@node1:~/opt/ceph$ sudo ceph-fuse -m {ip-address-of-monitor}:6789 /mnt/cephfs\nceph@node1:~/opt/ceph$ df -h\n```\n\n## 11. 注意事项\n<font color=red>用户ceph不能够锁定，为了安全问题，只能将用户ceph改为nologin</font>\n \n## 12. 服务器重启\n服务器重启后，对于mon节点来说`osd`和`mon`会自动启动\nosd节点的osd服务也会自动启动\n \n mon节点的`mds`服务需要手动启动，启动方法为\n ```\n sudo ceph-mds --cluster {cluster-name} -i {id} -m {mon-hostname}:{mon-port} [-f]\n ```\n **另**\n 启动完mds后还需要执行挂载命令\n ```\n sudo ceph-fuse -m {ip-address-of-monitor}:6789 /mnt/cephfs\n ```\n 可以将以上命令**放入到开机启动项中**，但是服务器重启完成后要进行检查ceph的运行状态\n `ceph -s`或者`ps -ef | grep ceph` 或者 通过`df -h`查看ceph-fuse是否成功挂载目录\n 如果长时间没成功，并且`ceph -s`报错，可以尝试将另一节点node2也重启，node1可以成功挂载。\n\n","source":"_posts/ceph.md","raw":"---\ntitle: ceph\ndate: 2017-03-13 21:13:03\ncategories: ceph\ntags: ceph\n---\n# ceph的搭建\n\n**注** 如果在安装过程中，想要重新安装，需要执行如下命令清除\n```\nsudo stop ceph-all  #停止所有CEPH进程\nceph-deploy uninstall  [{ceph-node}]   #卸载所有ceph程序\nceph-deploy purge   [[ceph-node} [{ceph-node}] #删除ceph相关的包\nceph-deploy purgedata {ceph-node} [{ceph-node}]   #删除ceph相关的包\nceph-deploy forgetkeys #删除key  \n```\n\n## 1. 安装前准备\n### 1.1 添加hosts解析\n```\nsudo vi /etc/hosts\n\n# 添加如下内容\n192.168.1.174\tnode1\n192.168.1.175\tnode2\n```\n**注:  <font color=red>node1 node2必须为hostname，因为在安装过程中会验证hostname是否为node{1,2}\n遇到这个错误，需要完全清理ceph软件和配置数据，从头再来\n</font>**\n\n\n### 1.2 免密码登录\n```\n# 生成密钥对\nssh-keygen -t rsa\n\n# admin节点需要通过密钥对登录到其他节点\nssh-copy-id ceph@node1\nssh-copy-id ceph@node2\n```\n\n在**每个Ceph节点**中为用户增加 root 权限\n```\necho \"ceph ALL = (root) NOPASSWD:ALL\" | sudo tee /etc/sudoers.d/ceph\nsudo chmod 0440 /etc/sudoers.d/ceph\n```\n\n### 1.3 安装ceph-deploy软件\n\n```\nwget -q -O- 'https://download.ceph.com/keys/release.asc' | sudo apt-key add -\n\n# 添加Ceph软件包源，用Ceph稳定版（如cuttlefish 、 dumpling 、 emperor 、 firefly 等等）替换掉 {ceph-stable-release}\n# echo deb http://download.ceph.com/debian-{ceph-stable-release}/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list\n# 例如：\necho deb http://download.ceph.com/debian-dumpling/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list\nsudo apt-get update\nsudo apt-get install ceph-deploy\n```\n\n## 2. 创建ceph目录\n\n我们使用ceph-deploy部署，**后续操作均在admin节点操作**。\n首先需要创建工作环境，该环境会保存所有的配置文件：\n```\nmkdir opt/ceph\ncd opt/ceph\n```\n\n## 3. 创建集群\n\n```\nceph@node1:~/opt/ceph$ ceph-deploy new node1\n```\n其中node1是mon节点，执行该命令会生成ceph配置文件、monitor密钥文件以及日志文件。\n```\nceph@node1:~/opt/ceph$ ls\nceph.conf  ceph.log  ceph.mon.keyring\n```\n\n## 4. 修改默认冗余份数\n\n### 4.1 设置osd冗余份数\n由于我们目前只有两个osd节点，而默认的冗余份数是3，因此我们需要设置为2，如果osd节点大于2，则此步骤省略。\n修改ceph.conf文件，在[global]下增加以下内容：\n```\nceph@node1:~/opt/ceph$ echo \"osd pool default size = 2\" >> ceph.conf\n```\n**如果有多块网卡需要配置使用哪块网卡**\n```\nmon_host = `对应网卡的IP地址`\n```\n\n### 4.2 在节点上安装ceph软件\n```\nceph@node1:~/opt/ceph$ ceph-deploy install node1 node2\n```\n如果失败会报如下错误\n```\n[node1][ERROR ] RuntimeError: command returned non-zero exit status: 100\n[ceph_deploy][ERROR ] RuntimeError: Failed to execute command: apt-get -q update\n```\n**解决方法**\n- 1.同步配置\n```\nceph@node1:~/opt/ceph$ rsync -avz ../ceph ceph@node2:~/opt/\n```\n- 2.在<font color=red>所有节点</font>分别安装ceph\n```\nceph@node1:~/opt/ceph$ sudo apt-get install ceph\n```\n\n## 5. 初始化mon节点和收集密钥信息\n```\nceph@node1:~/opt/ceph$ ceph-deploy mon create-initial\n```\n如果报如下错误\n```\n[node1][DEBUG ] get remote short hostname\n[node1][WARNIN] ********************************************************************************\n[node1][WARNIN] provided hostname must match remote hostname\n[node1][WARNIN] provided hostname: node1\n[node1][WARNIN] remote hostname: ubuntu\n[node1][WARNIN] monitors may not reach quorum and create-keys will not complete\n```\n因为/etc/hosts中解析的`ip地址 主机名`和远端的主机名不匹配所致，在/etc/hosts中修改为正确的hostname，清理下从头重新安装。\n\n执行完毕，目录应该有以下文件：\n```\n{cluster-name}.client.admin.keyring\n{cluster-name}.bootstrap-osd.keyring\n{cluster-name}.bootstrap-mds.keyring\n{cluster-name}.bootstrap-rgw.keyring\n```\n\n## 6. 配置osd节点\n首先格式化磁盘，注意我们使用的是/dev/sdb：\n```\nceph@node1:~/opt/ceph$ ceph-deploy disk zap node1:sdb\nceph@node1:~/opt/ceph$ ceph-deploy disk zap node2:sdb\n```\n以上步骤会<font color=red>清空磁盘的所有数据</font>。\n\n接下来创建osd，注意由于我们只是测试，故没有使用单独的磁盘作为journal\n(todo分析具体什么)\n实际在生产环境下，需要配备SSD分区作为journal，能够最大化IO吞吐量。\n```\nceph@node1:~/opt/ceph$ ceph-deploy osd create node1:sdb\nceph@node1:~/opt/ceph$ ceph-deploy osd create node2:sdb\n```\n在节点上执行`df -h`会得到如下结果\n```\n/dev/sdb1        35G   36M   35G   1% /var/lib/ceph/osd/ceph-0\n```\n\n\n## 7. 配置admin节点\nadmin节点同时也作为我们的client节点，需要拷贝其他节点的配置文件以及密钥，使得不需要指定mon地址以及用户信息就可以直接管理我们的ceph集群，执行以下命令即可：\n```\nceph@node1:~/opt/ceph$ ceph-deploy admin node1 node2\nceph@node1:~/opt/ceph$ sudo chmod +r /etc/ceph/ceph.client.admin.keyring # 保证具有读取的密钥的权限\n```\n\n## 8. 测试结果\n\n运行以下命令：\n```\nceph@node1:~/opt/ceph$ ceph health\nceph@node1:~/opt/ceph$ ceph -s\n```\n结果若返回active + clean状态，则说明部署成功！\n\n\n## 9. 配置mds\n[Adding MDS参考链接](http://docs.ceph.com/docs/master/install/manual-deployment/#adding-mds)\n### 9.1 安装mds\n```\nceph@node1:~/opt/ceph$ sudo apt-get install ceph-mds\n```\n\n### 9.2 配置\n{id}是一个任意的名字,例如可以是电脑的主机名\n\n编辑`ceph.conf`，添加MDS区域\n```\n[mds]\n  mds data = /var/lib/ceph/mds/mds.$id\n  keyring = /var/lib/ceph/mds/mds.$id/mds.$id.keyring\n\n[mds.0] # 0为id\n  host = 0 # {id}\n```\n\n### 9.3 创建目录\n```\nceph@node1:~/opt/ceph$ mkdir -p /var/lib/ceph/mds/{cluster-name}-{id}\n```\n\n### 9.4 生成keyring\n```\nceph@node1:~/opt/ceph$ ceph-authtool --create-keyring /var/lib/ceph/mds/{cluster-name}-{id}/keyring --gen-key -n mds.{id}\n```\n\nImport the keyring and set caps.:\n\n### 9.5 导入keyring\n```\nceph@node1:~/opt/ceph$ ceph auth add mds.{id} osd \"allow rwx\" mds \"allow\" mon \"allow profile mds\" -i /var/lib/ceph/mds/{cluster}-{id}/keyring\n```\n### 9.6 修改配置文件\nAdd to ceph.conf.:\n```\n[mds.{id}]\nhost = {id}\n```\n### 9.7 手动启动\nStart the daemon the manual way.:\n```\nceph@node1:~/opt/ceph$ ceph-mds --cluster {cluster-name} -i {id} -m {mon-hostname}:{mon-port} [-f]\n```\n```\nceph@node1:~/opt/ceph$ service ceph start\nceph@node1:~/opt/ceph$ sudo service ceph start mds\n```\n检查进程是否存在\n```\nceph@node1:~/opt/ceph$ ps -ef | grep ceph\nroot      4032     1  0 17:18 ?        00:00:00 /usr/bin/ceph-mon --cluster=ceph -i node1 -f\nroot      4687     1  0 17:19 ?        00:00:04 /usr/bin/ceph-osd --cluster=ceph -i 0 -f\nroot      5196     1  0 17:23 ?        00:00:00 ceph-mds --cluster mds -i 0 -m 192.168.1.176:6789\n```\n如果已经存在，下面步骤跳过，直接执行第10步的挂载\n\n如果mds起不来，可以执行如下命令，查看具体报错信息\n```\nceph@node1:~/opt/ceph$ sudo ceph-mds --cluster node1 -i 0 -m 192.168.1.176:6789 -f\nstarting mds.0 at :/0\n2017-03-13 15:15:49.485908 7f32b07bb800 -1 did not load config file, using default settings.\n2017-03-13 15:15:49.488414 7f32b07bb800 -1 monclient(hunting): ERROR: missing keyring, cannot use cephx for authentication\n2017-03-13 15:15:49.490934 7f32b07bb800 -1 mds.-1.0 ERROR: failed to authenticate: (95) Operation not supported\n```\n\n> If starting the daemon fails with this error:\n> mds.-1.0 ERROR: failed to authenticate: (22) Invalid argument\n> Then make sure you do not have a keyring set in ceph.conf in the global section; move it to the client section; or add a keyring setting specific to this mds daemon. And verify that you see the same key in the mds data directory and ceph auth get mds.{id} output.\n\n** 检查步骤 **  \n查看如下结果是否一致\n```\nceph@node1:~/opt/ceph$ ceph auth get mds.0\nexported keyring for mds.0\n[mds.0]\n        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==\n        caps mds = \"allow\"\n        caps mon = \"allow profile mds\"\n        caps osd = \"allow rwx\"\n\n\nceph@node1:~/opt/ceph$ cat /var/lib/ceph/mds/mds-0/keyring\n[mds.0]\n        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==\n```\n\n如果仍然报如上错误，可以尝试\n```\nceph@node1:~/opt/ceph$ sudo chown -R ceph:ceph /var/lib/ceph/mds/mds-0\n```\n重新生成认证文件应该就会成功,<font color=red>不过不确定对后续操作的影响</font>\n\n[也可以尝试这里的步骤，不过不保证会好使](https://www.sebastien-han.fr/blog/2013/05/13/deploy-a-ceph-mds-server/)\n\n\nNow you are ready to create a Ceph filesystem.\n\n## 10. 挂载\n\n```\nceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs\nceph@node1:~/opt/ceph$ sudo ceph-fuse -m {ip-address-of-monitor}:6789 /mnt/cephfs\nceph@node1:~/opt/ceph$ df -h\n```\n\n在node2上执行 安装ceph-fuse\n```\nceph@node1:~/opt/ceph$ sudo apt-get install ceph-fuse\nceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs\nceph@node1:~/opt/ceph$ sudo ceph-fuse -m {ip-address-of-monitor}:6789 /mnt/cephfs\nceph@node1:~/opt/ceph$ df -h\n```\n\n## 11. 注意事项\n<font color=red>用户ceph不能够锁定，为了安全问题，只能将用户ceph改为nologin</font>\n \n## 12. 服务器重启\n服务器重启后，对于mon节点来说`osd`和`mon`会自动启动\nosd节点的osd服务也会自动启动\n \n mon节点的`mds`服务需要手动启动，启动方法为\n ```\n sudo ceph-mds --cluster {cluster-name} -i {id} -m {mon-hostname}:{mon-port} [-f]\n ```\n **另**\n 启动完mds后还需要执行挂载命令\n ```\n sudo ceph-fuse -m {ip-address-of-monitor}:6789 /mnt/cephfs\n ```\n 可以将以上命令**放入到开机启动项中**，但是服务器重启完成后要进行检查ceph的运行状态\n `ceph -s`或者`ps -ef | grep ceph` 或者 通过`df -h`查看ceph-fuse是否成功挂载目录\n 如果长时间没成功，并且`ceph -s`报错，可以尝试将另一节点node2也重启，node1可以成功挂载。\n\n","slug":"ceph","published":1,"updated":"2017-06-04T13:38:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4l000azahivo2ocfjz","content":"<h1 id=\"ceph的搭建\"><a href=\"#ceph的搭建\" class=\"headerlink\" title=\"ceph的搭建\"></a>ceph的搭建</h1><p><strong>注</strong> 如果在安装过程中，想要重新安装，需要执行如下命令清除<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo stop ceph-all  #停止所有CEPH进程</span><br><span class=\"line\">ceph-deploy uninstall  [&#123;ceph-node&#125;]   #卸载所有ceph程序</span><br><span class=\"line\">ceph-deploy purge   [[ceph-node&#125; [&#123;ceph-node&#125;] #删除ceph相关的包</span><br><span class=\"line\">ceph-deploy purgedata &#123;ceph-node&#125; [&#123;ceph-node&#125;]   #删除ceph相关的包</span><br><span class=\"line\">ceph-deploy forgetkeys #删除key</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"1-安装前准备\"><a href=\"#1-安装前准备\" class=\"headerlink\" title=\"1. 安装前准备\"></a>1. 安装前准备</h2><h3 id=\"1-1-添加hosts解析\"><a href=\"#1-1-添加hosts解析\" class=\"headerlink\" title=\"1.1 添加hosts解析\"></a>1.1 添加hosts解析</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/hosts</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加如下内容</span><br><span class=\"line\">192.168.1.174\tnode1</span><br><span class=\"line\">192.168.1.175\tnode2</span><br></pre></td></tr></table></figure>\n<p><strong>注:  <font color=\"red\">node1 node2必须为hostname，因为在安装过程中会验证hostname是否为node{1,2}<br>遇到这个错误，需要完全清理ceph软件和配置数据，从头再来<br></font></strong></p>\n<h3 id=\"1-2-免密码登录\"><a href=\"#1-2-免密码登录\" class=\"headerlink\" title=\"1.2 免密码登录\"></a>1.2 免密码登录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 生成密钥对</span><br><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\"></span><br><span class=\"line\"># admin节点需要通过密钥对登录到其他节点</span><br><span class=\"line\">ssh-copy-id ceph@node1</span><br><span class=\"line\">ssh-copy-id ceph@node2</span><br></pre></td></tr></table></figure>\n<p>在<strong>每个Ceph节点</strong>中为用户增加 root 权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;ceph ALL = (root) NOPASSWD:ALL&quot; | sudo tee /etc/sudoers.d/ceph</span><br><span class=\"line\">sudo chmod 0440 /etc/sudoers.d/ceph</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"1-3-安装ceph-deploy软件\"><a href=\"#1-3-安装ceph-deploy软件\" class=\"headerlink\" title=\"1.3 安装ceph-deploy软件\"></a>1.3 安装ceph-deploy软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -q -O- &apos;https://download.ceph.com/keys/release.asc&apos; | sudo apt-key add -</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加Ceph软件包源，用Ceph稳定版（如cuttlefish 、 dumpling 、 emperor 、 firefly 等等）替换掉 &#123;ceph-stable-release&#125;</span><br><span class=\"line\"># echo deb http://download.ceph.com/debian-&#123;ceph-stable-release&#125;/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list</span><br><span class=\"line\"># 例如：</span><br><span class=\"line\">echo deb http://download.ceph.com/debian-dumpling/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install ceph-deploy</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-创建ceph目录\"><a href=\"#2-创建ceph目录\" class=\"headerlink\" title=\"2. 创建ceph目录\"></a>2. 创建ceph目录</h2><p>我们使用ceph-deploy部署，<strong>后续操作均在admin节点操作</strong>。<br>首先需要创建工作环境，该环境会保存所有的配置文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir opt/ceph</span><br><span class=\"line\">cd opt/ceph</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-创建集群\"><a href=\"#3-创建集群\" class=\"headerlink\" title=\"3. 创建集群\"></a>3. 创建集群</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy new node1</span><br></pre></td></tr></table></figure>\n<p>其中node1是mon节点，执行该命令会生成ceph配置文件、monitor密钥文件以及日志文件。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ls</span><br><span class=\"line\">ceph.conf  ceph.log  ceph.mon.keyring</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-修改默认冗余份数\"><a href=\"#4-修改默认冗余份数\" class=\"headerlink\" title=\"4. 修改默认冗余份数\"></a>4. 修改默认冗余份数</h2><h3 id=\"4-1-设置osd冗余份数\"><a href=\"#4-1-设置osd冗余份数\" class=\"headerlink\" title=\"4.1 设置osd冗余份数\"></a>4.1 设置osd冗余份数</h3><p>由于我们目前只有两个osd节点，而默认的冗余份数是3，因此我们需要设置为2，如果osd节点大于2，则此步骤省略。<br>修改ceph.conf文件，在[global]下增加以下内容：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ echo &quot;osd pool default size = 2&quot; &gt;&gt; ceph.conf</span><br></pre></td></tr></table></figure></p>\n<p><strong>如果有多块网卡需要配置使用哪块网卡</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mon_host = `对应网卡的IP地址`</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"4-2-在节点上安装ceph软件\"><a href=\"#4-2-在节点上安装ceph软件\" class=\"headerlink\" title=\"4.2 在节点上安装ceph软件\"></a>4.2 在节点上安装ceph软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy install node1 node2</span><br></pre></td></tr></table></figure>\n<p>如果失败会报如下错误<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[node1][ERROR ] RuntimeError: command returned non-zero exit status: 100</span><br><span class=\"line\">[ceph_deploy][ERROR ] RuntimeError: Failed to execute command: apt-get -q update</span><br></pre></td></tr></table></figure></p>\n<p><strong>解决方法</strong></p>\n<ul>\n<li><p>1.同步配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ rsync -avz ../ceph ceph@node2:~/opt/</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2.在<font color=\"red\">所有节点</font>分别安装ceph</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo apt-get install ceph</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"5-初始化mon节点和收集密钥信息\"><a href=\"#5-初始化mon节点和收集密钥信息\" class=\"headerlink\" title=\"5. 初始化mon节点和收集密钥信息\"></a>5. 初始化mon节点和收集密钥信息</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy mon create-initial</span><br></pre></td></tr></table></figure>\n<p>如果报如下错误<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[node1][DEBUG ] get remote short hostname</span><br><span class=\"line\">[node1][WARNIN] ********************************************************************************</span><br><span class=\"line\">[node1][WARNIN] provided hostname must match remote hostname</span><br><span class=\"line\">[node1][WARNIN] provided hostname: node1</span><br><span class=\"line\">[node1][WARNIN] remote hostname: ubuntu</span><br><span class=\"line\">[node1][WARNIN] monitors may not reach quorum and create-keys will not complete</span><br></pre></td></tr></table></figure></p>\n<p>因为/etc/hosts中解析的<code>ip地址 主机名</code>和远端的主机名不匹配所致，在/etc/hosts中修改为正确的hostname，清理下从头重新安装。</p>\n<p>执行完毕，目录应该有以下文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;cluster-name&#125;.client.admin.keyring</span><br><span class=\"line\">&#123;cluster-name&#125;.bootstrap-osd.keyring</span><br><span class=\"line\">&#123;cluster-name&#125;.bootstrap-mds.keyring</span><br><span class=\"line\">&#123;cluster-name&#125;.bootstrap-rgw.keyring</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"6-配置osd节点\"><a href=\"#6-配置osd节点\" class=\"headerlink\" title=\"6. 配置osd节点\"></a>6. 配置osd节点</h2><p>首先格式化磁盘，注意我们使用的是/dev/sdb：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy disk zap node1:sdb</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy disk zap node2:sdb</span><br></pre></td></tr></table></figure></p>\n<p>以上步骤会<font color=\"red\">清空磁盘的所有数据</font>。</p>\n<p>接下来创建osd，注意由于我们只是测试，故没有使用单独的磁盘作为journal<br>(todo分析具体什么)<br>实际在生产环境下，需要配备SSD分区作为journal，能够最大化IO吞吐量。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy osd create node1:sdb</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy osd create node2:sdb</span><br></pre></td></tr></table></figure></p>\n<p>在节点上执行<code>df -h</code>会得到如下结果<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/dev/sdb1        35G   36M   35G   1% /var/lib/ceph/osd/ceph-0</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"7-配置admin节点\"><a href=\"#7-配置admin节点\" class=\"headerlink\" title=\"7. 配置admin节点\"></a>7. 配置admin节点</h2><p>admin节点同时也作为我们的client节点，需要拷贝其他节点的配置文件以及密钥，使得不需要指定mon地址以及用户信息就可以直接管理我们的ceph集群，执行以下命令即可：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy admin node1 node2</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo chmod +r /etc/ceph/ceph.client.admin.keyring # 保证具有读取的密钥的权限</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"8-测试结果\"><a href=\"#8-测试结果\" class=\"headerlink\" title=\"8. 测试结果\"></a>8. 测试结果</h2><p>运行以下命令：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph health</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ ceph -s</span><br></pre></td></tr></table></figure></p>\n<p>结果若返回active + clean状态，则说明部署成功！</p>\n<h2 id=\"9-配置mds\"><a href=\"#9-配置mds\" class=\"headerlink\" title=\"9. 配置mds\"></a>9. 配置mds</h2><p><a href=\"http://docs.ceph.com/docs/master/install/manual-deployment/#adding-mds\" target=\"_blank\" rel=\"noopener\">Adding MDS参考链接</a></p>\n<h3 id=\"9-1-安装mds\"><a href=\"#9-1-安装mds\" class=\"headerlink\" title=\"9.1 安装mds\"></a>9.1 安装mds</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo apt-get install ceph-mds</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-2-配置\"><a href=\"#9-2-配置\" class=\"headerlink\" title=\"9.2 配置\"></a>9.2 配置</h3><p>{id}是一个任意的名字,例如可以是电脑的主机名</p>\n<p>编辑<code>ceph.conf</code>，添加MDS区域<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mds]</span><br><span class=\"line\">  mds data = /var/lib/ceph/mds/mds.$id</span><br><span class=\"line\">  keyring = /var/lib/ceph/mds/mds.$id/mds.$id.keyring</span><br><span class=\"line\"></span><br><span class=\"line\">[mds.0] # 0为id</span><br><span class=\"line\">  host = 0 # &#123;id&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"9-3-创建目录\"><a href=\"#9-3-创建目录\" class=\"headerlink\" title=\"9.3 创建目录\"></a>9.3 创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ mkdir -p /var/lib/ceph/mds/&#123;cluster-name&#125;-&#123;id&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-4-生成keyring\"><a href=\"#9-4-生成keyring\" class=\"headerlink\" title=\"9.4 生成keyring\"></a>9.4 生成keyring</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-authtool --create-keyring /var/lib/ceph/mds/&#123;cluster-name&#125;-&#123;id&#125;/keyring --gen-key -n mds.&#123;id&#125;</span><br></pre></td></tr></table></figure>\n<p>Import the keyring and set caps.:</p>\n<h3 id=\"9-5-导入keyring\"><a href=\"#9-5-导入keyring\" class=\"headerlink\" title=\"9.5 导入keyring\"></a>9.5 导入keyring</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph auth add mds.&#123;id&#125; osd &quot;allow rwx&quot; mds &quot;allow&quot; mon &quot;allow profile mds&quot; -i /var/lib/ceph/mds/&#123;cluster&#125;-&#123;id&#125;/keyring</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-6-修改配置文件\"><a href=\"#9-6-修改配置文件\" class=\"headerlink\" title=\"9.6 修改配置文件\"></a>9.6 修改配置文件</h3><p>Add to ceph.conf.:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mds.&#123;id&#125;]</span><br><span class=\"line\">host = &#123;id&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"9-7-手动启动\"><a href=\"#9-7-手动启动\" class=\"headerlink\" title=\"9.7 手动启动\"></a>9.7 手动启动</h3><p>Start the daemon the manual way.:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-mds --cluster &#123;cluster-name&#125; -i &#123;id&#125; -m &#123;mon-hostname&#125;:&#123;mon-port&#125; [-f]</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ service ceph start</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo service ceph start mds</span><br></pre></td></tr></table></figure>\n<p>检查进程是否存在<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ps -ef | grep ceph</span><br><span class=\"line\">root      4032     1  0 17:18 ?        00:00:00 /usr/bin/ceph-mon --cluster=ceph -i node1 -f</span><br><span class=\"line\">root      4687     1  0 17:19 ?        00:00:04 /usr/bin/ceph-osd --cluster=ceph -i 0 -f</span><br><span class=\"line\">root      5196     1  0 17:23 ?        00:00:00 ceph-mds --cluster mds -i 0 -m 192.168.1.176:6789</span><br></pre></td></tr></table></figure></p>\n<p>如果已经存在，下面步骤跳过，直接执行第10步的挂载</p>\n<p>如果mds起不来，可以执行如下命令，查看具体报错信息<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo ceph-mds --cluster node1 -i 0 -m 192.168.1.176:6789 -f</span><br><span class=\"line\">starting mds.0 at :/0</span><br><span class=\"line\">2017-03-13 15:15:49.485908 7f32b07bb800 -1 did not load config file, using default settings.</span><br><span class=\"line\">2017-03-13 15:15:49.488414 7f32b07bb800 -1 monclient(hunting): ERROR: missing keyring, cannot use cephx for authentication</span><br><span class=\"line\">2017-03-13 15:15:49.490934 7f32b07bb800 -1 mds.-1.0 ERROR: failed to authenticate: (95) Operation not supported</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>If starting the daemon fails with this error:<br>mds.-1.0 ERROR: failed to authenticate: (22) Invalid argument<br>Then make sure you do not have a keyring set in ceph.conf in the global section; move it to the client section; or add a keyring setting specific to this mds daemon. And verify that you see the same key in the mds data directory and ceph auth get mds.{id} output.</p>\n</blockquote>\n<p><strong> 检查步骤 </strong><br>查看如下结果是否一致<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph auth get mds.0</span><br><span class=\"line\">exported keyring for mds.0</span><br><span class=\"line\">[mds.0]</span><br><span class=\"line\">        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==</span><br><span class=\"line\">        caps mds = &quot;allow&quot;</span><br><span class=\"line\">        caps mon = &quot;allow profile mds&quot;</span><br><span class=\"line\">        caps osd = &quot;allow rwx&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ceph@node1:~/opt/ceph$ cat /var/lib/ceph/mds/mds-0/keyring</span><br><span class=\"line\">[mds.0]</span><br><span class=\"line\">        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==</span><br></pre></td></tr></table></figure></p>\n<p>如果仍然报如上错误，可以尝试<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo chown -R ceph:ceph /var/lib/ceph/mds/mds-0</span><br></pre></td></tr></table></figure></p>\n<p>重新生成认证文件应该就会成功,<font color=\"red\">不过不确定对后续操作的影响</font></p>\n<p><a href=\"https://www.sebastien-han.fr/blog/2013/05/13/deploy-a-ceph-mds-server/\" target=\"_blank\" rel=\"noopener\">也可以尝试这里的步骤，不过不保证会好使</a></p>\n<p>Now you are ready to create a Ceph filesystem.</p>\n<h2 id=\"10-挂载\"><a href=\"#10-挂载\" class=\"headerlink\" title=\"10. 挂载\"></a>10. 挂载</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo ceph-fuse -m &#123;ip-address-of-monitor&#125;:6789 /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ df -h</span><br></pre></td></tr></table></figure>\n<p>在node2上执行 安装ceph-fuse<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo apt-get install ceph-fuse</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo ceph-fuse -m &#123;ip-address-of-monitor&#125;:6789 /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ df -h</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"11-注意事项\"><a href=\"#11-注意事项\" class=\"headerlink\" title=\"11. 注意事项\"></a>11. 注意事项</h2><font color=\"red\">用户ceph不能够锁定，为了安全问题，只能将用户ceph改为nologin</font>\n\n<h2 id=\"12-服务器重启\"><a href=\"#12-服务器重启\" class=\"headerlink\" title=\"12. 服务器重启\"></a>12. 服务器重启</h2><p>服务器重启后，对于mon节点来说<code>osd</code>和<code>mon</code>会自动启动<br>osd节点的osd服务也会自动启动</p>\n<p> mon节点的<code>mds</code>服务需要手动启动，启动方法为<br> <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ceph-mds --cluster &#123;cluster-name&#125; -i &#123;id&#125; -m &#123;mon-hostname&#125;:&#123;mon-port&#125; [-f]</span><br></pre></td></tr></table></figure></p>\n<p> <strong>另</strong><br> 启动完mds后还需要执行挂载命令<br> <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ceph-fuse -m &#123;ip-address-of-monitor&#125;:6789 /mnt/cephfs</span><br></pre></td></tr></table></figure></p>\n<p> 可以将以上命令<strong>放入到开机启动项中</strong>，但是服务器重启完成后要进行检查ceph的运行状态<br> <code>ceph -s</code>或者<code>ps -ef | grep ceph</code> 或者 通过<code>df -h</code>查看ceph-fuse是否成功挂载目录<br> 如果长时间没成功，并且<code>ceph -s</code>报错，可以尝试将另一节点node2也重启，node1可以成功挂载。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"ceph的搭建\"><a href=\"#ceph的搭建\" class=\"headerlink\" title=\"ceph的搭建\"></a>ceph的搭建</h1><p><strong>注</strong> 如果在安装过程中，想要重新安装，需要执行如下命令清除<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo stop ceph-all  #停止所有CEPH进程</span><br><span class=\"line\">ceph-deploy uninstall  [&#123;ceph-node&#125;]   #卸载所有ceph程序</span><br><span class=\"line\">ceph-deploy purge   [[ceph-node&#125; [&#123;ceph-node&#125;] #删除ceph相关的包</span><br><span class=\"line\">ceph-deploy purgedata &#123;ceph-node&#125; [&#123;ceph-node&#125;]   #删除ceph相关的包</span><br><span class=\"line\">ceph-deploy forgetkeys #删除key</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"1-安装前准备\"><a href=\"#1-安装前准备\" class=\"headerlink\" title=\"1. 安装前准备\"></a>1. 安装前准备</h2><h3 id=\"1-1-添加hosts解析\"><a href=\"#1-1-添加hosts解析\" class=\"headerlink\" title=\"1.1 添加hosts解析\"></a>1.1 添加hosts解析</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/hosts</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加如下内容</span><br><span class=\"line\">192.168.1.174\tnode1</span><br><span class=\"line\">192.168.1.175\tnode2</span><br></pre></td></tr></table></figure>\n<p><strong>注:  <font color=\"red\">node1 node2必须为hostname，因为在安装过程中会验证hostname是否为node{1,2}<br>遇到这个错误，需要完全清理ceph软件和配置数据，从头再来<br></font></strong></p>\n<h3 id=\"1-2-免密码登录\"><a href=\"#1-2-免密码登录\" class=\"headerlink\" title=\"1.2 免密码登录\"></a>1.2 免密码登录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 生成密钥对</span><br><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\"></span><br><span class=\"line\"># admin节点需要通过密钥对登录到其他节点</span><br><span class=\"line\">ssh-copy-id ceph@node1</span><br><span class=\"line\">ssh-copy-id ceph@node2</span><br></pre></td></tr></table></figure>\n<p>在<strong>每个Ceph节点</strong>中为用户增加 root 权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;ceph ALL = (root) NOPASSWD:ALL&quot; | sudo tee /etc/sudoers.d/ceph</span><br><span class=\"line\">sudo chmod 0440 /etc/sudoers.d/ceph</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"1-3-安装ceph-deploy软件\"><a href=\"#1-3-安装ceph-deploy软件\" class=\"headerlink\" title=\"1.3 安装ceph-deploy软件\"></a>1.3 安装ceph-deploy软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -q -O- &apos;https://download.ceph.com/keys/release.asc&apos; | sudo apt-key add -</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加Ceph软件包源，用Ceph稳定版（如cuttlefish 、 dumpling 、 emperor 、 firefly 等等）替换掉 &#123;ceph-stable-release&#125;</span><br><span class=\"line\"># echo deb http://download.ceph.com/debian-&#123;ceph-stable-release&#125;/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list</span><br><span class=\"line\"># 例如：</span><br><span class=\"line\">echo deb http://download.ceph.com/debian-dumpling/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install ceph-deploy</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-创建ceph目录\"><a href=\"#2-创建ceph目录\" class=\"headerlink\" title=\"2. 创建ceph目录\"></a>2. 创建ceph目录</h2><p>我们使用ceph-deploy部署，<strong>后续操作均在admin节点操作</strong>。<br>首先需要创建工作环境，该环境会保存所有的配置文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir opt/ceph</span><br><span class=\"line\">cd opt/ceph</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-创建集群\"><a href=\"#3-创建集群\" class=\"headerlink\" title=\"3. 创建集群\"></a>3. 创建集群</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy new node1</span><br></pre></td></tr></table></figure>\n<p>其中node1是mon节点，执行该命令会生成ceph配置文件、monitor密钥文件以及日志文件。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ls</span><br><span class=\"line\">ceph.conf  ceph.log  ceph.mon.keyring</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-修改默认冗余份数\"><a href=\"#4-修改默认冗余份数\" class=\"headerlink\" title=\"4. 修改默认冗余份数\"></a>4. 修改默认冗余份数</h2><h3 id=\"4-1-设置osd冗余份数\"><a href=\"#4-1-设置osd冗余份数\" class=\"headerlink\" title=\"4.1 设置osd冗余份数\"></a>4.1 设置osd冗余份数</h3><p>由于我们目前只有两个osd节点，而默认的冗余份数是3，因此我们需要设置为2，如果osd节点大于2，则此步骤省略。<br>修改ceph.conf文件，在[global]下增加以下内容：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ echo &quot;osd pool default size = 2&quot; &gt;&gt; ceph.conf</span><br></pre></td></tr></table></figure></p>\n<p><strong>如果有多块网卡需要配置使用哪块网卡</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mon_host = `对应网卡的IP地址`</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"4-2-在节点上安装ceph软件\"><a href=\"#4-2-在节点上安装ceph软件\" class=\"headerlink\" title=\"4.2 在节点上安装ceph软件\"></a>4.2 在节点上安装ceph软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy install node1 node2</span><br></pre></td></tr></table></figure>\n<p>如果失败会报如下错误<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[node1][ERROR ] RuntimeError: command returned non-zero exit status: 100</span><br><span class=\"line\">[ceph_deploy][ERROR ] RuntimeError: Failed to execute command: apt-get -q update</span><br></pre></td></tr></table></figure></p>\n<p><strong>解决方法</strong></p>\n<ul>\n<li><p>1.同步配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ rsync -avz ../ceph ceph@node2:~/opt/</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2.在<font color=\"red\">所有节点</font>分别安装ceph</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo apt-get install ceph</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"5-初始化mon节点和收集密钥信息\"><a href=\"#5-初始化mon节点和收集密钥信息\" class=\"headerlink\" title=\"5. 初始化mon节点和收集密钥信息\"></a>5. 初始化mon节点和收集密钥信息</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy mon create-initial</span><br></pre></td></tr></table></figure>\n<p>如果报如下错误<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[node1][DEBUG ] get remote short hostname</span><br><span class=\"line\">[node1][WARNIN] ********************************************************************************</span><br><span class=\"line\">[node1][WARNIN] provided hostname must match remote hostname</span><br><span class=\"line\">[node1][WARNIN] provided hostname: node1</span><br><span class=\"line\">[node1][WARNIN] remote hostname: ubuntu</span><br><span class=\"line\">[node1][WARNIN] monitors may not reach quorum and create-keys will not complete</span><br></pre></td></tr></table></figure></p>\n<p>因为/etc/hosts中解析的<code>ip地址 主机名</code>和远端的主机名不匹配所致，在/etc/hosts中修改为正确的hostname，清理下从头重新安装。</p>\n<p>执行完毕，目录应该有以下文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;cluster-name&#125;.client.admin.keyring</span><br><span class=\"line\">&#123;cluster-name&#125;.bootstrap-osd.keyring</span><br><span class=\"line\">&#123;cluster-name&#125;.bootstrap-mds.keyring</span><br><span class=\"line\">&#123;cluster-name&#125;.bootstrap-rgw.keyring</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"6-配置osd节点\"><a href=\"#6-配置osd节点\" class=\"headerlink\" title=\"6. 配置osd节点\"></a>6. 配置osd节点</h2><p>首先格式化磁盘，注意我们使用的是/dev/sdb：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy disk zap node1:sdb</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy disk zap node2:sdb</span><br></pre></td></tr></table></figure></p>\n<p>以上步骤会<font color=\"red\">清空磁盘的所有数据</font>。</p>\n<p>接下来创建osd，注意由于我们只是测试，故没有使用单独的磁盘作为journal<br>(todo分析具体什么)<br>实际在生产环境下，需要配备SSD分区作为journal，能够最大化IO吞吐量。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy osd create node1:sdb</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy osd create node2:sdb</span><br></pre></td></tr></table></figure></p>\n<p>在节点上执行<code>df -h</code>会得到如下结果<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/dev/sdb1        35G   36M   35G   1% /var/lib/ceph/osd/ceph-0</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"7-配置admin节点\"><a href=\"#7-配置admin节点\" class=\"headerlink\" title=\"7. 配置admin节点\"></a>7. 配置admin节点</h2><p>admin节点同时也作为我们的client节点，需要拷贝其他节点的配置文件以及密钥，使得不需要指定mon地址以及用户信息就可以直接管理我们的ceph集群，执行以下命令即可：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-deploy admin node1 node2</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo chmod +r /etc/ceph/ceph.client.admin.keyring # 保证具有读取的密钥的权限</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"8-测试结果\"><a href=\"#8-测试结果\" class=\"headerlink\" title=\"8. 测试结果\"></a>8. 测试结果</h2><p>运行以下命令：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph health</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ ceph -s</span><br></pre></td></tr></table></figure></p>\n<p>结果若返回active + clean状态，则说明部署成功！</p>\n<h2 id=\"9-配置mds\"><a href=\"#9-配置mds\" class=\"headerlink\" title=\"9. 配置mds\"></a>9. 配置mds</h2><p><a href=\"http://docs.ceph.com/docs/master/install/manual-deployment/#adding-mds\" target=\"_blank\" rel=\"noopener\">Adding MDS参考链接</a></p>\n<h3 id=\"9-1-安装mds\"><a href=\"#9-1-安装mds\" class=\"headerlink\" title=\"9.1 安装mds\"></a>9.1 安装mds</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo apt-get install ceph-mds</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-2-配置\"><a href=\"#9-2-配置\" class=\"headerlink\" title=\"9.2 配置\"></a>9.2 配置</h3><p>{id}是一个任意的名字,例如可以是电脑的主机名</p>\n<p>编辑<code>ceph.conf</code>，添加MDS区域<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mds]</span><br><span class=\"line\">  mds data = /var/lib/ceph/mds/mds.$id</span><br><span class=\"line\">  keyring = /var/lib/ceph/mds/mds.$id/mds.$id.keyring</span><br><span class=\"line\"></span><br><span class=\"line\">[mds.0] # 0为id</span><br><span class=\"line\">  host = 0 # &#123;id&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"9-3-创建目录\"><a href=\"#9-3-创建目录\" class=\"headerlink\" title=\"9.3 创建目录\"></a>9.3 创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ mkdir -p /var/lib/ceph/mds/&#123;cluster-name&#125;-&#123;id&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-4-生成keyring\"><a href=\"#9-4-生成keyring\" class=\"headerlink\" title=\"9.4 生成keyring\"></a>9.4 生成keyring</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-authtool --create-keyring /var/lib/ceph/mds/&#123;cluster-name&#125;-&#123;id&#125;/keyring --gen-key -n mds.&#123;id&#125;</span><br></pre></td></tr></table></figure>\n<p>Import the keyring and set caps.:</p>\n<h3 id=\"9-5-导入keyring\"><a href=\"#9-5-导入keyring\" class=\"headerlink\" title=\"9.5 导入keyring\"></a>9.5 导入keyring</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph auth add mds.&#123;id&#125; osd &quot;allow rwx&quot; mds &quot;allow&quot; mon &quot;allow profile mds&quot; -i /var/lib/ceph/mds/&#123;cluster&#125;-&#123;id&#125;/keyring</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-6-修改配置文件\"><a href=\"#9-6-修改配置文件\" class=\"headerlink\" title=\"9.6 修改配置文件\"></a>9.6 修改配置文件</h3><p>Add to ceph.conf.:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mds.&#123;id&#125;]</span><br><span class=\"line\">host = &#123;id&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"9-7-手动启动\"><a href=\"#9-7-手动启动\" class=\"headerlink\" title=\"9.7 手动启动\"></a>9.7 手动启动</h3><p>Start the daemon the manual way.:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph-mds --cluster &#123;cluster-name&#125; -i &#123;id&#125; -m &#123;mon-hostname&#125;:&#123;mon-port&#125; [-f]</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ service ceph start</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo service ceph start mds</span><br></pre></td></tr></table></figure>\n<p>检查进程是否存在<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ps -ef | grep ceph</span><br><span class=\"line\">root      4032     1  0 17:18 ?        00:00:00 /usr/bin/ceph-mon --cluster=ceph -i node1 -f</span><br><span class=\"line\">root      4687     1  0 17:19 ?        00:00:04 /usr/bin/ceph-osd --cluster=ceph -i 0 -f</span><br><span class=\"line\">root      5196     1  0 17:23 ?        00:00:00 ceph-mds --cluster mds -i 0 -m 192.168.1.176:6789</span><br></pre></td></tr></table></figure></p>\n<p>如果已经存在，下面步骤跳过，直接执行第10步的挂载</p>\n<p>如果mds起不来，可以执行如下命令，查看具体报错信息<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo ceph-mds --cluster node1 -i 0 -m 192.168.1.176:6789 -f</span><br><span class=\"line\">starting mds.0 at :/0</span><br><span class=\"line\">2017-03-13 15:15:49.485908 7f32b07bb800 -1 did not load config file, using default settings.</span><br><span class=\"line\">2017-03-13 15:15:49.488414 7f32b07bb800 -1 monclient(hunting): ERROR: missing keyring, cannot use cephx for authentication</span><br><span class=\"line\">2017-03-13 15:15:49.490934 7f32b07bb800 -1 mds.-1.0 ERROR: failed to authenticate: (95) Operation not supported</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>If starting the daemon fails with this error:<br>mds.-1.0 ERROR: failed to authenticate: (22) Invalid argument<br>Then make sure you do not have a keyring set in ceph.conf in the global section; move it to the client section; or add a keyring setting specific to this mds daemon. And verify that you see the same key in the mds data directory and ceph auth get mds.{id} output.</p>\n</blockquote>\n<p><strong> 检查步骤 </strong><br>查看如下结果是否一致<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ ceph auth get mds.0</span><br><span class=\"line\">exported keyring for mds.0</span><br><span class=\"line\">[mds.0]</span><br><span class=\"line\">        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==</span><br><span class=\"line\">        caps mds = &quot;allow&quot;</span><br><span class=\"line\">        caps mon = &quot;allow profile mds&quot;</span><br><span class=\"line\">        caps osd = &quot;allow rwx&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ceph@node1:~/opt/ceph$ cat /var/lib/ceph/mds/mds-0/keyring</span><br><span class=\"line\">[mds.0]</span><br><span class=\"line\">        key = AQBrR8ZY8GN+NxAAVu2pKRH0pXKixwca7HUdjA==</span><br></pre></td></tr></table></figure></p>\n<p>如果仍然报如上错误，可以尝试<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo chown -R ceph:ceph /var/lib/ceph/mds/mds-0</span><br></pre></td></tr></table></figure></p>\n<p>重新生成认证文件应该就会成功,<font color=\"red\">不过不确定对后续操作的影响</font></p>\n<p><a href=\"https://www.sebastien-han.fr/blog/2013/05/13/deploy-a-ceph-mds-server/\" target=\"_blank\" rel=\"noopener\">也可以尝试这里的步骤，不过不保证会好使</a></p>\n<p>Now you are ready to create a Ceph filesystem.</p>\n<h2 id=\"10-挂载\"><a href=\"#10-挂载\" class=\"headerlink\" title=\"10. 挂载\"></a>10. 挂载</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo ceph-fuse -m &#123;ip-address-of-monitor&#125;:6789 /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ df -h</span><br></pre></td></tr></table></figure>\n<p>在node2上执行 安装ceph-fuse<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ceph@node1:~/opt/ceph$ sudo apt-get install ceph-fuse</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo mkdir /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ sudo ceph-fuse -m &#123;ip-address-of-monitor&#125;:6789 /mnt/cephfs</span><br><span class=\"line\">ceph@node1:~/opt/ceph$ df -h</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"11-注意事项\"><a href=\"#11-注意事项\" class=\"headerlink\" title=\"11. 注意事项\"></a>11. 注意事项</h2><font color=\"red\">用户ceph不能够锁定，为了安全问题，只能将用户ceph改为nologin</font>\n\n<h2 id=\"12-服务器重启\"><a href=\"#12-服务器重启\" class=\"headerlink\" title=\"12. 服务器重启\"></a>12. 服务器重启</h2><p>服务器重启后，对于mon节点来说<code>osd</code>和<code>mon</code>会自动启动<br>osd节点的osd服务也会自动启动</p>\n<p> mon节点的<code>mds</code>服务需要手动启动，启动方法为<br> <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ceph-mds --cluster &#123;cluster-name&#125; -i &#123;id&#125; -m &#123;mon-hostname&#125;:&#123;mon-port&#125; [-f]</span><br></pre></td></tr></table></figure></p>\n<p> <strong>另</strong><br> 启动完mds后还需要执行挂载命令<br> <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ceph-fuse -m &#123;ip-address-of-monitor&#125;:6789 /mnt/cephfs</span><br></pre></td></tr></table></figure></p>\n<p> 可以将以上命令<strong>放入到开机启动项中</strong>，但是服务器重启完成后要进行检查ceph的运行状态<br> <code>ceph -s</code>或者<code>ps -ef | grep ceph</code> 或者 通过<code>df -h</code>查看ceph-fuse是否成功挂载目录<br> 如果长时间没成功，并且<code>ceph -s</code>报错，可以尝试将另一节点node2也重启，node1可以成功挂载。</p>\n"},{"title":"docker-registry","date":"2017-02-27T11:44:00.000Z","_content":"\n## 1. 启动registry\n```\ndocker run -d -p 5000:5000 --name registry registry\n```\n**说明**\n\n| 参数                      | 说明                                                    |  \n| -----                     | ------                                                  |\n| `-p 5000:5000`              | 第一个是host的端口，第二个是container的端口             |\n| `--name registry registry1` | registry是镜像名字，registry1是自定义的私有registry名字 |\n\n## 2. 测试私有仓库\n\n### 2.1 新pull一个镜像\n```\nsudo docker pull busybox\n```\n\n### 2.2 给镜像打个tag\n```\nsudo docker tag busybox xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n### 2.3 push到私有仓库\n```\nsudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n### 2.4 查看私有镜像仓库中的镜像\n```\ncurl http://xxx.xxx.xxx.xxx:5000/v2/_catalog\n```\n\n### 2.5 删除本地的镜像\n```\nsudo docker rmi xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n### 2.6 将刚才的删除的镜像，从私有镜像仓库pull回来\n```\nsudo docker pull xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n\n## 3. 报错及处理\n### 3.1 在本地push时，出现如下错误\n```\nsudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage\nThe push refers to a repository [xxx.xxx.xxx.xxx:5000/myfirstimage]\nGet https://xxx.xxx.xxx.xxx:5000/v1/_ping: http: server gave HTTP response to HTTPS client\n```\n**解决方案**\n1. 修改配置\n```\nsudo vi /etc/default/docker\n```\n2. 添加如下内容\n```\nDOCKER_OPTS=\"--insecure-registry xxx.xxx.xxx.xxx:5000\"\n```\n3. 重启docker服务\n```\nsudo service docker restart\n```\n4. 重新执行\n```\nsudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n","source":"_posts/docker-registry.md","raw":"---\ntitle: docker-registry\ndate: 2017-02-27 19:44:00\ntags: docker\n---\n\n## 1. 启动registry\n```\ndocker run -d -p 5000:5000 --name registry registry\n```\n**说明**\n\n| 参数                      | 说明                                                    |  \n| -----                     | ------                                                  |\n| `-p 5000:5000`              | 第一个是host的端口，第二个是container的端口             |\n| `--name registry registry1` | registry是镜像名字，registry1是自定义的私有registry名字 |\n\n## 2. 测试私有仓库\n\n### 2.1 新pull一个镜像\n```\nsudo docker pull busybox\n```\n\n### 2.2 给镜像打个tag\n```\nsudo docker tag busybox xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n### 2.3 push到私有仓库\n```\nsudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n### 2.4 查看私有镜像仓库中的镜像\n```\ncurl http://xxx.xxx.xxx.xxx:5000/v2/_catalog\n```\n\n### 2.5 删除本地的镜像\n```\nsudo docker rmi xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n### 2.6 将刚才的删除的镜像，从私有镜像仓库pull回来\n```\nsudo docker pull xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n\n## 3. 报错及处理\n### 3.1 在本地push时，出现如下错误\n```\nsudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage\nThe push refers to a repository [xxx.xxx.xxx.xxx:5000/myfirstimage]\nGet https://xxx.xxx.xxx.xxx:5000/v1/_ping: http: server gave HTTP response to HTTPS client\n```\n**解决方案**\n1. 修改配置\n```\nsudo vi /etc/default/docker\n```\n2. 添加如下内容\n```\nDOCKER_OPTS=\"--insecure-registry xxx.xxx.xxx.xxx:5000\"\n```\n3. 重启docker服务\n```\nsudo service docker restart\n```\n4. 重新执行\n```\nsudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage\n```\n\n","slug":"docker-registry","published":1,"updated":"2017-08-29T15:13:37.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4l000bzahiy33s6mun","content":"<h2 id=\"1-启动registry\"><a href=\"#1-启动registry\" class=\"headerlink\" title=\"1. 启动registry\"></a>1. 启动registry</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 5000:5000 --name registry registry</span><br></pre></td></tr></table></figure>\n<p><strong>说明</strong></p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-p 5000:5000</code></td>\n<td>第一个是host的端口，第二个是container的端口</td>\n</tr>\n<tr>\n<td><code>--name registry registry1</code></td>\n<td>registry是镜像名字，registry1是自定义的私有registry名字</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"2-测试私有仓库\"><a href=\"#2-测试私有仓库\" class=\"headerlink\" title=\"2. 测试私有仓库\"></a>2. 测试私有仓库</h2><h3 id=\"2-1-新pull一个镜像\"><a href=\"#2-1-新pull一个镜像\" class=\"headerlink\" title=\"2.1 新pull一个镜像\"></a>2.1 新pull一个镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull busybox</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-给镜像打个tag\"><a href=\"#2-2-给镜像打个tag\" class=\"headerlink\" title=\"2.2 给镜像打个tag\"></a>2.2 给镜像打个tag</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker tag busybox xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-push到私有仓库\"><a href=\"#2-3-push到私有仓库\" class=\"headerlink\" title=\"2.3 push到私有仓库\"></a>2.3 push到私有仓库</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-查看私有镜像仓库中的镜像\"><a href=\"#2-4-查看私有镜像仓库中的镜像\" class=\"headerlink\" title=\"2.4 查看私有镜像仓库中的镜像\"></a>2.4 查看私有镜像仓库中的镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://xxx.xxx.xxx.xxx:5000/v2/_catalog</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-删除本地的镜像\"><a href=\"#2-5-删除本地的镜像\" class=\"headerlink\" title=\"2.5 删除本地的镜像\"></a>2.5 删除本地的镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker rmi xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-6-将刚才的删除的镜像，从私有镜像仓库pull回来\"><a href=\"#2-6-将刚才的删除的镜像，从私有镜像仓库pull回来\" class=\"headerlink\" title=\"2.6 将刚才的删除的镜像，从私有镜像仓库pull回来\"></a>2.6 将刚才的删除的镜像，从私有镜像仓库pull回来</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-报错及处理\"><a href=\"#3-报错及处理\" class=\"headerlink\" title=\"3. 报错及处理\"></a>3. 报错及处理</h2><h3 id=\"3-1-在本地push时，出现如下错误\"><a href=\"#3-1-在本地push时，出现如下错误\" class=\"headerlink\" title=\"3.1 在本地push时，出现如下错误\"></a>3.1 在本地push时，出现如下错误</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage</span><br><span class=\"line\">The push refers to a repository [xxx.xxx.xxx.xxx:5000/myfirstimage]</span><br><span class=\"line\">Get https://xxx.xxx.xxx.xxx:5000/v1/_ping: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>\n<p><strong>解决方案</strong></p>\n<ol>\n<li><p>修改配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/default/docker</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>添加如下内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DOCKER_OPTS=&quot;--insecure-registry xxx.xxx.xxx.xxx:5000&quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启docker服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service docker restart</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重新执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-启动registry\"><a href=\"#1-启动registry\" class=\"headerlink\" title=\"1. 启动registry\"></a>1. 启动registry</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 5000:5000 --name registry registry</span><br></pre></td></tr></table></figure>\n<p><strong>说明</strong></p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-p 5000:5000</code></td>\n<td>第一个是host的端口，第二个是container的端口</td>\n</tr>\n<tr>\n<td><code>--name registry registry1</code></td>\n<td>registry是镜像名字，registry1是自定义的私有registry名字</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"2-测试私有仓库\"><a href=\"#2-测试私有仓库\" class=\"headerlink\" title=\"2. 测试私有仓库\"></a>2. 测试私有仓库</h2><h3 id=\"2-1-新pull一个镜像\"><a href=\"#2-1-新pull一个镜像\" class=\"headerlink\" title=\"2.1 新pull一个镜像\"></a>2.1 新pull一个镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull busybox</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-给镜像打个tag\"><a href=\"#2-2-给镜像打个tag\" class=\"headerlink\" title=\"2.2 给镜像打个tag\"></a>2.2 给镜像打个tag</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker tag busybox xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-push到私有仓库\"><a href=\"#2-3-push到私有仓库\" class=\"headerlink\" title=\"2.3 push到私有仓库\"></a>2.3 push到私有仓库</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-查看私有镜像仓库中的镜像\"><a href=\"#2-4-查看私有镜像仓库中的镜像\" class=\"headerlink\" title=\"2.4 查看私有镜像仓库中的镜像\"></a>2.4 查看私有镜像仓库中的镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl http://xxx.xxx.xxx.xxx:5000/v2/_catalog</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-删除本地的镜像\"><a href=\"#2-5-删除本地的镜像\" class=\"headerlink\" title=\"2.5 删除本地的镜像\"></a>2.5 删除本地的镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker rmi xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-6-将刚才的删除的镜像，从私有镜像仓库pull回来\"><a href=\"#2-6-将刚才的删除的镜像，从私有镜像仓库pull回来\" class=\"headerlink\" title=\"2.6 将刚才的删除的镜像，从私有镜像仓库pull回来\"></a>2.6 将刚才的删除的镜像，从私有镜像仓库pull回来</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-报错及处理\"><a href=\"#3-报错及处理\" class=\"headerlink\" title=\"3. 报错及处理\"></a>3. 报错及处理</h2><h3 id=\"3-1-在本地push时，出现如下错误\"><a href=\"#3-1-在本地push时，出现如下错误\" class=\"headerlink\" title=\"3.1 在本地push时，出现如下错误\"></a>3.1 在本地push时，出现如下错误</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage</span><br><span class=\"line\">The push refers to a repository [xxx.xxx.xxx.xxx:5000/myfirstimage]</span><br><span class=\"line\">Get https://xxx.xxx.xxx.xxx:5000/v1/_ping: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>\n<p><strong>解决方案</strong></p>\n<ol>\n<li><p>修改配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/default/docker</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>添加如下内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DOCKER_OPTS=&quot;--insecure-registry xxx.xxx.xxx.xxx:5000&quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启docker服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service docker restart</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重新执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push xxx.xxx.xxx.xxx:5000/myfirstimage</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n"},{"title":"docker安装","date":"2017-02-27T09:03:14.000Z","_content":"\n## 1. ubuntu通过Docker源安装最新版本\n### 1.1 安装依赖\n要安装最新的Docker版本，首先需要安装apt-transport-https支持，之后通过添加源来安装。\n```\nsudo apt-get update\nsudo apt-get install apt-transport-https ca-certificates\n```\n### 1.2 添加GPG key\n```\nsudo apt-key adv \\\n               --keyserver hkp://ha.pool.sks-keyservers.net:80 \\\n               --recv-keys 58118E89F3A912897C070ADBF76221572C52609D \n               \n```\n### 1.3 添加对应的源\n源列表\n\n| Ubuntu version      | Repository                                                 |\n| ---                 | --                                                         |\n| Precise 12.04 (LTS) | deb https://apt.dockerproject.org/repo ubuntu-precise main |\n| Trusty 14.04 (LTS)  | deb https://apt.dockerproject.org/repo ubuntu-trusty main  |\n| Wily 15.10          | deb https://apt.dockerproject.org/repo ubuntu-wily main    |\n| Xenial 16.04 (LTS)  | deb https://apt.dockerproject.org/repo ubuntu-xenial main  |\n\n```\necho \"<REPO>\" | sudo tee /etc/apt/sources.list.d/docker.list\n```\n### 1.4 更新apt包的index\n```\nsudo apt-get update\n```\n### 1.5  安装docker\n```\nsudo apt-get install docker-engine\nsudo service docker start\nsudo docker run hello-world \n```\n\n## 2. CentOS安装\n\n### 2.1 更新包\n```\nsudo yum update\n```\n### 2.2 添加yum源\n```\nsudo tee /etc/yum.repos.d/docker.repo << EOF\n[DockerRepo]\nname=Docker Repository\nbaseurl=https://yum.dockerproject.org/repo/main/centos/7/\nenabled=1\ngpgcheck=1\ngpgkey=https://yum.dockerproject.org/gpg\nEOF\n```\n### 2.3 安装docker包\n```\nsudo yum -y install docker-engine\n```\n### 2.4 开启启动\n```\nsudo systemctl enable docker.service\n```\n### 2.5 启动服务\n```\nsudo systemctl start docker\n```\n## 3. 验证docker是否安装成功\n```\nsudo docker run --rm hello-world\n\nUnable to find image 'hello-world:latest' locally\n latest: Pulling from library/hello-world\n c04b14da8d14: Pull complete\n Digest: sha256:0256e8a36e2070f7bf2d0b0763dbabdd67798512411de4cdcf9431a1feb60fd9\n Status: Downloaded newer image for hello-world:latest\n\n Hello from Docker!\n This message shows that your installation appears to be working correctly.\n\n To generate this message, Docker took the following steps:\n  1. The Docker client contacted the Docker daemon.\n  2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub.\n  3. The Docker daemon created a new container from that image which runs the\n     executable that produces the output you are currently reading.\n  4. The Docker daemon streamed that output to the Docker client, which sent it\n     to your terminal.\n\n To try something more ambitious, you can run an Ubuntu container with:\n  $ docker run -it ubuntu bash\n\n Share images, automate workflows, and more with a free Docker Hub account:\n  https://hub.docker.com\n\n For more examples and ideas, visit:\n  https://docs.docker.com/engine/userguide/\n```\n\n\n[docker on github](https://github.com/docker/docker)  \n[docker install mothed](https://docs.docker.com/engine/installation/)\n","source":"_posts/docker安装.md","raw":"---\ntitle: docker安装\ndate: 2017-02-27 17:03:14\ntags: docker\n---\n\n## 1. ubuntu通过Docker源安装最新版本\n### 1.1 安装依赖\n要安装最新的Docker版本，首先需要安装apt-transport-https支持，之后通过添加源来安装。\n```\nsudo apt-get update\nsudo apt-get install apt-transport-https ca-certificates\n```\n### 1.2 添加GPG key\n```\nsudo apt-key adv \\\n               --keyserver hkp://ha.pool.sks-keyservers.net:80 \\\n               --recv-keys 58118E89F3A912897C070ADBF76221572C52609D \n               \n```\n### 1.3 添加对应的源\n源列表\n\n| Ubuntu version      | Repository                                                 |\n| ---                 | --                                                         |\n| Precise 12.04 (LTS) | deb https://apt.dockerproject.org/repo ubuntu-precise main |\n| Trusty 14.04 (LTS)  | deb https://apt.dockerproject.org/repo ubuntu-trusty main  |\n| Wily 15.10          | deb https://apt.dockerproject.org/repo ubuntu-wily main    |\n| Xenial 16.04 (LTS)  | deb https://apt.dockerproject.org/repo ubuntu-xenial main  |\n\n```\necho \"<REPO>\" | sudo tee /etc/apt/sources.list.d/docker.list\n```\n### 1.4 更新apt包的index\n```\nsudo apt-get update\n```\n### 1.5  安装docker\n```\nsudo apt-get install docker-engine\nsudo service docker start\nsudo docker run hello-world \n```\n\n## 2. CentOS安装\n\n### 2.1 更新包\n```\nsudo yum update\n```\n### 2.2 添加yum源\n```\nsudo tee /etc/yum.repos.d/docker.repo << EOF\n[DockerRepo]\nname=Docker Repository\nbaseurl=https://yum.dockerproject.org/repo/main/centos/7/\nenabled=1\ngpgcheck=1\ngpgkey=https://yum.dockerproject.org/gpg\nEOF\n```\n### 2.3 安装docker包\n```\nsudo yum -y install docker-engine\n```\n### 2.4 开启启动\n```\nsudo systemctl enable docker.service\n```\n### 2.5 启动服务\n```\nsudo systemctl start docker\n```\n## 3. 验证docker是否安装成功\n```\nsudo docker run --rm hello-world\n\nUnable to find image 'hello-world:latest' locally\n latest: Pulling from library/hello-world\n c04b14da8d14: Pull complete\n Digest: sha256:0256e8a36e2070f7bf2d0b0763dbabdd67798512411de4cdcf9431a1feb60fd9\n Status: Downloaded newer image for hello-world:latest\n\n Hello from Docker!\n This message shows that your installation appears to be working correctly.\n\n To generate this message, Docker took the following steps:\n  1. The Docker client contacted the Docker daemon.\n  2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub.\n  3. The Docker daemon created a new container from that image which runs the\n     executable that produces the output you are currently reading.\n  4. The Docker daemon streamed that output to the Docker client, which sent it\n     to your terminal.\n\n To try something more ambitious, you can run an Ubuntu container with:\n  $ docker run -it ubuntu bash\n\n Share images, automate workflows, and more with a free Docker Hub account:\n  https://hub.docker.com\n\n For more examples and ideas, visit:\n  https://docs.docker.com/engine/userguide/\n```\n\n\n[docker on github](https://github.com/docker/docker)  \n[docker install mothed](https://docs.docker.com/engine/installation/)\n","slug":"docker安装","published":1,"updated":"2017-06-04T13:38:04.417Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4m000dzahijsex47ih","content":"<h2 id=\"1-ubuntu通过Docker源安装最新版本\"><a href=\"#1-ubuntu通过Docker源安装最新版本\" class=\"headerlink\" title=\"1. ubuntu通过Docker源安装最新版本\"></a>1. ubuntu通过Docker源安装最新版本</h2><h3 id=\"1-1-安装依赖\"><a href=\"#1-1-安装依赖\" class=\"headerlink\" title=\"1.1 安装依赖\"></a>1.1 安装依赖</h3><p>要安装最新的Docker版本，首先需要安装apt-transport-https支持，之后通过添加源来安装。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install apt-transport-https ca-certificates</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"1-2-添加GPG-key\"><a href=\"#1-2-添加GPG-key\" class=\"headerlink\" title=\"1.2 添加GPG key\"></a>1.2 添加GPG key</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv \\</span><br><span class=\"line\">               --keyserver hkp://ha.pool.sks-keyservers.net:80 \\</span><br><span class=\"line\">               --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-3-添加对应的源\"><a href=\"#1-3-添加对应的源\" class=\"headerlink\" title=\"1.3 添加对应的源\"></a>1.3 添加对应的源</h3><p>源列表</p>\n<table>\n<thead>\n<tr>\n<th>Ubuntu version</th>\n<th>Repository</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Precise 12.04 (LTS)</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-precise main</td>\n</tr>\n<tr>\n<td>Trusty 14.04 (LTS)</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-trusty main</td>\n</tr>\n<tr>\n<td>Wily 15.10</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-wily main</td>\n</tr>\n<tr>\n<td>Xenial 16.04 (LTS)</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-xenial main</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;&lt;REPO&gt;&quot; | sudo tee /etc/apt/sources.list.d/docker.list</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-4-更新apt包的index\"><a href=\"#1-4-更新apt包的index\" class=\"headerlink\" title=\"1.4 更新apt包的index\"></a>1.4 更新apt包的index</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-5-安装docker\"><a href=\"#1-5-安装docker\" class=\"headerlink\" title=\"1.5  安装docker\"></a>1.5  安装docker</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-engine</span><br><span class=\"line\">sudo service docker start</span><br><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-CentOS安装\"><a href=\"#2-CentOS安装\" class=\"headerlink\" title=\"2. CentOS安装\"></a>2. CentOS安装</h2><h3 id=\"2-1-更新包\"><a href=\"#2-1-更新包\" class=\"headerlink\" title=\"2.1 更新包\"></a>2.1 更新包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum update</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-添加yum源\"><a href=\"#2-2-添加yum源\" class=\"headerlink\" title=\"2.2 添加yum源\"></a>2.2 添加yum源</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tee /etc/yum.repos.d/docker.repo &lt;&lt; EOF</span><br><span class=\"line\">[DockerRepo]</span><br><span class=\"line\">name=Docker Repository</span><br><span class=\"line\">baseurl=https://yum.dockerproject.org/repo/main/centos/7/</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=https://yum.dockerproject.org/gpg</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-安装docker包\"><a href=\"#2-3-安装docker包\" class=\"headerlink\" title=\"2.3 安装docker包\"></a>2.3 安装docker包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum -y install docker-engine</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-开启启动\"><a href=\"#2-4-开启启动\" class=\"headerlink\" title=\"2.4 开启启动\"></a>2.4 开启启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl enable docker.service</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-启动服务\"><a href=\"#2-5-启动服务\" class=\"headerlink\" title=\"2.5 启动服务\"></a>2.5 启动服务</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start docker</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-验证docker是否安装成功\"><a href=\"#3-验证docker是否安装成功\" class=\"headerlink\" title=\"3. 验证docker是否安装成功\"></a>3. 验证docker是否安装成功</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --rm hello-world</span><br><span class=\"line\"></span><br><span class=\"line\">Unable to find image &apos;hello-world:latest&apos; locally</span><br><span class=\"line\"> latest: Pulling from library/hello-world</span><br><span class=\"line\"> c04b14da8d14: Pull complete</span><br><span class=\"line\"> Digest: sha256:0256e8a36e2070f7bf2d0b0763dbabdd67798512411de4cdcf9431a1feb60fd9</span><br><span class=\"line\"> Status: Downloaded newer image for hello-world:latest</span><br><span class=\"line\"></span><br><span class=\"line\"> Hello from Docker!</span><br><span class=\"line\"> This message shows that your installation appears to be working correctly.</span><br><span class=\"line\"></span><br><span class=\"line\"> To generate this message, Docker took the following steps:</span><br><span class=\"line\">  1. The Docker client contacted the Docker daemon.</span><br><span class=\"line\">  2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class=\"line\">  3. The Docker daemon created a new container from that image which runs the</span><br><span class=\"line\">     executable that produces the output you are currently reading.</span><br><span class=\"line\">  4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class=\"line\">     to your terminal.</span><br><span class=\"line\"></span><br><span class=\"line\"> To try something more ambitious, you can run an Ubuntu container with:</span><br><span class=\"line\">  $ docker run -it ubuntu bash</span><br><span class=\"line\"></span><br><span class=\"line\"> Share images, automate workflows, and more with a free Docker Hub account:</span><br><span class=\"line\">  https://hub.docker.com</span><br><span class=\"line\"></span><br><span class=\"line\"> For more examples and ideas, visit:</span><br><span class=\"line\">  https://docs.docker.com/engine/userguide/</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/docker/docker\" target=\"_blank\" rel=\"noopener\">docker on github</a><br><a href=\"https://docs.docker.com/engine/installation/\" target=\"_blank\" rel=\"noopener\">docker install mothed</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-ubuntu通过Docker源安装最新版本\"><a href=\"#1-ubuntu通过Docker源安装最新版本\" class=\"headerlink\" title=\"1. ubuntu通过Docker源安装最新版本\"></a>1. ubuntu通过Docker源安装最新版本</h2><h3 id=\"1-1-安装依赖\"><a href=\"#1-1-安装依赖\" class=\"headerlink\" title=\"1.1 安装依赖\"></a>1.1 安装依赖</h3><p>要安装最新的Docker版本，首先需要安装apt-transport-https支持，之后通过添加源来安装。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install apt-transport-https ca-certificates</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"1-2-添加GPG-key\"><a href=\"#1-2-添加GPG-key\" class=\"headerlink\" title=\"1.2 添加GPG key\"></a>1.2 添加GPG key</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv \\</span><br><span class=\"line\">               --keyserver hkp://ha.pool.sks-keyservers.net:80 \\</span><br><span class=\"line\">               --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-3-添加对应的源\"><a href=\"#1-3-添加对应的源\" class=\"headerlink\" title=\"1.3 添加对应的源\"></a>1.3 添加对应的源</h3><p>源列表</p>\n<table>\n<thead>\n<tr>\n<th>Ubuntu version</th>\n<th>Repository</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Precise 12.04 (LTS)</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-precise main</td>\n</tr>\n<tr>\n<td>Trusty 14.04 (LTS)</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-trusty main</td>\n</tr>\n<tr>\n<td>Wily 15.10</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-wily main</td>\n</tr>\n<tr>\n<td>Xenial 16.04 (LTS)</td>\n<td>deb <a href=\"https://apt.dockerproject.org/repo\" target=\"_blank\" rel=\"noopener\">https://apt.dockerproject.org/repo</a> ubuntu-xenial main</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;&lt;REPO&gt;&quot; | sudo tee /etc/apt/sources.list.d/docker.list</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-4-更新apt包的index\"><a href=\"#1-4-更新apt包的index\" class=\"headerlink\" title=\"1.4 更新apt包的index\"></a>1.4 更新apt包的index</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-5-安装docker\"><a href=\"#1-5-安装docker\" class=\"headerlink\" title=\"1.5  安装docker\"></a>1.5  安装docker</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-engine</span><br><span class=\"line\">sudo service docker start</span><br><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-CentOS安装\"><a href=\"#2-CentOS安装\" class=\"headerlink\" title=\"2. CentOS安装\"></a>2. CentOS安装</h2><h3 id=\"2-1-更新包\"><a href=\"#2-1-更新包\" class=\"headerlink\" title=\"2.1 更新包\"></a>2.1 更新包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum update</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-添加yum源\"><a href=\"#2-2-添加yum源\" class=\"headerlink\" title=\"2.2 添加yum源\"></a>2.2 添加yum源</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tee /etc/yum.repos.d/docker.repo &lt;&lt; EOF</span><br><span class=\"line\">[DockerRepo]</span><br><span class=\"line\">name=Docker Repository</span><br><span class=\"line\">baseurl=https://yum.dockerproject.org/repo/main/centos/7/</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=https://yum.dockerproject.org/gpg</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-安装docker包\"><a href=\"#2-3-安装docker包\" class=\"headerlink\" title=\"2.3 安装docker包\"></a>2.3 安装docker包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum -y install docker-engine</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-开启启动\"><a href=\"#2-4-开启启动\" class=\"headerlink\" title=\"2.4 开启启动\"></a>2.4 开启启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl enable docker.service</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-启动服务\"><a href=\"#2-5-启动服务\" class=\"headerlink\" title=\"2.5 启动服务\"></a>2.5 启动服务</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start docker</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-验证docker是否安装成功\"><a href=\"#3-验证docker是否安装成功\" class=\"headerlink\" title=\"3. 验证docker是否安装成功\"></a>3. 验证docker是否安装成功</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --rm hello-world</span><br><span class=\"line\"></span><br><span class=\"line\">Unable to find image &apos;hello-world:latest&apos; locally</span><br><span class=\"line\"> latest: Pulling from library/hello-world</span><br><span class=\"line\"> c04b14da8d14: Pull complete</span><br><span class=\"line\"> Digest: sha256:0256e8a36e2070f7bf2d0b0763dbabdd67798512411de4cdcf9431a1feb60fd9</span><br><span class=\"line\"> Status: Downloaded newer image for hello-world:latest</span><br><span class=\"line\"></span><br><span class=\"line\"> Hello from Docker!</span><br><span class=\"line\"> This message shows that your installation appears to be working correctly.</span><br><span class=\"line\"></span><br><span class=\"line\"> To generate this message, Docker took the following steps:</span><br><span class=\"line\">  1. The Docker client contacted the Docker daemon.</span><br><span class=\"line\">  2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class=\"line\">  3. The Docker daemon created a new container from that image which runs the</span><br><span class=\"line\">     executable that produces the output you are currently reading.</span><br><span class=\"line\">  4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class=\"line\">     to your terminal.</span><br><span class=\"line\"></span><br><span class=\"line\"> To try something more ambitious, you can run an Ubuntu container with:</span><br><span class=\"line\">  $ docker run -it ubuntu bash</span><br><span class=\"line\"></span><br><span class=\"line\"> Share images, automate workflows, and more with a free Docker Hub account:</span><br><span class=\"line\">  https://hub.docker.com</span><br><span class=\"line\"></span><br><span class=\"line\"> For more examples and ideas, visit:</span><br><span class=\"line\">  https://docs.docker.com/engine/userguide/</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/docker/docker\" target=\"_blank\" rel=\"noopener\">docker on github</a><br><a href=\"https://docs.docker.com/engine/installation/\" target=\"_blank\" rel=\"noopener\">docker install mothed</a></p>\n"},{"title":"docker容器","date":"2017-02-27T09:26:49.000Z","_content":"\n\n## 1. 新建并启动容器\n`docker run`\n例：下面的命令输出一个“Hello World”并终止容器\n```\nsudo docker run ubuntu:14.04 /bin/echo 'Hello World'\nHello World\n```\n启动一个bash终端并允许交互\n```\nsudo docker run -t -i ubuntu:14.04 /bin/bash\nroot@3060c837bd2d:/#\n```\n`-t`让docker分配一个伪终端并绑定到容器的标准输入上，`-i`则让容器的标准输入保持打开。\n\n## 2. 启动已终止的容器\n```\nsudo docker ps -a 找到容器ID\nsudo docker start CONTAINER_ID\n```\n\n## 3. 守护态运行\n```\n$sudo docker run -d ubuntu:14.04 /bin/sh -c \"while true; do echo hello world; sleep 1; done\"\n```\n在使用`-d`参数时,容器启动后会进入后台。某些时候需要进入容器进行操作,有很多种方法,包括使用`docker attach`命令或nsenter工具等。\n```\nubuntu@ubuntu:~$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES\n428e85fb5182        ubuntu:12.04        \"/bin/sh -c 'while t   3 minutes ago       Up 3 minutes                            pensive_kirch       \nubuntu@ubuntu:~$ sudo docker attach 428e85fb5182\nhello world\nhello world\nhello world\n^Cubuntu@ubuntu:~$ \nubuntu@ubuntu:~$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n```\n获取容器的输出信息，可以通过`docker log`命令。\n```\nsudo docker logs CONTAINER_ID\n```\n\n## 4. 终止容器\n```\nsudo docker stop CONTAINER_ID\n```\n处于终止态的容器可以通过`sudo docker start CONTAINER_ID`命令来重新启动。\n`sudo docker restart CONTAINER_ID`命令可以重启一个运行态的容器。\n\n\n## 5. 进入容器\n```\nsudo docker attach CONTAINER_ID\n```\n用attach命令有时候并不方便。当多个窗口同时attach到同一个容器的时候,所有窗口都会同步显示。当某个窗口因命令阻塞时,其他窗口也无法执行操作了。\n\n\n## 6. 导出容器\n```\nsudo docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS           PORTS             NAMES\n3060c837bd2d        ubuntu:14.04        \"/bin/bash\"              3 days ago          Up 6 hours                         nonghe\n\nsudo docker export 3060c837bd2d > ubuntu.tar\n```\n这样导出容器快照到本地文件。\n\n## 7. 导入容器快照\n```\ncat ubuntu.tar | sudo docker import - test/ubuntu:v1.0\nsudo docker images\n```\n通过指定URL或者某个目录来导入\n```\nsudo docker import http://example.com/exampleimage.tgz example/imagerepo\n```\n既可以使用`docker load`来导入镜像存储文件到本地镜像库，也可以使用`docker import`来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保持容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。\n\n\n## 8. 删除容器\n处于终止状态的容器可以通过如下命令来删除\n```\nsudo docker rm CONTAINER_ID\n```\n如果要删除一个运行中的容器，可以添加`-f`参数。docker会发送SIGKILL信号给容器。\n\n","source":"_posts/docker容器.md","raw":"---\ntitle: docker容器\ndate: 2017-02-27 17:26:49\ntags: docker\n---\n\n\n## 1. 新建并启动容器\n`docker run`\n例：下面的命令输出一个“Hello World”并终止容器\n```\nsudo docker run ubuntu:14.04 /bin/echo 'Hello World'\nHello World\n```\n启动一个bash终端并允许交互\n```\nsudo docker run -t -i ubuntu:14.04 /bin/bash\nroot@3060c837bd2d:/#\n```\n`-t`让docker分配一个伪终端并绑定到容器的标准输入上，`-i`则让容器的标准输入保持打开。\n\n## 2. 启动已终止的容器\n```\nsudo docker ps -a 找到容器ID\nsudo docker start CONTAINER_ID\n```\n\n## 3. 守护态运行\n```\n$sudo docker run -d ubuntu:14.04 /bin/sh -c \"while true; do echo hello world; sleep 1; done\"\n```\n在使用`-d`参数时,容器启动后会进入后台。某些时候需要进入容器进行操作,有很多种方法,包括使用`docker attach`命令或nsenter工具等。\n```\nubuntu@ubuntu:~$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES\n428e85fb5182        ubuntu:12.04        \"/bin/sh -c 'while t   3 minutes ago       Up 3 minutes                            pensive_kirch       \nubuntu@ubuntu:~$ sudo docker attach 428e85fb5182\nhello world\nhello world\nhello world\n^Cubuntu@ubuntu:~$ \nubuntu@ubuntu:~$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n```\n获取容器的输出信息，可以通过`docker log`命令。\n```\nsudo docker logs CONTAINER_ID\n```\n\n## 4. 终止容器\n```\nsudo docker stop CONTAINER_ID\n```\n处于终止态的容器可以通过`sudo docker start CONTAINER_ID`命令来重新启动。\n`sudo docker restart CONTAINER_ID`命令可以重启一个运行态的容器。\n\n\n## 5. 进入容器\n```\nsudo docker attach CONTAINER_ID\n```\n用attach命令有时候并不方便。当多个窗口同时attach到同一个容器的时候,所有窗口都会同步显示。当某个窗口因命令阻塞时,其他窗口也无法执行操作了。\n\n\n## 6. 导出容器\n```\nsudo docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS           PORTS             NAMES\n3060c837bd2d        ubuntu:14.04        \"/bin/bash\"              3 days ago          Up 6 hours                         nonghe\n\nsudo docker export 3060c837bd2d > ubuntu.tar\n```\n这样导出容器快照到本地文件。\n\n## 7. 导入容器快照\n```\ncat ubuntu.tar | sudo docker import - test/ubuntu:v1.0\nsudo docker images\n```\n通过指定URL或者某个目录来导入\n```\nsudo docker import http://example.com/exampleimage.tgz example/imagerepo\n```\n既可以使用`docker load`来导入镜像存储文件到本地镜像库，也可以使用`docker import`来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保持容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。\n\n\n## 8. 删除容器\n处于终止状态的容器可以通过如下命令来删除\n```\nsudo docker rm CONTAINER_ID\n```\n如果要删除一个运行中的容器，可以添加`-f`参数。docker会发送SIGKILL信号给容器。\n\n","slug":"docker容器","published":1,"updated":"2017-03-13T13:34:57.010Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4o000gzahi8koiwtcy","content":"<h2 id=\"1-新建并启动容器\"><a href=\"#1-新建并启动容器\" class=\"headerlink\" title=\"1. 新建并启动容器\"></a>1. 新建并启动容器</h2><p><code>docker run</code><br>例：下面的命令输出一个“Hello World”并终止容器<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run ubuntu:14.04 /bin/echo &apos;Hello World&apos;</span><br><span class=\"line\">Hello World</span><br></pre></td></tr></table></figure></p>\n<p>启动一个bash终端并允许交互<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -t -i ubuntu:14.04 /bin/bash</span><br><span class=\"line\">root@3060c837bd2d:/#</span><br></pre></td></tr></table></figure></p>\n<p><code>-t</code>让docker分配一个伪终端并绑定到容器的标准输入上，<code>-i</code>则让容器的标准输入保持打开。</p>\n<h2 id=\"2-启动已终止的容器\"><a href=\"#2-启动已终止的容器\" class=\"headerlink\" title=\"2. 启动已终止的容器\"></a>2. 启动已终止的容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker ps -a 找到容器ID</span><br><span class=\"line\">sudo docker start CONTAINER_ID</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-守护态运行\"><a href=\"#3-守护态运行\" class=\"headerlink\" title=\"3. 守护态运行\"></a>3. 守护态运行</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sudo docker run -d ubuntu:14.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span><br></pre></td></tr></table></figure>\n<p>在使用<code>-d</code>参数时,容器启动后会进入后台。某些时候需要进入容器进行操作,有很多种方法,包括使用<code>docker attach</code>命令或nsenter工具等。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">428e85fb5182        ubuntu:12.04        &quot;/bin/sh -c &apos;while t   3 minutes ago       Up 3 minutes                            pensive_kirch       </span><br><span class=\"line\">ubuntu@ubuntu:~$ sudo docker attach 428e85fb5182</span><br><span class=\"line\">hello world</span><br><span class=\"line\">hello world</span><br><span class=\"line\">hello world</span><br><span class=\"line\">^Cubuntu@ubuntu:~$ </span><br><span class=\"line\">ubuntu@ubuntu:~$ sudo docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br></pre></td></tr></table></figure></p>\n<p>获取容器的输出信息，可以通过<code>docker log</code>命令。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker logs CONTAINER_ID</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-终止容器\"><a href=\"#4-终止容器\" class=\"headerlink\" title=\"4. 终止容器\"></a>4. 终止容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker stop CONTAINER_ID</span><br></pre></td></tr></table></figure>\n<p>处于终止态的容器可以通过<code>sudo docker start CONTAINER_ID</code>命令来重新启动。<br><code>sudo docker restart CONTAINER_ID</code>命令可以重启一个运行态的容器。</p>\n<h2 id=\"5-进入容器\"><a href=\"#5-进入容器\" class=\"headerlink\" title=\"5. 进入容器\"></a>5. 进入容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker attach CONTAINER_ID</span><br></pre></td></tr></table></figure>\n<p>用attach命令有时候并不方便。当多个窗口同时attach到同一个容器的时候,所有窗口都会同步显示。当某个窗口因命令阻塞时,其他窗口也无法执行操作了。</p>\n<h2 id=\"6-导出容器\"><a href=\"#6-导出容器\" class=\"headerlink\" title=\"6. 导出容器\"></a>6. 导出容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS           PORTS             NAMES</span><br><span class=\"line\">3060c837bd2d        ubuntu:14.04        &quot;/bin/bash&quot;              3 days ago          Up 6 hours                         nonghe</span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker export 3060c837bd2d &gt; ubuntu.tar</span><br></pre></td></tr></table></figure>\n<p>这样导出容器快照到本地文件。</p>\n<h2 id=\"7-导入容器快照\"><a href=\"#7-导入容器快照\" class=\"headerlink\" title=\"7. 导入容器快照\"></a>7. 导入容器快照</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat ubuntu.tar | sudo docker import - test/ubuntu:v1.0</span><br><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure>\n<p>通过指定URL或者某个目录来导入<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker import http://example.com/exampleimage.tgz example/imagerepo</span><br></pre></td></tr></table></figure></p>\n<p>既可以使用<code>docker load</code>来导入镜像存储文件到本地镜像库，也可以使用<code>docker import</code>来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保持容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。</p>\n<h2 id=\"8-删除容器\"><a href=\"#8-删除容器\" class=\"headerlink\" title=\"8. 删除容器\"></a>8. 删除容器</h2><p>处于终止状态的容器可以通过如下命令来删除<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker rm CONTAINER_ID</span><br></pre></td></tr></table></figure></p>\n<p>如果要删除一个运行中的容器，可以添加<code>-f</code>参数。docker会发送SIGKILL信号给容器。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-新建并启动容器\"><a href=\"#1-新建并启动容器\" class=\"headerlink\" title=\"1. 新建并启动容器\"></a>1. 新建并启动容器</h2><p><code>docker run</code><br>例：下面的命令输出一个“Hello World”并终止容器<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run ubuntu:14.04 /bin/echo &apos;Hello World&apos;</span><br><span class=\"line\">Hello World</span><br></pre></td></tr></table></figure></p>\n<p>启动一个bash终端并允许交互<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -t -i ubuntu:14.04 /bin/bash</span><br><span class=\"line\">root@3060c837bd2d:/#</span><br></pre></td></tr></table></figure></p>\n<p><code>-t</code>让docker分配一个伪终端并绑定到容器的标准输入上，<code>-i</code>则让容器的标准输入保持打开。</p>\n<h2 id=\"2-启动已终止的容器\"><a href=\"#2-启动已终止的容器\" class=\"headerlink\" title=\"2. 启动已终止的容器\"></a>2. 启动已终止的容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker ps -a 找到容器ID</span><br><span class=\"line\">sudo docker start CONTAINER_ID</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-守护态运行\"><a href=\"#3-守护态运行\" class=\"headerlink\" title=\"3. 守护态运行\"></a>3. 守护态运行</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sudo docker run -d ubuntu:14.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span><br></pre></td></tr></table></figure>\n<p>在使用<code>-d</code>参数时,容器启动后会进入后台。某些时候需要进入容器进行操作,有很多种方法,包括使用<code>docker attach</code>命令或nsenter工具等。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">428e85fb5182        ubuntu:12.04        &quot;/bin/sh -c &apos;while t   3 minutes ago       Up 3 minutes                            pensive_kirch       </span><br><span class=\"line\">ubuntu@ubuntu:~$ sudo docker attach 428e85fb5182</span><br><span class=\"line\">hello world</span><br><span class=\"line\">hello world</span><br><span class=\"line\">hello world</span><br><span class=\"line\">^Cubuntu@ubuntu:~$ </span><br><span class=\"line\">ubuntu@ubuntu:~$ sudo docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br></pre></td></tr></table></figure></p>\n<p>获取容器的输出信息，可以通过<code>docker log</code>命令。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker logs CONTAINER_ID</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-终止容器\"><a href=\"#4-终止容器\" class=\"headerlink\" title=\"4. 终止容器\"></a>4. 终止容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker stop CONTAINER_ID</span><br></pre></td></tr></table></figure>\n<p>处于终止态的容器可以通过<code>sudo docker start CONTAINER_ID</code>命令来重新启动。<br><code>sudo docker restart CONTAINER_ID</code>命令可以重启一个运行态的容器。</p>\n<h2 id=\"5-进入容器\"><a href=\"#5-进入容器\" class=\"headerlink\" title=\"5. 进入容器\"></a>5. 进入容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker attach CONTAINER_ID</span><br></pre></td></tr></table></figure>\n<p>用attach命令有时候并不方便。当多个窗口同时attach到同一个容器的时候,所有窗口都会同步显示。当某个窗口因命令阻塞时,其他窗口也无法执行操作了。</p>\n<h2 id=\"6-导出容器\"><a href=\"#6-导出容器\" class=\"headerlink\" title=\"6. 导出容器\"></a>6. 导出容器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS           PORTS             NAMES</span><br><span class=\"line\">3060c837bd2d        ubuntu:14.04        &quot;/bin/bash&quot;              3 days ago          Up 6 hours                         nonghe</span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker export 3060c837bd2d &gt; ubuntu.tar</span><br></pre></td></tr></table></figure>\n<p>这样导出容器快照到本地文件。</p>\n<h2 id=\"7-导入容器快照\"><a href=\"#7-导入容器快照\" class=\"headerlink\" title=\"7. 导入容器快照\"></a>7. 导入容器快照</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat ubuntu.tar | sudo docker import - test/ubuntu:v1.0</span><br><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure>\n<p>通过指定URL或者某个目录来导入<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker import http://example.com/exampleimage.tgz example/imagerepo</span><br></pre></td></tr></table></figure></p>\n<p>既可以使用<code>docker load</code>来导入镜像存储文件到本地镜像库，也可以使用<code>docker import</code>来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保持容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。</p>\n<h2 id=\"8-删除容器\"><a href=\"#8-删除容器\" class=\"headerlink\" title=\"8. 删除容器\"></a>8. 删除容器</h2><p>处于终止状态的容器可以通过如下命令来删除<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker rm CONTAINER_ID</span><br></pre></td></tr></table></figure></p>\n<p>如果要删除一个运行中的容器，可以添加<code>-f</code>参数。docker会发送SIGKILL信号给容器。</p>\n"},{"title":"docker镜像","date":"2017-02-27T09:15:33.000Z","_content":"\n## 1. 获取镜像\n```\nsudo docker pull 镜像名\n```\n例：从Docker Hub仓库下载一个Ubuntu 12.04的操作系统的镜像\n```\nubuntu@ubuntu:~$ sudo docker pull ubuntu:12.04\n12.04: Pulling from ubuntu\n\n8941035ae797: Pull complete \n191c4e1e4400: Pull complete \nfd04a9dc157f: Pull complete \nbe08d59fa177: Pull complete \necf8c2069900: Pull complete \n8ea067ad7a27: Pull complete \nDigest: sha256:57a83f4b4f43f2d008c8ceaa9663a6f7ecd061fefa80da8f32e0f22c7b923390\nStatus: Downloaded newer image for ubuntu:12.04\n```\n\n## 2. 显示本地镜像\n```\nsudo docker images\n```\n\n```\nubuntu@ubuntu:~$ sudo docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu              12.04               8ea067ad7a27        4 weeks ago         103.6 MB\n```\n\n## 3. 创建镜像\n\n### 3.1 修改已有的镜像\n\n- 使用下载的镜像启动一个容器\n```\nsudo docker run -t -i 镜像名 /bin/bash\n```\n例： 使用镜像ubuntu:12.04来启动一个容器\n```\nubuntu@ubuntu:~$ sudo docker run -t -i ubuntu:12.04 /bin/bash\nroot@c2b59b70c1b7:/# pwd\n/\nroot@f93c7537832d:/# ls\nbin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var\nroot@f93c7537832d:/# ps \n  PID TTY          TIME CMD\n    1 ?        00:00:00 bash\n   12 ?        00:00:00 ps\n```\n- 在容器中对安装软件\n结束操作后，执行`exit`来退出。\n\n- 提交更新后的副本\n```\nsudo docker commit -m \"提交说明\" -a 指定更新的用户信息 用来创建镜像的容器的ID 指定目标镜像的仓库名和tag信息\n```\n创建成功后会返回这个镜像的ID信息\n例：\n```\nsudo docker commit -m \"Add node\" -a \"username\" aeee120a81fc testnode \n\nsudo docker images 查看新创建的镜像\nsudo docker run -t -i testnode /bin/bash  使用新创建的镜像启动容器\n```\n\n### 3.2 使用Dockerfile来创建镜像\ntodo\n\n### 3.3 从本地导入\n```\nsudo cat ubuntu-14.04.tar.gz | docker import - ubuntu:14.04\nsudo docker images\n```\n\n### 3.4 上传镜像\n用户在Docker Hub上完成注册后，可以可以通过`docker push`命令，把自己创建的镜像上传到docker的公共仓库来共享。\n```\nsudo docker push 镜像名\n```\n\n## 4. 存出镜像\n```\nsudo docker images\nsudo docker save -o 保存文件名 镜像名\n```\n\n## 5. 载入镜像\n可以使用`docker load`从导出的本地文件中再导入到本地镜像库。\n```\nsudo docker load --input ubuntu_14.04.tar\n```\n或\n```\nsudo docker load < ubuntu_14.04.tar\n```\n这将导入镜像以及相关的元数据信息（包括标签等）\n\n\n## 6. 删除本地镜像\n```\nsudo docker rmi IMAGE_ID\n```\n","source":"_posts/docker镜像.md","raw":"---\ntitle: docker镜像\ndate: 2017-02-27 17:15:33\ntags: docker\n---\n\n## 1. 获取镜像\n```\nsudo docker pull 镜像名\n```\n例：从Docker Hub仓库下载一个Ubuntu 12.04的操作系统的镜像\n```\nubuntu@ubuntu:~$ sudo docker pull ubuntu:12.04\n12.04: Pulling from ubuntu\n\n8941035ae797: Pull complete \n191c4e1e4400: Pull complete \nfd04a9dc157f: Pull complete \nbe08d59fa177: Pull complete \necf8c2069900: Pull complete \n8ea067ad7a27: Pull complete \nDigest: sha256:57a83f4b4f43f2d008c8ceaa9663a6f7ecd061fefa80da8f32e0f22c7b923390\nStatus: Downloaded newer image for ubuntu:12.04\n```\n\n## 2. 显示本地镜像\n```\nsudo docker images\n```\n\n```\nubuntu@ubuntu:~$ sudo docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu              12.04               8ea067ad7a27        4 weeks ago         103.6 MB\n```\n\n## 3. 创建镜像\n\n### 3.1 修改已有的镜像\n\n- 使用下载的镜像启动一个容器\n```\nsudo docker run -t -i 镜像名 /bin/bash\n```\n例： 使用镜像ubuntu:12.04来启动一个容器\n```\nubuntu@ubuntu:~$ sudo docker run -t -i ubuntu:12.04 /bin/bash\nroot@c2b59b70c1b7:/# pwd\n/\nroot@f93c7537832d:/# ls\nbin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var\nroot@f93c7537832d:/# ps \n  PID TTY          TIME CMD\n    1 ?        00:00:00 bash\n   12 ?        00:00:00 ps\n```\n- 在容器中对安装软件\n结束操作后，执行`exit`来退出。\n\n- 提交更新后的副本\n```\nsudo docker commit -m \"提交说明\" -a 指定更新的用户信息 用来创建镜像的容器的ID 指定目标镜像的仓库名和tag信息\n```\n创建成功后会返回这个镜像的ID信息\n例：\n```\nsudo docker commit -m \"Add node\" -a \"username\" aeee120a81fc testnode \n\nsudo docker images 查看新创建的镜像\nsudo docker run -t -i testnode /bin/bash  使用新创建的镜像启动容器\n```\n\n### 3.2 使用Dockerfile来创建镜像\ntodo\n\n### 3.3 从本地导入\n```\nsudo cat ubuntu-14.04.tar.gz | docker import - ubuntu:14.04\nsudo docker images\n```\n\n### 3.4 上传镜像\n用户在Docker Hub上完成注册后，可以可以通过`docker push`命令，把自己创建的镜像上传到docker的公共仓库来共享。\n```\nsudo docker push 镜像名\n```\n\n## 4. 存出镜像\n```\nsudo docker images\nsudo docker save -o 保存文件名 镜像名\n```\n\n## 5. 载入镜像\n可以使用`docker load`从导出的本地文件中再导入到本地镜像库。\n```\nsudo docker load --input ubuntu_14.04.tar\n```\n或\n```\nsudo docker load < ubuntu_14.04.tar\n```\n这将导入镜像以及相关的元数据信息（包括标签等）\n\n\n## 6. 删除本地镜像\n```\nsudo docker rmi IMAGE_ID\n```\n","slug":"docker镜像","published":1,"updated":"2017-03-13T13:34:57.010Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4p000hzahioqqebm91","content":"<h2 id=\"1-获取镜像\"><a href=\"#1-获取镜像\" class=\"headerlink\" title=\"1. 获取镜像\"></a>1. 获取镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull 镜像名</span><br></pre></td></tr></table></figure>\n<p>例：从Docker Hub仓库下载一个Ubuntu 12.04的操作系统的镜像<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker pull ubuntu:12.04</span><br><span class=\"line\">12.04: Pulling from ubuntu</span><br><span class=\"line\"></span><br><span class=\"line\">8941035ae797: Pull complete </span><br><span class=\"line\">191c4e1e4400: Pull complete </span><br><span class=\"line\">fd04a9dc157f: Pull complete </span><br><span class=\"line\">be08d59fa177: Pull complete </span><br><span class=\"line\">ecf8c2069900: Pull complete </span><br><span class=\"line\">8ea067ad7a27: Pull complete </span><br><span class=\"line\">Digest: sha256:57a83f4b4f43f2d008c8ceaa9663a6f7ecd061fefa80da8f32e0f22c7b923390</span><br><span class=\"line\">Status: Downloaded newer image for ubuntu:12.04</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-显示本地镜像\"><a href=\"#2-显示本地镜像\" class=\"headerlink\" title=\"2. 显示本地镜像\"></a>2. 显示本地镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker images</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class=\"line\">ubuntu              12.04               8ea067ad7a27        4 weeks ago         103.6 MB</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-创建镜像\"><a href=\"#3-创建镜像\" class=\"headerlink\" title=\"3. 创建镜像\"></a>3. 创建镜像</h2><h3 id=\"3-1-修改已有的镜像\"><a href=\"#3-1-修改已有的镜像\" class=\"headerlink\" title=\"3.1 修改已有的镜像\"></a>3.1 修改已有的镜像</h3><ul>\n<li>使用下载的镜像启动一个容器<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -t -i 镜像名 /bin/bash</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>例： 使用镜像ubuntu:12.04来启动一个容器<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker run -t -i ubuntu:12.04 /bin/bash</span><br><span class=\"line\">root@c2b59b70c1b7:/# pwd</span><br><span class=\"line\">/</span><br><span class=\"line\">root@f93c7537832d:/# ls</span><br><span class=\"line\">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var</span><br><span class=\"line\">root@f93c7537832d:/# ps </span><br><span class=\"line\">  PID TTY          TIME CMD</span><br><span class=\"line\">    1 ?        00:00:00 bash</span><br><span class=\"line\">   12 ?        00:00:00 ps</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><p>在容器中对安装软件<br>结束操作后，执行<code>exit</code>来退出。</p>\n</li>\n<li><p>提交更新后的副本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker commit -m &quot;提交说明&quot; -a 指定更新的用户信息 用来创建镜像的容器的ID 指定目标镜像的仓库名和tag信息</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>创建成功后会返回这个镜像的ID信息<br>例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker commit -m &quot;Add node&quot; -a &quot;username&quot; aeee120a81fc testnode </span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker images 查看新创建的镜像</span><br><span class=\"line\">sudo docker run -t -i testnode /bin/bash  使用新创建的镜像启动容器</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-2-使用Dockerfile来创建镜像\"><a href=\"#3-2-使用Dockerfile来创建镜像\" class=\"headerlink\" title=\"3.2 使用Dockerfile来创建镜像\"></a>3.2 使用Dockerfile来创建镜像</h3><p>todo</p>\n<h3 id=\"3-3-从本地导入\"><a href=\"#3-3-从本地导入\" class=\"headerlink\" title=\"3.3 从本地导入\"></a>3.3 从本地导入</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cat ubuntu-14.04.tar.gz | docker import - ubuntu:14.04</span><br><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-4-上传镜像\"><a href=\"#3-4-上传镜像\" class=\"headerlink\" title=\"3.4 上传镜像\"></a>3.4 上传镜像</h3><p>用户在Docker Hub上完成注册后，可以可以通过<code>docker push</code>命令，把自己创建的镜像上传到docker的公共仓库来共享。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push 镜像名</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-存出镜像\"><a href=\"#4-存出镜像\" class=\"headerlink\" title=\"4. 存出镜像\"></a>4. 存出镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker images</span><br><span class=\"line\">sudo docker save -o 保存文件名 镜像名</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-载入镜像\"><a href=\"#5-载入镜像\" class=\"headerlink\" title=\"5. 载入镜像\"></a>5. 载入镜像</h2><p>可以使用<code>docker load</code>从导出的本地文件中再导入到本地镜像库。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker load --input ubuntu_14.04.tar</span><br></pre></td></tr></table></figure></p>\n<p>或<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker load &lt; ubuntu_14.04.tar</span><br></pre></td></tr></table></figure></p>\n<p>这将导入镜像以及相关的元数据信息（包括标签等）</p>\n<h2 id=\"6-删除本地镜像\"><a href=\"#6-删除本地镜像\" class=\"headerlink\" title=\"6. 删除本地镜像\"></a>6. 删除本地镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker rmi IMAGE_ID</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-获取镜像\"><a href=\"#1-获取镜像\" class=\"headerlink\" title=\"1. 获取镜像\"></a>1. 获取镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull 镜像名</span><br></pre></td></tr></table></figure>\n<p>例：从Docker Hub仓库下载一个Ubuntu 12.04的操作系统的镜像<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker pull ubuntu:12.04</span><br><span class=\"line\">12.04: Pulling from ubuntu</span><br><span class=\"line\"></span><br><span class=\"line\">8941035ae797: Pull complete </span><br><span class=\"line\">191c4e1e4400: Pull complete </span><br><span class=\"line\">fd04a9dc157f: Pull complete </span><br><span class=\"line\">be08d59fa177: Pull complete </span><br><span class=\"line\">ecf8c2069900: Pull complete </span><br><span class=\"line\">8ea067ad7a27: Pull complete </span><br><span class=\"line\">Digest: sha256:57a83f4b4f43f2d008c8ceaa9663a6f7ecd061fefa80da8f32e0f22c7b923390</span><br><span class=\"line\">Status: Downloaded newer image for ubuntu:12.04</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-显示本地镜像\"><a href=\"#2-显示本地镜像\" class=\"headerlink\" title=\"2. 显示本地镜像\"></a>2. 显示本地镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker images</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class=\"line\">ubuntu              12.04               8ea067ad7a27        4 weeks ago         103.6 MB</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-创建镜像\"><a href=\"#3-创建镜像\" class=\"headerlink\" title=\"3. 创建镜像\"></a>3. 创建镜像</h2><h3 id=\"3-1-修改已有的镜像\"><a href=\"#3-1-修改已有的镜像\" class=\"headerlink\" title=\"3.1 修改已有的镜像\"></a>3.1 修改已有的镜像</h3><ul>\n<li>使用下载的镜像启动一个容器<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -t -i 镜像名 /bin/bash</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>例： 使用镜像ubuntu:12.04来启动一个容器<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu@ubuntu:~$ sudo docker run -t -i ubuntu:12.04 /bin/bash</span><br><span class=\"line\">root@c2b59b70c1b7:/# pwd</span><br><span class=\"line\">/</span><br><span class=\"line\">root@f93c7537832d:/# ls</span><br><span class=\"line\">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var</span><br><span class=\"line\">root@f93c7537832d:/# ps </span><br><span class=\"line\">  PID TTY          TIME CMD</span><br><span class=\"line\">    1 ?        00:00:00 bash</span><br><span class=\"line\">   12 ?        00:00:00 ps</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><p>在容器中对安装软件<br>结束操作后，执行<code>exit</code>来退出。</p>\n</li>\n<li><p>提交更新后的副本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker commit -m &quot;提交说明&quot; -a 指定更新的用户信息 用来创建镜像的容器的ID 指定目标镜像的仓库名和tag信息</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>创建成功后会返回这个镜像的ID信息<br>例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker commit -m &quot;Add node&quot; -a &quot;username&quot; aeee120a81fc testnode </span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker images 查看新创建的镜像</span><br><span class=\"line\">sudo docker run -t -i testnode /bin/bash  使用新创建的镜像启动容器</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-2-使用Dockerfile来创建镜像\"><a href=\"#3-2-使用Dockerfile来创建镜像\" class=\"headerlink\" title=\"3.2 使用Dockerfile来创建镜像\"></a>3.2 使用Dockerfile来创建镜像</h3><p>todo</p>\n<h3 id=\"3-3-从本地导入\"><a href=\"#3-3-从本地导入\" class=\"headerlink\" title=\"3.3 从本地导入\"></a>3.3 从本地导入</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cat ubuntu-14.04.tar.gz | docker import - ubuntu:14.04</span><br><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-4-上传镜像\"><a href=\"#3-4-上传镜像\" class=\"headerlink\" title=\"3.4 上传镜像\"></a>3.4 上传镜像</h3><p>用户在Docker Hub上完成注册后，可以可以通过<code>docker push</code>命令，把自己创建的镜像上传到docker的公共仓库来共享。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker push 镜像名</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-存出镜像\"><a href=\"#4-存出镜像\" class=\"headerlink\" title=\"4. 存出镜像\"></a>4. 存出镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker images</span><br><span class=\"line\">sudo docker save -o 保存文件名 镜像名</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-载入镜像\"><a href=\"#5-载入镜像\" class=\"headerlink\" title=\"5. 载入镜像\"></a>5. 载入镜像</h2><p>可以使用<code>docker load</code>从导出的本地文件中再导入到本地镜像库。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker load --input ubuntu_14.04.tar</span><br></pre></td></tr></table></figure></p>\n<p>或<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker load &lt; ubuntu_14.04.tar</span><br></pre></td></tr></table></figure></p>\n<p>这将导入镜像以及相关的元数据信息（包括标签等）</p>\n<h2 id=\"6-删除本地镜像\"><a href=\"#6-删除本地镜像\" class=\"headerlink\" title=\"6. 删除本地镜像\"></a>6. 删除本地镜像</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker rmi IMAGE_ID</span><br></pre></td></tr></table></figure>\n"},{"title":"git bisect","date":"2017-08-30T14:06:12.000Z","_content":"\n# git bisect\n在提交了多次代码后，发现代码不能正确运行了，但是很确定的是某一个commit是好使的，比如昨天晚上或者上午的某次提交是可以正确运行的，这个时候可以通过`git bisect`来通过二分查找出问题的那次提交\n\n## 1. 开始\n```\ngit bisect start\n```\n## 2.标记当前的HEAD为bad\n```\ngit bisect bad\n```\n\n## 3.标记最近一次可以正确运行的commit为good\n```\ngit bisect good <commit-id> \n```\n## 4.检查中间的那次提交状态是正确还是错误\n- 如果是正确，标记为good\n```\ngit bisect good\n```\n这时候，git会从这个good到最初标记的bad进行二分查找\n\n- 如果是出错的，标记为bad\n```\ngit bisect bad\n```\n这时候，git会从这个bad到最初标记的good位置进行二分查找\n\n\n## 5.重复步骤4\n即可找到最初的bad是在哪次commit不小心引入的。\n\n## 6.结束\n查找到引入bug的commit之后，回到最初的HEAD\n```\ngit bisect reset\n```\n\n\n\n\n\n\n\n\n","source":"_posts/git-bisect.md","raw":"---\ntitle: git bisect\ndate: 2017-08-30 22:06:12\ntags: git\n---\n\n# git bisect\n在提交了多次代码后，发现代码不能正确运行了，但是很确定的是某一个commit是好使的，比如昨天晚上或者上午的某次提交是可以正确运行的，这个时候可以通过`git bisect`来通过二分查找出问题的那次提交\n\n## 1. 开始\n```\ngit bisect start\n```\n## 2.标记当前的HEAD为bad\n```\ngit bisect bad\n```\n\n## 3.标记最近一次可以正确运行的commit为good\n```\ngit bisect good <commit-id> \n```\n## 4.检查中间的那次提交状态是正确还是错误\n- 如果是正确，标记为good\n```\ngit bisect good\n```\n这时候，git会从这个good到最初标记的bad进行二分查找\n\n- 如果是出错的，标记为bad\n```\ngit bisect bad\n```\n这时候，git会从这个bad到最初标记的good位置进行二分查找\n\n\n## 5.重复步骤4\n即可找到最初的bad是在哪次commit不小心引入的。\n\n## 6.结束\n查找到引入bug的commit之后，回到最初的HEAD\n```\ngit bisect reset\n```\n\n\n\n\n\n\n\n\n","slug":"git-bisect","published":1,"updated":"2017-08-30T14:10:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4q000kzahiwx94eqc7","content":"<h1 id=\"git-bisect\"><a href=\"#git-bisect\" class=\"headerlink\" title=\"git bisect\"></a>git bisect</h1><p>在提交了多次代码后，发现代码不能正确运行了，但是很确定的是某一个commit是好使的，比如昨天晚上或者上午的某次提交是可以正确运行的，这个时候可以通过<code>git bisect</code>来通过二分查找出问题的那次提交</p>\n<h2 id=\"1-开始\"><a href=\"#1-开始\" class=\"headerlink\" title=\"1. 开始\"></a>1. 开始</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect start</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-标记当前的HEAD为bad\"><a href=\"#2-标记当前的HEAD为bad\" class=\"headerlink\" title=\"2.标记当前的HEAD为bad\"></a>2.标记当前的HEAD为bad</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect bad</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-标记最近一次可以正确运行的commit为good\"><a href=\"#3-标记最近一次可以正确运行的commit为good\" class=\"headerlink\" title=\"3.标记最近一次可以正确运行的commit为good\"></a>3.标记最近一次可以正确运行的commit为good</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect good &lt;commit-id&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-检查中间的那次提交状态是正确还是错误\"><a href=\"#4-检查中间的那次提交状态是正确还是错误\" class=\"headerlink\" title=\"4.检查中间的那次提交状态是正确还是错误\"></a>4.检查中间的那次提交状态是正确还是错误</h2><ul>\n<li>如果是正确，标记为good<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect good</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这时候，git会从这个good到最初标记的bad进行二分查找</p>\n<ul>\n<li>如果是出错的，标记为bad<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect bad</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这时候，git会从这个bad到最初标记的good位置进行二分查找</p>\n<h2 id=\"5-重复步骤4\"><a href=\"#5-重复步骤4\" class=\"headerlink\" title=\"5.重复步骤4\"></a>5.重复步骤4</h2><p>即可找到最初的bad是在哪次commit不小心引入的。</p>\n<h2 id=\"6-结束\"><a href=\"#6-结束\" class=\"headerlink\" title=\"6.结束\"></a>6.结束</h2><p>查找到引入bug的commit之后，回到最初的HEAD<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect reset</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"git-bisect\"><a href=\"#git-bisect\" class=\"headerlink\" title=\"git bisect\"></a>git bisect</h1><p>在提交了多次代码后，发现代码不能正确运行了，但是很确定的是某一个commit是好使的，比如昨天晚上或者上午的某次提交是可以正确运行的，这个时候可以通过<code>git bisect</code>来通过二分查找出问题的那次提交</p>\n<h2 id=\"1-开始\"><a href=\"#1-开始\" class=\"headerlink\" title=\"1. 开始\"></a>1. 开始</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect start</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-标记当前的HEAD为bad\"><a href=\"#2-标记当前的HEAD为bad\" class=\"headerlink\" title=\"2.标记当前的HEAD为bad\"></a>2.标记当前的HEAD为bad</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect bad</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-标记最近一次可以正确运行的commit为good\"><a href=\"#3-标记最近一次可以正确运行的commit为good\" class=\"headerlink\" title=\"3.标记最近一次可以正确运行的commit为good\"></a>3.标记最近一次可以正确运行的commit为good</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect good &lt;commit-id&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-检查中间的那次提交状态是正确还是错误\"><a href=\"#4-检查中间的那次提交状态是正确还是错误\" class=\"headerlink\" title=\"4.检查中间的那次提交状态是正确还是错误\"></a>4.检查中间的那次提交状态是正确还是错误</h2><ul>\n<li>如果是正确，标记为good<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect good</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这时候，git会从这个good到最初标记的bad进行二分查找</p>\n<ul>\n<li>如果是出错的，标记为bad<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect bad</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这时候，git会从这个bad到最初标记的good位置进行二分查找</p>\n<h2 id=\"5-重复步骤4\"><a href=\"#5-重复步骤4\" class=\"headerlink\" title=\"5.重复步骤4\"></a>5.重复步骤4</h2><p>即可找到最初的bad是在哪次commit不小心引入的。</p>\n<h2 id=\"6-结束\"><a href=\"#6-结束\" class=\"headerlink\" title=\"6.结束\"></a>6.结束</h2><p>查找到引入bug的commit之后，回到最初的HEAD<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git bisect reset</span><br></pre></td></tr></table></figure></p>\n"},{"title":"git cherry-pick","date":"2017-01-14T05:06:14.000Z","_content":"\n## 1. 用法\n\n```\n$ git cherry-pick <commit id>\n```\n\ncherry-pick的作用是在当前分支上应用某一个提交，在合并的时候特别有用。\n当前在 fixbug 分支上，做了3次修改并提交到本地\n\n```\n$ git branch\n* fixbug\n  master\n\n$ git log --oneline \n43f50dd fix bug3\nb24931f fix bug2\n9ab09b7 fix bug1\n```\n这时候我发现 fix bug1 这个提交是不需要的，之需要将后2次合并进主分支即可。 可以这么操作:\n\n```\n$ git checkout master  #切换到master分支\nSwitched to branch 'master'\nYour branch is up-to-date with 'origin/master'.\n\n$ git cherry-pick 9ab09b7..43f50dd\n[master 9cc5bca] fix bug2\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 b\n[master 5a0704b] fix bug3\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 c\n\n$ git log --oneline \n5a0704b fix bug3\n9cc5bca fix bug2\nc9e81c7 rename\n```\n\n可以看到，执行`check-pick`后， git 将指定的 commit <font color=red>(不含第一个，包含 最后一个)</font> 应用到了当前的 master 分支。执行完之后，可以删除掉 fixbug 分支。这样就可以很方便的从一个分支里面选取一部分提交合并到主分支里面去 了。当然同样也会遇到需要merge的情况。和merege一样操作即可。\n\n\n## 2. 实例 \n\n在本地 fixbug 分支上做了一个commit (09e827c96960780ebdee18040a4324de7fecba9b)， 如何把它放到 master 分支上？ \n\n办法之一： 使用 cherry-pick.  根据git 文档：\n> Apply the changes introduced by some existing commits\n\n就是对已经存在的commit 进行apply (可以理解为再次提交）\n例如：\n```\n$ git checkout master\n$ git cherry-pick 09e827c     # 这个09e827c号码，位于：\n```\n\n```\n$ git log\ncommit 09e827c96960780ebdee18040a4324de7fecba9b\nAuthor: niuzhiqiang <niuzhiqiang90@foxmail.com>\nDate:   Fri Aug 12 10:52:32 2016 +0800\n\n    add other\n\n```\n\n### 2.1 如果顺利，就会正常提交。结果：\n\n```\n$ git cherry-pick 9ab09b7..43f50dd\n[master 9cc5bca] fix bug2\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 b\n[master 5a0704b] fix 3\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 c\n```\n\n### 2.2 如果在cherry-pick的过程中出现了冲突\n\n```\n$ git cherry-pick 09e827c\nerror: could not apply 09e827c... add other\nhint: after resolving the conflicts, mark the corrected paths\nhint: with 'git add <paths>' or 'git rm <paths>'\nhint: and commit the result with 'git commit'\n```\n\n#### 2.2.1 看哪些文件出现冲突\n\n```\n$ git status\nOn branch master\nYour branch is ahead of 'origin/master' by 3 commits.\n  (use \"git push\" to publish your local commits)\n\nYou are currently cherry-picking commit 09e827c.\n  (fix conflicts and run \"git cherry-pick --continue\")\n  (use \"git cherry-pick --abort\" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use \"git add <file>...\" to mark resolution)\n\n        both modified:      b\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n```\n\n```\n$ git diff \ndiff --cc b\nindex 7898192,6178079..0000000\n--- a/b\n+++ b/b\n@@@ -1,1 -1,1 +1,5 @@@\n++<<<<<<< HEAD\n +a\n++=======\n +b\n++>>>>>>> 09e827c... add other\n```\n\n#### 2.2.2 手动解决它\n\n```\n$ vi b \n<<<<<<< HEAD\na\n=======\nb\n>>>>>>> 09e827c... add other\n```\n\n保存退出，手动提交\n\n```\n$ git add b\n$ git commit -m \"merge by handler\"\n$ git push\n```\n","source":"_posts/git-cherry-pick.md","raw":"---\ntitle: git cherry-pick\ndate: 2017-01-14 13:06:14\ncategories: git\ntags: git\n---\n\n## 1. 用法\n\n```\n$ git cherry-pick <commit id>\n```\n\ncherry-pick的作用是在当前分支上应用某一个提交，在合并的时候特别有用。\n当前在 fixbug 分支上，做了3次修改并提交到本地\n\n```\n$ git branch\n* fixbug\n  master\n\n$ git log --oneline \n43f50dd fix bug3\nb24931f fix bug2\n9ab09b7 fix bug1\n```\n这时候我发现 fix bug1 这个提交是不需要的，之需要将后2次合并进主分支即可。 可以这么操作:\n\n```\n$ git checkout master  #切换到master分支\nSwitched to branch 'master'\nYour branch is up-to-date with 'origin/master'.\n\n$ git cherry-pick 9ab09b7..43f50dd\n[master 9cc5bca] fix bug2\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 b\n[master 5a0704b] fix bug3\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 c\n\n$ git log --oneline \n5a0704b fix bug3\n9cc5bca fix bug2\nc9e81c7 rename\n```\n\n可以看到，执行`check-pick`后， git 将指定的 commit <font color=red>(不含第一个，包含 最后一个)</font> 应用到了当前的 master 分支。执行完之后，可以删除掉 fixbug 分支。这样就可以很方便的从一个分支里面选取一部分提交合并到主分支里面去 了。当然同样也会遇到需要merge的情况。和merege一样操作即可。\n\n\n## 2. 实例 \n\n在本地 fixbug 分支上做了一个commit (09e827c96960780ebdee18040a4324de7fecba9b)， 如何把它放到 master 分支上？ \n\n办法之一： 使用 cherry-pick.  根据git 文档：\n> Apply the changes introduced by some existing commits\n\n就是对已经存在的commit 进行apply (可以理解为再次提交）\n例如：\n```\n$ git checkout master\n$ git cherry-pick 09e827c     # 这个09e827c号码，位于：\n```\n\n```\n$ git log\ncommit 09e827c96960780ebdee18040a4324de7fecba9b\nAuthor: niuzhiqiang <niuzhiqiang90@foxmail.com>\nDate:   Fri Aug 12 10:52:32 2016 +0800\n\n    add other\n\n```\n\n### 2.1 如果顺利，就会正常提交。结果：\n\n```\n$ git cherry-pick 9ab09b7..43f50dd\n[master 9cc5bca] fix bug2\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 b\n[master 5a0704b] fix 3\n 1 file changed, 0 insertions(+), 0 deletions(-)\n create mode 100644 c\n```\n\n### 2.2 如果在cherry-pick的过程中出现了冲突\n\n```\n$ git cherry-pick 09e827c\nerror: could not apply 09e827c... add other\nhint: after resolving the conflicts, mark the corrected paths\nhint: with 'git add <paths>' or 'git rm <paths>'\nhint: and commit the result with 'git commit'\n```\n\n#### 2.2.1 看哪些文件出现冲突\n\n```\n$ git status\nOn branch master\nYour branch is ahead of 'origin/master' by 3 commits.\n  (use \"git push\" to publish your local commits)\n\nYou are currently cherry-picking commit 09e827c.\n  (fix conflicts and run \"git cherry-pick --continue\")\n  (use \"git cherry-pick --abort\" to cancel the cherry-pick operation)\n\nUnmerged paths:\n  (use \"git add <file>...\" to mark resolution)\n\n        both modified:      b\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n```\n\n```\n$ git diff \ndiff --cc b\nindex 7898192,6178079..0000000\n--- a/b\n+++ b/b\n@@@ -1,1 -1,1 +1,5 @@@\n++<<<<<<< HEAD\n +a\n++=======\n +b\n++>>>>>>> 09e827c... add other\n```\n\n#### 2.2.2 手动解决它\n\n```\n$ vi b \n<<<<<<< HEAD\na\n=======\nb\n>>>>>>> 09e827c... add other\n```\n\n保存退出，手动提交\n\n```\n$ git add b\n$ git commit -m \"merge by handler\"\n$ git push\n```\n","slug":"git-cherry-pick","published":1,"updated":"2017-01-14T05:27:32.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4q000lzahibujf21jc","content":"<h2 id=\"1-用法\"><a href=\"#1-用法\" class=\"headerlink\" title=\"1. 用法\"></a>1. 用法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git cherry-pick &lt;commit id&gt;</span><br></pre></td></tr></table></figure>\n<p>cherry-pick的作用是在当前分支上应用某一个提交，在合并的时候特别有用。<br>当前在 fixbug 分支上，做了3次修改并提交到本地</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch</span><br><span class=\"line\">* fixbug</span><br><span class=\"line\">  master</span><br><span class=\"line\"></span><br><span class=\"line\">$ git log --oneline </span><br><span class=\"line\">43f50dd fix bug3</span><br><span class=\"line\">b24931f fix bug2</span><br><span class=\"line\">9ab09b7 fix bug1</span><br></pre></td></tr></table></figure>\n<p>这时候我发现 fix bug1 这个提交是不需要的，之需要将后2次合并进主分支即可。 可以这么操作:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout master  #切换到master分支</span><br><span class=\"line\">Switched to branch &apos;master&apos;</span><br><span class=\"line\">Your branch is up-to-date with &apos;origin/master&apos;.</span><br><span class=\"line\"></span><br><span class=\"line\">$ git cherry-pick 9ab09b7..43f50dd</span><br><span class=\"line\">[master 9cc5bca] fix bug2</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 b</span><br><span class=\"line\">[master 5a0704b] fix bug3</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 c</span><br><span class=\"line\"></span><br><span class=\"line\">$ git log --oneline </span><br><span class=\"line\">5a0704b fix bug3</span><br><span class=\"line\">9cc5bca fix bug2</span><br><span class=\"line\">c9e81c7 rename</span><br></pre></td></tr></table></figure>\n<p>可以看到，执行<code>check-pick</code>后， git 将指定的 commit <font color=\"red\">(不含第一个，包含 最后一个)</font> 应用到了当前的 master 分支。执行完之后，可以删除掉 fixbug 分支。这样就可以很方便的从一个分支里面选取一部分提交合并到主分支里面去 了。当然同样也会遇到需要merge的情况。和merege一样操作即可。</p>\n<h2 id=\"2-实例\"><a href=\"#2-实例\" class=\"headerlink\" title=\"2. 实例\"></a>2. 实例</h2><p>在本地 fixbug 分支上做了一个commit (09e827c96960780ebdee18040a4324de7fecba9b)， 如何把它放到 master 分支上？ </p>\n<p>办法之一： 使用 cherry-pick.  根据git 文档：</p>\n<blockquote>\n<p>Apply the changes introduced by some existing commits</p>\n</blockquote>\n<p>就是对已经存在的commit 进行apply (可以理解为再次提交）<br>例如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout master</span><br><span class=\"line\">$ git cherry-pick 09e827c     # 这个09e827c号码，位于：</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log</span><br><span class=\"line\">commit 09e827c96960780ebdee18040a4324de7fecba9b</span><br><span class=\"line\">Author: niuzhiqiang &lt;niuzhiqiang90@foxmail.com&gt;</span><br><span class=\"line\">Date:   Fri Aug 12 10:52:32 2016 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    add other</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-1-如果顺利，就会正常提交。结果：\"><a href=\"#2-1-如果顺利，就会正常提交。结果：\" class=\"headerlink\" title=\"2.1 如果顺利，就会正常提交。结果：\"></a>2.1 如果顺利，就会正常提交。结果：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git cherry-pick 9ab09b7..43f50dd</span><br><span class=\"line\">[master 9cc5bca] fix bug2</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 b</span><br><span class=\"line\">[master 5a0704b] fix 3</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 c</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-如果在cherry-pick的过程中出现了冲突\"><a href=\"#2-2-如果在cherry-pick的过程中出现了冲突\" class=\"headerlink\" title=\"2.2 如果在cherry-pick的过程中出现了冲突\"></a>2.2 如果在cherry-pick的过程中出现了冲突</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git cherry-pick 09e827c</span><br><span class=\"line\">error: could not apply 09e827c... add other</span><br><span class=\"line\">hint: after resolving the conflicts, mark the corrected paths</span><br><span class=\"line\">hint: with &apos;git add &lt;paths&gt;&apos; or &apos;git rm &lt;paths&gt;&apos;</span><br><span class=\"line\">hint: and commit the result with &apos;git commit&apos;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-2-1-看哪些文件出现冲突\"><a href=\"#2-2-1-看哪些文件出现冲突\" class=\"headerlink\" title=\"2.2.1 看哪些文件出现冲突\"></a>2.2.1 看哪些文件出现冲突</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Your branch is ahead of &apos;origin/master&apos; by 3 commits.</span><br><span class=\"line\">  (use &quot;git push&quot; to publish your local commits)</span><br><span class=\"line\"></span><br><span class=\"line\">You are currently cherry-picking commit 09e827c.</span><br><span class=\"line\">  (fix conflicts and run &quot;git cherry-pick --continue&quot;)</span><br><span class=\"line\">  (use &quot;git cherry-pick --abort&quot; to cancel the cherry-pick operation)</span><br><span class=\"line\"></span><br><span class=\"line\">Unmerged paths:</span><br><span class=\"line\">  (use &quot;git add &lt;file&gt;...&quot; to mark resolution)</span><br><span class=\"line\"></span><br><span class=\"line\">        both modified:      b</span><br><span class=\"line\"></span><br><span class=\"line\">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git diff </span><br><span class=\"line\">diff --cc b</span><br><span class=\"line\">index 7898192,6178079..0000000</span><br><span class=\"line\">--- a/b</span><br><span class=\"line\">+++ b/b</span><br><span class=\"line\">@@@ -1,1 -1,1 +1,5 @@@</span><br><span class=\"line\">++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class=\"line\"> +a</span><br><span class=\"line\">++=======</span><br><span class=\"line\"> +b</span><br><span class=\"line\">++&gt;&gt;&gt;&gt;&gt;&gt;&gt; 09e827c... add other</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-2-2-手动解决它\"><a href=\"#2-2-2-手动解决它\" class=\"headerlink\" title=\"2.2.2 手动解决它\"></a>2.2.2 手动解决它</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi b </span><br><span class=\"line\">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class=\"line\">a</span><br><span class=\"line\">=======</span><br><span class=\"line\">b</span><br><span class=\"line\">&gt;&gt;&gt;&gt;&gt;&gt;&gt; 09e827c... add other</span><br></pre></td></tr></table></figure>\n<p>保存退出，手动提交</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add b</span><br><span class=\"line\">$ git commit -m &quot;merge by handler&quot;</span><br><span class=\"line\">$ git push</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-用法\"><a href=\"#1-用法\" class=\"headerlink\" title=\"1. 用法\"></a>1. 用法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git cherry-pick &lt;commit id&gt;</span><br></pre></td></tr></table></figure>\n<p>cherry-pick的作用是在当前分支上应用某一个提交，在合并的时候特别有用。<br>当前在 fixbug 分支上，做了3次修改并提交到本地</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch</span><br><span class=\"line\">* fixbug</span><br><span class=\"line\">  master</span><br><span class=\"line\"></span><br><span class=\"line\">$ git log --oneline </span><br><span class=\"line\">43f50dd fix bug3</span><br><span class=\"line\">b24931f fix bug2</span><br><span class=\"line\">9ab09b7 fix bug1</span><br></pre></td></tr></table></figure>\n<p>这时候我发现 fix bug1 这个提交是不需要的，之需要将后2次合并进主分支即可。 可以这么操作:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout master  #切换到master分支</span><br><span class=\"line\">Switched to branch &apos;master&apos;</span><br><span class=\"line\">Your branch is up-to-date with &apos;origin/master&apos;.</span><br><span class=\"line\"></span><br><span class=\"line\">$ git cherry-pick 9ab09b7..43f50dd</span><br><span class=\"line\">[master 9cc5bca] fix bug2</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 b</span><br><span class=\"line\">[master 5a0704b] fix bug3</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 c</span><br><span class=\"line\"></span><br><span class=\"line\">$ git log --oneline </span><br><span class=\"line\">5a0704b fix bug3</span><br><span class=\"line\">9cc5bca fix bug2</span><br><span class=\"line\">c9e81c7 rename</span><br></pre></td></tr></table></figure>\n<p>可以看到，执行<code>check-pick</code>后， git 将指定的 commit <font color=\"red\">(不含第一个，包含 最后一个)</font> 应用到了当前的 master 分支。执行完之后，可以删除掉 fixbug 分支。这样就可以很方便的从一个分支里面选取一部分提交合并到主分支里面去 了。当然同样也会遇到需要merge的情况。和merege一样操作即可。</p>\n<h2 id=\"2-实例\"><a href=\"#2-实例\" class=\"headerlink\" title=\"2. 实例\"></a>2. 实例</h2><p>在本地 fixbug 分支上做了一个commit (09e827c96960780ebdee18040a4324de7fecba9b)， 如何把它放到 master 分支上？ </p>\n<p>办法之一： 使用 cherry-pick.  根据git 文档：</p>\n<blockquote>\n<p>Apply the changes introduced by some existing commits</p>\n</blockquote>\n<p>就是对已经存在的commit 进行apply (可以理解为再次提交）<br>例如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout master</span><br><span class=\"line\">$ git cherry-pick 09e827c     # 这个09e827c号码，位于：</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log</span><br><span class=\"line\">commit 09e827c96960780ebdee18040a4324de7fecba9b</span><br><span class=\"line\">Author: niuzhiqiang &lt;niuzhiqiang90@foxmail.com&gt;</span><br><span class=\"line\">Date:   Fri Aug 12 10:52:32 2016 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    add other</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-1-如果顺利，就会正常提交。结果：\"><a href=\"#2-1-如果顺利，就会正常提交。结果：\" class=\"headerlink\" title=\"2.1 如果顺利，就会正常提交。结果：\"></a>2.1 如果顺利，就会正常提交。结果：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git cherry-pick 9ab09b7..43f50dd</span><br><span class=\"line\">[master 9cc5bca] fix bug2</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 b</span><br><span class=\"line\">[master 5a0704b] fix 3</span><br><span class=\"line\"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class=\"line\"> create mode 100644 c</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-如果在cherry-pick的过程中出现了冲突\"><a href=\"#2-2-如果在cherry-pick的过程中出现了冲突\" class=\"headerlink\" title=\"2.2 如果在cherry-pick的过程中出现了冲突\"></a>2.2 如果在cherry-pick的过程中出现了冲突</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git cherry-pick 09e827c</span><br><span class=\"line\">error: could not apply 09e827c... add other</span><br><span class=\"line\">hint: after resolving the conflicts, mark the corrected paths</span><br><span class=\"line\">hint: with &apos;git add &lt;paths&gt;&apos; or &apos;git rm &lt;paths&gt;&apos;</span><br><span class=\"line\">hint: and commit the result with &apos;git commit&apos;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-2-1-看哪些文件出现冲突\"><a href=\"#2-2-1-看哪些文件出现冲突\" class=\"headerlink\" title=\"2.2.1 看哪些文件出现冲突\"></a>2.2.1 看哪些文件出现冲突</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Your branch is ahead of &apos;origin/master&apos; by 3 commits.</span><br><span class=\"line\">  (use &quot;git push&quot; to publish your local commits)</span><br><span class=\"line\"></span><br><span class=\"line\">You are currently cherry-picking commit 09e827c.</span><br><span class=\"line\">  (fix conflicts and run &quot;git cherry-pick --continue&quot;)</span><br><span class=\"line\">  (use &quot;git cherry-pick --abort&quot; to cancel the cherry-pick operation)</span><br><span class=\"line\"></span><br><span class=\"line\">Unmerged paths:</span><br><span class=\"line\">  (use &quot;git add &lt;file&gt;...&quot; to mark resolution)</span><br><span class=\"line\"></span><br><span class=\"line\">        both modified:      b</span><br><span class=\"line\"></span><br><span class=\"line\">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git diff </span><br><span class=\"line\">diff --cc b</span><br><span class=\"line\">index 7898192,6178079..0000000</span><br><span class=\"line\">--- a/b</span><br><span class=\"line\">+++ b/b</span><br><span class=\"line\">@@@ -1,1 -1,1 +1,5 @@@</span><br><span class=\"line\">++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class=\"line\"> +a</span><br><span class=\"line\">++=======</span><br><span class=\"line\"> +b</span><br><span class=\"line\">++&gt;&gt;&gt;&gt;&gt;&gt;&gt; 09e827c... add other</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-2-2-手动解决它\"><a href=\"#2-2-2-手动解决它\" class=\"headerlink\" title=\"2.2.2 手动解决它\"></a>2.2.2 手动解决它</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi b </span><br><span class=\"line\">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class=\"line\">a</span><br><span class=\"line\">=======</span><br><span class=\"line\">b</span><br><span class=\"line\">&gt;&gt;&gt;&gt;&gt;&gt;&gt; 09e827c... add other</span><br></pre></td></tr></table></figure>\n<p>保存退出，手动提交</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add b</span><br><span class=\"line\">$ git commit -m &quot;merge by handler&quot;</span><br><span class=\"line\">$ git push</span><br></pre></td></tr></table></figure>\n"},{"title":"git 基本操作","date":"2017-01-11T03:54:12.000Z","_content":"\n## 1 安装\n- ubuntu\n```\n$ sudo apt-get install git gitk\n```\n- windows\n[下载链接](https://www.git-scm.com/download/win)\n- 其他系统\n[点击这里](https://www.git-scm.com/downloads)\n\n\n## 2 设置\n- 全局设置（你的每次提交都会使用这些设置）  \n```\n$ git config --global user.name \"姓名\"\n$ git config --global user.email \"邮箱地址\"\n```\n- 局部设置（只在当前项目中生效）\n```\n$ git config --local user.name \"姓名\"\n$ git config --local user.email \"邮箱地址\"\n```\n\n## 3 更新本地代码\n```\n$ cd the/project/directory\n$ git pull\n```\n\n## 4 提交代码\n修改完成之后 提交修改的步骤如下\n### 4.1 查看修改的文件\n```\n$ git status\n```\n### 4.2 查看修改的内容\n```\n$ git diff\n```\n### 4.3 从服务器上更新代码\n```\n$ git pull\n```\n### 4.4 将修改添加到本地仓库\n```\n$ git add 修改的文件名\n```\n```\n$ git add . (当前目录下的所有修改)\n```\n例如 \n```\ngit add a.txt c/b.txt\n```\n### 4.5 添加本次修改的描述\n```\n$ git commit -m \"大致说明本次修改了什么\"\n```\n### 4.6 将本地修改提交到服务器\n```\n$ git push\n```\n## 5 分支操作\n### 5.1 查看所有分支\n```\n$ git branch -a\n```\n### 5.2 切换分支\n- 第一次切换\n```\n$ git checkout -b *** origin/***\n```\n- 以后切换\n```\n$ git checkout ***\n```\n### 5.3 删除本地分支\n```\n$ git checkout the/other/branch\n$ git branch -D the/delete/branch\n```\n\n** 补充 **  \n[点击查看更详细的用法](https://mp.weixin.qq.com/s?__biz=MjM5NjQ4MjYwMQ==&mid=207476935&idx=1&sn=7e2df0fc83583b2970be033e295d595d&scene=4&srcid=0914UZRLJAd9vzLoflDXei0Y&pass_ticket=HC7otQjvd7%2FlrKPIl%2FUdQOZ4wjnTDDOzJXOZps0L2JZRnBVO0WgCnxedN7YVcvQi#rd)\n","source":"_posts/git-基本操作.md","raw":"---\ntitle: git 基本操作 \ndate: 2017-01-11 11:54:12\ncategories: git\ntags: git\n---\n\n## 1 安装\n- ubuntu\n```\n$ sudo apt-get install git gitk\n```\n- windows\n[下载链接](https://www.git-scm.com/download/win)\n- 其他系统\n[点击这里](https://www.git-scm.com/downloads)\n\n\n## 2 设置\n- 全局设置（你的每次提交都会使用这些设置）  \n```\n$ git config --global user.name \"姓名\"\n$ git config --global user.email \"邮箱地址\"\n```\n- 局部设置（只在当前项目中生效）\n```\n$ git config --local user.name \"姓名\"\n$ git config --local user.email \"邮箱地址\"\n```\n\n## 3 更新本地代码\n```\n$ cd the/project/directory\n$ git pull\n```\n\n## 4 提交代码\n修改完成之后 提交修改的步骤如下\n### 4.1 查看修改的文件\n```\n$ git status\n```\n### 4.2 查看修改的内容\n```\n$ git diff\n```\n### 4.3 从服务器上更新代码\n```\n$ git pull\n```\n### 4.4 将修改添加到本地仓库\n```\n$ git add 修改的文件名\n```\n```\n$ git add . (当前目录下的所有修改)\n```\n例如 \n```\ngit add a.txt c/b.txt\n```\n### 4.5 添加本次修改的描述\n```\n$ git commit -m \"大致说明本次修改了什么\"\n```\n### 4.6 将本地修改提交到服务器\n```\n$ git push\n```\n## 5 分支操作\n### 5.1 查看所有分支\n```\n$ git branch -a\n```\n### 5.2 切换分支\n- 第一次切换\n```\n$ git checkout -b *** origin/***\n```\n- 以后切换\n```\n$ git checkout ***\n```\n### 5.3 删除本地分支\n```\n$ git checkout the/other/branch\n$ git branch -D the/delete/branch\n```\n\n** 补充 **  \n[点击查看更详细的用法](https://mp.weixin.qq.com/s?__biz=MjM5NjQ4MjYwMQ==&mid=207476935&idx=1&sn=7e2df0fc83583b2970be033e295d595d&scene=4&srcid=0914UZRLJAd9vzLoflDXei0Y&pass_ticket=HC7otQjvd7%2FlrKPIl%2FUdQOZ4wjnTDDOzJXOZps0L2JZRnBVO0WgCnxedN7YVcvQi#rd)\n","slug":"git-基本操作","published":1,"updated":"2017-01-12T08:51:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4r000ozahikvv5pjb3","content":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1 安装\"></a>1 安装</h2><ul>\n<li><p>ubuntu</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install git gitk</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>windows<br><a href=\"https://www.git-scm.com/download/win\" target=\"_blank\" rel=\"noopener\">下载链接</a></p>\n</li>\n<li>其他系统<br><a href=\"https://www.git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">点击这里</a></li>\n</ul>\n<h2 id=\"2-设置\"><a href=\"#2-设置\" class=\"headerlink\" title=\"2 设置\"></a>2 设置</h2><ul>\n<li><p>全局设置（你的每次提交都会使用这些设置）  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global user.name &quot;姓名&quot;</span><br><span class=\"line\">$ git config --global user.email &quot;邮箱地址&quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>局部设置（只在当前项目中生效）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --local user.name &quot;姓名&quot;</span><br><span class=\"line\">$ git config --local user.email &quot;邮箱地址&quot;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"3-更新本地代码\"><a href=\"#3-更新本地代码\" class=\"headerlink\" title=\"3 更新本地代码\"></a>3 更新本地代码</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cd the/project/directory</span><br><span class=\"line\">$ git pull</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-提交代码\"><a href=\"#4-提交代码\" class=\"headerlink\" title=\"4 提交代码\"></a>4 提交代码</h2><p>修改完成之后 提交修改的步骤如下</p>\n<h3 id=\"4-1-查看修改的文件\"><a href=\"#4-1-查看修改的文件\" class=\"headerlink\" title=\"4.1 查看修改的文件\"></a>4.1 查看修改的文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-2-查看修改的内容\"><a href=\"#4-2-查看修改的内容\" class=\"headerlink\" title=\"4.2 查看修改的内容\"></a>4.2 查看修改的内容</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git diff</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-从服务器上更新代码\"><a href=\"#4-3-从服务器上更新代码\" class=\"headerlink\" title=\"4.3 从服务器上更新代码\"></a>4.3 从服务器上更新代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git pull</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-4-将修改添加到本地仓库\"><a href=\"#4-4-将修改添加到本地仓库\" class=\"headerlink\" title=\"4.4 将修改添加到本地仓库\"></a>4.4 将修改添加到本地仓库</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add 修改的文件名</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add . (当前目录下的所有修改)</span><br></pre></td></tr></table></figure>\n<p>例如<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add a.txt c/b.txt</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"4-5-添加本次修改的描述\"><a href=\"#4-5-添加本次修改的描述\" class=\"headerlink\" title=\"4.5 添加本次修改的描述\"></a>4.5 添加本次修改的描述</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git commit -m &quot;大致说明本次修改了什么&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-6-将本地修改提交到服务器\"><a href=\"#4-6-将本地修改提交到服务器\" class=\"headerlink\" title=\"4.6 将本地修改提交到服务器\"></a>4.6 将本地修改提交到服务器</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git push</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-分支操作\"><a href=\"#5-分支操作\" class=\"headerlink\" title=\"5 分支操作\"></a>5 分支操作</h2><h3 id=\"5-1-查看所有分支\"><a href=\"#5-1-查看所有分支\" class=\"headerlink\" title=\"5.1 查看所有分支\"></a>5.1 查看所有分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch -a</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-2-切换分支\"><a href=\"#5-2-切换分支\" class=\"headerlink\" title=\"5.2 切换分支\"></a>5.2 切换分支</h3><ul>\n<li><p>第一次切换</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout -b *** origin/***</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>以后切换</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout ***</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"5-3-删除本地分支\"><a href=\"#5-3-删除本地分支\" class=\"headerlink\" title=\"5.3 删除本地分支\"></a>5.3 删除本地分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout the/other/branch</span><br><span class=\"line\">$ git branch -D the/delete/branch</span><br></pre></td></tr></table></figure>\n<p><strong> 补充 </strong><br><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5NjQ4MjYwMQ==&amp;mid=207476935&amp;idx=1&amp;sn=7e2df0fc83583b2970be033e295d595d&amp;scene=4&amp;srcid=0914UZRLJAd9vzLoflDXei0Y&amp;pass_ticket=HC7otQjvd7%2FlrKPIl%2FUdQOZ4wjnTDDOzJXOZps0L2JZRnBVO0WgCnxedN7YVcvQi#rd\" target=\"_blank\" rel=\"noopener\">点击查看更详细的用法</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1 安装\"></a>1 安装</h2><ul>\n<li><p>ubuntu</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install git gitk</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>windows<br><a href=\"https://www.git-scm.com/download/win\" target=\"_blank\" rel=\"noopener\">下载链接</a></p>\n</li>\n<li>其他系统<br><a href=\"https://www.git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">点击这里</a></li>\n</ul>\n<h2 id=\"2-设置\"><a href=\"#2-设置\" class=\"headerlink\" title=\"2 设置\"></a>2 设置</h2><ul>\n<li><p>全局设置（你的每次提交都会使用这些设置）  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global user.name &quot;姓名&quot;</span><br><span class=\"line\">$ git config --global user.email &quot;邮箱地址&quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>局部设置（只在当前项目中生效）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --local user.name &quot;姓名&quot;</span><br><span class=\"line\">$ git config --local user.email &quot;邮箱地址&quot;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"3-更新本地代码\"><a href=\"#3-更新本地代码\" class=\"headerlink\" title=\"3 更新本地代码\"></a>3 更新本地代码</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cd the/project/directory</span><br><span class=\"line\">$ git pull</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-提交代码\"><a href=\"#4-提交代码\" class=\"headerlink\" title=\"4 提交代码\"></a>4 提交代码</h2><p>修改完成之后 提交修改的步骤如下</p>\n<h3 id=\"4-1-查看修改的文件\"><a href=\"#4-1-查看修改的文件\" class=\"headerlink\" title=\"4.1 查看修改的文件\"></a>4.1 查看修改的文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-2-查看修改的内容\"><a href=\"#4-2-查看修改的内容\" class=\"headerlink\" title=\"4.2 查看修改的内容\"></a>4.2 查看修改的内容</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git diff</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-从服务器上更新代码\"><a href=\"#4-3-从服务器上更新代码\" class=\"headerlink\" title=\"4.3 从服务器上更新代码\"></a>4.3 从服务器上更新代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git pull</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-4-将修改添加到本地仓库\"><a href=\"#4-4-将修改添加到本地仓库\" class=\"headerlink\" title=\"4.4 将修改添加到本地仓库\"></a>4.4 将修改添加到本地仓库</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add 修改的文件名</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add . (当前目录下的所有修改)</span><br></pre></td></tr></table></figure>\n<p>例如<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add a.txt c/b.txt</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"4-5-添加本次修改的描述\"><a href=\"#4-5-添加本次修改的描述\" class=\"headerlink\" title=\"4.5 添加本次修改的描述\"></a>4.5 添加本次修改的描述</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git commit -m &quot;大致说明本次修改了什么&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-6-将本地修改提交到服务器\"><a href=\"#4-6-将本地修改提交到服务器\" class=\"headerlink\" title=\"4.6 将本地修改提交到服务器\"></a>4.6 将本地修改提交到服务器</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git push</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-分支操作\"><a href=\"#5-分支操作\" class=\"headerlink\" title=\"5 分支操作\"></a>5 分支操作</h2><h3 id=\"5-1-查看所有分支\"><a href=\"#5-1-查看所有分支\" class=\"headerlink\" title=\"5.1 查看所有分支\"></a>5.1 查看所有分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch -a</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-2-切换分支\"><a href=\"#5-2-切换分支\" class=\"headerlink\" title=\"5.2 切换分支\"></a>5.2 切换分支</h3><ul>\n<li><p>第一次切换</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout -b *** origin/***</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>以后切换</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout ***</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"5-3-删除本地分支\"><a href=\"#5-3-删除本地分支\" class=\"headerlink\" title=\"5.3 删除本地分支\"></a>5.3 删除本地分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout the/other/branch</span><br><span class=\"line\">$ git branch -D the/delete/branch</span><br></pre></td></tr></table></figure>\n<p><strong> 补充 </strong><br><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5NjQ4MjYwMQ==&amp;mid=207476935&amp;idx=1&amp;sn=7e2df0fc83583b2970be033e295d595d&amp;scene=4&amp;srcid=0914UZRLJAd9vzLoflDXei0Y&amp;pass_ticket=HC7otQjvd7%2FlrKPIl%2FUdQOZ4wjnTDDOzJXOZps0L2JZRnBVO0WgCnxedN7YVcvQi#rd\" target=\"_blank\" rel=\"noopener\">点击查看更详细的用法</a></p>\n"},{"title":"git分支操作","date":"2017-01-12T08:42:22.000Z","_content":"\n## 1 新建分支\n\n### 1.1 新建本地分支\n\n```\ngit checkout -b <branchName>\n```\n\n### 1.2 推送本地分支到远程\n\n```\ngit push origin <localBranch>:<remoteBranch>\n```\n\n\n\n## 2 删除分支\n### 2.1 删除本地分支\n\n```\ngit branch -D <branchName>\n```\n\n### 2.2 删除远程分支\n```\ngit push origin --delete <branchName>\n```\n","source":"_posts/git-分支操作.md","raw":"---\ntitle: git分支操作\ndate: 2017-01-12 16:42:22\ncategories: git\ntags: git\n---\n\n## 1 新建分支\n\n### 1.1 新建本地分支\n\n```\ngit checkout -b <branchName>\n```\n\n### 1.2 推送本地分支到远程\n\n```\ngit push origin <localBranch>:<remoteBranch>\n```\n\n\n\n## 2 删除分支\n### 2.1 删除本地分支\n\n```\ngit branch -D <branchName>\n```\n\n### 2.2 删除远程分支\n```\ngit push origin --delete <branchName>\n```\n","slug":"git-分支操作","published":1,"updated":"2017-01-12T08:51:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4s000rzahithhuhlel","content":"<h2 id=\"1-新建分支\"><a href=\"#1-新建分支\" class=\"headerlink\" title=\"1 新建分支\"></a>1 新建分支</h2><h3 id=\"1-1-新建本地分支\"><a href=\"#1-1-新建本地分支\" class=\"headerlink\" title=\"1.1 新建本地分支\"></a>1.1 新建本地分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b &lt;branchName&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-推送本地分支到远程\"><a href=\"#1-2-推送本地分支到远程\" class=\"headerlink\" title=\"1.2 推送本地分支到远程\"></a>1.2 推送本地分支到远程</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin &lt;localBranch&gt;:&lt;remoteBranch&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-删除分支\"><a href=\"#2-删除分支\" class=\"headerlink\" title=\"2 删除分支\"></a>2 删除分支</h2><h3 id=\"2-1-删除本地分支\"><a href=\"#2-1-删除本地分支\" class=\"headerlink\" title=\"2.1 删除本地分支\"></a>2.1 删除本地分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -D &lt;branchName&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-删除远程分支\"><a href=\"#2-2-删除远程分支\" class=\"headerlink\" title=\"2.2 删除远程分支\"></a>2.2 删除远程分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin --delete &lt;branchName&gt;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-新建分支\"><a href=\"#1-新建分支\" class=\"headerlink\" title=\"1 新建分支\"></a>1 新建分支</h2><h3 id=\"1-1-新建本地分支\"><a href=\"#1-1-新建本地分支\" class=\"headerlink\" title=\"1.1 新建本地分支\"></a>1.1 新建本地分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b &lt;branchName&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-推送本地分支到远程\"><a href=\"#1-2-推送本地分支到远程\" class=\"headerlink\" title=\"1.2 推送本地分支到远程\"></a>1.2 推送本地分支到远程</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin &lt;localBranch&gt;:&lt;remoteBranch&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-删除分支\"><a href=\"#2-删除分支\" class=\"headerlink\" title=\"2 删除分支\"></a>2 删除分支</h2><h3 id=\"2-1-删除本地分支\"><a href=\"#2-1-删除本地分支\" class=\"headerlink\" title=\"2.1 删除本地分支\"></a>2.1 删除本地分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -D &lt;branchName&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-删除远程分支\"><a href=\"#2-2-删除远程分支\" class=\"headerlink\" title=\"2.2 删除远程分支\"></a>2.2 删除远程分支</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin --delete &lt;branchName&gt;</span><br></pre></td></tr></table></figure>\n"},{"title":"git tag操作","date":"2017-03-22T05:17:19.000Z","_content":"\n# 1. 显示本地tag\n不带任何参数执行git tag，即可显示当前版本库里的tag列表\n```\ngit tag\n```\n显示说明 `-n<num>` 显示最多num行的说明\n```\ngit tag -n1\n```\n只显示名称和通配符相符的tag\n```\ngit tag -l string*\n```\n# 2. 创建tag\n## 2.1 创建轻量级里程碑\n```\ngit tag <tagname> [<commitID>]\n```\n## 2.2 创建带说明的tag\n```\ngit tag -a <tagname> [<commitID>]\n或\ngit tag -m <msg> <tagname> [<commitID>] //直接通过-m参数提供tag说明\n```\n\n## 2.3 创建带GnuPG签名的tag\n```\ngit tag -s <tagname> [<commitID>]\n或\ngit tag -u <key-id>  <tagname> [<commitID>] //-u参数选择指定的私钥进行签名\n```\n创建tag需要输入tag的名称(<tagname>)和一个可选的提交ID(<commitID>)。<font color=red>如果没有提供提交ID，则基于头指针HEAD创建tag。</font>\n\n# 3. 删除tag\n本地\n```\ngit tag -d <tagname> \n```\n远程\n```\ngit push origin --delete tag <tagname>\n或\ngit tag -d <tagname> \ngit push origin :refs/tags/<tagname>  #推送一个空tag到远程\n```\n# 4. 提交tag\n提交单个tag\n```\ngit push origin <tagname>\n或\ngit push tag <tagname>\n```\n提交所有tag\n```\ngit push --tags\n或\ngit push origin --tags\n```\n\n","source":"_posts/git-tag操作.md","raw":"---\ntitle: git tag操作\ndate: 2017-03-22 13:17:19\ntags: git\n---\n\n# 1. 显示本地tag\n不带任何参数执行git tag，即可显示当前版本库里的tag列表\n```\ngit tag\n```\n显示说明 `-n<num>` 显示最多num行的说明\n```\ngit tag -n1\n```\n只显示名称和通配符相符的tag\n```\ngit tag -l string*\n```\n# 2. 创建tag\n## 2.1 创建轻量级里程碑\n```\ngit tag <tagname> [<commitID>]\n```\n## 2.2 创建带说明的tag\n```\ngit tag -a <tagname> [<commitID>]\n或\ngit tag -m <msg> <tagname> [<commitID>] //直接通过-m参数提供tag说明\n```\n\n## 2.3 创建带GnuPG签名的tag\n```\ngit tag -s <tagname> [<commitID>]\n或\ngit tag -u <key-id>  <tagname> [<commitID>] //-u参数选择指定的私钥进行签名\n```\n创建tag需要输入tag的名称(<tagname>)和一个可选的提交ID(<commitID>)。<font color=red>如果没有提供提交ID，则基于头指针HEAD创建tag。</font>\n\n# 3. 删除tag\n本地\n```\ngit tag -d <tagname> \n```\n远程\n```\ngit push origin --delete tag <tagname>\n或\ngit tag -d <tagname> \ngit push origin :refs/tags/<tagname>  #推送一个空tag到远程\n```\n# 4. 提交tag\n提交单个tag\n```\ngit push origin <tagname>\n或\ngit push tag <tagname>\n```\n提交所有tag\n```\ngit push --tags\n或\ngit push origin --tags\n```\n\n","slug":"git-tag操作","published":1,"updated":"2018-03-22T22:58:30.001Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4t000tzahip5fa1qoc","content":"<h1 id=\"1-显示本地tag\"><a href=\"#1-显示本地tag\" class=\"headerlink\" title=\"1. 显示本地tag\"></a>1. 显示本地tag</h1><p>不带任何参数执行git tag，即可显示当前版本库里的tag列表<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag</span><br></pre></td></tr></table></figure></p>\n<p>显示说明 <code>-n&lt;num&gt;</code> 显示最多num行的说明<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -n1</span><br></pre></td></tr></table></figure></p>\n<p>只显示名称和通配符相符的tag<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -l string*</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"2-创建tag\"><a href=\"#2-创建tag\" class=\"headerlink\" title=\"2. 创建tag\"></a>2. 创建tag</h1><h2 id=\"2-1-创建轻量级里程碑\"><a href=\"#2-1-创建轻量级里程碑\" class=\"headerlink\" title=\"2.1 创建轻量级里程碑\"></a>2.1 创建轻量级里程碑</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag &lt;tagname&gt; [&lt;commitID&gt;]</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-2-创建带说明的tag\"><a href=\"#2-2-创建带说明的tag\" class=\"headerlink\" title=\"2.2 创建带说明的tag\"></a>2.2 创建带说明的tag</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -a &lt;tagname&gt; [&lt;commitID&gt;]</span><br><span class=\"line\">或</span><br><span class=\"line\">git tag -m &lt;msg&gt; &lt;tagname&gt; [&lt;commitID&gt;] //直接通过-m参数提供tag说明</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-创建带GnuPG签名的tag\"><a href=\"#2-3-创建带GnuPG签名的tag\" class=\"headerlink\" title=\"2.3 创建带GnuPG签名的tag\"></a>2.3 创建带GnuPG签名的tag</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -s &lt;tagname&gt; [&lt;commitID&gt;]</span><br><span class=\"line\">或</span><br><span class=\"line\">git tag -u &lt;key-id&gt;  &lt;tagname&gt; [&lt;commitID&gt;] //-u参数选择指定的私钥进行签名</span><br></pre></td></tr></table></figure>\n<p>创建tag需要输入tag的名称(<tagname>)和一个可选的提交ID(<commitid>)。<font color=\"red\">如果没有提供提交ID，则基于头指针HEAD创建tag。</font></commitid></tagname></p>\n<h1 id=\"3-删除tag\"><a href=\"#3-删除tag\" class=\"headerlink\" title=\"3. 删除tag\"></a>3. 删除tag</h1><p>本地<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -d &lt;tagname&gt;</span><br></pre></td></tr></table></figure></p>\n<p>远程<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin --delete tag &lt;tagname&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">git tag -d &lt;tagname&gt; </span><br><span class=\"line\">git push origin :refs/tags/&lt;tagname&gt;  #推送一个空tag到远程</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"4-提交tag\"><a href=\"#4-提交tag\" class=\"headerlink\" title=\"4. 提交tag\"></a>4. 提交tag</h1><p>提交单个tag<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin &lt;tagname&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">git push tag &lt;tagname&gt;</span><br></pre></td></tr></table></figure></p>\n<p>提交所有tag<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push --tags</span><br><span class=\"line\">或</span><br><span class=\"line\">git push origin --tags</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"1-显示本地tag\"><a href=\"#1-显示本地tag\" class=\"headerlink\" title=\"1. 显示本地tag\"></a>1. 显示本地tag</h1><p>不带任何参数执行git tag，即可显示当前版本库里的tag列表<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag</span><br></pre></td></tr></table></figure></p>\n<p>显示说明 <code>-n&lt;num&gt;</code> 显示最多num行的说明<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -n1</span><br></pre></td></tr></table></figure></p>\n<p>只显示名称和通配符相符的tag<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -l string*</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"2-创建tag\"><a href=\"#2-创建tag\" class=\"headerlink\" title=\"2. 创建tag\"></a>2. 创建tag</h1><h2 id=\"2-1-创建轻量级里程碑\"><a href=\"#2-1-创建轻量级里程碑\" class=\"headerlink\" title=\"2.1 创建轻量级里程碑\"></a>2.1 创建轻量级里程碑</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag &lt;tagname&gt; [&lt;commitID&gt;]</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-2-创建带说明的tag\"><a href=\"#2-2-创建带说明的tag\" class=\"headerlink\" title=\"2.2 创建带说明的tag\"></a>2.2 创建带说明的tag</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -a &lt;tagname&gt; [&lt;commitID&gt;]</span><br><span class=\"line\">或</span><br><span class=\"line\">git tag -m &lt;msg&gt; &lt;tagname&gt; [&lt;commitID&gt;] //直接通过-m参数提供tag说明</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-创建带GnuPG签名的tag\"><a href=\"#2-3-创建带GnuPG签名的tag\" class=\"headerlink\" title=\"2.3 创建带GnuPG签名的tag\"></a>2.3 创建带GnuPG签名的tag</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -s &lt;tagname&gt; [&lt;commitID&gt;]</span><br><span class=\"line\">或</span><br><span class=\"line\">git tag -u &lt;key-id&gt;  &lt;tagname&gt; [&lt;commitID&gt;] //-u参数选择指定的私钥进行签名</span><br></pre></td></tr></table></figure>\n<p>创建tag需要输入tag的名称(<tagname>)和一个可选的提交ID(<commitid>)。<font color=\"red\">如果没有提供提交ID，则基于头指针HEAD创建tag。</font></commitid></tagname></p>\n<h1 id=\"3-删除tag\"><a href=\"#3-删除tag\" class=\"headerlink\" title=\"3. 删除tag\"></a>3. 删除tag</h1><p>本地<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag -d &lt;tagname&gt;</span><br></pre></td></tr></table></figure></p>\n<p>远程<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin --delete tag &lt;tagname&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">git tag -d &lt;tagname&gt; </span><br><span class=\"line\">git push origin :refs/tags/&lt;tagname&gt;  #推送一个空tag到远程</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"4-提交tag\"><a href=\"#4-提交tag\" class=\"headerlink\" title=\"4. 提交tag\"></a>4. 提交tag</h1><p>提交单个tag<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin &lt;tagname&gt;</span><br><span class=\"line\">或</span><br><span class=\"line\">git push tag &lt;tagname&gt;</span><br></pre></td></tr></table></figure></p>\n<p>提交所有tag<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push --tags</span><br><span class=\"line\">或</span><br><span class=\"line\">git push origin --tags</span><br></pre></td></tr></table></figure></p>\n"},{"title":"Hello World","date":"2017-01-10T16:00:00.000Z","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\ndate: 2017-01-11 \n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","slug":"hello-world","published":1,"updated":"2017-03-13T13:42:40.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4u000vzahijx2boem6","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n"},{"title":"linux添加swap","date":"2017-02-14T06:39:33.000Z","_content":"\n## 1. swap说明\n物理内存就是计算机的实际内存大小，由RAM芯片组成的。\n虚拟内存则是虚拟出来的，使用磁盘代替内存。\n虚拟内存的出现，让机器内存不够的情况得到部分解决。当程序运行起来由操作系统做具体虚拟内存到物理内存的替换和载。这里的虚拟内存就是swap\n\n当物理内存使用完或者达到一定比例之后，我们可以使用swap做临时的内存使用。当物理内存和swap都被使用完那么就会出错，out of memory。\n\n## 2. 使用dd创建swap\n\n### 2.1 查看当前内存\n```\n×××@localhost: ~$ free -h\n             total       used       free     shared    buffers     cached\nMem:          7.7G       6.0G       1.6G       875M       476M       3.2G\n-/+ buffers/cache:       2.4G       5.3G\nSwap:         0B         0B       0B\n```\n\n### 2.2 创建swap文件\n```\n×××@localhost: ~$ sudo -s\nroot@localhost:~# dd if=/dev/zero of=/mnt/swap_mount_point bs=1M count=2048\n2048+0 records in\n2048+0 records out\n2147483648 bytes (2.1 GB) copied, 16.7229 s, 128 MB/s\n\nroot@localhost:~# ls -lh /mnt/swap_mount_point \n-rw-r--r-- 1 root root 2.0G Feb 14 18:08 /mnt/swap_mount_point\n\nroot@localhost:~# file /mnt/swap_mount_point \n/mnt/swap_mount_point: data\n\n```\n\n### 2.3 格式化swap文件\n```\nroot@localhost:~# mkswap /mnt/swap_mount_point \nSetting up swapspace version 1, size = 2097148 KiB\nno label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678\nroot@localhost:~# file /mnt/swap_mount_point \n/mnt/swap_mount_point: Linux/i386 swap file (new style), version 1 (4K pages), size 524287 pages, no label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678\n```\n\n### 2.4 挂载\n```\nroot@localhost:~# swapon /mnt/swap_mount_point \nroot@localhost:~# free -h\n             total       used       free     shared    buffers     cached\nMem:          7.7G       7.5G       197M       878M       476M       4.7G\n-/+ buffers/cache:       2.3G       5.3G\nSwap:         2G       264K       2G\n```\n\n### 2.5 添加开机启动\n```\nroot@localhost:~# echo \"/mnt/swap_mount_point swap swap defaults 0 0\" >> /etc/fstab  \n```\n\n## 3. 相关命令\n- 挂载swap\n```\n×××@localhost: ~$ swapon /mnt/swap_mount_ponit\n```\n\n- 卸载swap\n```\n×××@localhost: ~$ swapoff /mnt/swap_mount_point\n```\n\n- 查看swap使用情况\n```\n×××@localhost: ~$ swapon -s \n或\n×××@localhost: ~$ cat /proc/swaps\n```\n\n## 4. swap的优化\n在ubuntu中swappiness参数值的大小对如何使用swap分区有很大的关系。\nswappiness=0 表示最大限度使用物理内存。然后才是swap分区\nswappiness=100 表示积极地使用swap分区，并把内存上的数据及时地搬运到swap空间上。\n\n**swappiness值的修改方法**\n- 方法1\n```\n×××@localhost: ~$ sudo sysctl vm.swappiness=60\n```\n- 方法2\n```\n×××@localhost: ~$ sudo vi /etc/sysctl.conf\n在文件尾添加`vm.swappiness=60`，然后刷新内核参数\n×××@localhost: ~$ sudo sysctl -p\n```\n\n\n\n\n","source":"_posts/linux添加swap.md","raw":"---\ntitle: linux添加swap\ndate: 2017-02-14 14:39:33\ntags: linux\n---\n\n## 1. swap说明\n物理内存就是计算机的实际内存大小，由RAM芯片组成的。\n虚拟内存则是虚拟出来的，使用磁盘代替内存。\n虚拟内存的出现，让机器内存不够的情况得到部分解决。当程序运行起来由操作系统做具体虚拟内存到物理内存的替换和载。这里的虚拟内存就是swap\n\n当物理内存使用完或者达到一定比例之后，我们可以使用swap做临时的内存使用。当物理内存和swap都被使用完那么就会出错，out of memory。\n\n## 2. 使用dd创建swap\n\n### 2.1 查看当前内存\n```\n×××@localhost: ~$ free -h\n             total       used       free     shared    buffers     cached\nMem:          7.7G       6.0G       1.6G       875M       476M       3.2G\n-/+ buffers/cache:       2.4G       5.3G\nSwap:         0B         0B       0B\n```\n\n### 2.2 创建swap文件\n```\n×××@localhost: ~$ sudo -s\nroot@localhost:~# dd if=/dev/zero of=/mnt/swap_mount_point bs=1M count=2048\n2048+0 records in\n2048+0 records out\n2147483648 bytes (2.1 GB) copied, 16.7229 s, 128 MB/s\n\nroot@localhost:~# ls -lh /mnt/swap_mount_point \n-rw-r--r-- 1 root root 2.0G Feb 14 18:08 /mnt/swap_mount_point\n\nroot@localhost:~# file /mnt/swap_mount_point \n/mnt/swap_mount_point: data\n\n```\n\n### 2.3 格式化swap文件\n```\nroot@localhost:~# mkswap /mnt/swap_mount_point \nSetting up swapspace version 1, size = 2097148 KiB\nno label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678\nroot@localhost:~# file /mnt/swap_mount_point \n/mnt/swap_mount_point: Linux/i386 swap file (new style), version 1 (4K pages), size 524287 pages, no label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678\n```\n\n### 2.4 挂载\n```\nroot@localhost:~# swapon /mnt/swap_mount_point \nroot@localhost:~# free -h\n             total       used       free     shared    buffers     cached\nMem:          7.7G       7.5G       197M       878M       476M       4.7G\n-/+ buffers/cache:       2.3G       5.3G\nSwap:         2G       264K       2G\n```\n\n### 2.5 添加开机启动\n```\nroot@localhost:~# echo \"/mnt/swap_mount_point swap swap defaults 0 0\" >> /etc/fstab  \n```\n\n## 3. 相关命令\n- 挂载swap\n```\n×××@localhost: ~$ swapon /mnt/swap_mount_ponit\n```\n\n- 卸载swap\n```\n×××@localhost: ~$ swapoff /mnt/swap_mount_point\n```\n\n- 查看swap使用情况\n```\n×××@localhost: ~$ swapon -s \n或\n×××@localhost: ~$ cat /proc/swaps\n```\n\n## 4. swap的优化\n在ubuntu中swappiness参数值的大小对如何使用swap分区有很大的关系。\nswappiness=0 表示最大限度使用物理内存。然后才是swap分区\nswappiness=100 表示积极地使用swap分区，并把内存上的数据及时地搬运到swap空间上。\n\n**swappiness值的修改方法**\n- 方法1\n```\n×××@localhost: ~$ sudo sysctl vm.swappiness=60\n```\n- 方法2\n```\n×××@localhost: ~$ sudo vi /etc/sysctl.conf\n在文件尾添加`vm.swappiness=60`，然后刷新内核参数\n×××@localhost: ~$ sudo sysctl -p\n```\n\n\n\n\n","slug":"linux添加swap","published":1,"updated":"2017-02-15T05:22:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4v000yzahiemf9o3lx","content":"<h2 id=\"1-swap说明\"><a href=\"#1-swap说明\" class=\"headerlink\" title=\"1. swap说明\"></a>1. swap说明</h2><p>物理内存就是计算机的实际内存大小，由RAM芯片组成的。<br>虚拟内存则是虚拟出来的，使用磁盘代替内存。<br>虚拟内存的出现，让机器内存不够的情况得到部分解决。当程序运行起来由操作系统做具体虚拟内存到物理内存的替换和载。这里的虚拟内存就是swap</p>\n<p>当物理内存使用完或者达到一定比例之后，我们可以使用swap做临时的内存使用。当物理内存和swap都被使用完那么就会出错，out of memory。</p>\n<h2 id=\"2-使用dd创建swap\"><a href=\"#2-使用dd创建swap\" class=\"headerlink\" title=\"2. 使用dd创建swap\"></a>2. 使用dd创建swap</h2><h3 id=\"2-1-查看当前内存\"><a href=\"#2-1-查看当前内存\" class=\"headerlink\" title=\"2.1 查看当前内存\"></a>2.1 查看当前内存</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ free -h</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:          7.7G       6.0G       1.6G       875M       476M       3.2G</span><br><span class=\"line\">-/+ buffers/cache:       2.4G       5.3G</span><br><span class=\"line\">Swap:         0B         0B       0B</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-创建swap文件\"><a href=\"#2-2-创建swap文件\" class=\"headerlink\" title=\"2.2 创建swap文件\"></a>2.2 创建swap文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ sudo -s</span><br><span class=\"line\">root@localhost:~# dd if=/dev/zero of=/mnt/swap_mount_point bs=1M count=2048</span><br><span class=\"line\">2048+0 records in</span><br><span class=\"line\">2048+0 records out</span><br><span class=\"line\">2147483648 bytes (2.1 GB) copied, 16.7229 s, 128 MB/s</span><br><span class=\"line\"></span><br><span class=\"line\">root@localhost:~# ls -lh /mnt/swap_mount_point </span><br><span class=\"line\">-rw-r--r-- 1 root root 2.0G Feb 14 18:08 /mnt/swap_mount_point</span><br><span class=\"line\"></span><br><span class=\"line\">root@localhost:~# file /mnt/swap_mount_point </span><br><span class=\"line\">/mnt/swap_mount_point: data</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-格式化swap文件\"><a href=\"#2-3-格式化swap文件\" class=\"headerlink\" title=\"2.3 格式化swap文件\"></a>2.3 格式化swap文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@localhost:~# mkswap /mnt/swap_mount_point </span><br><span class=\"line\">Setting up swapspace version 1, size = 2097148 KiB</span><br><span class=\"line\">no label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678</span><br><span class=\"line\">root@localhost:~# file /mnt/swap_mount_point </span><br><span class=\"line\">/mnt/swap_mount_point: Linux/i386 swap file (new style), version 1 (4K pages), size 524287 pages, no label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-挂载\"><a href=\"#2-4-挂载\" class=\"headerlink\" title=\"2.4 挂载\"></a>2.4 挂载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@localhost:~# swapon /mnt/swap_mount_point </span><br><span class=\"line\">root@localhost:~# free -h</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:          7.7G       7.5G       197M       878M       476M       4.7G</span><br><span class=\"line\">-/+ buffers/cache:       2.3G       5.3G</span><br><span class=\"line\">Swap:         2G       264K       2G</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-添加开机启动\"><a href=\"#2-5-添加开机启动\" class=\"headerlink\" title=\"2.5 添加开机启动\"></a>2.5 添加开机启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@localhost:~# echo &quot;/mnt/swap_mount_point swap swap defaults 0 0&quot; &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-相关命令\"><a href=\"#3-相关命令\" class=\"headerlink\" title=\"3. 相关命令\"></a>3. 相关命令</h2><ul>\n<li><p>挂载swap</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ swapon /mnt/swap_mount_ponit</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>卸载swap</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ swapoff /mnt/swap_mount_point</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看swap使用情况</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ swapon -s </span><br><span class=\"line\">或</span><br><span class=\"line\">×××@localhost: ~$ cat /proc/swaps</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"4-swap的优化\"><a href=\"#4-swap的优化\" class=\"headerlink\" title=\"4. swap的优化\"></a>4. swap的优化</h2><p>在ubuntu中swappiness参数值的大小对如何使用swap分区有很大的关系。<br>swappiness=0 表示最大限度使用物理内存。然后才是swap分区<br>swappiness=100 表示积极地使用swap分区，并把内存上的数据及时地搬运到swap空间上。</p>\n<p><strong>swappiness值的修改方法</strong></p>\n<ul>\n<li><p>方法1</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ sudo sysctl vm.swappiness=60</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>方法2</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ sudo vi /etc/sysctl.conf</span><br><span class=\"line\">在文件尾添加`vm.swappiness=60`，然后刷新内核参数</span><br><span class=\"line\">×××@localhost: ~$ sudo sysctl -p</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-swap说明\"><a href=\"#1-swap说明\" class=\"headerlink\" title=\"1. swap说明\"></a>1. swap说明</h2><p>物理内存就是计算机的实际内存大小，由RAM芯片组成的。<br>虚拟内存则是虚拟出来的，使用磁盘代替内存。<br>虚拟内存的出现，让机器内存不够的情况得到部分解决。当程序运行起来由操作系统做具体虚拟内存到物理内存的替换和载。这里的虚拟内存就是swap</p>\n<p>当物理内存使用完或者达到一定比例之后，我们可以使用swap做临时的内存使用。当物理内存和swap都被使用完那么就会出错，out of memory。</p>\n<h2 id=\"2-使用dd创建swap\"><a href=\"#2-使用dd创建swap\" class=\"headerlink\" title=\"2. 使用dd创建swap\"></a>2. 使用dd创建swap</h2><h3 id=\"2-1-查看当前内存\"><a href=\"#2-1-查看当前内存\" class=\"headerlink\" title=\"2.1 查看当前内存\"></a>2.1 查看当前内存</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ free -h</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:          7.7G       6.0G       1.6G       875M       476M       3.2G</span><br><span class=\"line\">-/+ buffers/cache:       2.4G       5.3G</span><br><span class=\"line\">Swap:         0B         0B       0B</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-创建swap文件\"><a href=\"#2-2-创建swap文件\" class=\"headerlink\" title=\"2.2 创建swap文件\"></a>2.2 创建swap文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ sudo -s</span><br><span class=\"line\">root@localhost:~# dd if=/dev/zero of=/mnt/swap_mount_point bs=1M count=2048</span><br><span class=\"line\">2048+0 records in</span><br><span class=\"line\">2048+0 records out</span><br><span class=\"line\">2147483648 bytes (2.1 GB) copied, 16.7229 s, 128 MB/s</span><br><span class=\"line\"></span><br><span class=\"line\">root@localhost:~# ls -lh /mnt/swap_mount_point </span><br><span class=\"line\">-rw-r--r-- 1 root root 2.0G Feb 14 18:08 /mnt/swap_mount_point</span><br><span class=\"line\"></span><br><span class=\"line\">root@localhost:~# file /mnt/swap_mount_point </span><br><span class=\"line\">/mnt/swap_mount_point: data</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-格式化swap文件\"><a href=\"#2-3-格式化swap文件\" class=\"headerlink\" title=\"2.3 格式化swap文件\"></a>2.3 格式化swap文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@localhost:~# mkswap /mnt/swap_mount_point </span><br><span class=\"line\">Setting up swapspace version 1, size = 2097148 KiB</span><br><span class=\"line\">no label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678</span><br><span class=\"line\">root@localhost:~# file /mnt/swap_mount_point </span><br><span class=\"line\">/mnt/swap_mount_point: Linux/i386 swap file (new style), version 1 (4K pages), size 524287 pages, no label, UUID=2ed6629c-4b31-499b-b21d-2235971f8678</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-挂载\"><a href=\"#2-4-挂载\" class=\"headerlink\" title=\"2.4 挂载\"></a>2.4 挂载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@localhost:~# swapon /mnt/swap_mount_point </span><br><span class=\"line\">root@localhost:~# free -h</span><br><span class=\"line\">             total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:          7.7G       7.5G       197M       878M       476M       4.7G</span><br><span class=\"line\">-/+ buffers/cache:       2.3G       5.3G</span><br><span class=\"line\">Swap:         2G       264K       2G</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-添加开机启动\"><a href=\"#2-5-添加开机启动\" class=\"headerlink\" title=\"2.5 添加开机启动\"></a>2.5 添加开机启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@localhost:~# echo &quot;/mnt/swap_mount_point swap swap defaults 0 0&quot; &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-相关命令\"><a href=\"#3-相关命令\" class=\"headerlink\" title=\"3. 相关命令\"></a>3. 相关命令</h2><ul>\n<li><p>挂载swap</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ swapon /mnt/swap_mount_ponit</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>卸载swap</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ swapoff /mnt/swap_mount_point</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看swap使用情况</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ swapon -s </span><br><span class=\"line\">或</span><br><span class=\"line\">×××@localhost: ~$ cat /proc/swaps</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"4-swap的优化\"><a href=\"#4-swap的优化\" class=\"headerlink\" title=\"4. swap的优化\"></a>4. swap的优化</h2><p>在ubuntu中swappiness参数值的大小对如何使用swap分区有很大的关系。<br>swappiness=0 表示最大限度使用物理内存。然后才是swap分区<br>swappiness=100 表示积极地使用swap分区，并把内存上的数据及时地搬运到swap空间上。</p>\n<p><strong>swappiness值的修改方法</strong></p>\n<ul>\n<li><p>方法1</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ sudo sysctl vm.swappiness=60</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>方法2</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">×××@localhost: ~$ sudo vi /etc/sysctl.conf</span><br><span class=\"line\">在文件尾添加`vm.swappiness=60`，然后刷新内核参数</span><br><span class=\"line\">×××@localhost: ~$ sudo sysctl -p</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n"},{"title":"mediawiki","date":"2017-08-18T13:08:11.000Z","_content":"\n## 1. 准备\n`mediawiki`依赖`LNMP`环境，所以在部署前，需要首先搭建`LNMP`环境，参考上一篇。\n\n## 2. 下载mediawiki并解压\n[下载链接](https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz)  \n```\nwget https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz\nmv mediawiki-1.27.3.tar.gz /mnt/data/\ncd /mnt/data\ntar -zxvf mediawiki-1.27.3.tar.gz\n```\n## 3. 进行域名解析\n将要使用的域名(例如`mediawiki.xxx.cn`)解析到该服务器\n\n## 4. 配置nginx\n```\nserver {\n    listen  80;\n    server_name  mediawiki.xxx.cn;\n    return 301 https://mediawiki.xxx.cn:443$request_uri;\n}\n\nserver {\n        listen  443 ssl;\n        server_name     mediawiki.xxx.cn;\n\n        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.crt;\n        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.key;\n\n\n        root    /mnt/data/mediawiki-1.27.3;\n        #index  index.php index.html index.htm;\n\n        location ~ \\.php$ {\n             root               /mnt/data/mediawiki-1.27.3;\n             fastcgi_pass       127.0.0.1:9000;\n             fastcgi_index      index.php;\n             fastcgi_param      SCRIPT_FILENAME /scripts$fastcgi_script_name;\n             include            fastcgi.conf;\n        }\n\n        location / {            \n             root               /mnt/data/mediawiki-1.27.3;\n             index index.php;\n        }\n    }\n```\n\n## 5. 安装\n通过浏览器访问`mediawiki.xxx.cn`配置安装即可。\n其中要注意正确设置连接数据库的用户名密码。","source":"_posts/mediawiki.md","raw":"---\ntitle: 'mediawiki'\ndate: 2017-08-18 21:08:11\ntags:\n---\n\n## 1. 准备\n`mediawiki`依赖`LNMP`环境，所以在部署前，需要首先搭建`LNMP`环境，参考上一篇。\n\n## 2. 下载mediawiki并解压\n[下载链接](https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz)  \n```\nwget https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz\nmv mediawiki-1.27.3.tar.gz /mnt/data/\ncd /mnt/data\ntar -zxvf mediawiki-1.27.3.tar.gz\n```\n## 3. 进行域名解析\n将要使用的域名(例如`mediawiki.xxx.cn`)解析到该服务器\n\n## 4. 配置nginx\n```\nserver {\n    listen  80;\n    server_name  mediawiki.xxx.cn;\n    return 301 https://mediawiki.xxx.cn:443$request_uri;\n}\n\nserver {\n        listen  443 ssl;\n        server_name     mediawiki.xxx.cn;\n\n        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.crt;\n        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.key;\n\n\n        root    /mnt/data/mediawiki-1.27.3;\n        #index  index.php index.html index.htm;\n\n        location ~ \\.php$ {\n             root               /mnt/data/mediawiki-1.27.3;\n             fastcgi_pass       127.0.0.1:9000;\n             fastcgi_index      index.php;\n             fastcgi_param      SCRIPT_FILENAME /scripts$fastcgi_script_name;\n             include            fastcgi.conf;\n        }\n\n        location / {            \n             root               /mnt/data/mediawiki-1.27.3;\n             index index.php;\n        }\n    }\n```\n\n## 5. 安装\n通过浏览器访问`mediawiki.xxx.cn`配置安装即可。\n其中要注意正确设置连接数据库的用户名密码。","slug":"mediawiki","published":1,"updated":"2018-12-08T09:51:01.658Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4w0010zahi7a7tfyml","content":"<h2 id=\"1-准备\"><a href=\"#1-准备\" class=\"headerlink\" title=\"1. 准备\"></a>1. 准备</h2><p><code>mediawiki</code>依赖<code>LNMP</code>环境，所以在部署前，需要首先搭建<code>LNMP</code>环境，参考上一篇。</p>\n<h2 id=\"2-下载mediawiki并解压\"><a href=\"#2-下载mediawiki并解压\" class=\"headerlink\" title=\"2. 下载mediawiki并解压\"></a>2. 下载mediawiki并解压</h2><p><a href=\"https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz\" target=\"_blank\" rel=\"noopener\">下载链接</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz</span><br><span class=\"line\">mv mediawiki-1.27.3.tar.gz /mnt/data/</span><br><span class=\"line\">cd /mnt/data</span><br><span class=\"line\">tar -zxvf mediawiki-1.27.3.tar.gz</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-进行域名解析\"><a href=\"#3-进行域名解析\" class=\"headerlink\" title=\"3. 进行域名解析\"></a>3. 进行域名解析</h2><p>将要使用的域名(例如<code>mediawiki.xxx.cn</code>)解析到该服务器</p>\n<h2 id=\"4-配置nginx\"><a href=\"#4-配置nginx\" class=\"headerlink\" title=\"4. 配置nginx\"></a>4. 配置nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen  80;</span><br><span class=\"line\">    server_name  mediawiki.xxx.cn;</span><br><span class=\"line\">    return 301 https://mediawiki.xxx.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen  443 ssl;</span><br><span class=\"line\">        server_name     mediawiki.xxx.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.crt;</span><br><span class=\"line\">        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.key;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        root    /mnt/data/mediawiki-1.27.3;</span><br><span class=\"line\">        #index  index.php index.html index.htm;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">             root               /mnt/data/mediawiki-1.27.3;</span><br><span class=\"line\">             fastcgi_pass       127.0.0.1:9000;</span><br><span class=\"line\">             fastcgi_index      index.php;</span><br><span class=\"line\">             fastcgi_param      SCRIPT_FILENAME /scripts$fastcgi_script_name;</span><br><span class=\"line\">             include            fastcgi.conf;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;            </span><br><span class=\"line\">             root               /mnt/data/mediawiki-1.27.3;</span><br><span class=\"line\">             index index.php;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-安装\"><a href=\"#5-安装\" class=\"headerlink\" title=\"5. 安装\"></a>5. 安装</h2><p>通过浏览器访问<code>mediawiki.xxx.cn</code>配置安装即可。<br>其中要注意正确设置连接数据库的用户名密码。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-准备\"><a href=\"#1-准备\" class=\"headerlink\" title=\"1. 准备\"></a>1. 准备</h2><p><code>mediawiki</code>依赖<code>LNMP</code>环境，所以在部署前，需要首先搭建<code>LNMP</code>环境，参考上一篇。</p>\n<h2 id=\"2-下载mediawiki并解压\"><a href=\"#2-下载mediawiki并解压\" class=\"headerlink\" title=\"2. 下载mediawiki并解压\"></a>2. 下载mediawiki并解压</h2><p><a href=\"https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz\" target=\"_blank\" rel=\"noopener\">下载链接</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://releases.wikimedia.org/mediawiki/1.27/mediawiki-1.27.3.tar.gz</span><br><span class=\"line\">mv mediawiki-1.27.3.tar.gz /mnt/data/</span><br><span class=\"line\">cd /mnt/data</span><br><span class=\"line\">tar -zxvf mediawiki-1.27.3.tar.gz</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-进行域名解析\"><a href=\"#3-进行域名解析\" class=\"headerlink\" title=\"3. 进行域名解析\"></a>3. 进行域名解析</h2><p>将要使用的域名(例如<code>mediawiki.xxx.cn</code>)解析到该服务器</p>\n<h2 id=\"4-配置nginx\"><a href=\"#4-配置nginx\" class=\"headerlink\" title=\"4. 配置nginx\"></a>4. 配置nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen  80;</span><br><span class=\"line\">    server_name  mediawiki.xxx.cn;</span><br><span class=\"line\">    return 301 https://mediawiki.xxx.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen  443 ssl;</span><br><span class=\"line\">        server_name     mediawiki.xxx.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.crt;</span><br><span class=\"line\">        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/mediawiki-server.key;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        root    /mnt/data/mediawiki-1.27.3;</span><br><span class=\"line\">        #index  index.php index.html index.htm;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">             root               /mnt/data/mediawiki-1.27.3;</span><br><span class=\"line\">             fastcgi_pass       127.0.0.1:9000;</span><br><span class=\"line\">             fastcgi_index      index.php;</span><br><span class=\"line\">             fastcgi_param      SCRIPT_FILENAME /scripts$fastcgi_script_name;</span><br><span class=\"line\">             include            fastcgi.conf;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;            </span><br><span class=\"line\">             root               /mnt/data/mediawiki-1.27.3;</span><br><span class=\"line\">             index index.php;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-安装\"><a href=\"#5-安装\" class=\"headerlink\" title=\"5. 安装\"></a>5. 安装</h2><p>通过浏览器访问<code>mediawiki.xxx.cn</code>配置安装即可。<br>其中要注意正确设置连接数据库的用户名密码。</p>\n"},{"title":"mongodb主从","date":"2018-12-11T12:44:12.000Z","_content":"\n## 1. 安装\n根据需求从[这里](https://www.mongodb.com/download-center/community)下载相应的版本即可。  \n例如下载完后放到`~/opt`\n```\ncd ~/opt\ntar -zxvf mongodb-linux-x86_64-ubuntu1604-4.1.6.tgz\nmv mongodb-linux-x86_64-ubuntu1604-4.1.6 mongodb-4.1.6\n```\n\n## 2. 配置\n\n### 2.1 创建配置目录\n在`master`和`slaver`上创建配置文件目录\n```\ncd ~/opt/mongodb-4.1.6\nmkdir conf\n```\n\n### 2.2 配置项\n配置文件可以放到`~/opt/mongodb-4.1.6/conf`里\n\nmaster配置文件`mongod.conf`内容如下\n```\ndbpath=/mnt/data/dbs/mongodb/data\nlogpath=/mnt/data/dbs/mongodb/logs/mongod.log\n\nlogappend=true\nport = 27017\n\n# Listen to local interface only. Comment out to listen on all interfaces. \nbind_ip = 10.211.55.6,127.0.0.1\n\ndirectoryperdb = true\nprofile = 1 \n\nmaster = true\n```\n\nslaver的配置文件`mongod.conf`内容如下\n```\ndbpath=/mnt/data/dbs/mongodb/data\nlogpath=/mnt/data/dbs/mongodb/logs/mongod.log\n\nlogappend=true\nport = 27017\n\n# Listen to local interface only. Comment out to listen on all interfaces. \nbind_ip = 10.221.55.7,127.0.0.1\n \ndirectoryperdb = true\nprofile = 1 \n \nsource = 10.211.55.6:27017\nslave = true\n```\n\n### 2.3 创建数据目录\n在`master`和`slaver`上创建数据目录\n\n```\nmkdir -p /mnt/data/dbs/mongodb/{data,logs}\n```\n\n### 2.4 启动并测试\n在`master`和`slaver`上分别启动`mongodb`\n\n```\ncd ~/opt/mongodb-4.1.6/\n./bin/mongod --config ./config/mongod.conf\n```\n服务启动后，在`master`执行写入数据命令\n```\n./bin/mongo \n> #写入数据命令\n```\n\n在`slaver`上进行查询验证写入的数据。\n\n## 3. 添加用户名密码\n上述过程，`mongodb`主从就已经配置完成，但是这样是不安全的，生产环境通常需要对数据库设置用户名密码。\n\n在`master`和`slaver`的配置文件中，分别添加\n```\nauth = true\n```\n\n### 3.1 添加root用户\n```\n./bin/mongo \n> use admin\n> db.createUser(\n{ \nuser: \"root\",\npwd: \"pwd4root\",\nroles: [ { role: \"root\", db: \"admin\" } ]\n}\n)\n>\n```\n\n### 3.2 为数据库添加用户\n```\n./bin/mongo \n> use db_name\n> db.createUser(\n{\nuser: \"dbowner\",\npwd: \"pwd4dbowner\",\nroles: [ { role: \"dbOwner\", db:\"db_name\"}]\n}\n)\n```\n\n\n### 3.3 删除错建用户\n获取当前数据库的用户\n```\n./bin/mongo \n> use db_name\n> db.auth(\"dbowner\",\"pwd4dbowner\")\n> db.getUsers()\n```\n\n删除不需要的数据库用户\n```\n./bin/mongo \n> use db_name\n> db.auth(\"dbowner\",\"pwd4dbowner\")\n> db.dropUser(\"drop_username\")\n```\n\n### 3.3 创建认证keyfile\n在`master`服务器上生成`keyfile`  \n修改权限为700  \n复制到`slaver`服务器\n```\ncd /mnt/data/dbs/mongodb/\nopenssl rand -base64 741 >> keyfile \nchmod 700 keyfile\n```\n\n在`master`和`slaver`的配置文件中，分别添加\n```\nkeyFile = /mnt/data/dbs/mongodb/keyfile\n```\n依次重启`master`和`slaver`服务器的`mongodb`\n\n## 4. 测试\n在`master`服务器进行数据写入操作  \n在`slaver`服务器进行验证，新写入的数据同步了，包括数据库的用户认证信息也会同步。  \n**注：**  \n在`slaver`登陆`mongo`并认证通过后，需要执行`rs.slaveOk()`才可以在从数据库上开启读操作。  \n例如：\n```\n$ cd ~/opt/mongodb-4.1.6\n$ ./bin/mongo\n> use db_name\n> db.auth(\"dbowner\",\"pwd4dbowner\")\n> rs.slaveOk()\n> show collections\n```\n","source":"_posts/mongodb主从.md","raw":"---\ntitle: mongodb主从\ndate: 2018-12-11 20:44:12\ntags: 模拟\n---\n\n## 1. 安装\n根据需求从[这里](https://www.mongodb.com/download-center/community)下载相应的版本即可。  \n例如下载完后放到`~/opt`\n```\ncd ~/opt\ntar -zxvf mongodb-linux-x86_64-ubuntu1604-4.1.6.tgz\nmv mongodb-linux-x86_64-ubuntu1604-4.1.6 mongodb-4.1.6\n```\n\n## 2. 配置\n\n### 2.1 创建配置目录\n在`master`和`slaver`上创建配置文件目录\n```\ncd ~/opt/mongodb-4.1.6\nmkdir conf\n```\n\n### 2.2 配置项\n配置文件可以放到`~/opt/mongodb-4.1.6/conf`里\n\nmaster配置文件`mongod.conf`内容如下\n```\ndbpath=/mnt/data/dbs/mongodb/data\nlogpath=/mnt/data/dbs/mongodb/logs/mongod.log\n\nlogappend=true\nport = 27017\n\n# Listen to local interface only. Comment out to listen on all interfaces. \nbind_ip = 10.211.55.6,127.0.0.1\n\ndirectoryperdb = true\nprofile = 1 \n\nmaster = true\n```\n\nslaver的配置文件`mongod.conf`内容如下\n```\ndbpath=/mnt/data/dbs/mongodb/data\nlogpath=/mnt/data/dbs/mongodb/logs/mongod.log\n\nlogappend=true\nport = 27017\n\n# Listen to local interface only. Comment out to listen on all interfaces. \nbind_ip = 10.221.55.7,127.0.0.1\n \ndirectoryperdb = true\nprofile = 1 \n \nsource = 10.211.55.6:27017\nslave = true\n```\n\n### 2.3 创建数据目录\n在`master`和`slaver`上创建数据目录\n\n```\nmkdir -p /mnt/data/dbs/mongodb/{data,logs}\n```\n\n### 2.4 启动并测试\n在`master`和`slaver`上分别启动`mongodb`\n\n```\ncd ~/opt/mongodb-4.1.6/\n./bin/mongod --config ./config/mongod.conf\n```\n服务启动后，在`master`执行写入数据命令\n```\n./bin/mongo \n> #写入数据命令\n```\n\n在`slaver`上进行查询验证写入的数据。\n\n## 3. 添加用户名密码\n上述过程，`mongodb`主从就已经配置完成，但是这样是不安全的，生产环境通常需要对数据库设置用户名密码。\n\n在`master`和`slaver`的配置文件中，分别添加\n```\nauth = true\n```\n\n### 3.1 添加root用户\n```\n./bin/mongo \n> use admin\n> db.createUser(\n{ \nuser: \"root\",\npwd: \"pwd4root\",\nroles: [ { role: \"root\", db: \"admin\" } ]\n}\n)\n>\n```\n\n### 3.2 为数据库添加用户\n```\n./bin/mongo \n> use db_name\n> db.createUser(\n{\nuser: \"dbowner\",\npwd: \"pwd4dbowner\",\nroles: [ { role: \"dbOwner\", db:\"db_name\"}]\n}\n)\n```\n\n\n### 3.3 删除错建用户\n获取当前数据库的用户\n```\n./bin/mongo \n> use db_name\n> db.auth(\"dbowner\",\"pwd4dbowner\")\n> db.getUsers()\n```\n\n删除不需要的数据库用户\n```\n./bin/mongo \n> use db_name\n> db.auth(\"dbowner\",\"pwd4dbowner\")\n> db.dropUser(\"drop_username\")\n```\n\n### 3.3 创建认证keyfile\n在`master`服务器上生成`keyfile`  \n修改权限为700  \n复制到`slaver`服务器\n```\ncd /mnt/data/dbs/mongodb/\nopenssl rand -base64 741 >> keyfile \nchmod 700 keyfile\n```\n\n在`master`和`slaver`的配置文件中，分别添加\n```\nkeyFile = /mnt/data/dbs/mongodb/keyfile\n```\n依次重启`master`和`slaver`服务器的`mongodb`\n\n## 4. 测试\n在`master`服务器进行数据写入操作  \n在`slaver`服务器进行验证，新写入的数据同步了，包括数据库的用户认证信息也会同步。  \n**注：**  \n在`slaver`登陆`mongo`并认证通过后，需要执行`rs.slaveOk()`才可以在从数据库上开启读操作。  \n例如：\n```\n$ cd ~/opt/mongodb-4.1.6\n$ ./bin/mongo\n> use db_name\n> db.auth(\"dbowner\",\"pwd4dbowner\")\n> rs.slaveOk()\n> show collections\n```\n","slug":"mongodb主从","published":1,"updated":"2018-12-14T07:42:31.460Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4x0014zahiwo2ifdgr","content":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><p>根据需求从<a href=\"https://www.mongodb.com/download-center/community\" target=\"_blank\" rel=\"noopener\">这里</a>下载相应的版本即可。<br>例如下载完后放到<code>~/opt</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt</span><br><span class=\"line\">tar -zxvf mongodb-linux-x86_64-ubuntu1604-4.1.6.tgz</span><br><span class=\"line\">mv mongodb-linux-x86_64-ubuntu1604-4.1.6 mongodb-4.1.6</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2. 配置\"></a>2. 配置</h2><h3 id=\"2-1-创建配置目录\"><a href=\"#2-1-创建配置目录\" class=\"headerlink\" title=\"2.1 创建配置目录\"></a>2.1 创建配置目录</h3><p>在<code>master</code>和<code>slaver</code>上创建配置文件目录<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/mongodb-4.1.6</span><br><span class=\"line\">mkdir conf</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-配置项\"><a href=\"#2-2-配置项\" class=\"headerlink\" title=\"2.2 配置项\"></a>2.2 配置项</h3><p>配置文件可以放到<code>~/opt/mongodb-4.1.6/conf</code>里</p>\n<p>master配置文件<code>mongod.conf</code>内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=/mnt/data/dbs/mongodb/data</span><br><span class=\"line\">logpath=/mnt/data/dbs/mongodb/logs/mongod.log</span><br><span class=\"line\"></span><br><span class=\"line\">logappend=true</span><br><span class=\"line\">port = 27017</span><br><span class=\"line\"></span><br><span class=\"line\"># Listen to local interface only. Comment out to listen on all interfaces. </span><br><span class=\"line\">bind_ip = 10.211.55.6,127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">directoryperdb = true</span><br><span class=\"line\">profile = 1 </span><br><span class=\"line\"></span><br><span class=\"line\">master = true</span><br></pre></td></tr></table></figure></p>\n<p>slaver的配置文件<code>mongod.conf</code>内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=/mnt/data/dbs/mongodb/data</span><br><span class=\"line\">logpath=/mnt/data/dbs/mongodb/logs/mongod.log</span><br><span class=\"line\"></span><br><span class=\"line\">logappend=true</span><br><span class=\"line\">port = 27017</span><br><span class=\"line\"></span><br><span class=\"line\"># Listen to local interface only. Comment out to listen on all interfaces. </span><br><span class=\"line\">bind_ip = 10.221.55.7,127.0.0.1</span><br><span class=\"line\"> </span><br><span class=\"line\">directoryperdb = true</span><br><span class=\"line\">profile = 1 </span><br><span class=\"line\"> </span><br><span class=\"line\">source = 10.211.55.6:27017</span><br><span class=\"line\">slave = true</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-创建数据目录\"><a href=\"#2-3-创建数据目录\" class=\"headerlink\" title=\"2.3 创建数据目录\"></a>2.3 创建数据目录</h3><p>在<code>master</code>和<code>slaver</code>上创建数据目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /mnt/data/dbs/mongodb/&#123;data,logs&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-启动并测试\"><a href=\"#2-4-启动并测试\" class=\"headerlink\" title=\"2.4 启动并测试\"></a>2.4 启动并测试</h3><p>在<code>master</code>和<code>slaver</code>上分别启动<code>mongodb</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/mongodb-4.1.6/</span><br><span class=\"line\">./bin/mongod --config ./config/mongod.conf</span><br></pre></td></tr></table></figure>\n<p>服务启动后，在<code>master</code>执行写入数据命令<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; #写入数据命令</span><br></pre></td></tr></table></figure></p>\n<p>在<code>slaver</code>上进行查询验证写入的数据。</p>\n<h2 id=\"3-添加用户名密码\"><a href=\"#3-添加用户名密码\" class=\"headerlink\" title=\"3. 添加用户名密码\"></a>3. 添加用户名密码</h2><p>上述过程，<code>mongodb</code>主从就已经配置完成，但是这样是不安全的，生产环境通常需要对数据库设置用户名密码。</p>\n<p>在<code>master</code>和<code>slaver</code>的配置文件中，分别添加<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">auth = true</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-1-添加root用户\"><a href=\"#3-1-添加root用户\" class=\"headerlink\" title=\"3.1 添加root用户\"></a>3.1 添加root用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use admin</span><br><span class=\"line\">&gt; db.createUser(</span><br><span class=\"line\">&#123; </span><br><span class=\"line\">user: &quot;root&quot;,</span><br><span class=\"line\">pwd: &quot;pwd4root&quot;,</span><br><span class=\"line\">roles: [ &#123; role: &quot;root&quot;, db: &quot;admin&quot; &#125; ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">)</span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-为数据库添加用户\"><a href=\"#3-2-为数据库添加用户\" class=\"headerlink\" title=\"3.2 为数据库添加用户\"></a>3.2 为数据库添加用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.createUser(</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">user: &quot;dbowner&quot;,</span><br><span class=\"line\">pwd: &quot;pwd4dbowner&quot;,</span><br><span class=\"line\">roles: [ &#123; role: &quot;dbOwner&quot;, db:&quot;db_name&quot;&#125;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-删除错建用户\"><a href=\"#3-3-删除错建用户\" class=\"headerlink\" title=\"3.3 删除错建用户\"></a>3.3 删除错建用户</h3><p>获取当前数据库的用户<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.auth(&quot;dbowner&quot;,&quot;pwd4dbowner&quot;)</span><br><span class=\"line\">&gt; db.getUsers()</span><br></pre></td></tr></table></figure></p>\n<p>删除不需要的数据库用户<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.auth(&quot;dbowner&quot;,&quot;pwd4dbowner&quot;)</span><br><span class=\"line\">&gt; db.dropUser(&quot;drop_username&quot;)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-3-创建认证keyfile\"><a href=\"#3-3-创建认证keyfile\" class=\"headerlink\" title=\"3.3 创建认证keyfile\"></a>3.3 创建认证keyfile</h3><p>在<code>master</code>服务器上生成<code>keyfile</code><br>修改权限为700<br>复制到<code>slaver</code>服务器<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /mnt/data/dbs/mongodb/</span><br><span class=\"line\">openssl rand -base64 741 &gt;&gt; keyfile </span><br><span class=\"line\">chmod 700 keyfile</span><br></pre></td></tr></table></figure></p>\n<p>在<code>master</code>和<code>slaver</code>的配置文件中，分别添加<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keyFile = /mnt/data/dbs/mongodb/keyfile</span><br></pre></td></tr></table></figure></p>\n<p>依次重启<code>master</code>和<code>slaver</code>服务器的<code>mongodb</code></p>\n<h2 id=\"4-测试\"><a href=\"#4-测试\" class=\"headerlink\" title=\"4. 测试\"></a>4. 测试</h2><p>在<code>master</code>服务器进行数据写入操作<br>在<code>slaver</code>服务器进行验证，新写入的数据同步了，包括数据库的用户认证信息也会同步。<br><strong>注：</strong><br>在<code>slaver</code>登陆<code>mongo</code>并认证通过后，需要执行<code>rs.slaveOk()</code>才可以在从数据库上开启读操作。<br>例如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cd ~/opt/mongodb-4.1.6</span><br><span class=\"line\">$ ./bin/mongo</span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.auth(&quot;dbowner&quot;,&quot;pwd4dbowner&quot;)</span><br><span class=\"line\">&gt; rs.slaveOk()</span><br><span class=\"line\">&gt; show collections</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><p>根据需求从<a href=\"https://www.mongodb.com/download-center/community\" target=\"_blank\" rel=\"noopener\">这里</a>下载相应的版本即可。<br>例如下载完后放到<code>~/opt</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt</span><br><span class=\"line\">tar -zxvf mongodb-linux-x86_64-ubuntu1604-4.1.6.tgz</span><br><span class=\"line\">mv mongodb-linux-x86_64-ubuntu1604-4.1.6 mongodb-4.1.6</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2. 配置\"></a>2. 配置</h2><h3 id=\"2-1-创建配置目录\"><a href=\"#2-1-创建配置目录\" class=\"headerlink\" title=\"2.1 创建配置目录\"></a>2.1 创建配置目录</h3><p>在<code>master</code>和<code>slaver</code>上创建配置文件目录<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/mongodb-4.1.6</span><br><span class=\"line\">mkdir conf</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-配置项\"><a href=\"#2-2-配置项\" class=\"headerlink\" title=\"2.2 配置项\"></a>2.2 配置项</h3><p>配置文件可以放到<code>~/opt/mongodb-4.1.6/conf</code>里</p>\n<p>master配置文件<code>mongod.conf</code>内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=/mnt/data/dbs/mongodb/data</span><br><span class=\"line\">logpath=/mnt/data/dbs/mongodb/logs/mongod.log</span><br><span class=\"line\"></span><br><span class=\"line\">logappend=true</span><br><span class=\"line\">port = 27017</span><br><span class=\"line\"></span><br><span class=\"line\"># Listen to local interface only. Comment out to listen on all interfaces. </span><br><span class=\"line\">bind_ip = 10.211.55.6,127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">directoryperdb = true</span><br><span class=\"line\">profile = 1 </span><br><span class=\"line\"></span><br><span class=\"line\">master = true</span><br></pre></td></tr></table></figure></p>\n<p>slaver的配置文件<code>mongod.conf</code>内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=/mnt/data/dbs/mongodb/data</span><br><span class=\"line\">logpath=/mnt/data/dbs/mongodb/logs/mongod.log</span><br><span class=\"line\"></span><br><span class=\"line\">logappend=true</span><br><span class=\"line\">port = 27017</span><br><span class=\"line\"></span><br><span class=\"line\"># Listen to local interface only. Comment out to listen on all interfaces. </span><br><span class=\"line\">bind_ip = 10.221.55.7,127.0.0.1</span><br><span class=\"line\"> </span><br><span class=\"line\">directoryperdb = true</span><br><span class=\"line\">profile = 1 </span><br><span class=\"line\"> </span><br><span class=\"line\">source = 10.211.55.6:27017</span><br><span class=\"line\">slave = true</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-创建数据目录\"><a href=\"#2-3-创建数据目录\" class=\"headerlink\" title=\"2.3 创建数据目录\"></a>2.3 创建数据目录</h3><p>在<code>master</code>和<code>slaver</code>上创建数据目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /mnt/data/dbs/mongodb/&#123;data,logs&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-启动并测试\"><a href=\"#2-4-启动并测试\" class=\"headerlink\" title=\"2.4 启动并测试\"></a>2.4 启动并测试</h3><p>在<code>master</code>和<code>slaver</code>上分别启动<code>mongodb</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/mongodb-4.1.6/</span><br><span class=\"line\">./bin/mongod --config ./config/mongod.conf</span><br></pre></td></tr></table></figure>\n<p>服务启动后，在<code>master</code>执行写入数据命令<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; #写入数据命令</span><br></pre></td></tr></table></figure></p>\n<p>在<code>slaver</code>上进行查询验证写入的数据。</p>\n<h2 id=\"3-添加用户名密码\"><a href=\"#3-添加用户名密码\" class=\"headerlink\" title=\"3. 添加用户名密码\"></a>3. 添加用户名密码</h2><p>上述过程，<code>mongodb</code>主从就已经配置完成，但是这样是不安全的，生产环境通常需要对数据库设置用户名密码。</p>\n<p>在<code>master</code>和<code>slaver</code>的配置文件中，分别添加<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">auth = true</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-1-添加root用户\"><a href=\"#3-1-添加root用户\" class=\"headerlink\" title=\"3.1 添加root用户\"></a>3.1 添加root用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use admin</span><br><span class=\"line\">&gt; db.createUser(</span><br><span class=\"line\">&#123; </span><br><span class=\"line\">user: &quot;root&quot;,</span><br><span class=\"line\">pwd: &quot;pwd4root&quot;,</span><br><span class=\"line\">roles: [ &#123; role: &quot;root&quot;, db: &quot;admin&quot; &#125; ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">)</span><br><span class=\"line\">&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-为数据库添加用户\"><a href=\"#3-2-为数据库添加用户\" class=\"headerlink\" title=\"3.2 为数据库添加用户\"></a>3.2 为数据库添加用户</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.createUser(</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">user: &quot;dbowner&quot;,</span><br><span class=\"line\">pwd: &quot;pwd4dbowner&quot;,</span><br><span class=\"line\">roles: [ &#123; role: &quot;dbOwner&quot;, db:&quot;db_name&quot;&#125;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-删除错建用户\"><a href=\"#3-3-删除错建用户\" class=\"headerlink\" title=\"3.3 删除错建用户\"></a>3.3 删除错建用户</h3><p>获取当前数据库的用户<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.auth(&quot;dbowner&quot;,&quot;pwd4dbowner&quot;)</span><br><span class=\"line\">&gt; db.getUsers()</span><br></pre></td></tr></table></figure></p>\n<p>删除不需要的数据库用户<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/mongo </span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.auth(&quot;dbowner&quot;,&quot;pwd4dbowner&quot;)</span><br><span class=\"line\">&gt; db.dropUser(&quot;drop_username&quot;)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-3-创建认证keyfile\"><a href=\"#3-3-创建认证keyfile\" class=\"headerlink\" title=\"3.3 创建认证keyfile\"></a>3.3 创建认证keyfile</h3><p>在<code>master</code>服务器上生成<code>keyfile</code><br>修改权限为700<br>复制到<code>slaver</code>服务器<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /mnt/data/dbs/mongodb/</span><br><span class=\"line\">openssl rand -base64 741 &gt;&gt; keyfile </span><br><span class=\"line\">chmod 700 keyfile</span><br></pre></td></tr></table></figure></p>\n<p>在<code>master</code>和<code>slaver</code>的配置文件中，分别添加<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keyFile = /mnt/data/dbs/mongodb/keyfile</span><br></pre></td></tr></table></figure></p>\n<p>依次重启<code>master</code>和<code>slaver</code>服务器的<code>mongodb</code></p>\n<h2 id=\"4-测试\"><a href=\"#4-测试\" class=\"headerlink\" title=\"4. 测试\"></a>4. 测试</h2><p>在<code>master</code>服务器进行数据写入操作<br>在<code>slaver</code>服务器进行验证，新写入的数据同步了，包括数据库的用户认证信息也会同步。<br><strong>注：</strong><br>在<code>slaver</code>登陆<code>mongo</code>并认证通过后，需要执行<code>rs.slaveOk()</code>才可以在从数据库上开启读操作。<br>例如：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cd ~/opt/mongodb-4.1.6</span><br><span class=\"line\">$ ./bin/mongo</span><br><span class=\"line\">&gt; use db_name</span><br><span class=\"line\">&gt; db.auth(&quot;dbowner&quot;,&quot;pwd4dbowner&quot;)</span><br><span class=\"line\">&gt; rs.slaveOk()</span><br><span class=\"line\">&gt; show collections</span><br></pre></td></tr></table></figure></p>\n"},{"title":"linux系统监控基本命令","date":"2017-03-25T09:09:57.000Z","_content":"\n## 1. nmon软件\n\n### 1.1 运行nmon软件\n\n```\n:~$ nmon \n```\n\n```\n┌nmon─14g──────[H for help]───Hostname=localhost────Refresh= 2secs ───16:48.29────────────────────────┐\n------------------------------       For help type H or ...                                           │\n│  #    #  #    #   ####   #    #        nmon -?  - hint                                              │\n│  ##   #  ##  ##  #    #  ##   #        nmon -h  - full                                              │\n│  # #  #  # ## #  #    #  # #  #                                                                     │\n│  #  # #  #    #  #    #  #  # #       To start the same way every time                              │\n│  #   ##  #    #  #    #  #   ##        set the NMON ksh variable                                    │\n│  #    #  #    #   ####   #    #                                                                     │\n│  ------------------------------                                                                     │\n│                                                                                                     │\n│  Use these keys to toggle statistics on/off:                                                        │\n│     c = CPU        l = CPU Long-term   - = Faster screen updates                                    │\n│     m = Memory     j = Filesystems     + = Slower screen updates                                    │\n│     d = Disks      n = Network         V = Virtual Memory                                           │\n│     r = Resource   N = NFS             v = Verbose hints                                            │\n│     k = kernel     t = Top-processes   . = only busy disks/procs                                    │\n│     h = more options                 q = Quit                                                       │\n│─────────────────────────────────────────────────────────────────────────────────────────────────────│\n```\n\n\n### 1.2 显示CPU信息\n\n```\n│ CPU Utilisation ──────────────────────────────────────────────────────────────\n│---------------------------+-------------------------------------------------+\n│CPU  User%  Sys% Wait% Idle|0          |25         |50          |75       100|\n│  1  15.2   1.5   0.0  83.2|UUUUUUU           >                              |\n│  2   7.1   2.6   0.0  90.3|UUUs             >                               |\n│  3  17.5   1.0   0.5  81.0|UUUUUUUU        >                                |\n│  4  13.6   3.0   0.0  83.3|UUUUUUs            >                             |\n│---------------------------+-------------------------------------------------+\n│Avg  13.4   2.1   0.3  84.3|UUUUUUs        >                                 |\n│---------------------------+-------------------------------------------------+\n\n```\n\n### 1.3 显示内存信息\n```\n│ Memory Stats ──────────────────────────────────────────────────────────────────\n                RAM     High      Low     Swap    Page Size=4 KB\n│ Total MB      7843.5     -0.0     -0.0   3916.0\n│ Free  MB      1259.8     -0.0     -0.0   3915.6\n│ Free Percent    16.1%   100.0%   100.0%   100.0%\n│             MB                  MB                  MB\n│                      Cached=  2912.7     Active=  3842.7\n│ Buffers=   929.4 Swapcached=     0.0  Inactive =  1789.8\n│ Dirty  =     0.1 Writeback =     0.0  Mapped   =   946.5\n│ Slab   =   799.7 Commit_AS =  6624.9 PageTables=    40.2\n\n```\n\n### 1.4 显示磁盘信息\n\n```\n Disk I/O ──/proc/diskstats────mostly in KB/s─────Warning:contains duplicates────\n│DiskName Busy  Read WriteKB|0          |25         |50          |75       100|\n│sda        5%    0.0   42.0|WW>                                              |\n│sda1       0%    0.0    0.0|>                                                |\n│sda2       0%    0.0    0.0|>                                                |\n│sda5       5%    0.0   42.0|WW>                                              |\n│sda6       0%    0.0    0.0|>                                                |\n│Totals Read-MB/s=0.0      Writes-MB/s=0.1      Transfers/sec=12.0 \n\n```\n\n### 1.5 显示网络信息\n\n```\n Network I/O ────────────────────────────────────────────────────────────────────\n│I/F Name Recv=KB/s Trans=KB/s packin packout insize outsize Peak->Recv Trans \n│      lo     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 \n│   wlan0     0.1     0.0       0.5      0.0   215.0    0.0        0.1     0.0 \n│ docker0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 \n│    eth0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0\n│ Network Error Counters ─────────────────────────────────────────────────────────\n│I/F Name iErrors iDrop iOverrun iFrame oErrors   oDrop oOverrun oCarrier oColls\n│      lo       0       0       0       0       0       0       0       0       0\n│   wlan0       0       0       0       0       0       0       0       0       0\n│ docker0       0       0       0       0       0       0       0       0       0\n│    eth0       0       0       0       0       0       0       0       0       0\n```\n\n### 1.6 显示内核信息\n```\nKernel Stats ────────────────────────────────────────────────────────────────────\n│ RunQueue              3   Load Average    CPU use since boot time\n│ ContextSwitch    2735.0    1 mins  0.54    Uptime Days=  0 Hours= 7 Mins=58\n│ Forks               0.5    5 mins  0.86    Idle   Days=  1 Hours= 1 Mins=36\n│ Interrupts        836.9   15 mins  0.92    Average CPU use=-221.51%\n\n```\n\n## 2. ethstatus\n`ethstatus`可以实时监控网卡的带宽占用。\n\n```\n───────────────────.EthStatus v0.4a.──────────────────────────────[0/910]──────────────────────│\n│                                                                                              │\n│                                                                                              │\n│                      ######                                                                  │\n│                                                                                              │\n│         ###                                                                                  │\n│        ON/OFF                      RX  TX                                                    │\n│                            0.00 B/s   0 Packets/s                                            │\n│                                                                                              │\n│                                                                                              │\n│     IP Address:          192.168.1.116                                                       │\n│     Interface name:      wlan0         Graphic Using Speed:    9.77 MB/s                     │\n│     Top Speed:           732.00 B/s    Top Packets/s:          5                             │\n│     Received Packets:    593428        Transmited Packets:     437965                        │\n│     Received:            399.68 MB     Transmitted:            54.73 MB                      │\n│     Errors on Receiving: 0             Errors on Transmission: 0                             │\n│                                                                                              │\n│                                                                                              │\n\n```\n\n## 3. iftop监控网卡实时流量\n常用参数列表\n\n| 参数 | 含义                                            | 例子                          |\n| --   | --                                              | --                            |\n| -i   | 指定需要监测的网卡                              | sudo iftop -i wlan0           |\n| -n   | 将输出的主机信息都通过ip显示，不进行DNS方向解析 | sudo iftop -n -i wlan0        |\n| -B   | 将输出以byte为单位显示网卡流量，默认是bit       | sudo iftop -B -i wlan0        |\n| -p   | 以混杂模式运行iftop,此时iftop可以作为网络嗅探器 | sudo iftop -p -i wlan0        |\n| -N   | 只显示链接端口号，不显示对应的服务名称          | sudo iftop -N -i wlan0        |\n| -P   | 显示主机及端口信息                              | sudo iftop -P -i wlan0        |\n| -F   | 显示特定网段的网卡进出流量                      | sudo iftop -F 192.168.1.10/24 |\n\n```\n                    12.5kb              25.0kb               37.5kb              50.0kb         [0/37]\n+-------------------+-------------------+--------------------+-------------------+--------------------\n192.168.1.116                         => 101.227.160.102                       17.6kb  3.55kb  1.90kb \n                                      <=                                       7.29kb  1.50kb   807b\n224.0.0.251                           => 192.168.1.165                            0b      0b      0b  \n                                      <=                                       1.72kb  2.21kb   566b\n192.168.1.116                         => 140.206.160.161                       4.89kb  0.98kb  1.21kb\n                                      <=                                       1.18kb   242b    302b\n192.168.1.116                         => 192.168.1.1                              0b    112b     96b  \n                                      <=                                          0b    378b    254b\n239.255.255.250                       => 192.168.1.148                            0b      0b      0b\n                                      <=                                       1.19kb   486b    730b\n224.0.0.251                           => 192.168.1.166                            0b      0b      0b\n                                      <=                                        272b     54b     14b\n192.168.1.165                         => all-routers.mcast.net                    0b     26b      6b\n                                      <=                                          0b      0b      0b\n192.168.1.116                         => 101.226.76.164                           0b      0b   2.11kb\n                                      <=                                          0b      0b    752b  \n192.168.1.116                         => dev                                      0b      0b   1.50kb\n                                      <=                                          0b      0b    544b\n192.168.1.116                         => stage                                    0b      0b   1.40kb\n                                      <=                                          0b      0b    504b\n239.255.255.250                       => 192.168.1.135                            0b      0b      0b\n                                      <=                                          0b      0b    161b\n239.255.255.250                       => 192.168.1.113                            0b      0b      0b\n                                      <=                                          0b      0b    160b\n------------------------------------------------------------------------------------------------------\nTX:             cum:   51.5kB   peak:   44.7kb                        rates:   22.4kb  4.64kb  8.27kb\nRX:                    46.8kB           28.5kb                                 11.6kb  4.87kb  4.94kb\nTOTAL:                 98.4kB           73.2kb                                 34.1kb  9.51kb  13.2kb\n```\n\n## 4. mtr\nmtr是Linux中有一个非常棒的网络连通性判断工具,它结合了`ping`，`traceroute`，`nslookup`的相关特性。\n相对于其他命令仅仅收集传输路径或响应时间，MTR 工具会收集更多的信息，比如 连接状态，连接可用性，以及传输路径中主机的响应性。\n\n常用参数\n\n| 参数       | 说明                                          |\n| --         | --                                            |\n| -s         | 用来指定ping数据包的大小                      |\n| `--no-dns` | 不对IP地址做域名解析                          |\n| -a         | 使用这个参数来设置ICMP返回之间的要求默认是1秒 |\n| `--report` | 给主机发送10个ICMP包，然后输出报告            |\n\n\n```\n                    My traceroute  [v0.85]                                     [0/102]\nlocalhost (0.0.0.0)                            Sun Mar 26 20:25:43 2017\nKeys:  Help   Display mode   Restart statistics   Order of fields   quit\n                                            Packets               Pings\n Host                                    Loss%   Snt   Last   Avg  Best  Wrst StDev\n 1. 192.168.0.1                           0.0%     8    1.5   2.3   1.3   4.3   0.8\n 2. 192.168.1.1                           0.0%     8    1.7   4.6   1.7  13.7   5.2\n 3. 114.245.248.1                         0.0%     8   78.3 108.3   3.7 363.8 149.8\n 4. 123.126.26.45                         0.0%     8    7.9  19.6   3.8  76.7  26.3\n 5. 61.148.158.53                         0.0%     8    7.2  12.2   5.1  31.6   9.2\n 6. 61.51.115.106                         0.0%     8   78.8  15.4   4.6  78.8  25.7\n 7. 61.49.168.110                         0.0%     8    4.9   7.1   4.8  12.8   2.7\n 8. ???\n 9. ???\n10. 61.135.169.121                        0.0%     7    4.3   5.9   4.2  10.9   2.2\n\n```\n**说明**\n当分析mtr的输出时，需要注意两点:loss和latency\n如果你在任何一跳上看到loss的百分比，这就说明这一跳上可能有问题。当然也有可能是服务提供商人为限制了ICMP发送的速率，也会导致丢包。如果下一跳没有丢包，那说明该丢包是人为限制的。\n如果第4跳和第5跳都有50%的丢包率，从接下来的几跳都有丢包现象，所以不像是人为限制 ICMP 速率的原因。但是最后几跳都是30%的丢包率，我们可以猜测30%的丢包率除了网络糟糕的原因之前还有人为限制ICMP。所以，当我们看到不同的丢包率时，通常要以最后几跳为准。当出现短暂的10%丢包率的时候，不必担心，应用层的程序会弥补这点损失。\n\n## 5. htop\n常用功能键\n\n| 按键 | 说明                                       |\n| --   | --                                         |\n| F1   | 帮助                                       |\n| F2   | 设置                                       |\n| F3   | 搜索进程                                   |\n| F4   | 过滤器，按关键字搜索                       |\n| F5   | 显示树形结构                               |\n| F6   | 选择排序方式                               |\n| F7   | 减少nice值，可以提高对应进程的优先级       |\n| F8   | 增加nice值，可以降低对应进程的优先级       |\n| F9   | 杀掉选中的进程                             |\n| F10  | 退出                                       |\n| /    | 搜索字符                                   |\n| h    | 显示帮助                                   |\n| l    | 显示进程打开的文件 lsof                    |\n| u    | 显示所有用户，并可以选择某一特定用户的进程 |\n| s    | 将调用strace追踪进程的系统调用             |\n| t    | 显示树形结构                               |\n| H    | 显示/隐藏用户线程                          |\n| I    | 倒转排序                                   |\n| K    | 显示/隐藏内核线程                          |\n| M    | 按内存占用排序                             |\n| P    | 按CPU排序                                  |\n| T    | 按运行时间排序                             |\n\nhtop的左上角显示CPU、内存、交换区的使用情况，右边显示任务、负载、开机时间，下面是进程实时状态。\n最后一行是F1～F10的功能菜单和对应的字符快捷键。\n\n## 6. linux系统性能分析\n分析次序为cpu mem disk network\n","source":"_posts/linux系统监控基本命令.md","raw":"---\ntitle: linux系统监控基本命令\ndate: 2017-03-25 17:09:57\ntags: linux\n---\n\n## 1. nmon软件\n\n### 1.1 运行nmon软件\n\n```\n:~$ nmon \n```\n\n```\n┌nmon─14g──────[H for help]───Hostname=localhost────Refresh= 2secs ───16:48.29────────────────────────┐\n------------------------------       For help type H or ...                                           │\n│  #    #  #    #   ####   #    #        nmon -?  - hint                                              │\n│  ##   #  ##  ##  #    #  ##   #        nmon -h  - full                                              │\n│  # #  #  # ## #  #    #  # #  #                                                                     │\n│  #  # #  #    #  #    #  #  # #       To start the same way every time                              │\n│  #   ##  #    #  #    #  #   ##        set the NMON ksh variable                                    │\n│  #    #  #    #   ####   #    #                                                                     │\n│  ------------------------------                                                                     │\n│                                                                                                     │\n│  Use these keys to toggle statistics on/off:                                                        │\n│     c = CPU        l = CPU Long-term   - = Faster screen updates                                    │\n│     m = Memory     j = Filesystems     + = Slower screen updates                                    │\n│     d = Disks      n = Network         V = Virtual Memory                                           │\n│     r = Resource   N = NFS             v = Verbose hints                                            │\n│     k = kernel     t = Top-processes   . = only busy disks/procs                                    │\n│     h = more options                 q = Quit                                                       │\n│─────────────────────────────────────────────────────────────────────────────────────────────────────│\n```\n\n\n### 1.2 显示CPU信息\n\n```\n│ CPU Utilisation ──────────────────────────────────────────────────────────────\n│---------------------------+-------------------------------------------------+\n│CPU  User%  Sys% Wait% Idle|0          |25         |50          |75       100|\n│  1  15.2   1.5   0.0  83.2|UUUUUUU           >                              |\n│  2   7.1   2.6   0.0  90.3|UUUs             >                               |\n│  3  17.5   1.0   0.5  81.0|UUUUUUUU        >                                |\n│  4  13.6   3.0   0.0  83.3|UUUUUUs            >                             |\n│---------------------------+-------------------------------------------------+\n│Avg  13.4   2.1   0.3  84.3|UUUUUUs        >                                 |\n│---------------------------+-------------------------------------------------+\n\n```\n\n### 1.3 显示内存信息\n```\n│ Memory Stats ──────────────────────────────────────────────────────────────────\n                RAM     High      Low     Swap    Page Size=4 KB\n│ Total MB      7843.5     -0.0     -0.0   3916.0\n│ Free  MB      1259.8     -0.0     -0.0   3915.6\n│ Free Percent    16.1%   100.0%   100.0%   100.0%\n│             MB                  MB                  MB\n│                      Cached=  2912.7     Active=  3842.7\n│ Buffers=   929.4 Swapcached=     0.0  Inactive =  1789.8\n│ Dirty  =     0.1 Writeback =     0.0  Mapped   =   946.5\n│ Slab   =   799.7 Commit_AS =  6624.9 PageTables=    40.2\n\n```\n\n### 1.4 显示磁盘信息\n\n```\n Disk I/O ──/proc/diskstats────mostly in KB/s─────Warning:contains duplicates────\n│DiskName Busy  Read WriteKB|0          |25         |50          |75       100|\n│sda        5%    0.0   42.0|WW>                                              |\n│sda1       0%    0.0    0.0|>                                                |\n│sda2       0%    0.0    0.0|>                                                |\n│sda5       5%    0.0   42.0|WW>                                              |\n│sda6       0%    0.0    0.0|>                                                |\n│Totals Read-MB/s=0.0      Writes-MB/s=0.1      Transfers/sec=12.0 \n\n```\n\n### 1.5 显示网络信息\n\n```\n Network I/O ────────────────────────────────────────────────────────────────────\n│I/F Name Recv=KB/s Trans=KB/s packin packout insize outsize Peak->Recv Trans \n│      lo     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 \n│   wlan0     0.1     0.0       0.5      0.0   215.0    0.0        0.1     0.0 \n│ docker0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 \n│    eth0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0\n│ Network Error Counters ─────────────────────────────────────────────────────────\n│I/F Name iErrors iDrop iOverrun iFrame oErrors   oDrop oOverrun oCarrier oColls\n│      lo       0       0       0       0       0       0       0       0       0\n│   wlan0       0       0       0       0       0       0       0       0       0\n│ docker0       0       0       0       0       0       0       0       0       0\n│    eth0       0       0       0       0       0       0       0       0       0\n```\n\n### 1.6 显示内核信息\n```\nKernel Stats ────────────────────────────────────────────────────────────────────\n│ RunQueue              3   Load Average    CPU use since boot time\n│ ContextSwitch    2735.0    1 mins  0.54    Uptime Days=  0 Hours= 7 Mins=58\n│ Forks               0.5    5 mins  0.86    Idle   Days=  1 Hours= 1 Mins=36\n│ Interrupts        836.9   15 mins  0.92    Average CPU use=-221.51%\n\n```\n\n## 2. ethstatus\n`ethstatus`可以实时监控网卡的带宽占用。\n\n```\n───────────────────.EthStatus v0.4a.──────────────────────────────[0/910]──────────────────────│\n│                                                                                              │\n│                                                                                              │\n│                      ######                                                                  │\n│                                                                                              │\n│         ###                                                                                  │\n│        ON/OFF                      RX  TX                                                    │\n│                            0.00 B/s   0 Packets/s                                            │\n│                                                                                              │\n│                                                                                              │\n│     IP Address:          192.168.1.116                                                       │\n│     Interface name:      wlan0         Graphic Using Speed:    9.77 MB/s                     │\n│     Top Speed:           732.00 B/s    Top Packets/s:          5                             │\n│     Received Packets:    593428        Transmited Packets:     437965                        │\n│     Received:            399.68 MB     Transmitted:            54.73 MB                      │\n│     Errors on Receiving: 0             Errors on Transmission: 0                             │\n│                                                                                              │\n│                                                                                              │\n\n```\n\n## 3. iftop监控网卡实时流量\n常用参数列表\n\n| 参数 | 含义                                            | 例子                          |\n| --   | --                                              | --                            |\n| -i   | 指定需要监测的网卡                              | sudo iftop -i wlan0           |\n| -n   | 将输出的主机信息都通过ip显示，不进行DNS方向解析 | sudo iftop -n -i wlan0        |\n| -B   | 将输出以byte为单位显示网卡流量，默认是bit       | sudo iftop -B -i wlan0        |\n| -p   | 以混杂模式运行iftop,此时iftop可以作为网络嗅探器 | sudo iftop -p -i wlan0        |\n| -N   | 只显示链接端口号，不显示对应的服务名称          | sudo iftop -N -i wlan0        |\n| -P   | 显示主机及端口信息                              | sudo iftop -P -i wlan0        |\n| -F   | 显示特定网段的网卡进出流量                      | sudo iftop -F 192.168.1.10/24 |\n\n```\n                    12.5kb              25.0kb               37.5kb              50.0kb         [0/37]\n+-------------------+-------------------+--------------------+-------------------+--------------------\n192.168.1.116                         => 101.227.160.102                       17.6kb  3.55kb  1.90kb \n                                      <=                                       7.29kb  1.50kb   807b\n224.0.0.251                           => 192.168.1.165                            0b      0b      0b  \n                                      <=                                       1.72kb  2.21kb   566b\n192.168.1.116                         => 140.206.160.161                       4.89kb  0.98kb  1.21kb\n                                      <=                                       1.18kb   242b    302b\n192.168.1.116                         => 192.168.1.1                              0b    112b     96b  \n                                      <=                                          0b    378b    254b\n239.255.255.250                       => 192.168.1.148                            0b      0b      0b\n                                      <=                                       1.19kb   486b    730b\n224.0.0.251                           => 192.168.1.166                            0b      0b      0b\n                                      <=                                        272b     54b     14b\n192.168.1.165                         => all-routers.mcast.net                    0b     26b      6b\n                                      <=                                          0b      0b      0b\n192.168.1.116                         => 101.226.76.164                           0b      0b   2.11kb\n                                      <=                                          0b      0b    752b  \n192.168.1.116                         => dev                                      0b      0b   1.50kb\n                                      <=                                          0b      0b    544b\n192.168.1.116                         => stage                                    0b      0b   1.40kb\n                                      <=                                          0b      0b    504b\n239.255.255.250                       => 192.168.1.135                            0b      0b      0b\n                                      <=                                          0b      0b    161b\n239.255.255.250                       => 192.168.1.113                            0b      0b      0b\n                                      <=                                          0b      0b    160b\n------------------------------------------------------------------------------------------------------\nTX:             cum:   51.5kB   peak:   44.7kb                        rates:   22.4kb  4.64kb  8.27kb\nRX:                    46.8kB           28.5kb                                 11.6kb  4.87kb  4.94kb\nTOTAL:                 98.4kB           73.2kb                                 34.1kb  9.51kb  13.2kb\n```\n\n## 4. mtr\nmtr是Linux中有一个非常棒的网络连通性判断工具,它结合了`ping`，`traceroute`，`nslookup`的相关特性。\n相对于其他命令仅仅收集传输路径或响应时间，MTR 工具会收集更多的信息，比如 连接状态，连接可用性，以及传输路径中主机的响应性。\n\n常用参数\n\n| 参数       | 说明                                          |\n| --         | --                                            |\n| -s         | 用来指定ping数据包的大小                      |\n| `--no-dns` | 不对IP地址做域名解析                          |\n| -a         | 使用这个参数来设置ICMP返回之间的要求默认是1秒 |\n| `--report` | 给主机发送10个ICMP包，然后输出报告            |\n\n\n```\n                    My traceroute  [v0.85]                                     [0/102]\nlocalhost (0.0.0.0)                            Sun Mar 26 20:25:43 2017\nKeys:  Help   Display mode   Restart statistics   Order of fields   quit\n                                            Packets               Pings\n Host                                    Loss%   Snt   Last   Avg  Best  Wrst StDev\n 1. 192.168.0.1                           0.0%     8    1.5   2.3   1.3   4.3   0.8\n 2. 192.168.1.1                           0.0%     8    1.7   4.6   1.7  13.7   5.2\n 3. 114.245.248.1                         0.0%     8   78.3 108.3   3.7 363.8 149.8\n 4. 123.126.26.45                         0.0%     8    7.9  19.6   3.8  76.7  26.3\n 5. 61.148.158.53                         0.0%     8    7.2  12.2   5.1  31.6   9.2\n 6. 61.51.115.106                         0.0%     8   78.8  15.4   4.6  78.8  25.7\n 7. 61.49.168.110                         0.0%     8    4.9   7.1   4.8  12.8   2.7\n 8. ???\n 9. ???\n10. 61.135.169.121                        0.0%     7    4.3   5.9   4.2  10.9   2.2\n\n```\n**说明**\n当分析mtr的输出时，需要注意两点:loss和latency\n如果你在任何一跳上看到loss的百分比，这就说明这一跳上可能有问题。当然也有可能是服务提供商人为限制了ICMP发送的速率，也会导致丢包。如果下一跳没有丢包，那说明该丢包是人为限制的。\n如果第4跳和第5跳都有50%的丢包率，从接下来的几跳都有丢包现象，所以不像是人为限制 ICMP 速率的原因。但是最后几跳都是30%的丢包率，我们可以猜测30%的丢包率除了网络糟糕的原因之前还有人为限制ICMP。所以，当我们看到不同的丢包率时，通常要以最后几跳为准。当出现短暂的10%丢包率的时候，不必担心，应用层的程序会弥补这点损失。\n\n## 5. htop\n常用功能键\n\n| 按键 | 说明                                       |\n| --   | --                                         |\n| F1   | 帮助                                       |\n| F2   | 设置                                       |\n| F3   | 搜索进程                                   |\n| F4   | 过滤器，按关键字搜索                       |\n| F5   | 显示树形结构                               |\n| F6   | 选择排序方式                               |\n| F7   | 减少nice值，可以提高对应进程的优先级       |\n| F8   | 增加nice值，可以降低对应进程的优先级       |\n| F9   | 杀掉选中的进程                             |\n| F10  | 退出                                       |\n| /    | 搜索字符                                   |\n| h    | 显示帮助                                   |\n| l    | 显示进程打开的文件 lsof                    |\n| u    | 显示所有用户，并可以选择某一特定用户的进程 |\n| s    | 将调用strace追踪进程的系统调用             |\n| t    | 显示树形结构                               |\n| H    | 显示/隐藏用户线程                          |\n| I    | 倒转排序                                   |\n| K    | 显示/隐藏内核线程                          |\n| M    | 按内存占用排序                             |\n| P    | 按CPU排序                                  |\n| T    | 按运行时间排序                             |\n\nhtop的左上角显示CPU、内存、交换区的使用情况，右边显示任务、负载、开机时间，下面是进程实时状态。\n最后一行是F1～F10的功能菜单和对应的字符快捷键。\n\n## 6. linux系统性能分析\n分析次序为cpu mem disk network\n","slug":"linux系统监控基本命令","published":1,"updated":"2017-03-27T13:25:05.932Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4y0016zahi6ax7jx37","content":"<h2 id=\"1-nmon软件\"><a href=\"#1-nmon软件\" class=\"headerlink\" title=\"1. nmon软件\"></a>1. nmon软件</h2><h3 id=\"1-1-运行nmon软件\"><a href=\"#1-1-运行nmon软件\" class=\"headerlink\" title=\"1.1 运行nmon软件\"></a>1.1 运行nmon软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ nmon</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">┌nmon─14g──────[H for help]───Hostname=localhost────Refresh= 2secs ───16:48.29────────────────────────┐</span><br><span class=\"line\">------------------------------       For help type H or ...                                           │</span><br><span class=\"line\">│  #    #  #    #   ####   #    #        nmon -?  - hint                                              │</span><br><span class=\"line\">│  ##   #  ##  ##  #    #  ##   #        nmon -h  - full                                              │</span><br><span class=\"line\">│  # #  #  # ## #  #    #  # #  #                                                                     │</span><br><span class=\"line\">│  #  # #  #    #  #    #  #  # #       To start the same way every time                              │</span><br><span class=\"line\">│  #   ##  #    #  #    #  #   ##        set the NMON ksh variable                                    │</span><br><span class=\"line\">│  #    #  #    #   ####   #    #                                                                     │</span><br><span class=\"line\">│  ------------------------------                                                                     │</span><br><span class=\"line\">│                                                                                                     │</span><br><span class=\"line\">│  Use these keys to toggle statistics on/off:                                                        │</span><br><span class=\"line\">│     c = CPU        l = CPU Long-term   - = Faster screen updates                                    │</span><br><span class=\"line\">│     m = Memory     j = Filesystems     + = Slower screen updates                                    │</span><br><span class=\"line\">│     d = Disks      n = Network         V = Virtual Memory                                           │</span><br><span class=\"line\">│     r = Resource   N = NFS             v = Verbose hints                                            │</span><br><span class=\"line\">│     k = kernel     t = Top-processes   . = only busy disks/procs                                    │</span><br><span class=\"line\">│     h = more options                 q = Quit                                                       │</span><br><span class=\"line\">│─────────────────────────────────────────────────────────────────────────────────────────────────────│</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-显示CPU信息\"><a href=\"#1-2-显示CPU信息\" class=\"headerlink\" title=\"1.2 显示CPU信息\"></a>1.2 显示CPU信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│ CPU Utilisation ──────────────────────────────────────────────────────────────</span><br><span class=\"line\">│---------------------------+-------------------------------------------------+</span><br><span class=\"line\">│CPU  User%  Sys% Wait% Idle|0          |25         |50          |75       100|</span><br><span class=\"line\">│  1  15.2   1.5   0.0  83.2|UUUUUUU           &gt;                              |</span><br><span class=\"line\">│  2   7.1   2.6   0.0  90.3|UUUs             &gt;                               |</span><br><span class=\"line\">│  3  17.5   1.0   0.5  81.0|UUUUUUUU        &gt;                                |</span><br><span class=\"line\">│  4  13.6   3.0   0.0  83.3|UUUUUUs            &gt;                             |</span><br><span class=\"line\">│---------------------------+-------------------------------------------------+</span><br><span class=\"line\">│Avg  13.4   2.1   0.3  84.3|UUUUUUs        &gt;                                 |</span><br><span class=\"line\">│---------------------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-3-显示内存信息\"><a href=\"#1-3-显示内存信息\" class=\"headerlink\" title=\"1.3 显示内存信息\"></a>1.3 显示内存信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│ Memory Stats ──────────────────────────────────────────────────────────────────</span><br><span class=\"line\">                RAM     High      Low     Swap    Page Size=4 KB</span><br><span class=\"line\">│ Total MB      7843.5     -0.0     -0.0   3916.0</span><br><span class=\"line\">│ Free  MB      1259.8     -0.0     -0.0   3915.6</span><br><span class=\"line\">│ Free Percent    16.1%   100.0%   100.0%   100.0%</span><br><span class=\"line\">│             MB                  MB                  MB</span><br><span class=\"line\">│                      Cached=  2912.7     Active=  3842.7</span><br><span class=\"line\">│ Buffers=   929.4 Swapcached=     0.0  Inactive =  1789.8</span><br><span class=\"line\">│ Dirty  =     0.1 Writeback =     0.0  Mapped   =   946.5</span><br><span class=\"line\">│ Slab   =   799.7 Commit_AS =  6624.9 PageTables=    40.2</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-4-显示磁盘信息\"><a href=\"#1-4-显示磁盘信息\" class=\"headerlink\" title=\"1.4 显示磁盘信息\"></a>1.4 显示磁盘信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Disk I/O ──/proc/diskstats────mostly in KB/s─────Warning:contains duplicates────</span><br><span class=\"line\">│DiskName Busy  Read WriteKB|0          |25         |50          |75       100|</span><br><span class=\"line\">│sda        5%    0.0   42.0|WW&gt;                                              |</span><br><span class=\"line\">│sda1       0%    0.0    0.0|&gt;                                                |</span><br><span class=\"line\">│sda2       0%    0.0    0.0|&gt;                                                |</span><br><span class=\"line\">│sda5       5%    0.0   42.0|WW&gt;                                              |</span><br><span class=\"line\">│sda6       0%    0.0    0.0|&gt;                                                |</span><br><span class=\"line\">│Totals Read-MB/s=0.0      Writes-MB/s=0.1      Transfers/sec=12.0</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-5-显示网络信息\"><a href=\"#1-5-显示网络信息\" class=\"headerlink\" title=\"1.5 显示网络信息\"></a>1.5 显示网络信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Network I/O ────────────────────────────────────────────────────────────────────</span><br><span class=\"line\">│I/F Name Recv=KB/s Trans=KB/s packin packout insize outsize Peak-&gt;Recv Trans </span><br><span class=\"line\">│      lo     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 </span><br><span class=\"line\">│   wlan0     0.1     0.0       0.5      0.0   215.0    0.0        0.1     0.0 </span><br><span class=\"line\">│ docker0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 </span><br><span class=\"line\">│    eth0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0</span><br><span class=\"line\">│ Network Error Counters ─────────────────────────────────────────────────────────</span><br><span class=\"line\">│I/F Name iErrors iDrop iOverrun iFrame oErrors   oDrop oOverrun oCarrier oColls</span><br><span class=\"line\">│      lo       0       0       0       0       0       0       0       0       0</span><br><span class=\"line\">│   wlan0       0       0       0       0       0       0       0       0       0</span><br><span class=\"line\">│ docker0       0       0       0       0       0       0       0       0       0</span><br><span class=\"line\">│    eth0       0       0       0       0       0       0       0       0       0</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-6-显示内核信息\"><a href=\"#1-6-显示内核信息\" class=\"headerlink\" title=\"1.6 显示内核信息\"></a>1.6 显示内核信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Kernel Stats ────────────────────────────────────────────────────────────────────</span><br><span class=\"line\">│ RunQueue              3   Load Average    CPU use since boot time</span><br><span class=\"line\">│ ContextSwitch    2735.0    1 mins  0.54    Uptime Days=  0 Hours= 7 Mins=58</span><br><span class=\"line\">│ Forks               0.5    5 mins  0.86    Idle   Days=  1 Hours= 1 Mins=36</span><br><span class=\"line\">│ Interrupts        836.9   15 mins  0.92    Average CPU use=-221.51%</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-ethstatus\"><a href=\"#2-ethstatus\" class=\"headerlink\" title=\"2. ethstatus\"></a>2. ethstatus</h2><p><code>ethstatus</code>可以实时监控网卡的带宽占用。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">───────────────────.EthStatus v0.4a.──────────────────────────────[0/910]──────────────────────│</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                      ######                                                                  │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│         ###                                                                                  │</span><br><span class=\"line\">│        ON/OFF                      RX  TX                                                    │</span><br><span class=\"line\">│                            0.00 B/s   0 Packets/s                                            │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│     IP Address:          192.168.1.116                                                       │</span><br><span class=\"line\">│     Interface name:      wlan0         Graphic Using Speed:    9.77 MB/s                     │</span><br><span class=\"line\">│     Top Speed:           732.00 B/s    Top Packets/s:          5                             │</span><br><span class=\"line\">│     Received Packets:    593428        Transmited Packets:     437965                        │</span><br><span class=\"line\">│     Received:            399.68 MB     Transmitted:            54.73 MB                      │</span><br><span class=\"line\">│     Errors on Receiving: 0             Errors on Transmission: 0                             │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                                                                                              │</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-iftop监控网卡实时流量\"><a href=\"#3-iftop监控网卡实时流量\" class=\"headerlink\" title=\"3. iftop监控网卡实时流量\"></a>3. iftop监控网卡实时流量</h2><p>常用参数列表</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>含义</th>\n<th>例子</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-i</td>\n<td>指定需要监测的网卡</td>\n<td>sudo iftop -i wlan0</td>\n</tr>\n<tr>\n<td>-n</td>\n<td>将输出的主机信息都通过ip显示，不进行DNS方向解析</td>\n<td>sudo iftop -n -i wlan0</td>\n</tr>\n<tr>\n<td>-B</td>\n<td>将输出以byte为单位显示网卡流量，默认是bit</td>\n<td>sudo iftop -B -i wlan0</td>\n</tr>\n<tr>\n<td>-p</td>\n<td>以混杂模式运行iftop,此时iftop可以作为网络嗅探器</td>\n<td>sudo iftop -p -i wlan0</td>\n</tr>\n<tr>\n<td>-N</td>\n<td>只显示链接端口号，不显示对应的服务名称</td>\n<td>sudo iftop -N -i wlan0</td>\n</tr>\n<tr>\n<td>-P</td>\n<td>显示主机及端口信息</td>\n<td>sudo iftop -P -i wlan0</td>\n</tr>\n<tr>\n<td>-F</td>\n<td>显示特定网段的网卡进出流量</td>\n<td>sudo iftop -F 192.168.1.10/24</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                    12.5kb              25.0kb               37.5kb              50.0kb         [0/37]</span><br><span class=\"line\">+-------------------+-------------------+--------------------+-------------------+--------------------</span><br><span class=\"line\">192.168.1.116                         =&gt; 101.227.160.102                       17.6kb  3.55kb  1.90kb </span><br><span class=\"line\">                                      &lt;=                                       7.29kb  1.50kb   807b</span><br><span class=\"line\">224.0.0.251                           =&gt; 192.168.1.165                            0b      0b      0b  </span><br><span class=\"line\">                                      &lt;=                                       1.72kb  2.21kb   566b</span><br><span class=\"line\">192.168.1.116                         =&gt; 140.206.160.161                       4.89kb  0.98kb  1.21kb</span><br><span class=\"line\">                                      &lt;=                                       1.18kb   242b    302b</span><br><span class=\"line\">192.168.1.116                         =&gt; 192.168.1.1                              0b    112b     96b  </span><br><span class=\"line\">                                      &lt;=                                          0b    378b    254b</span><br><span class=\"line\">239.255.255.250                       =&gt; 192.168.1.148                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                       1.19kb   486b    730b</span><br><span class=\"line\">224.0.0.251                           =&gt; 192.168.1.166                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                        272b     54b     14b</span><br><span class=\"line\">192.168.1.165                         =&gt; all-routers.mcast.net                    0b     26b      6b</span><br><span class=\"line\">                                      &lt;=                                          0b      0b      0b</span><br><span class=\"line\">192.168.1.116                         =&gt; 101.226.76.164                           0b      0b   2.11kb</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    752b  </span><br><span class=\"line\">192.168.1.116                         =&gt; dev                                      0b      0b   1.50kb</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    544b</span><br><span class=\"line\">192.168.1.116                         =&gt; stage                                    0b      0b   1.40kb</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    504b</span><br><span class=\"line\">239.255.255.250                       =&gt; 192.168.1.135                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    161b</span><br><span class=\"line\">239.255.255.250                       =&gt; 192.168.1.113                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    160b</span><br><span class=\"line\">------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">TX:             cum:   51.5kB   peak:   44.7kb                        rates:   22.4kb  4.64kb  8.27kb</span><br><span class=\"line\">RX:                    46.8kB           28.5kb                                 11.6kb  4.87kb  4.94kb</span><br><span class=\"line\">TOTAL:                 98.4kB           73.2kb                                 34.1kb  9.51kb  13.2kb</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-mtr\"><a href=\"#4-mtr\" class=\"headerlink\" title=\"4. mtr\"></a>4. mtr</h2><p>mtr是Linux中有一个非常棒的网络连通性判断工具,它结合了<code>ping</code>，<code>traceroute</code>，<code>nslookup</code>的相关特性。<br>相对于其他命令仅仅收集传输路径或响应时间，MTR 工具会收集更多的信息，比如 连接状态，连接可用性，以及传输路径中主机的响应性。</p>\n<p>常用参数</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-s</td>\n<td>用来指定ping数据包的大小</td>\n</tr>\n<tr>\n<td><code>--no-dns</code></td>\n<td>不对IP地址做域名解析</td>\n</tr>\n<tr>\n<td>-a</td>\n<td>使用这个参数来设置ICMP返回之间的要求默认是1秒</td>\n</tr>\n<tr>\n<td><code>--report</code></td>\n<td>给主机发送10个ICMP包，然后输出报告</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                    My traceroute  [v0.85]                                     [0/102]</span><br><span class=\"line\">localhost (0.0.0.0)                            Sun Mar 26 20:25:43 2017</span><br><span class=\"line\">Keys:  Help   Display mode   Restart statistics   Order of fields   quit</span><br><span class=\"line\">                                            Packets               Pings</span><br><span class=\"line\"> Host                                    Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class=\"line\"> 1. 192.168.0.1                           0.0%     8    1.5   2.3   1.3   4.3   0.8</span><br><span class=\"line\"> 2. 192.168.1.1                           0.0%     8    1.7   4.6   1.7  13.7   5.2</span><br><span class=\"line\"> 3. 114.245.248.1                         0.0%     8   78.3 108.3   3.7 363.8 149.8</span><br><span class=\"line\"> 4. 123.126.26.45                         0.0%     8    7.9  19.6   3.8  76.7  26.3</span><br><span class=\"line\"> 5. 61.148.158.53                         0.0%     8    7.2  12.2   5.1  31.6   9.2</span><br><span class=\"line\"> 6. 61.51.115.106                         0.0%     8   78.8  15.4   4.6  78.8  25.7</span><br><span class=\"line\"> 7. 61.49.168.110                         0.0%     8    4.9   7.1   4.8  12.8   2.7</span><br><span class=\"line\"> 8. ???</span><br><span class=\"line\"> 9. ???</span><br><span class=\"line\">10. 61.135.169.121                        0.0%     7    4.3   5.9   4.2  10.9   2.2</span><br></pre></td></tr></table></figure>\n<p><strong>说明</strong><br>当分析mtr的输出时，需要注意两点:loss和latency<br>如果你在任何一跳上看到loss的百分比，这就说明这一跳上可能有问题。当然也有可能是服务提供商人为限制了ICMP发送的速率，也会导致丢包。如果下一跳没有丢包，那说明该丢包是人为限制的。<br>如果第4跳和第5跳都有50%的丢包率，从接下来的几跳都有丢包现象，所以不像是人为限制 ICMP 速率的原因。但是最后几跳都是30%的丢包率，我们可以猜测30%的丢包率除了网络糟糕的原因之前还有人为限制ICMP。所以，当我们看到不同的丢包率时，通常要以最后几跳为准。当出现短暂的10%丢包率的时候，不必担心，应用层的程序会弥补这点损失。</p>\n<h2 id=\"5-htop\"><a href=\"#5-htop\" class=\"headerlink\" title=\"5. htop\"></a>5. htop</h2><p>常用功能键</p>\n<table>\n<thead>\n<tr>\n<th>按键</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>F1</td>\n<td>帮助</td>\n</tr>\n<tr>\n<td>F2</td>\n<td>设置</td>\n</tr>\n<tr>\n<td>F3</td>\n<td>搜索进程</td>\n</tr>\n<tr>\n<td>F4</td>\n<td>过滤器，按关键字搜索</td>\n</tr>\n<tr>\n<td>F5</td>\n<td>显示树形结构</td>\n</tr>\n<tr>\n<td>F6</td>\n<td>选择排序方式</td>\n</tr>\n<tr>\n<td>F7</td>\n<td>减少nice值，可以提高对应进程的优先级</td>\n</tr>\n<tr>\n<td>F8</td>\n<td>增加nice值，可以降低对应进程的优先级</td>\n</tr>\n<tr>\n<td>F9</td>\n<td>杀掉选中的进程</td>\n</tr>\n<tr>\n<td>F10</td>\n<td>退出</td>\n</tr>\n<tr>\n<td>/</td>\n<td>搜索字符</td>\n</tr>\n<tr>\n<td>h</td>\n<td>显示帮助</td>\n</tr>\n<tr>\n<td>l</td>\n<td>显示进程打开的文件 lsof</td>\n</tr>\n<tr>\n<td>u</td>\n<td>显示所有用户，并可以选择某一特定用户的进程</td>\n</tr>\n<tr>\n<td>s</td>\n<td>将调用strace追踪进程的系统调用</td>\n</tr>\n<tr>\n<td>t</td>\n<td>显示树形结构</td>\n</tr>\n<tr>\n<td>H</td>\n<td>显示/隐藏用户线程</td>\n</tr>\n<tr>\n<td>I</td>\n<td>倒转排序</td>\n</tr>\n<tr>\n<td>K</td>\n<td>显示/隐藏内核线程</td>\n</tr>\n<tr>\n<td>M</td>\n<td>按内存占用排序</td>\n</tr>\n<tr>\n<td>P</td>\n<td>按CPU排序</td>\n</tr>\n<tr>\n<td>T</td>\n<td>按运行时间排序</td>\n</tr>\n</tbody>\n</table>\n<p>htop的左上角显示CPU、内存、交换区的使用情况，右边显示任务、负载、开机时间，下面是进程实时状态。<br>最后一行是F1～F10的功能菜单和对应的字符快捷键。</p>\n<h2 id=\"6-linux系统性能分析\"><a href=\"#6-linux系统性能分析\" class=\"headerlink\" title=\"6. linux系统性能分析\"></a>6. linux系统性能分析</h2><p>分析次序为cpu mem disk network</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-nmon软件\"><a href=\"#1-nmon软件\" class=\"headerlink\" title=\"1. nmon软件\"></a>1. nmon软件</h2><h3 id=\"1-1-运行nmon软件\"><a href=\"#1-1-运行nmon软件\" class=\"headerlink\" title=\"1.1 运行nmon软件\"></a>1.1 运行nmon软件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:~$ nmon</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">┌nmon─14g──────[H for help]───Hostname=localhost────Refresh= 2secs ───16:48.29────────────────────────┐</span><br><span class=\"line\">------------------------------       For help type H or ...                                           │</span><br><span class=\"line\">│  #    #  #    #   ####   #    #        nmon -?  - hint                                              │</span><br><span class=\"line\">│  ##   #  ##  ##  #    #  ##   #        nmon -h  - full                                              │</span><br><span class=\"line\">│  # #  #  # ## #  #    #  # #  #                                                                     │</span><br><span class=\"line\">│  #  # #  #    #  #    #  #  # #       To start the same way every time                              │</span><br><span class=\"line\">│  #   ##  #    #  #    #  #   ##        set the NMON ksh variable                                    │</span><br><span class=\"line\">│  #    #  #    #   ####   #    #                                                                     │</span><br><span class=\"line\">│  ------------------------------                                                                     │</span><br><span class=\"line\">│                                                                                                     │</span><br><span class=\"line\">│  Use these keys to toggle statistics on/off:                                                        │</span><br><span class=\"line\">│     c = CPU        l = CPU Long-term   - = Faster screen updates                                    │</span><br><span class=\"line\">│     m = Memory     j = Filesystems     + = Slower screen updates                                    │</span><br><span class=\"line\">│     d = Disks      n = Network         V = Virtual Memory                                           │</span><br><span class=\"line\">│     r = Resource   N = NFS             v = Verbose hints                                            │</span><br><span class=\"line\">│     k = kernel     t = Top-processes   . = only busy disks/procs                                    │</span><br><span class=\"line\">│     h = more options                 q = Quit                                                       │</span><br><span class=\"line\">│─────────────────────────────────────────────────────────────────────────────────────────────────────│</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-显示CPU信息\"><a href=\"#1-2-显示CPU信息\" class=\"headerlink\" title=\"1.2 显示CPU信息\"></a>1.2 显示CPU信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│ CPU Utilisation ──────────────────────────────────────────────────────────────</span><br><span class=\"line\">│---------------------------+-------------------------------------------------+</span><br><span class=\"line\">│CPU  User%  Sys% Wait% Idle|0          |25         |50          |75       100|</span><br><span class=\"line\">│  1  15.2   1.5   0.0  83.2|UUUUUUU           &gt;                              |</span><br><span class=\"line\">│  2   7.1   2.6   0.0  90.3|UUUs             &gt;                               |</span><br><span class=\"line\">│  3  17.5   1.0   0.5  81.0|UUUUUUUU        &gt;                                |</span><br><span class=\"line\">│  4  13.6   3.0   0.0  83.3|UUUUUUs            &gt;                             |</span><br><span class=\"line\">│---------------------------+-------------------------------------------------+</span><br><span class=\"line\">│Avg  13.4   2.1   0.3  84.3|UUUUUUs        &gt;                                 |</span><br><span class=\"line\">│---------------------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-3-显示内存信息\"><a href=\"#1-3-显示内存信息\" class=\"headerlink\" title=\"1.3 显示内存信息\"></a>1.3 显示内存信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">│ Memory Stats ──────────────────────────────────────────────────────────────────</span><br><span class=\"line\">                RAM     High      Low     Swap    Page Size=4 KB</span><br><span class=\"line\">│ Total MB      7843.5     -0.0     -0.0   3916.0</span><br><span class=\"line\">│ Free  MB      1259.8     -0.0     -0.0   3915.6</span><br><span class=\"line\">│ Free Percent    16.1%   100.0%   100.0%   100.0%</span><br><span class=\"line\">│             MB                  MB                  MB</span><br><span class=\"line\">│                      Cached=  2912.7     Active=  3842.7</span><br><span class=\"line\">│ Buffers=   929.4 Swapcached=     0.0  Inactive =  1789.8</span><br><span class=\"line\">│ Dirty  =     0.1 Writeback =     0.0  Mapped   =   946.5</span><br><span class=\"line\">│ Slab   =   799.7 Commit_AS =  6624.9 PageTables=    40.2</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-4-显示磁盘信息\"><a href=\"#1-4-显示磁盘信息\" class=\"headerlink\" title=\"1.4 显示磁盘信息\"></a>1.4 显示磁盘信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Disk I/O ──/proc/diskstats────mostly in KB/s─────Warning:contains duplicates────</span><br><span class=\"line\">│DiskName Busy  Read WriteKB|0          |25         |50          |75       100|</span><br><span class=\"line\">│sda        5%    0.0   42.0|WW&gt;                                              |</span><br><span class=\"line\">│sda1       0%    0.0    0.0|&gt;                                                |</span><br><span class=\"line\">│sda2       0%    0.0    0.0|&gt;                                                |</span><br><span class=\"line\">│sda5       5%    0.0   42.0|WW&gt;                                              |</span><br><span class=\"line\">│sda6       0%    0.0    0.0|&gt;                                                |</span><br><span class=\"line\">│Totals Read-MB/s=0.0      Writes-MB/s=0.1      Transfers/sec=12.0</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-5-显示网络信息\"><a href=\"#1-5-显示网络信息\" class=\"headerlink\" title=\"1.5 显示网络信息\"></a>1.5 显示网络信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Network I/O ────────────────────────────────────────────────────────────────────</span><br><span class=\"line\">│I/F Name Recv=KB/s Trans=KB/s packin packout insize outsize Peak-&gt;Recv Trans </span><br><span class=\"line\">│      lo     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 </span><br><span class=\"line\">│   wlan0     0.1     0.0       0.5      0.0   215.0    0.0        0.1     0.0 </span><br><span class=\"line\">│ docker0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0 </span><br><span class=\"line\">│    eth0     0.0     0.0       0.0      0.0     0.0    0.0        0.0     0.0</span><br><span class=\"line\">│ Network Error Counters ─────────────────────────────────────────────────────────</span><br><span class=\"line\">│I/F Name iErrors iDrop iOverrun iFrame oErrors   oDrop oOverrun oCarrier oColls</span><br><span class=\"line\">│      lo       0       0       0       0       0       0       0       0       0</span><br><span class=\"line\">│   wlan0       0       0       0       0       0       0       0       0       0</span><br><span class=\"line\">│ docker0       0       0       0       0       0       0       0       0       0</span><br><span class=\"line\">│    eth0       0       0       0       0       0       0       0       0       0</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-6-显示内核信息\"><a href=\"#1-6-显示内核信息\" class=\"headerlink\" title=\"1.6 显示内核信息\"></a>1.6 显示内核信息</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Kernel Stats ────────────────────────────────────────────────────────────────────</span><br><span class=\"line\">│ RunQueue              3   Load Average    CPU use since boot time</span><br><span class=\"line\">│ ContextSwitch    2735.0    1 mins  0.54    Uptime Days=  0 Hours= 7 Mins=58</span><br><span class=\"line\">│ Forks               0.5    5 mins  0.86    Idle   Days=  1 Hours= 1 Mins=36</span><br><span class=\"line\">│ Interrupts        836.9   15 mins  0.92    Average CPU use=-221.51%</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-ethstatus\"><a href=\"#2-ethstatus\" class=\"headerlink\" title=\"2. ethstatus\"></a>2. ethstatus</h2><p><code>ethstatus</code>可以实时监控网卡的带宽占用。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">───────────────────.EthStatus v0.4a.──────────────────────────────[0/910]──────────────────────│</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                      ######                                                                  │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│         ###                                                                                  │</span><br><span class=\"line\">│        ON/OFF                      RX  TX                                                    │</span><br><span class=\"line\">│                            0.00 B/s   0 Packets/s                                            │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│     IP Address:          192.168.1.116                                                       │</span><br><span class=\"line\">│     Interface name:      wlan0         Graphic Using Speed:    9.77 MB/s                     │</span><br><span class=\"line\">│     Top Speed:           732.00 B/s    Top Packets/s:          5                             │</span><br><span class=\"line\">│     Received Packets:    593428        Transmited Packets:     437965                        │</span><br><span class=\"line\">│     Received:            399.68 MB     Transmitted:            54.73 MB                      │</span><br><span class=\"line\">│     Errors on Receiving: 0             Errors on Transmission: 0                             │</span><br><span class=\"line\">│                                                                                              │</span><br><span class=\"line\">│                                                                                              │</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-iftop监控网卡实时流量\"><a href=\"#3-iftop监控网卡实时流量\" class=\"headerlink\" title=\"3. iftop监控网卡实时流量\"></a>3. iftop监控网卡实时流量</h2><p>常用参数列表</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>含义</th>\n<th>例子</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-i</td>\n<td>指定需要监测的网卡</td>\n<td>sudo iftop -i wlan0</td>\n</tr>\n<tr>\n<td>-n</td>\n<td>将输出的主机信息都通过ip显示，不进行DNS方向解析</td>\n<td>sudo iftop -n -i wlan0</td>\n</tr>\n<tr>\n<td>-B</td>\n<td>将输出以byte为单位显示网卡流量，默认是bit</td>\n<td>sudo iftop -B -i wlan0</td>\n</tr>\n<tr>\n<td>-p</td>\n<td>以混杂模式运行iftop,此时iftop可以作为网络嗅探器</td>\n<td>sudo iftop -p -i wlan0</td>\n</tr>\n<tr>\n<td>-N</td>\n<td>只显示链接端口号，不显示对应的服务名称</td>\n<td>sudo iftop -N -i wlan0</td>\n</tr>\n<tr>\n<td>-P</td>\n<td>显示主机及端口信息</td>\n<td>sudo iftop -P -i wlan0</td>\n</tr>\n<tr>\n<td>-F</td>\n<td>显示特定网段的网卡进出流量</td>\n<td>sudo iftop -F 192.168.1.10/24</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                    12.5kb              25.0kb               37.5kb              50.0kb         [0/37]</span><br><span class=\"line\">+-------------------+-------------------+--------------------+-------------------+--------------------</span><br><span class=\"line\">192.168.1.116                         =&gt; 101.227.160.102                       17.6kb  3.55kb  1.90kb </span><br><span class=\"line\">                                      &lt;=                                       7.29kb  1.50kb   807b</span><br><span class=\"line\">224.0.0.251                           =&gt; 192.168.1.165                            0b      0b      0b  </span><br><span class=\"line\">                                      &lt;=                                       1.72kb  2.21kb   566b</span><br><span class=\"line\">192.168.1.116                         =&gt; 140.206.160.161                       4.89kb  0.98kb  1.21kb</span><br><span class=\"line\">                                      &lt;=                                       1.18kb   242b    302b</span><br><span class=\"line\">192.168.1.116                         =&gt; 192.168.1.1                              0b    112b     96b  </span><br><span class=\"line\">                                      &lt;=                                          0b    378b    254b</span><br><span class=\"line\">239.255.255.250                       =&gt; 192.168.1.148                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                       1.19kb   486b    730b</span><br><span class=\"line\">224.0.0.251                           =&gt; 192.168.1.166                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                        272b     54b     14b</span><br><span class=\"line\">192.168.1.165                         =&gt; all-routers.mcast.net                    0b     26b      6b</span><br><span class=\"line\">                                      &lt;=                                          0b      0b      0b</span><br><span class=\"line\">192.168.1.116                         =&gt; 101.226.76.164                           0b      0b   2.11kb</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    752b  </span><br><span class=\"line\">192.168.1.116                         =&gt; dev                                      0b      0b   1.50kb</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    544b</span><br><span class=\"line\">192.168.1.116                         =&gt; stage                                    0b      0b   1.40kb</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    504b</span><br><span class=\"line\">239.255.255.250                       =&gt; 192.168.1.135                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    161b</span><br><span class=\"line\">239.255.255.250                       =&gt; 192.168.1.113                            0b      0b      0b</span><br><span class=\"line\">                                      &lt;=                                          0b      0b    160b</span><br><span class=\"line\">------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">TX:             cum:   51.5kB   peak:   44.7kb                        rates:   22.4kb  4.64kb  8.27kb</span><br><span class=\"line\">RX:                    46.8kB           28.5kb                                 11.6kb  4.87kb  4.94kb</span><br><span class=\"line\">TOTAL:                 98.4kB           73.2kb                                 34.1kb  9.51kb  13.2kb</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-mtr\"><a href=\"#4-mtr\" class=\"headerlink\" title=\"4. mtr\"></a>4. mtr</h2><p>mtr是Linux中有一个非常棒的网络连通性判断工具,它结合了<code>ping</code>，<code>traceroute</code>，<code>nslookup</code>的相关特性。<br>相对于其他命令仅仅收集传输路径或响应时间，MTR 工具会收集更多的信息，比如 连接状态，连接可用性，以及传输路径中主机的响应性。</p>\n<p>常用参数</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-s</td>\n<td>用来指定ping数据包的大小</td>\n</tr>\n<tr>\n<td><code>--no-dns</code></td>\n<td>不对IP地址做域名解析</td>\n</tr>\n<tr>\n<td>-a</td>\n<td>使用这个参数来设置ICMP返回之间的要求默认是1秒</td>\n</tr>\n<tr>\n<td><code>--report</code></td>\n<td>给主机发送10个ICMP包，然后输出报告</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                    My traceroute  [v0.85]                                     [0/102]</span><br><span class=\"line\">localhost (0.0.0.0)                            Sun Mar 26 20:25:43 2017</span><br><span class=\"line\">Keys:  Help   Display mode   Restart statistics   Order of fields   quit</span><br><span class=\"line\">                                            Packets               Pings</span><br><span class=\"line\"> Host                                    Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class=\"line\"> 1. 192.168.0.1                           0.0%     8    1.5   2.3   1.3   4.3   0.8</span><br><span class=\"line\"> 2. 192.168.1.1                           0.0%     8    1.7   4.6   1.7  13.7   5.2</span><br><span class=\"line\"> 3. 114.245.248.1                         0.0%     8   78.3 108.3   3.7 363.8 149.8</span><br><span class=\"line\"> 4. 123.126.26.45                         0.0%     8    7.9  19.6   3.8  76.7  26.3</span><br><span class=\"line\"> 5. 61.148.158.53                         0.0%     8    7.2  12.2   5.1  31.6   9.2</span><br><span class=\"line\"> 6. 61.51.115.106                         0.0%     8   78.8  15.4   4.6  78.8  25.7</span><br><span class=\"line\"> 7. 61.49.168.110                         0.0%     8    4.9   7.1   4.8  12.8   2.7</span><br><span class=\"line\"> 8. ???</span><br><span class=\"line\"> 9. ???</span><br><span class=\"line\">10. 61.135.169.121                        0.0%     7    4.3   5.9   4.2  10.9   2.2</span><br></pre></td></tr></table></figure>\n<p><strong>说明</strong><br>当分析mtr的输出时，需要注意两点:loss和latency<br>如果你在任何一跳上看到loss的百分比，这就说明这一跳上可能有问题。当然也有可能是服务提供商人为限制了ICMP发送的速率，也会导致丢包。如果下一跳没有丢包，那说明该丢包是人为限制的。<br>如果第4跳和第5跳都有50%的丢包率，从接下来的几跳都有丢包现象，所以不像是人为限制 ICMP 速率的原因。但是最后几跳都是30%的丢包率，我们可以猜测30%的丢包率除了网络糟糕的原因之前还有人为限制ICMP。所以，当我们看到不同的丢包率时，通常要以最后几跳为准。当出现短暂的10%丢包率的时候，不必担心，应用层的程序会弥补这点损失。</p>\n<h2 id=\"5-htop\"><a href=\"#5-htop\" class=\"headerlink\" title=\"5. htop\"></a>5. htop</h2><p>常用功能键</p>\n<table>\n<thead>\n<tr>\n<th>按键</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>F1</td>\n<td>帮助</td>\n</tr>\n<tr>\n<td>F2</td>\n<td>设置</td>\n</tr>\n<tr>\n<td>F3</td>\n<td>搜索进程</td>\n</tr>\n<tr>\n<td>F4</td>\n<td>过滤器，按关键字搜索</td>\n</tr>\n<tr>\n<td>F5</td>\n<td>显示树形结构</td>\n</tr>\n<tr>\n<td>F6</td>\n<td>选择排序方式</td>\n</tr>\n<tr>\n<td>F7</td>\n<td>减少nice值，可以提高对应进程的优先级</td>\n</tr>\n<tr>\n<td>F8</td>\n<td>增加nice值，可以降低对应进程的优先级</td>\n</tr>\n<tr>\n<td>F9</td>\n<td>杀掉选中的进程</td>\n</tr>\n<tr>\n<td>F10</td>\n<td>退出</td>\n</tr>\n<tr>\n<td>/</td>\n<td>搜索字符</td>\n</tr>\n<tr>\n<td>h</td>\n<td>显示帮助</td>\n</tr>\n<tr>\n<td>l</td>\n<td>显示进程打开的文件 lsof</td>\n</tr>\n<tr>\n<td>u</td>\n<td>显示所有用户，并可以选择某一特定用户的进程</td>\n</tr>\n<tr>\n<td>s</td>\n<td>将调用strace追踪进程的系统调用</td>\n</tr>\n<tr>\n<td>t</td>\n<td>显示树形结构</td>\n</tr>\n<tr>\n<td>H</td>\n<td>显示/隐藏用户线程</td>\n</tr>\n<tr>\n<td>I</td>\n<td>倒转排序</td>\n</tr>\n<tr>\n<td>K</td>\n<td>显示/隐藏内核线程</td>\n</tr>\n<tr>\n<td>M</td>\n<td>按内存占用排序</td>\n</tr>\n<tr>\n<td>P</td>\n<td>按CPU排序</td>\n</tr>\n<tr>\n<td>T</td>\n<td>按运行时间排序</td>\n</tr>\n</tbody>\n</table>\n<p>htop的左上角显示CPU、内存、交换区的使用情况，右边显示任务、负载、开机时间，下面是进程实时状态。<br>最后一行是F1～F10的功能菜单和对应的字符快捷键。</p>\n<h2 id=\"6-linux系统性能分析\"><a href=\"#6-linux系统性能分析\" class=\"headerlink\" title=\"6. linux系统性能分析\"></a>6. linux系统性能分析</h2><p>分析次序为cpu mem disk network</p>\n"},{"title":"mysql配置项修改","date":"2017-08-17T13:12:03.000Z","_content":"\n大多数情况下我们会想指定`mysql`的`basedir`和`datadir`或者`mysql`的启动用户。\n\n## 1. 修改配置文件\n`/etc/my.cnf`\n添加如下内容\n```\n[mysqld]\nbasedir     = /home/USERNAME/opt/mysql-5.5.57 #mysql安装目录\ndatadir     = /mnt/data/mysqld/data #mysql数据目录\n```\n同时也可以修改mysql的启动用户\n[Run MySQL as a Normal User](https://dev.mysql.com/doc/refman/5.5/en/changing-mysql-user.html)\n```\nuser         = USERNAME   #修改mysql的用户\nbind-address = 127.0.0.1 #修改绑定的ip\n```\n\n## 2. 同步数据文件\n```\ncd /mnt/data/mysqld/data\nsudo rsync -avz /home/USERNAME/opt/mysql-5.5.57/data/* ./\nsudo chown -R USERNAME:USERNAME ../data  #如果没有修改mysql的用户，该步忽略\n```\n\n## 3. 启动并检测\n执行`mysql`相关命令来启动进程\n```\nmysqld-svc start\nps -ef | grep mysqld\n```\n\n## 4. 补充\n修改mysql的日志文件位置\n```\n[mysqld_safe]\nlog-error   = /mnt/data/mysqld/logs/mysqld.log\n```\n记得创建日志文件目录。\n\n\n\n\n","source":"_posts/mysql配置项修改.md","raw":"---\ntitle: mysql配置项修改\ndate: 2017-08-17 21:12:03\ntags: mysql\n---\n\n大多数情况下我们会想指定`mysql`的`basedir`和`datadir`或者`mysql`的启动用户。\n\n## 1. 修改配置文件\n`/etc/my.cnf`\n添加如下内容\n```\n[mysqld]\nbasedir     = /home/USERNAME/opt/mysql-5.5.57 #mysql安装目录\ndatadir     = /mnt/data/mysqld/data #mysql数据目录\n```\n同时也可以修改mysql的启动用户\n[Run MySQL as a Normal User](https://dev.mysql.com/doc/refman/5.5/en/changing-mysql-user.html)\n```\nuser         = USERNAME   #修改mysql的用户\nbind-address = 127.0.0.1 #修改绑定的ip\n```\n\n## 2. 同步数据文件\n```\ncd /mnt/data/mysqld/data\nsudo rsync -avz /home/USERNAME/opt/mysql-5.5.57/data/* ./\nsudo chown -R USERNAME:USERNAME ../data  #如果没有修改mysql的用户，该步忽略\n```\n\n## 3. 启动并检测\n执行`mysql`相关命令来启动进程\n```\nmysqld-svc start\nps -ef | grep mysqld\n```\n\n## 4. 补充\n修改mysql的日志文件位置\n```\n[mysqld_safe]\nlog-error   = /mnt/data/mysqld/logs/mysqld.log\n```\n记得创建日志文件目录。\n\n\n\n\n","slug":"mysql配置项修改","published":1,"updated":"2018-12-29T12:15:02.733Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4z0019zahi1en1i1x2","content":"<p>大多数情况下我们会想指定<code>mysql</code>的<code>basedir</code>和<code>datadir</code>或者<code>mysql</code>的启动用户。</p>\n<h2 id=\"1-修改配置文件\"><a href=\"#1-修改配置文件\" class=\"headerlink\" title=\"1. 修改配置文件\"></a>1. 修改配置文件</h2><p><code>/etc/my.cnf</code><br>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">basedir     = /home/USERNAME/opt/mysql-5.5.57 #mysql安装目录</span><br><span class=\"line\">datadir     = /mnt/data/mysqld/data #mysql数据目录</span><br></pre></td></tr></table></figure></p>\n<p>同时也可以修改mysql的启动用户<br><a href=\"https://dev.mysql.com/doc/refman/5.5/en/changing-mysql-user.html\" target=\"_blank\" rel=\"noopener\">Run MySQL as a Normal User</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user         = USERNAME   #修改mysql的用户</span><br><span class=\"line\">bind-address = 127.0.0.1 #修改绑定的ip</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-同步数据文件\"><a href=\"#2-同步数据文件\" class=\"headerlink\" title=\"2. 同步数据文件\"></a>2. 同步数据文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /mnt/data/mysqld/data</span><br><span class=\"line\">sudo rsync -avz /home/USERNAME/opt/mysql-5.5.57/data/* ./</span><br><span class=\"line\">sudo chown -R USERNAME:USERNAME ../data  #如果没有修改mysql的用户，该步忽略</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-启动并检测\"><a href=\"#3-启动并检测\" class=\"headerlink\" title=\"3. 启动并检测\"></a>3. 启动并检测</h2><p>执行<code>mysql</code>相关命令来启动进程<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqld-svc start</span><br><span class=\"line\">ps -ef | grep mysqld</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-补充\"><a href=\"#4-补充\" class=\"headerlink\" title=\"4. 补充\"></a>4. 补充</h2><p>修改mysql的日志文件位置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\">log-error   = /mnt/data/mysqld/logs/mysqld.log</span><br></pre></td></tr></table></figure></p>\n<p>记得创建日志文件目录。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>大多数情况下我们会想指定<code>mysql</code>的<code>basedir</code>和<code>datadir</code>或者<code>mysql</code>的启动用户。</p>\n<h2 id=\"1-修改配置文件\"><a href=\"#1-修改配置文件\" class=\"headerlink\" title=\"1. 修改配置文件\"></a>1. 修改配置文件</h2><p><code>/etc/my.cnf</code><br>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">basedir     = /home/USERNAME/opt/mysql-5.5.57 #mysql安装目录</span><br><span class=\"line\">datadir     = /mnt/data/mysqld/data #mysql数据目录</span><br></pre></td></tr></table></figure></p>\n<p>同时也可以修改mysql的启动用户<br><a href=\"https://dev.mysql.com/doc/refman/5.5/en/changing-mysql-user.html\" target=\"_blank\" rel=\"noopener\">Run MySQL as a Normal User</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user         = USERNAME   #修改mysql的用户</span><br><span class=\"line\">bind-address = 127.0.0.1 #修改绑定的ip</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-同步数据文件\"><a href=\"#2-同步数据文件\" class=\"headerlink\" title=\"2. 同步数据文件\"></a>2. 同步数据文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /mnt/data/mysqld/data</span><br><span class=\"line\">sudo rsync -avz /home/USERNAME/opt/mysql-5.5.57/data/* ./</span><br><span class=\"line\">sudo chown -R USERNAME:USERNAME ../data  #如果没有修改mysql的用户，该步忽略</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-启动并检测\"><a href=\"#3-启动并检测\" class=\"headerlink\" title=\"3. 启动并检测\"></a>3. 启动并检测</h2><p>执行<code>mysql</code>相关命令来启动进程<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqld-svc start</span><br><span class=\"line\">ps -ef | grep mysqld</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-补充\"><a href=\"#4-补充\" class=\"headerlink\" title=\"4. 补充\"></a>4. 补充</h2><p>修改mysql的日志文件位置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\">log-error   = /mnt/data/mysqld/logs/mysqld.log</span><br></pre></td></tr></table></figure></p>\n<p>记得创建日志文件目录。</p>\n"},{"title":"nginx编译安装lua模块","date":"2017-09-15T12:51:59.000Z","_content":"\n## 1. 获取nginx源代码\n```\ngit clone https://github.com/nginx/nginx.git nginx-release\n```\n\n## 2. 下载安装LuaJIT\n```\ngit clone https://github.com/LuaJIT/LuaJIT.git\ncd LuaJIT\nmake \nmake install\n```\n\n## 3. 下载lua-nginx-module\n```\nwget https://github.com/openresty/lua-nginx-module/archive/v0.10.7.tar.gz\ntar zxvf v0.10.7.tar.gz\n```\n或者\n```\ngit clone https://github.com/openresty/lua-nginx-module.git\n```\n\n## 4. 下载ngx_devel_kit\n```\nwget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz\n```\n或者\n```\ngit clone https://github.com/simpl/ngx_devel_kit.git\n```\n\n## 5. 编译安装nginx\n```\ncd ~/opt/nginx-release/\n./configure --prefix=/home/USERNAME/opt/nginx-1.9 --with-ld-opt=\"-Wl,-rpath,/usr/local/lib\" --add-module=/home/USERNAME/opt/nginx-module/lua-nginx-module-0.10.7 --add-module=/home/USERNAME/opt/nginx-module/ngx_devel_kit/ --with-http_stub_status_module --with-http_ssl_module --with-ipv6 --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module --with-pcre-jit\n\nmake -j4\nmake install\n```\n\n## 6. 修改nginx配置\n在http server区域内添加如下内容\n```\nlocation /hello_lua {\ndefault_type 'text/plain';\ncontent_by_lua 'ngx.say(\"hello, lua\")';\n}\n```\n重启nginx\n\n## 7. 测试\n浏览器访问`IP/hello_lua`显示\nhello,lua  \n\nnginx的lua模块安装完成。  \n\n\n","source":"_posts/nginx编译安装lua模块.md","raw":"---\ntitle: nginx编译安装lua模块\ndate: 2017-09-15 20:51:59\ntags: nginx\n---\n\n## 1. 获取nginx源代码\n```\ngit clone https://github.com/nginx/nginx.git nginx-release\n```\n\n## 2. 下载安装LuaJIT\n```\ngit clone https://github.com/LuaJIT/LuaJIT.git\ncd LuaJIT\nmake \nmake install\n```\n\n## 3. 下载lua-nginx-module\n```\nwget https://github.com/openresty/lua-nginx-module/archive/v0.10.7.tar.gz\ntar zxvf v0.10.7.tar.gz\n```\n或者\n```\ngit clone https://github.com/openresty/lua-nginx-module.git\n```\n\n## 4. 下载ngx_devel_kit\n```\nwget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz\n```\n或者\n```\ngit clone https://github.com/simpl/ngx_devel_kit.git\n```\n\n## 5. 编译安装nginx\n```\ncd ~/opt/nginx-release/\n./configure --prefix=/home/USERNAME/opt/nginx-1.9 --with-ld-opt=\"-Wl,-rpath,/usr/local/lib\" --add-module=/home/USERNAME/opt/nginx-module/lua-nginx-module-0.10.7 --add-module=/home/USERNAME/opt/nginx-module/ngx_devel_kit/ --with-http_stub_status_module --with-http_ssl_module --with-ipv6 --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module --with-pcre-jit\n\nmake -j4\nmake install\n```\n\n## 6. 修改nginx配置\n在http server区域内添加如下内容\n```\nlocation /hello_lua {\ndefault_type 'text/plain';\ncontent_by_lua 'ngx.say(\"hello, lua\")';\n}\n```\n重启nginx\n\n## 7. 测试\n浏览器访问`IP/hello_lua`显示\nhello,lua  \n\nnginx的lua模块安装完成。  \n\n\n","slug":"nginx编译安装lua模块","published":1,"updated":"2018-12-09T01:10:20.192Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j4z001bzahihevn0kox","content":"<h2 id=\"1-获取nginx源代码\"><a href=\"#1-获取nginx源代码\" class=\"headerlink\" title=\"1. 获取nginx源代码\"></a>1. 获取nginx源代码</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/nginx/nginx.git nginx-release</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-下载安装LuaJIT\"><a href=\"#2-下载安装LuaJIT\" class=\"headerlink\" title=\"2. 下载安装LuaJIT\"></a>2. 下载安装LuaJIT</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/LuaJIT/LuaJIT.git</span><br><span class=\"line\">cd LuaJIT</span><br><span class=\"line\">make </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-下载lua-nginx-module\"><a href=\"#3-下载lua-nginx-module\" class=\"headerlink\" title=\"3. 下载lua-nginx-module\"></a>3. 下载lua-nginx-module</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.7.tar.gz</span><br><span class=\"line\">tar zxvf v0.10.7.tar.gz</span><br></pre></td></tr></table></figure>\n<p>或者<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/openresty/lua-nginx-module.git</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-下载ngx-devel-kit\"><a href=\"#4-下载ngx-devel-kit\" class=\"headerlink\" title=\"4. 下载ngx_devel_kit\"></a>4. 下载ngx_devel_kit</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz</span><br></pre></td></tr></table></figure>\n<p>或者<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/simpl/ngx_devel_kit.git</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"5-编译安装nginx\"><a href=\"#5-编译安装nginx\" class=\"headerlink\" title=\"5. 编译安装nginx\"></a>5. 编译安装nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/nginx-release/</span><br><span class=\"line\">./configure --prefix=/home/USERNAME/opt/nginx-1.9 --with-ld-opt=&quot;-Wl,-rpath,/usr/local/lib&quot; --add-module=/home/USERNAME/opt/nginx-module/lua-nginx-module-0.10.7 --add-module=/home/USERNAME/opt/nginx-module/ngx_devel_kit/ --with-http_stub_status_module --with-http_ssl_module --with-ipv6 --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module --with-pcre-jit</span><br><span class=\"line\"></span><br><span class=\"line\">make -j4</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"6-修改nginx配置\"><a href=\"#6-修改nginx配置\" class=\"headerlink\" title=\"6. 修改nginx配置\"></a>6. 修改nginx配置</h2><p>在http server区域内添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /hello_lua &#123;</span><br><span class=\"line\">default_type &apos;text/plain&apos;;</span><br><span class=\"line\">content_by_lua &apos;ngx.say(&quot;hello, lua&quot;)&apos;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>重启nginx</p>\n<h2 id=\"7-测试\"><a href=\"#7-测试\" class=\"headerlink\" title=\"7. 测试\"></a>7. 测试</h2><p>浏览器访问<code>IP/hello_lua</code>显示<br>hello,lua  </p>\n<p>nginx的lua模块安装完成。  </p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-获取nginx源代码\"><a href=\"#1-获取nginx源代码\" class=\"headerlink\" title=\"1. 获取nginx源代码\"></a>1. 获取nginx源代码</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/nginx/nginx.git nginx-release</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-下载安装LuaJIT\"><a href=\"#2-下载安装LuaJIT\" class=\"headerlink\" title=\"2. 下载安装LuaJIT\"></a>2. 下载安装LuaJIT</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/LuaJIT/LuaJIT.git</span><br><span class=\"line\">cd LuaJIT</span><br><span class=\"line\">make </span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-下载lua-nginx-module\"><a href=\"#3-下载lua-nginx-module\" class=\"headerlink\" title=\"3. 下载lua-nginx-module\"></a>3. 下载lua-nginx-module</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.7.tar.gz</span><br><span class=\"line\">tar zxvf v0.10.7.tar.gz</span><br></pre></td></tr></table></figure>\n<p>或者<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/openresty/lua-nginx-module.git</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4-下载ngx-devel-kit\"><a href=\"#4-下载ngx-devel-kit\" class=\"headerlink\" title=\"4. 下载ngx_devel_kit\"></a>4. 下载ngx_devel_kit</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz</span><br></pre></td></tr></table></figure>\n<p>或者<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/simpl/ngx_devel_kit.git</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"5-编译安装nginx\"><a href=\"#5-编译安装nginx\" class=\"headerlink\" title=\"5. 编译安装nginx\"></a>5. 编译安装nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/opt/nginx-release/</span><br><span class=\"line\">./configure --prefix=/home/USERNAME/opt/nginx-1.9 --with-ld-opt=&quot;-Wl,-rpath,/usr/local/lib&quot; --add-module=/home/USERNAME/opt/nginx-module/lua-nginx-module-0.10.7 --add-module=/home/USERNAME/opt/nginx-module/ngx_devel_kit/ --with-http_stub_status_module --with-http_ssl_module --with-ipv6 --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module --with-pcre-jit</span><br><span class=\"line\"></span><br><span class=\"line\">make -j4</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"6-修改nginx配置\"><a href=\"#6-修改nginx配置\" class=\"headerlink\" title=\"6. 修改nginx配置\"></a>6. 修改nginx配置</h2><p>在http server区域内添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location /hello_lua &#123;</span><br><span class=\"line\">default_type &apos;text/plain&apos;;</span><br><span class=\"line\">content_by_lua &apos;ngx.say(&quot;hello, lua&quot;)&apos;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>重启nginx</p>\n<h2 id=\"7-测试\"><a href=\"#7-测试\" class=\"headerlink\" title=\"7. 测试\"></a>7. 测试</h2><p>浏览器访问<code>IP/hello_lua</code>显示<br>hello,lua  </p>\n<p>nginx的lua模块安装完成。  </p>\n"},{"title":"python使用和导入模块","date":"2017-03-20T13:47:06.000Z","_content":"\n## 1. 导入模块的方法 \n\n```\nimport moduleName 导入模块\nFrom module import sayHi  从模块导入某个具体的方法\nimport moduleName as newName  给模块起别名\nfrom sys import *   导入模块下的所有方法 \n```\n\n- 给模块起别名\n```\nimport multiprocessing as multi\n```\n\n\n- 把模块下所有的方法导入\n```\n>>> from sys import *\n>>> print path\n['', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-x86_64-linux-gnu', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages/PILcompat', '/usr/lib/python2.7/dist-packages/gtk-2.0', '/usr/lib/pymodules/python2.7', '/usr/lib/python2.7/dist-packages/ubuntu-sso-client']\n```\n\n<font color=red>不建议使用`from sys import *` 可能被自定义的变量覆盖 调用时加上模块名 `sys.argv[2]` 可防止 </font>\n\n\n## 2. 系统命令交互模块\n### 2.1 os模块\n\n```\n>>> import os\n>>> os.system('pwd')\n/home/niuzhiqiang/Desktop\n0\n>>> cur_dir = os.system('pwd')\n/home/xxx/Desktop\n>>> print cur_dir\n0\n\n>>> os.popen('pwd')\n<open file 'pwd', mode 'r' at 0x7f9017578c90>\n>>> cur_dir = os.popen('pwd').read()\n>>> print cur_dir\n/home/xxx/Desktop\n```\n**例：循环列出目录下的内容**\n\n```\n>>> os.walk('/the/directory/')\n>>> os.next()\n>>> os.next()\n```\n\n### 2.2 commands模块\n```\n>>> import commands\n>>> res = commands.getstatusoutput('pwd')\n>>> print res\n(0, '/home/xxx/Desktop')\n>>> print res[1]\n/home/xxx/Desktop\n```\n\n### 2.3 subprocess模块\ntodo\n\n\n\n### 2.4 sys模块\n\n取程序的参数\n```\nimport sys\nprint sys.argv\nprint sys.argv[2]\n```\n\n```\nfrom sys import argv\n# 不需要使用`sys.`\nprint argv\n```\n","source":"_posts/python使用和导入模块.md","raw":"---\ntitle: python使用和导入模块\ndate: 2017-03-20 21:47:06\ntags: python\n---\n\n## 1. 导入模块的方法 \n\n```\nimport moduleName 导入模块\nFrom module import sayHi  从模块导入某个具体的方法\nimport moduleName as newName  给模块起别名\nfrom sys import *   导入模块下的所有方法 \n```\n\n- 给模块起别名\n```\nimport multiprocessing as multi\n```\n\n\n- 把模块下所有的方法导入\n```\n>>> from sys import *\n>>> print path\n['', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-x86_64-linux-gnu', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages/PILcompat', '/usr/lib/python2.7/dist-packages/gtk-2.0', '/usr/lib/pymodules/python2.7', '/usr/lib/python2.7/dist-packages/ubuntu-sso-client']\n```\n\n<font color=red>不建议使用`from sys import *` 可能被自定义的变量覆盖 调用时加上模块名 `sys.argv[2]` 可防止 </font>\n\n\n## 2. 系统命令交互模块\n### 2.1 os模块\n\n```\n>>> import os\n>>> os.system('pwd')\n/home/niuzhiqiang/Desktop\n0\n>>> cur_dir = os.system('pwd')\n/home/xxx/Desktop\n>>> print cur_dir\n0\n\n>>> os.popen('pwd')\n<open file 'pwd', mode 'r' at 0x7f9017578c90>\n>>> cur_dir = os.popen('pwd').read()\n>>> print cur_dir\n/home/xxx/Desktop\n```\n**例：循环列出目录下的内容**\n\n```\n>>> os.walk('/the/directory/')\n>>> os.next()\n>>> os.next()\n```\n\n### 2.2 commands模块\n```\n>>> import commands\n>>> res = commands.getstatusoutput('pwd')\n>>> print res\n(0, '/home/xxx/Desktop')\n>>> print res[1]\n/home/xxx/Desktop\n```\n\n### 2.3 subprocess模块\ntodo\n\n\n\n### 2.4 sys模块\n\n取程序的参数\n```\nimport sys\nprint sys.argv\nprint sys.argv[2]\n```\n\n```\nfrom sys import argv\n# 不需要使用`sys.`\nprint argv\n```\n","slug":"python使用和导入模块","published":1,"updated":"2017-03-21T13:16:24.321Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j50001ezahi957lxkzv","content":"<h2 id=\"1-导入模块的方法\"><a href=\"#1-导入模块的方法\" class=\"headerlink\" title=\"1. 导入模块的方法\"></a>1. 导入模块的方法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import moduleName 导入模块</span><br><span class=\"line\">From module import sayHi  从模块导入某个具体的方法</span><br><span class=\"line\">import moduleName as newName  给模块起别名</span><br><span class=\"line\">from sys import *   导入模块下的所有方法</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>给模块起别名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import multiprocessing as multi</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>把模块下所有的方法导入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from sys import *</span><br><span class=\"line\">&gt;&gt;&gt; print path</span><br><span class=\"line\">[&apos;&apos;, &apos;/usr/lib/python2.7&apos;, &apos;/usr/lib/python2.7/plat-x86_64-linux-gnu&apos;, &apos;/usr/lib/python2.7/lib-tk&apos;, &apos;/usr/lib/python2.7/lib-old&apos;, &apos;/usr/lib/python2.7/lib-dynload&apos;, &apos;/usr/local/lib/python2.7/dist-packages&apos;, &apos;/usr/lib/python2.7/dist-packages&apos;, &apos;/usr/lib/python2.7/dist-packages/PILcompat&apos;, &apos;/usr/lib/python2.7/dist-packages/gtk-2.0&apos;, &apos;/usr/lib/pymodules/python2.7&apos;, &apos;/usr/lib/python2.7/dist-packages/ubuntu-sso-client&apos;]</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<font color=\"red\">不建议使用<code>from sys import *</code> 可能被自定义的变量覆盖 调用时加上模块名 <code>sys.argv[2]</code> 可防止 </font>\n\n\n<h2 id=\"2-系统命令交互模块\"><a href=\"#2-系统命令交互模块\" class=\"headerlink\" title=\"2. 系统命令交互模块\"></a>2. 系统命令交互模块</h2><h3 id=\"2-1-os模块\"><a href=\"#2-1-os模块\" class=\"headerlink\" title=\"2.1 os模块\"></a>2.1 os模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; import os</span><br><span class=\"line\">&gt;&gt;&gt; os.system(&apos;pwd&apos;)</span><br><span class=\"line\">/home/niuzhiqiang/Desktop</span><br><span class=\"line\">0</span><br><span class=\"line\">&gt;&gt;&gt; cur_dir = os.system(&apos;pwd&apos;)</span><br><span class=\"line\">/home/xxx/Desktop</span><br><span class=\"line\">&gt;&gt;&gt; print cur_dir</span><br><span class=\"line\">0</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; os.popen(&apos;pwd&apos;)</span><br><span class=\"line\">&lt;open file &apos;pwd&apos;, mode &apos;r&apos; at 0x7f9017578c90&gt;</span><br><span class=\"line\">&gt;&gt;&gt; cur_dir = os.popen(&apos;pwd&apos;).read()</span><br><span class=\"line\">&gt;&gt;&gt; print cur_dir</span><br><span class=\"line\">/home/xxx/Desktop</span><br></pre></td></tr></table></figure>\n<p><strong>例：循环列出目录下的内容</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; os.walk(&apos;/the/directory/&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; os.next()</span><br><span class=\"line\">&gt;&gt;&gt; os.next()</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-commands模块\"><a href=\"#2-2-commands模块\" class=\"headerlink\" title=\"2.2 commands模块\"></a>2.2 commands模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; import commands</span><br><span class=\"line\">&gt;&gt;&gt; res = commands.getstatusoutput(&apos;pwd&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; print res</span><br><span class=\"line\">(0, &apos;/home/xxx/Desktop&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; print res[1]</span><br><span class=\"line\">/home/xxx/Desktop</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-subprocess模块\"><a href=\"#2-3-subprocess模块\" class=\"headerlink\" title=\"2.3 subprocess模块\"></a>2.3 subprocess模块</h3><p>todo</p>\n<h3 id=\"2-4-sys模块\"><a href=\"#2-4-sys模块\" class=\"headerlink\" title=\"2.4 sys模块\"></a>2.4 sys模块</h3><p>取程序的参数<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import sys</span><br><span class=\"line\">print sys.argv</span><br><span class=\"line\">print sys.argv[2]</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from sys import argv</span><br><span class=\"line\"># 不需要使用`sys.`</span><br><span class=\"line\">print argv</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-导入模块的方法\"><a href=\"#1-导入模块的方法\" class=\"headerlink\" title=\"1. 导入模块的方法\"></a>1. 导入模块的方法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import moduleName 导入模块</span><br><span class=\"line\">From module import sayHi  从模块导入某个具体的方法</span><br><span class=\"line\">import moduleName as newName  给模块起别名</span><br><span class=\"line\">from sys import *   导入模块下的所有方法</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>给模块起别名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import multiprocessing as multi</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>把模块下所有的方法导入</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; from sys import *</span><br><span class=\"line\">&gt;&gt;&gt; print path</span><br><span class=\"line\">[&apos;&apos;, &apos;/usr/lib/python2.7&apos;, &apos;/usr/lib/python2.7/plat-x86_64-linux-gnu&apos;, &apos;/usr/lib/python2.7/lib-tk&apos;, &apos;/usr/lib/python2.7/lib-old&apos;, &apos;/usr/lib/python2.7/lib-dynload&apos;, &apos;/usr/local/lib/python2.7/dist-packages&apos;, &apos;/usr/lib/python2.7/dist-packages&apos;, &apos;/usr/lib/python2.7/dist-packages/PILcompat&apos;, &apos;/usr/lib/python2.7/dist-packages/gtk-2.0&apos;, &apos;/usr/lib/pymodules/python2.7&apos;, &apos;/usr/lib/python2.7/dist-packages/ubuntu-sso-client&apos;]</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<font color=\"red\">不建议使用<code>from sys import *</code> 可能被自定义的变量覆盖 调用时加上模块名 <code>sys.argv[2]</code> 可防止 </font>\n\n\n<h2 id=\"2-系统命令交互模块\"><a href=\"#2-系统命令交互模块\" class=\"headerlink\" title=\"2. 系统命令交互模块\"></a>2. 系统命令交互模块</h2><h3 id=\"2-1-os模块\"><a href=\"#2-1-os模块\" class=\"headerlink\" title=\"2.1 os模块\"></a>2.1 os模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; import os</span><br><span class=\"line\">&gt;&gt;&gt; os.system(&apos;pwd&apos;)</span><br><span class=\"line\">/home/niuzhiqiang/Desktop</span><br><span class=\"line\">0</span><br><span class=\"line\">&gt;&gt;&gt; cur_dir = os.system(&apos;pwd&apos;)</span><br><span class=\"line\">/home/xxx/Desktop</span><br><span class=\"line\">&gt;&gt;&gt; print cur_dir</span><br><span class=\"line\">0</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; os.popen(&apos;pwd&apos;)</span><br><span class=\"line\">&lt;open file &apos;pwd&apos;, mode &apos;r&apos; at 0x7f9017578c90&gt;</span><br><span class=\"line\">&gt;&gt;&gt; cur_dir = os.popen(&apos;pwd&apos;).read()</span><br><span class=\"line\">&gt;&gt;&gt; print cur_dir</span><br><span class=\"line\">/home/xxx/Desktop</span><br></pre></td></tr></table></figure>\n<p><strong>例：循环列出目录下的内容</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; os.walk(&apos;/the/directory/&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; os.next()</span><br><span class=\"line\">&gt;&gt;&gt; os.next()</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-commands模块\"><a href=\"#2-2-commands模块\" class=\"headerlink\" title=\"2.2 commands模块\"></a>2.2 commands模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; import commands</span><br><span class=\"line\">&gt;&gt;&gt; res = commands.getstatusoutput(&apos;pwd&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; print res</span><br><span class=\"line\">(0, &apos;/home/xxx/Desktop&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; print res[1]</span><br><span class=\"line\">/home/xxx/Desktop</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-subprocess模块\"><a href=\"#2-3-subprocess模块\" class=\"headerlink\" title=\"2.3 subprocess模块\"></a>2.3 subprocess模块</h3><p>todo</p>\n<h3 id=\"2-4-sys模块\"><a href=\"#2-4-sys模块\" class=\"headerlink\" title=\"2.4 sys模块\"></a>2.4 sys模块</h3><p>取程序的参数<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import sys</span><br><span class=\"line\">print sys.argv</span><br><span class=\"line\">print sys.argv[2]</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from sys import argv</span><br><span class=\"line\"># 不需要使用`sys.`</span><br><span class=\"line\">print argv</span><br></pre></td></tr></table></figure>\n"},{"title":"python字符串处理","date":"2017-03-23T13:49:45.000Z","_content":"\n## 1. 字符串处理函数\n\n| 函数                              | 说明                                                         |\n| --                                | --                                                           |\n| s.find(substring,[start[,end]])   | 查找子字符串，可以指定开始结束的位置，返回索引值，否则返回-1 |\n| s.rfind(substring,[start[,end]])  | 反向查找字符串                                               |\n| s.index(substring,[start[,end]])  | 同find，找不到产生ValueError异常                             |\n| s.rindex(substring,[start[,end]]) | 同反向查找                                                   |\n| s.count(substring,[start[,end]])  | 返回找到子串的个数                                           |\n| s.lowercase()                     | 所有字符转换成小写                                           |\n| s.capitalize()                    | 首字母转换成大写                                             |\n| s.lower()                         | 所有字符转换成小写                                           |\n| s.upper()                         | 所有字符转换成大写                                           |\n| s.swapcase()                      | 大小写互换                                                   |\n| s.split(str,'')                   | 将string转换成list，以空格分割                               |\n| s.join(list,'')                   | 将list转换成string,以空格连接                                |\n**处理字符串的内置函数**\n\n| 函数名               | 说明                        |\n| --                   | --                          |\n| len(str)             | 串长度                      |\n| cmp('first_str',str) | 字符串比较，第一个大，返回1 |\n| max('string')        | 寻找字符串中最大的字符      |\n| min('string')        | 寻找字符串中最小的字符      |\n\n## 2. 实例\n\n### 2.1 查找子字符串\n`s.find()`\n\n```\n>>> string = \"this is the test string\"\n>>> string.find('test')\n12\n```\n\n### 2.2 查找子字符串\n`s.index()`\n找不到就报错，找到就返回索引\n```\n>>> string = \"this is the test string\"\n>>> string.index('error')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nValueError: substring not found\n>>> string.index('test')\n12\n```\n\n### 2.3 首字母转换成大写\n`s.capitalize()`\n\n```\n>>> string = \"this is the test string\"\n>>> string.capitalize()\n'This is the test string'\n```\n\n### 2.4 字符串转换成大写\n`s.upper()`\n\n```\n>>> string.upper()\n'THIS IS THE TEST STRING'\n```\n\n\n### 2.5 字符串转换成小写\n`s.lower()`\n\n```\n>>> string.lower()\n'this is the test string'\n```\n\n### 2.6 大小写互换\n`s.swapcase()`\n\n```\n>>> string += \"THIS IS CAP\"\n>>> string\n'this is the test stringTHIS IS CAP'\n>>> string.swapcase()\n'THIS IS THE TEST STRINGthis is cap'\n```\n\n### 2.7 将string转换为list\n`s.split()`\n默认为空格，可以指定分隔符\n```\n>>> string.split()\n['this', 'is', 'the', 'test', 'stringTHIS', 'IS', 'CAP']\n```\n\n### 2.8 将list转换为string\n`s.join()`\n```\n>>> '|'.join(string.split())\n'this|is|the|test|stringTHIS|IS|CAP'\n```\n\n**拓展**\n`+=`和`.join`实现的效果是一样的，但是`+=`每次都会新开辟空间，但是`.join`不用\n例：\n```\n>>> a = 'the'\n>>> a += ' test'\n>>> a += ' is'\n>>> a += ' end'\n>>> a\n'the test is end'\n\n>>> ''.join(a)\n'the test is end'\n```\n\n\n\n","source":"_posts/python字符串处理.md","raw":"---\ntitle: python字符串处理\ndate: 2017-03-23 21:49:45\ntags: python\n---\n\n## 1. 字符串处理函数\n\n| 函数                              | 说明                                                         |\n| --                                | --                                                           |\n| s.find(substring,[start[,end]])   | 查找子字符串，可以指定开始结束的位置，返回索引值，否则返回-1 |\n| s.rfind(substring,[start[,end]])  | 反向查找字符串                                               |\n| s.index(substring,[start[,end]])  | 同find，找不到产生ValueError异常                             |\n| s.rindex(substring,[start[,end]]) | 同反向查找                                                   |\n| s.count(substring,[start[,end]])  | 返回找到子串的个数                                           |\n| s.lowercase()                     | 所有字符转换成小写                                           |\n| s.capitalize()                    | 首字母转换成大写                                             |\n| s.lower()                         | 所有字符转换成小写                                           |\n| s.upper()                         | 所有字符转换成大写                                           |\n| s.swapcase()                      | 大小写互换                                                   |\n| s.split(str,'')                   | 将string转换成list，以空格分割                               |\n| s.join(list,'')                   | 将list转换成string,以空格连接                                |\n**处理字符串的内置函数**\n\n| 函数名               | 说明                        |\n| --                   | --                          |\n| len(str)             | 串长度                      |\n| cmp('first_str',str) | 字符串比较，第一个大，返回1 |\n| max('string')        | 寻找字符串中最大的字符      |\n| min('string')        | 寻找字符串中最小的字符      |\n\n## 2. 实例\n\n### 2.1 查找子字符串\n`s.find()`\n\n```\n>>> string = \"this is the test string\"\n>>> string.find('test')\n12\n```\n\n### 2.2 查找子字符串\n`s.index()`\n找不到就报错，找到就返回索引\n```\n>>> string = \"this is the test string\"\n>>> string.index('error')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nValueError: substring not found\n>>> string.index('test')\n12\n```\n\n### 2.3 首字母转换成大写\n`s.capitalize()`\n\n```\n>>> string = \"this is the test string\"\n>>> string.capitalize()\n'This is the test string'\n```\n\n### 2.4 字符串转换成大写\n`s.upper()`\n\n```\n>>> string.upper()\n'THIS IS THE TEST STRING'\n```\n\n\n### 2.5 字符串转换成小写\n`s.lower()`\n\n```\n>>> string.lower()\n'this is the test string'\n```\n\n### 2.6 大小写互换\n`s.swapcase()`\n\n```\n>>> string += \"THIS IS CAP\"\n>>> string\n'this is the test stringTHIS IS CAP'\n>>> string.swapcase()\n'THIS IS THE TEST STRINGthis is cap'\n```\n\n### 2.7 将string转换为list\n`s.split()`\n默认为空格，可以指定分隔符\n```\n>>> string.split()\n['this', 'is', 'the', 'test', 'stringTHIS', 'IS', 'CAP']\n```\n\n### 2.8 将list转换为string\n`s.join()`\n```\n>>> '|'.join(string.split())\n'this|is|the|test|stringTHIS|IS|CAP'\n```\n\n**拓展**\n`+=`和`.join`实现的效果是一样的，但是`+=`每次都会新开辟空间，但是`.join`不用\n例：\n```\n>>> a = 'the'\n>>> a += ' test'\n>>> a += ' is'\n>>> a += ' end'\n>>> a\n'the test is end'\n\n>>> ''.join(a)\n'the test is end'\n```\n\n\n\n","slug":"python字符串处理","published":1,"updated":"2017-03-23T14:29:58.262Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j51001gzahirjssj5wx","content":"<h2 id=\"1-字符串处理函数\"><a href=\"#1-字符串处理函数\" class=\"headerlink\" title=\"1. 字符串处理函数\"></a>1. 字符串处理函数</h2><table>\n<thead>\n<tr>\n<th>函数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>s.find(substring,[start[,end]])</td>\n<td>查找子字符串，可以指定开始结束的位置，返回索引值，否则返回-1</td>\n</tr>\n<tr>\n<td>s.rfind(substring,[start[,end]])</td>\n<td>反向查找字符串</td>\n</tr>\n<tr>\n<td>s.index(substring,[start[,end]])</td>\n<td>同find，找不到产生ValueError异常</td>\n</tr>\n<tr>\n<td>s.rindex(substring,[start[,end]])</td>\n<td>同反向查找</td>\n</tr>\n<tr>\n<td>s.count(substring,[start[,end]])</td>\n<td>返回找到子串的个数</td>\n</tr>\n<tr>\n<td>s.lowercase()</td>\n<td>所有字符转换成小写</td>\n</tr>\n<tr>\n<td>s.capitalize()</td>\n<td>首字母转换成大写</td>\n</tr>\n<tr>\n<td>s.lower()</td>\n<td>所有字符转换成小写</td>\n</tr>\n<tr>\n<td>s.upper()</td>\n<td>所有字符转换成大写</td>\n</tr>\n<tr>\n<td>s.swapcase()</td>\n<td>大小写互换</td>\n</tr>\n<tr>\n<td>s.split(str,’’)</td>\n<td>将string转换成list，以空格分割</td>\n</tr>\n<tr>\n<td>s.join(list,’’)</td>\n<td>将list转换成string,以空格连接</td>\n</tr>\n</tbody>\n</table>\n<p><strong>处理字符串的内置函数</strong></p>\n<table>\n<thead>\n<tr>\n<th>函数名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>len(str)</td>\n<td>串长度</td>\n</tr>\n<tr>\n<td>cmp(‘first_str’,str)</td>\n<td>字符串比较，第一个大，返回1</td>\n</tr>\n<tr>\n<td>max(‘string’)</td>\n<td>寻找字符串中最大的字符</td>\n</tr>\n<tr>\n<td>min(‘string’)</td>\n<td>寻找字符串中最小的字符</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"2-实例\"><a href=\"#2-实例\" class=\"headerlink\" title=\"2. 实例\"></a>2. 实例</h2><h3 id=\"2-1-查找子字符串\"><a href=\"#2-1-查找子字符串\" class=\"headerlink\" title=\"2.1 查找子字符串\"></a>2.1 查找子字符串</h3><p><code>s.find()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string = &quot;this is the test string&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string.find(&apos;test&apos;)</span><br><span class=\"line\">12</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-查找子字符串\"><a href=\"#2-2-查找子字符串\" class=\"headerlink\" title=\"2.2 查找子字符串\"></a>2.2 查找子字符串</h3><p><code>s.index()</code><br>找不到就报错，找到就返回索引<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string = &quot;this is the test string&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string.index(&apos;error&apos;)</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">ValueError: substring not found</span><br><span class=\"line\">&gt;&gt;&gt; string.index(&apos;test&apos;)</span><br><span class=\"line\">12</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-首字母转换成大写\"><a href=\"#2-3-首字母转换成大写\" class=\"headerlink\" title=\"2.3 首字母转换成大写\"></a>2.3 首字母转换成大写</h3><p><code>s.capitalize()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string = &quot;this is the test string&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string.capitalize()</span><br><span class=\"line\">&apos;This is the test string&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-字符串转换成大写\"><a href=\"#2-4-字符串转换成大写\" class=\"headerlink\" title=\"2.4 字符串转换成大写\"></a>2.4 字符串转换成大写</h3><p><code>s.upper()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string.upper()</span><br><span class=\"line\">&apos;THIS IS THE TEST STRING&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-字符串转换成小写\"><a href=\"#2-5-字符串转换成小写\" class=\"headerlink\" title=\"2.5 字符串转换成小写\"></a>2.5 字符串转换成小写</h3><p><code>s.lower()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string.lower()</span><br><span class=\"line\">&apos;this is the test string&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-6-大小写互换\"><a href=\"#2-6-大小写互换\" class=\"headerlink\" title=\"2.6 大小写互换\"></a>2.6 大小写互换</h3><p><code>s.swapcase()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string += &quot;THIS IS CAP&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string</span><br><span class=\"line\">&apos;this is the test stringTHIS IS CAP&apos;</span><br><span class=\"line\">&gt;&gt;&gt; string.swapcase()</span><br><span class=\"line\">&apos;THIS IS THE TEST STRINGthis is cap&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-7-将string转换为list\"><a href=\"#2-7-将string转换为list\" class=\"headerlink\" title=\"2.7 将string转换为list\"></a>2.7 将string转换为list</h3><p><code>s.split()</code><br>默认为空格，可以指定分隔符<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string.split()</span><br><span class=\"line\">[&apos;this&apos;, &apos;is&apos;, &apos;the&apos;, &apos;test&apos;, &apos;stringTHIS&apos;, &apos;IS&apos;, &apos;CAP&apos;]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-8-将list转换为string\"><a href=\"#2-8-将list转换为string\" class=\"headerlink\" title=\"2.8 将list转换为string\"></a>2.8 将list转换为string</h3><p><code>s.join()</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; &apos;|&apos;.join(string.split())</span><br><span class=\"line\">&apos;this|is|the|test|stringTHIS|IS|CAP&apos;</span><br></pre></td></tr></table></figure></p>\n<p><strong>拓展</strong><br><code>+=</code>和<code>.join</code>实现的效果是一样的，但是<code>+=</code>每次都会新开辟空间，但是<code>.join</code>不用<br>例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; a = &apos;the&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a += &apos; test&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a += &apos; is&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a += &apos; end&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a</span><br><span class=\"line\">&apos;the test is end&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; &apos;&apos;.join(a)</span><br><span class=\"line\">&apos;the test is end&apos;</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-字符串处理函数\"><a href=\"#1-字符串处理函数\" class=\"headerlink\" title=\"1. 字符串处理函数\"></a>1. 字符串处理函数</h2><table>\n<thead>\n<tr>\n<th>函数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>s.find(substring,[start[,end]])</td>\n<td>查找子字符串，可以指定开始结束的位置，返回索引值，否则返回-1</td>\n</tr>\n<tr>\n<td>s.rfind(substring,[start[,end]])</td>\n<td>反向查找字符串</td>\n</tr>\n<tr>\n<td>s.index(substring,[start[,end]])</td>\n<td>同find，找不到产生ValueError异常</td>\n</tr>\n<tr>\n<td>s.rindex(substring,[start[,end]])</td>\n<td>同反向查找</td>\n</tr>\n<tr>\n<td>s.count(substring,[start[,end]])</td>\n<td>返回找到子串的个数</td>\n</tr>\n<tr>\n<td>s.lowercase()</td>\n<td>所有字符转换成小写</td>\n</tr>\n<tr>\n<td>s.capitalize()</td>\n<td>首字母转换成大写</td>\n</tr>\n<tr>\n<td>s.lower()</td>\n<td>所有字符转换成小写</td>\n</tr>\n<tr>\n<td>s.upper()</td>\n<td>所有字符转换成大写</td>\n</tr>\n<tr>\n<td>s.swapcase()</td>\n<td>大小写互换</td>\n</tr>\n<tr>\n<td>s.split(str,’’)</td>\n<td>将string转换成list，以空格分割</td>\n</tr>\n<tr>\n<td>s.join(list,’’)</td>\n<td>将list转换成string,以空格连接</td>\n</tr>\n</tbody>\n</table>\n<p><strong>处理字符串的内置函数</strong></p>\n<table>\n<thead>\n<tr>\n<th>函数名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>len(str)</td>\n<td>串长度</td>\n</tr>\n<tr>\n<td>cmp(‘first_str’,str)</td>\n<td>字符串比较，第一个大，返回1</td>\n</tr>\n<tr>\n<td>max(‘string’)</td>\n<td>寻找字符串中最大的字符</td>\n</tr>\n<tr>\n<td>min(‘string’)</td>\n<td>寻找字符串中最小的字符</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"2-实例\"><a href=\"#2-实例\" class=\"headerlink\" title=\"2. 实例\"></a>2. 实例</h2><h3 id=\"2-1-查找子字符串\"><a href=\"#2-1-查找子字符串\" class=\"headerlink\" title=\"2.1 查找子字符串\"></a>2.1 查找子字符串</h3><p><code>s.find()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string = &quot;this is the test string&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string.find(&apos;test&apos;)</span><br><span class=\"line\">12</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-查找子字符串\"><a href=\"#2-2-查找子字符串\" class=\"headerlink\" title=\"2.2 查找子字符串\"></a>2.2 查找子字符串</h3><p><code>s.index()</code><br>找不到就报错，找到就返回索引<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string = &quot;this is the test string&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string.index(&apos;error&apos;)</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">ValueError: substring not found</span><br><span class=\"line\">&gt;&gt;&gt; string.index(&apos;test&apos;)</span><br><span class=\"line\">12</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-首字母转换成大写\"><a href=\"#2-3-首字母转换成大写\" class=\"headerlink\" title=\"2.3 首字母转换成大写\"></a>2.3 首字母转换成大写</h3><p><code>s.capitalize()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string = &quot;this is the test string&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string.capitalize()</span><br><span class=\"line\">&apos;This is the test string&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-字符串转换成大写\"><a href=\"#2-4-字符串转换成大写\" class=\"headerlink\" title=\"2.4 字符串转换成大写\"></a>2.4 字符串转换成大写</h3><p><code>s.upper()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string.upper()</span><br><span class=\"line\">&apos;THIS IS THE TEST STRING&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-5-字符串转换成小写\"><a href=\"#2-5-字符串转换成小写\" class=\"headerlink\" title=\"2.5 字符串转换成小写\"></a>2.5 字符串转换成小写</h3><p><code>s.lower()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string.lower()</span><br><span class=\"line\">&apos;this is the test string&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-6-大小写互换\"><a href=\"#2-6-大小写互换\" class=\"headerlink\" title=\"2.6 大小写互换\"></a>2.6 大小写互换</h3><p><code>s.swapcase()</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string += &quot;THIS IS CAP&quot;</span><br><span class=\"line\">&gt;&gt;&gt; string</span><br><span class=\"line\">&apos;this is the test stringTHIS IS CAP&apos;</span><br><span class=\"line\">&gt;&gt;&gt; string.swapcase()</span><br><span class=\"line\">&apos;THIS IS THE TEST STRINGthis is cap&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-7-将string转换为list\"><a href=\"#2-7-将string转换为list\" class=\"headerlink\" title=\"2.7 将string转换为list\"></a>2.7 将string转换为list</h3><p><code>s.split()</code><br>默认为空格，可以指定分隔符<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; string.split()</span><br><span class=\"line\">[&apos;this&apos;, &apos;is&apos;, &apos;the&apos;, &apos;test&apos;, &apos;stringTHIS&apos;, &apos;IS&apos;, &apos;CAP&apos;]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-8-将list转换为string\"><a href=\"#2-8-将list转换为string\" class=\"headerlink\" title=\"2.8 将list转换为string\"></a>2.8 将list转换为string</h3><p><code>s.join()</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; &apos;|&apos;.join(string.split())</span><br><span class=\"line\">&apos;this|is|the|test|stringTHIS|IS|CAP&apos;</span><br></pre></td></tr></table></figure></p>\n<p><strong>拓展</strong><br><code>+=</code>和<code>.join</code>实现的效果是一样的，但是<code>+=</code>每次都会新开辟空间，但是<code>.join</code>不用<br>例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; a = &apos;the&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a += &apos; test&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a += &apos; is&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a += &apos; end&apos;</span><br><span class=\"line\">&gt;&gt;&gt; a</span><br><span class=\"line\">&apos;the test is end&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; &apos;&apos;.join(a)</span><br><span class=\"line\">&apos;the test is end&apos;</span><br></pre></td></tr></table></figure></p>\n"},{"title":"python字符串对齐","date":"2018-10-13T03:15:18.000Z","_content":"\n# python字符串对齐\n\n```\ntitle = \"九九乘法口诀表\"\n```\n\n## 1. 使用`ljust`,`rjust`,`center`方法\n```\nljust(s, width, *args)\n        ljust(s, width[, fillchar]) -> string\n        \n        Return a left-justified version of s, in a field of the\n        specified width, padded with spaces as needed.  The string is\n        never truncated.  If specified the fillchar is used instead of spaces.\n\nrjust(s, width, *args)\n        rjust(s, width[, fillchar]) -> string\n        \n        Return a right-justified version of s, in a field of the\n        specified width, padded with spaces as needed.  The string is\n        never truncated.  If specified the fillchar is used instead of spaces.\n\ncenter(s, width, *args)\n        center(s, width[, fillchar]) -> string\n        \n        Return a center version of s, in a field of the specified\n        width. padded with spaces as needed.  The string is never\n        truncated.  If specified the fillchar is used instead of spaces.\n```\n\n不指定填充字符默认空格\n```\n# 左对齐\nprint(title.ljust(100))\n# 右对齐\nprint(title.rjust(100))\n# 居中 \nprint(title.center(100))\n```\n\n指定填充字符为星号\n```\nprint(title.ljust(100,'*'))\nprint(title.rjust(100,'*'))\nprint(title.center(100,'*'))\n\n```\n\n## 2. 使用`format`方法\n\n`<` 左对齐\n`>` 右对齐\n`^` 居中对齐\n不指定填充字符默认空格\n```\nprint(format(title,\"<100\"));\nprint(format(title,\">100\"));\nprint(format(title,\"^100\"));\n\nprint('{:<100}'.format(title))\nprint('{:>100}'.format(title))\nprint('{:^100}'.format(title))\n\n```\n\n指定填充字符为星号\n```\nprint(format(title,\"*<100\"));\nprint(format(title,\"*>100\"));\nprint(format(title,\"*^100\"));\n\nprint('{:*<100}'.format(title))\nprint('{:>*100}'.format(title))\nprint('{:^*100}'.format(title))\n\n```\n\n精度与类型f\n```\nprint('{:.2f}'.format(3.1415926))\n```\n\n进制\n```\nprint('{:b}'.format(13))\nprint('{:o}'.format(13))\nprint('{:d}'.format(13))\nprint('{:x}'.format(13))\n```\n\n用逗号作金额的分隔符\n```\nprint('{:,}'.format(123456789))\n```\n\n\n\n","source":"_posts/python字符串对齐.md","raw":"---\ntitle: python字符串对齐\ndate: 2018-10-13 11:15:18\ntags: python\n---\n\n# python字符串对齐\n\n```\ntitle = \"九九乘法口诀表\"\n```\n\n## 1. 使用`ljust`,`rjust`,`center`方法\n```\nljust(s, width, *args)\n        ljust(s, width[, fillchar]) -> string\n        \n        Return a left-justified version of s, in a field of the\n        specified width, padded with spaces as needed.  The string is\n        never truncated.  If specified the fillchar is used instead of spaces.\n\nrjust(s, width, *args)\n        rjust(s, width[, fillchar]) -> string\n        \n        Return a right-justified version of s, in a field of the\n        specified width, padded with spaces as needed.  The string is\n        never truncated.  If specified the fillchar is used instead of spaces.\n\ncenter(s, width, *args)\n        center(s, width[, fillchar]) -> string\n        \n        Return a center version of s, in a field of the specified\n        width. padded with spaces as needed.  The string is never\n        truncated.  If specified the fillchar is used instead of spaces.\n```\n\n不指定填充字符默认空格\n```\n# 左对齐\nprint(title.ljust(100))\n# 右对齐\nprint(title.rjust(100))\n# 居中 \nprint(title.center(100))\n```\n\n指定填充字符为星号\n```\nprint(title.ljust(100,'*'))\nprint(title.rjust(100,'*'))\nprint(title.center(100,'*'))\n\n```\n\n## 2. 使用`format`方法\n\n`<` 左对齐\n`>` 右对齐\n`^` 居中对齐\n不指定填充字符默认空格\n```\nprint(format(title,\"<100\"));\nprint(format(title,\">100\"));\nprint(format(title,\"^100\"));\n\nprint('{:<100}'.format(title))\nprint('{:>100}'.format(title))\nprint('{:^100}'.format(title))\n\n```\n\n指定填充字符为星号\n```\nprint(format(title,\"*<100\"));\nprint(format(title,\"*>100\"));\nprint(format(title,\"*^100\"));\n\nprint('{:*<100}'.format(title))\nprint('{:>*100}'.format(title))\nprint('{:^*100}'.format(title))\n\n```\n\n精度与类型f\n```\nprint('{:.2f}'.format(3.1415926))\n```\n\n进制\n```\nprint('{:b}'.format(13))\nprint('{:o}'.format(13))\nprint('{:d}'.format(13))\nprint('{:x}'.format(13))\n```\n\n用逗号作金额的分隔符\n```\nprint('{:,}'.format(123456789))\n```\n\n\n\n","slug":"python字符串对齐","published":1,"updated":"2018-10-17T12:45:21.072Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j53001izahira316h2k","content":"<h1 id=\"python字符串对齐\"><a href=\"#python字符串对齐\" class=\"headerlink\" title=\"python字符串对齐\"></a>python字符串对齐</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title = &quot;九九乘法口诀表&quot;</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-使用ljust-rjust-center方法\"><a href=\"#1-使用ljust-rjust-center方法\" class=\"headerlink\" title=\"1. 使用ljust,rjust,center方法\"></a>1. 使用<code>ljust</code>,<code>rjust</code>,<code>center</code>方法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ljust(s, width, *args)</span><br><span class=\"line\">        ljust(s, width[, fillchar]) -&gt; string</span><br><span class=\"line\">        </span><br><span class=\"line\">        Return a left-justified version of s, in a field of the</span><br><span class=\"line\">        specified width, padded with spaces as needed.  The string is</span><br><span class=\"line\">        never truncated.  If specified the fillchar is used instead of spaces.</span><br><span class=\"line\"></span><br><span class=\"line\">rjust(s, width, *args)</span><br><span class=\"line\">        rjust(s, width[, fillchar]) -&gt; string</span><br><span class=\"line\">        </span><br><span class=\"line\">        Return a right-justified version of s, in a field of the</span><br><span class=\"line\">        specified width, padded with spaces as needed.  The string is</span><br><span class=\"line\">        never truncated.  If specified the fillchar is used instead of spaces.</span><br><span class=\"line\"></span><br><span class=\"line\">center(s, width, *args)</span><br><span class=\"line\">        center(s, width[, fillchar]) -&gt; string</span><br><span class=\"line\">        </span><br><span class=\"line\">        Return a center version of s, in a field of the specified</span><br><span class=\"line\">        width. padded with spaces as needed.  The string is never</span><br><span class=\"line\">        truncated.  If specified the fillchar is used instead of spaces.</span><br></pre></td></tr></table></figure>\n<p>不指定填充字符默认空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 左对齐</span><br><span class=\"line\">print(title.ljust(100))</span><br><span class=\"line\"># 右对齐</span><br><span class=\"line\">print(title.rjust(100))</span><br><span class=\"line\"># 居中 </span><br><span class=\"line\">print(title.center(100))</span><br></pre></td></tr></table></figure></p>\n<p>指定填充字符为星号<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(title.ljust(100,&apos;*&apos;))</span><br><span class=\"line\">print(title.rjust(100,&apos;*&apos;))</span><br><span class=\"line\">print(title.center(100,&apos;*&apos;))</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-使用format方法\"><a href=\"#2-使用format方法\" class=\"headerlink\" title=\"2. 使用format方法\"></a>2. 使用<code>format</code>方法</h2><p><code>&lt;</code> 左对齐<br><code>&gt;</code> 右对齐<br><code>^</code> 居中对齐<br>不指定填充字符默认空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(format(title,&quot;&lt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;&gt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;^100&quot;));</span><br><span class=\"line\"></span><br><span class=\"line\">print(&apos;&#123;:&lt;100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:&gt;100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:^100&#125;&apos;.format(title))</span><br></pre></td></tr></table></figure></p>\n<p>指定填充字符为星号<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(format(title,&quot;*&lt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;*&gt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;*^100&quot;));</span><br><span class=\"line\"></span><br><span class=\"line\">print(&apos;&#123;:*&lt;100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:&gt;*100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:^*100&#125;&apos;.format(title))</span><br></pre></td></tr></table></figure></p>\n<p>精度与类型f<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(&apos;&#123;:.2f&#125;&apos;.format(3.1415926))</span><br></pre></td></tr></table></figure></p>\n<p>进制<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(&apos;&#123;:b&#125;&apos;.format(13))</span><br><span class=\"line\">print(&apos;&#123;:o&#125;&apos;.format(13))</span><br><span class=\"line\">print(&apos;&#123;:d&#125;&apos;.format(13))</span><br><span class=\"line\">print(&apos;&#123;:x&#125;&apos;.format(13))</span><br></pre></td></tr></table></figure></p>\n<p>用逗号作金额的分隔符<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(&apos;&#123;:,&#125;&apos;.format(123456789))</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"python字符串对齐\"><a href=\"#python字符串对齐\" class=\"headerlink\" title=\"python字符串对齐\"></a>python字符串对齐</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title = &quot;九九乘法口诀表&quot;</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-使用ljust-rjust-center方法\"><a href=\"#1-使用ljust-rjust-center方法\" class=\"headerlink\" title=\"1. 使用ljust,rjust,center方法\"></a>1. 使用<code>ljust</code>,<code>rjust</code>,<code>center</code>方法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ljust(s, width, *args)</span><br><span class=\"line\">        ljust(s, width[, fillchar]) -&gt; string</span><br><span class=\"line\">        </span><br><span class=\"line\">        Return a left-justified version of s, in a field of the</span><br><span class=\"line\">        specified width, padded with spaces as needed.  The string is</span><br><span class=\"line\">        never truncated.  If specified the fillchar is used instead of spaces.</span><br><span class=\"line\"></span><br><span class=\"line\">rjust(s, width, *args)</span><br><span class=\"line\">        rjust(s, width[, fillchar]) -&gt; string</span><br><span class=\"line\">        </span><br><span class=\"line\">        Return a right-justified version of s, in a field of the</span><br><span class=\"line\">        specified width, padded with spaces as needed.  The string is</span><br><span class=\"line\">        never truncated.  If specified the fillchar is used instead of spaces.</span><br><span class=\"line\"></span><br><span class=\"line\">center(s, width, *args)</span><br><span class=\"line\">        center(s, width[, fillchar]) -&gt; string</span><br><span class=\"line\">        </span><br><span class=\"line\">        Return a center version of s, in a field of the specified</span><br><span class=\"line\">        width. padded with spaces as needed.  The string is never</span><br><span class=\"line\">        truncated.  If specified the fillchar is used instead of spaces.</span><br></pre></td></tr></table></figure>\n<p>不指定填充字符默认空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 左对齐</span><br><span class=\"line\">print(title.ljust(100))</span><br><span class=\"line\"># 右对齐</span><br><span class=\"line\">print(title.rjust(100))</span><br><span class=\"line\"># 居中 </span><br><span class=\"line\">print(title.center(100))</span><br></pre></td></tr></table></figure></p>\n<p>指定填充字符为星号<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(title.ljust(100,&apos;*&apos;))</span><br><span class=\"line\">print(title.rjust(100,&apos;*&apos;))</span><br><span class=\"line\">print(title.center(100,&apos;*&apos;))</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-使用format方法\"><a href=\"#2-使用format方法\" class=\"headerlink\" title=\"2. 使用format方法\"></a>2. 使用<code>format</code>方法</h2><p><code>&lt;</code> 左对齐<br><code>&gt;</code> 右对齐<br><code>^</code> 居中对齐<br>不指定填充字符默认空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(format(title,&quot;&lt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;&gt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;^100&quot;));</span><br><span class=\"line\"></span><br><span class=\"line\">print(&apos;&#123;:&lt;100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:&gt;100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:^100&#125;&apos;.format(title))</span><br></pre></td></tr></table></figure></p>\n<p>指定填充字符为星号<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(format(title,&quot;*&lt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;*&gt;100&quot;));</span><br><span class=\"line\">print(format(title,&quot;*^100&quot;));</span><br><span class=\"line\"></span><br><span class=\"line\">print(&apos;&#123;:*&lt;100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:&gt;*100&#125;&apos;.format(title))</span><br><span class=\"line\">print(&apos;&#123;:^*100&#125;&apos;.format(title))</span><br></pre></td></tr></table></figure></p>\n<p>精度与类型f<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(&apos;&#123;:.2f&#125;&apos;.format(3.1415926))</span><br></pre></td></tr></table></figure></p>\n<p>进制<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(&apos;&#123;:b&#125;&apos;.format(13))</span><br><span class=\"line\">print(&apos;&#123;:o&#125;&apos;.format(13))</span><br><span class=\"line\">print(&apos;&#123;:d&#125;&apos;.format(13))</span><br><span class=\"line\">print(&apos;&#123;:x&#125;&apos;.format(13))</span><br></pre></td></tr></table></figure></p>\n<p>用逗号作金额的分隔符<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(&apos;&#123;:,&#125;&apos;.format(123456789))</span><br></pre></td></tr></table></figure></p>\n"},{"title":"python字符编码","date":"2017-03-20T13:20:21.000Z","_content":"## 1. ASSIC码\n一共规定了128个字符的编码\n\n### 1.1 ord函数\n`ord('single-char')`\n\n```\nord(...)\n    ord(c) -> integer\n    \n    Return the integer ordinal of a one-character string.\n```\n\n```\n>>> ord('a')\n97\n>>> type(ord('a'))\n<type 'int'>\n```\n\n```\nstring = 'Hello World'\nfor i in string:\n    print ord(i)\n```\n\n```\nstring = 'Hello World'\nlist_ascii = [ord(i) for i in string]\nprint list_ascii\n```\n\n### 1.2 chr函数\n`chr(number)`\n\n```\nchr(...)\n    chr(i) -> character\n        \n            Return a string of one character with ordinal i; 0 <= i < 256.\n```\n\n\n\n## 2. Unicode编码\n\n16位 可以存下汉字\n\n### 2.1 默认编码是ASCII\n```\n>>> a = 'hello'\n>>> type(a)\n<type 'str'>\n>>> a\n'hello'\n```\n\n### 2.2 加`u`则指定为Unicode\n```\n>>> a = u'hello'\n>>> type(a)\n<type 'unicode'>\n>>> a\nu'hello'\n```\n\n\n```\n>>> b=u'你好'\n>>> b\nu'\\u4f60\\u597d'\n>>> len(b)\n2\n```\n\n## 3. UTF-8编码\n\n```\n# 转换成utf-8\n>>> b.encode('utf-8')\n'\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd'\n\n\n>>> b_utf8 = b.encode('utf-8')\n>>> len(b_utf8)\n6\n\n```\n\n## 4. Unicode和UTF-8的转换\n\n### 4.1 Unicode >> UTF-8    \n\n```\nname.encode('utf-8')\n```\n\n```\n>>> b=u'你好'\n# Unicode转换成UTF-8 \n>>> b_utf8=b.encode('utf-8')\n```\n\n### 4.2 UTF-8  >> Unicode\n\n```\nname_utf8.decode('utf-8')\n```\n```\n>>> b_utf8\n'\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd'\n>>> b_utf8.decode('utf-8')\nu'\\u4f60\\u597d'\n```\n\n## 5. 指定程序的编码方式\n程序如果有中文,需要指定编码方式\n```\n#_*_ coding:utf-8 _*_\n\nname = u'中文'\nprint name\n```","source":"_posts/python字符编码.md","raw":"---\ntitle: python字符编码\ndate: 2017-03-20 21:20:21\ntags: python\n---\n## 1. ASSIC码\n一共规定了128个字符的编码\n\n### 1.1 ord函数\n`ord('single-char')`\n\n```\nord(...)\n    ord(c) -> integer\n    \n    Return the integer ordinal of a one-character string.\n```\n\n```\n>>> ord('a')\n97\n>>> type(ord('a'))\n<type 'int'>\n```\n\n```\nstring = 'Hello World'\nfor i in string:\n    print ord(i)\n```\n\n```\nstring = 'Hello World'\nlist_ascii = [ord(i) for i in string]\nprint list_ascii\n```\n\n### 1.2 chr函数\n`chr(number)`\n\n```\nchr(...)\n    chr(i) -> character\n        \n            Return a string of one character with ordinal i; 0 <= i < 256.\n```\n\n\n\n## 2. Unicode编码\n\n16位 可以存下汉字\n\n### 2.1 默认编码是ASCII\n```\n>>> a = 'hello'\n>>> type(a)\n<type 'str'>\n>>> a\n'hello'\n```\n\n### 2.2 加`u`则指定为Unicode\n```\n>>> a = u'hello'\n>>> type(a)\n<type 'unicode'>\n>>> a\nu'hello'\n```\n\n\n```\n>>> b=u'你好'\n>>> b\nu'\\u4f60\\u597d'\n>>> len(b)\n2\n```\n\n## 3. UTF-8编码\n\n```\n# 转换成utf-8\n>>> b.encode('utf-8')\n'\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd'\n\n\n>>> b_utf8 = b.encode('utf-8')\n>>> len(b_utf8)\n6\n\n```\n\n## 4. Unicode和UTF-8的转换\n\n### 4.1 Unicode >> UTF-8    \n\n```\nname.encode('utf-8')\n```\n\n```\n>>> b=u'你好'\n# Unicode转换成UTF-8 \n>>> b_utf8=b.encode('utf-8')\n```\n\n### 4.2 UTF-8  >> Unicode\n\n```\nname_utf8.decode('utf-8')\n```\n```\n>>> b_utf8\n'\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd'\n>>> b_utf8.decode('utf-8')\nu'\\u4f60\\u597d'\n```\n\n## 5. 指定程序的编码方式\n程序如果有中文,需要指定编码方式\n```\n#_*_ coding:utf-8 _*_\n\nname = u'中文'\nprint name\n```","slug":"python字符编码","published":1,"updated":"2017-03-21T13:16:24.321Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j54001kzahiuxgjb2l8","content":"<h2 id=\"1-ASSIC码\"><a href=\"#1-ASSIC码\" class=\"headerlink\" title=\"1. ASSIC码\"></a>1. ASSIC码</h2><p>一共规定了128个字符的编码</p>\n<h3 id=\"1-1-ord函数\"><a href=\"#1-1-ord函数\" class=\"headerlink\" title=\"1.1 ord函数\"></a>1.1 ord函数</h3><p><code>ord(&#39;single-char&#39;)</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ord(...)</span><br><span class=\"line\">    ord(c) -&gt; integer</span><br><span class=\"line\">    </span><br><span class=\"line\">    Return the integer ordinal of a one-character string.</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; ord(&apos;a&apos;)</span><br><span class=\"line\">97</span><br><span class=\"line\">&gt;&gt;&gt; type(ord(&apos;a&apos;))</span><br><span class=\"line\">&lt;type &apos;int&apos;&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string = &apos;Hello World&apos;</span><br><span class=\"line\">for i in string:</span><br><span class=\"line\">    print ord(i)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string = &apos;Hello World&apos;</span><br><span class=\"line\">list_ascii = [ord(i) for i in string]</span><br><span class=\"line\">print list_ascii</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-chr函数\"><a href=\"#1-2-chr函数\" class=\"headerlink\" title=\"1.2 chr函数\"></a>1.2 chr函数</h3><p><code>chr(number)</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chr(...)</span><br><span class=\"line\">    chr(i) -&gt; character</span><br><span class=\"line\">        </span><br><span class=\"line\">            Return a string of one character with ordinal i; 0 &lt;= i &lt; 256.</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-Unicode编码\"><a href=\"#2-Unicode编码\" class=\"headerlink\" title=\"2. Unicode编码\"></a>2. Unicode编码</h2><p>16位 可以存下汉字</p>\n<h3 id=\"2-1-默认编码是ASCII\"><a href=\"#2-1-默认编码是ASCII\" class=\"headerlink\" title=\"2.1 默认编码是ASCII\"></a>2.1 默认编码是ASCII</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; a = &apos;hello&apos;</span><br><span class=\"line\">&gt;&gt;&gt; type(a)</span><br><span class=\"line\">&lt;type &apos;str&apos;&gt;</span><br><span class=\"line\">&gt;&gt;&gt; a</span><br><span class=\"line\">&apos;hello&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-加u则指定为Unicode\"><a href=\"#2-2-加u则指定为Unicode\" class=\"headerlink\" title=\"2.2 加u则指定为Unicode\"></a>2.2 加<code>u</code>则指定为Unicode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; a = u&apos;hello&apos;</span><br><span class=\"line\">&gt;&gt;&gt; type(a)</span><br><span class=\"line\">&lt;type &apos;unicode&apos;&gt;</span><br><span class=\"line\">&gt;&gt;&gt; a</span><br><span class=\"line\">u&apos;hello&apos;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b=u&apos;你好&apos;</span><br><span class=\"line\">&gt;&gt;&gt; b</span><br><span class=\"line\">u&apos;\\u4f60\\u597d&apos;</span><br><span class=\"line\">&gt;&gt;&gt; len(b)</span><br><span class=\"line\">2</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-UTF-8编码\"><a href=\"#3-UTF-8编码\" class=\"headerlink\" title=\"3. UTF-8编码\"></a>3. UTF-8编码</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 转换成utf-8</span><br><span class=\"line\">&gt;&gt;&gt; b.encode(&apos;utf-8&apos;)</span><br><span class=\"line\">&apos;\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; b_utf8 = b.encode(&apos;utf-8&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; len(b_utf8)</span><br><span class=\"line\">6</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-Unicode和UTF-8的转换\"><a href=\"#4-Unicode和UTF-8的转换\" class=\"headerlink\" title=\"4. Unicode和UTF-8的转换\"></a>4. Unicode和UTF-8的转换</h2><h3 id=\"4-1-Unicode-gt-gt-UTF-8\"><a href=\"#4-1-Unicode-gt-gt-UTF-8\" class=\"headerlink\" title=\"4.1 Unicode &gt;&gt; UTF-8\"></a>4.1 Unicode &gt;&gt; UTF-8</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name.encode(&apos;utf-8&apos;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b=u&apos;你好&apos;</span><br><span class=\"line\"># Unicode转换成UTF-8 </span><br><span class=\"line\">&gt;&gt;&gt; b_utf8=b.encode(&apos;utf-8&apos;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-2-UTF-8-gt-gt-Unicode\"><a href=\"#4-2-UTF-8-gt-gt-Unicode\" class=\"headerlink\" title=\"4.2 UTF-8  &gt;&gt; Unicode\"></a>4.2 UTF-8  &gt;&gt; Unicode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name_utf8.decode(&apos;utf-8&apos;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b_utf8</span><br><span class=\"line\">&apos;\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd&apos;</span><br><span class=\"line\">&gt;&gt;&gt; b_utf8.decode(&apos;utf-8&apos;)</span><br><span class=\"line\">u&apos;\\u4f60\\u597d&apos;</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-指定程序的编码方式\"><a href=\"#5-指定程序的编码方式\" class=\"headerlink\" title=\"5. 指定程序的编码方式\"></a>5. 指定程序的编码方式</h2><p>程序如果有中文,需要指定编码方式<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#_*_ coding:utf-8 _*_</span><br><span class=\"line\"></span><br><span class=\"line\">name = u&apos;中文&apos;</span><br><span class=\"line\">print name</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-ASSIC码\"><a href=\"#1-ASSIC码\" class=\"headerlink\" title=\"1. ASSIC码\"></a>1. ASSIC码</h2><p>一共规定了128个字符的编码</p>\n<h3 id=\"1-1-ord函数\"><a href=\"#1-1-ord函数\" class=\"headerlink\" title=\"1.1 ord函数\"></a>1.1 ord函数</h3><p><code>ord(&#39;single-char&#39;)</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ord(...)</span><br><span class=\"line\">    ord(c) -&gt; integer</span><br><span class=\"line\">    </span><br><span class=\"line\">    Return the integer ordinal of a one-character string.</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; ord(&apos;a&apos;)</span><br><span class=\"line\">97</span><br><span class=\"line\">&gt;&gt;&gt; type(ord(&apos;a&apos;))</span><br><span class=\"line\">&lt;type &apos;int&apos;&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string = &apos;Hello World&apos;</span><br><span class=\"line\">for i in string:</span><br><span class=\"line\">    print ord(i)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string = &apos;Hello World&apos;</span><br><span class=\"line\">list_ascii = [ord(i) for i in string]</span><br><span class=\"line\">print list_ascii</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-chr函数\"><a href=\"#1-2-chr函数\" class=\"headerlink\" title=\"1.2 chr函数\"></a>1.2 chr函数</h3><p><code>chr(number)</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chr(...)</span><br><span class=\"line\">    chr(i) -&gt; character</span><br><span class=\"line\">        </span><br><span class=\"line\">            Return a string of one character with ordinal i; 0 &lt;= i &lt; 256.</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-Unicode编码\"><a href=\"#2-Unicode编码\" class=\"headerlink\" title=\"2. Unicode编码\"></a>2. Unicode编码</h2><p>16位 可以存下汉字</p>\n<h3 id=\"2-1-默认编码是ASCII\"><a href=\"#2-1-默认编码是ASCII\" class=\"headerlink\" title=\"2.1 默认编码是ASCII\"></a>2.1 默认编码是ASCII</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; a = &apos;hello&apos;</span><br><span class=\"line\">&gt;&gt;&gt; type(a)</span><br><span class=\"line\">&lt;type &apos;str&apos;&gt;</span><br><span class=\"line\">&gt;&gt;&gt; a</span><br><span class=\"line\">&apos;hello&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-加u则指定为Unicode\"><a href=\"#2-2-加u则指定为Unicode\" class=\"headerlink\" title=\"2.2 加u则指定为Unicode\"></a>2.2 加<code>u</code>则指定为Unicode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; a = u&apos;hello&apos;</span><br><span class=\"line\">&gt;&gt;&gt; type(a)</span><br><span class=\"line\">&lt;type &apos;unicode&apos;&gt;</span><br><span class=\"line\">&gt;&gt;&gt; a</span><br><span class=\"line\">u&apos;hello&apos;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b=u&apos;你好&apos;</span><br><span class=\"line\">&gt;&gt;&gt; b</span><br><span class=\"line\">u&apos;\\u4f60\\u597d&apos;</span><br><span class=\"line\">&gt;&gt;&gt; len(b)</span><br><span class=\"line\">2</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-UTF-8编码\"><a href=\"#3-UTF-8编码\" class=\"headerlink\" title=\"3. UTF-8编码\"></a>3. UTF-8编码</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 转换成utf-8</span><br><span class=\"line\">&gt;&gt;&gt; b.encode(&apos;utf-8&apos;)</span><br><span class=\"line\">&apos;\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; b_utf8 = b.encode(&apos;utf-8&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; len(b_utf8)</span><br><span class=\"line\">6</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-Unicode和UTF-8的转换\"><a href=\"#4-Unicode和UTF-8的转换\" class=\"headerlink\" title=\"4. Unicode和UTF-8的转换\"></a>4. Unicode和UTF-8的转换</h2><h3 id=\"4-1-Unicode-gt-gt-UTF-8\"><a href=\"#4-1-Unicode-gt-gt-UTF-8\" class=\"headerlink\" title=\"4.1 Unicode &gt;&gt; UTF-8\"></a>4.1 Unicode &gt;&gt; UTF-8</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name.encode(&apos;utf-8&apos;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b=u&apos;你好&apos;</span><br><span class=\"line\"># Unicode转换成UTF-8 </span><br><span class=\"line\">&gt;&gt;&gt; b_utf8=b.encode(&apos;utf-8&apos;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-2-UTF-8-gt-gt-Unicode\"><a href=\"#4-2-UTF-8-gt-gt-Unicode\" class=\"headerlink\" title=\"4.2 UTF-8  &gt;&gt; Unicode\"></a>4.2 UTF-8  &gt;&gt; Unicode</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name_utf8.decode(&apos;utf-8&apos;)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; b_utf8</span><br><span class=\"line\">&apos;\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd&apos;</span><br><span class=\"line\">&gt;&gt;&gt; b_utf8.decode(&apos;utf-8&apos;)</span><br><span class=\"line\">u&apos;\\u4f60\\u597d&apos;</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-指定程序的编码方式\"><a href=\"#5-指定程序的编码方式\" class=\"headerlink\" title=\"5. 指定程序的编码方式\"></a>5. 指定程序的编码方式</h2><p>程序如果有中文,需要指定编码方式<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#_*_ coding:utf-8 _*_</span><br><span class=\"line\"></span><br><span class=\"line\">name = u&apos;中文&apos;</span><br><span class=\"line\">print name</span><br></pre></td></tr></table></figure></p>\n"},{"title":"python指定字符编码","date":"2017-02-07T01:37:14.000Z","_content":"\npython指定字符编码的方式有多种\n**编码格式是要写在解释器的下面的**\n\n\n## 1.指定方法\n```\n#!/usr/bin/env python\n# _*_ coding:utf-8 _*_\n```\n\n```\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n```\n\n```\n#!/usr/bin/env python\n# coding:utf-8\n```\n\n## 2.使用场景\n- 在python的程序中，如果有中文字符需要指定字符编码方式，无论是否是在注释中。\n- 在数据库操作中，读取或者写入的内容中有汉字时。具体的方法如下:\n```\n#!/usr/bin/env python\n# _*_ coding:utf-8 _*_\n\nimport sys\nreload(sys)                                                                      \nsys.setdefaultencoding('utf8')\n```\n","source":"_posts/python指定字符编码.md","raw":"---\ntitle: python指定字符编码\ndate: 2017-02-07 09:37:14\ntags: python\n---\n\npython指定字符编码的方式有多种\n**编码格式是要写在解释器的下面的**\n\n\n## 1.指定方法\n```\n#!/usr/bin/env python\n# _*_ coding:utf-8 _*_\n```\n\n```\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n```\n\n```\n#!/usr/bin/env python\n# coding:utf-8\n```\n\n## 2.使用场景\n- 在python的程序中，如果有中文字符需要指定字符编码方式，无论是否是在注释中。\n- 在数据库操作中，读取或者写入的内容中有汉字时。具体的方法如下:\n```\n#!/usr/bin/env python\n# _*_ coding:utf-8 _*_\n\nimport sys\nreload(sys)                                                                      \nsys.setdefaultencoding('utf8')\n```\n","slug":"python指定字符编码","published":1,"updated":"2017-02-07T05:08:31.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j54001mzahijyk99kf2","content":"<p>python指定字符编码的方式有多种<br><strong>编码格式是要写在解释器的下面的</strong></p>\n<h2 id=\"1-指定方法\"><a href=\"#1-指定方法\" class=\"headerlink\" title=\"1.指定方法\"></a>1.指定方法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># _*_ coding:utf-8 _*_</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># -*- coding:utf-8 -*-</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># coding:utf-8</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-使用场景\"><a href=\"#2-使用场景\" class=\"headerlink\" title=\"2.使用场景\"></a>2.使用场景</h2><ul>\n<li>在python的程序中，如果有中文字符需要指定字符编码方式，无论是否是在注释中。</li>\n<li>在数据库操作中，读取或者写入的内容中有汉字时。具体的方法如下:<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># _*_ coding:utf-8 _*_</span><br><span class=\"line\"></span><br><span class=\"line\">import sys</span><br><span class=\"line\">reload(sys)                                                                      </span><br><span class=\"line\">sys.setdefaultencoding(&apos;utf8&apos;)</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>python指定字符编码的方式有多种<br><strong>编码格式是要写在解释器的下面的</strong></p>\n<h2 id=\"1-指定方法\"><a href=\"#1-指定方法\" class=\"headerlink\" title=\"1.指定方法\"></a>1.指定方法</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># _*_ coding:utf-8 _*_</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># -*- coding:utf-8 -*-</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># coding:utf-8</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-使用场景\"><a href=\"#2-使用场景\" class=\"headerlink\" title=\"2.使用场景\"></a>2.使用场景</h2><ul>\n<li>在python的程序中，如果有中文字符需要指定字符编码方式，无论是否是在注释中。</li>\n<li>在数据库操作中，读取或者写入的内容中有汉字时。具体的方法如下:<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/env python</span><br><span class=\"line\"># _*_ coding:utf-8 _*_</span><br><span class=\"line\"></span><br><span class=\"line\">import sys</span><br><span class=\"line\">reload(sys)                                                                      </span><br><span class=\"line\">sys.setdefaultencoding(&apos;utf8&apos;)</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n"},{"title":"python文件处理","date":"2017-03-22T12:51:07.000Z","_content":"\n## 1. 文件操作\n\nfile('文件名','操作符')\n**省略操作符 默认为读**\n\n| 模式 | 操作符 | 说明                                           |\n| --   | --     | --                                             |\n| 只读 | `r`    | 文件必须存在                                   |\n| 只写 | `w`    | 文件不存在则创建，文件存在则清空文件内容       |\n| 追加 | `a`    | 文件不存在则创建，文件存在则在文件末尾添加内容 |\n| 读写 | `r+`   |                                                |\n| 写读 | `w+`   |                                                |\n| 追加 | `a+`   |                                                |\n\n在python中，以什么样的方式出来文件是比较重要的，如果你\n**以只读的方式打开文件，那你就不能写操作**\n**以只写的方式打开文件，那你就不能读操作**\n**以追加的方式打开文件，也应该是不能进行读操作的**\n**<font color=red>操作完毕，不要忘记关闭文件</font>**\n\n### 1.1 以只读方式打开文件\n```\n>>> f = file('test','r')  #f为该文件对象\n>>> f.readline()\n'hello world\\n'\n>>> f.readline()\n'\\n'\n>>> f.readline()\n'this is the second line\\n'\n>>> f.readline()\n>>> f.close()\n\n```\n\n### 1.2 以只写方式打开文件\n**如果文件存在并且有内容，则会把文件之前的内容清除；如果文件不存在。则会创建文件**\n```\n>>> f = file('test','w')\n>>> f.read()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIOError: File not open for reading\n\n>>> f.readline()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIOError: File not open for reading\n\n>>> f.write('this is the newest line')\n>>> f.close()\n>>> f_read = file('test','r')\n>>> f_read.read()\n'this is the newest line'\n>>> f_read.read()\n''\n```\n\n### 1.3 以追加的方式打开文件\n```\n>>> f = file('test','a') \n>>> f.write('second line') \n>>> f.write('\\nthird line')\n>>>\n```\n这个时候，打开文件，刚才写入的内容并没有写入到文件里。\n```\n>>> f_read = file('test','r')\n>>> f_read.readline()\n'this is the newest line'\n```\n**文件在关闭的时候才会写入到文件里**或者**强制写入**\n```\n>>> f.flush()\n```\n追加模式也不可以读\n```\n>>> f.read()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIOError: File not open for reading\n\n```\n\n**拓展**\n1. 去掉换行符 \n`line.strip('换行符')`\n省略换行符默认为空格\n\n2. 把行分割 \n`line.split('分隔符')`\n\n## 2. 实例\n\n### 2.1 读取`/etc/passwd`的内容\n```\nf = file('/etc/passwd')\nfor line in f.readlines(): #循环文件的每一行 \n    line = line.strip('\\n').split(':') \n    print line\n```\n得到的结果如下**一个列表**：\n```\n['root', 'x', '0', '0', 'root', '/root', '/bin/bash']\n['daemon', 'x', '1', '1', 'daemon', '/usr/sbin', '/usr/sbin/nologin']\n['bin', 'x', '2', '2', 'bin', '/bin', '/usr/sbin/nologin']\n['sys', 'x', '3', '3', 'sys', '/dev', '/usr/sbin/nologin']\n['sync', 'x', '4', '65534', 'sync', '/bin', '/bin/sync']\n['games', 'x', '5', '60', 'games', '/usr/games', '/usr/sbin/nologin']\n['man', 'x', '6', '12', 'man', '/var/cache/man', '/usr/sbin/nologin']\n\n```\n打印第1列，第2列\n```\nprint line[0],line[1]\n```\n\n### 2.2 写文件\n语言本身不存在文件保护的设置，避免多个程序对同一个文件进行操作，需要自己来完成。\n```\n>>> f.closed\nFalse\n```\n**如果`f.closed`值为False,说明文件已经被打开**\n\n显示文件的字符集，默认为ASCII\n```\n>>> f.encoding\n>>> print f.encoding\nNone\n```\n\n```\n>>> f = file('test_coding','w') \n>>> f.write(u'测试文件编码') \nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-5: ordinal not in range(128)\n>>> f.write(u'测试文件编码'.encode('utf-8'))\n>>> f.flush()\n```\n\n读到末尾，`next()`会报错\n```\n>>> f = file('test_coding','r') \n>>> f.readline()\n''\n>>> f.next()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nStopIteration\n>>> \n```\n\n\n## 3. 文件操作相关方法\nreadline是通过next实现的\n\n| 方法            | 说明                           |\n| ---             | ---                            |\n| f.readlines()   | 以列表的形式读出文件           |\n| f.read()        | 以字符串的形式，一次性读出文件 |\n| f.seek()        | 跳到文件的指定位置             |\n| f.tell()        | 当前位置                       |\n| f.truncate(100) | 从头开始截断文件               |\n| f.writelines()  | 多行写                         |\n| f.xreadlines()  | 逐行读                         |\n\n","source":"_posts/python文件处理.md","raw":"---\ntitle: python文件处理\ndate: 2017-03-22 20:51:07\ntags: python\n---\n\n## 1. 文件操作\n\nfile('文件名','操作符')\n**省略操作符 默认为读**\n\n| 模式 | 操作符 | 说明                                           |\n| --   | --     | --                                             |\n| 只读 | `r`    | 文件必须存在                                   |\n| 只写 | `w`    | 文件不存在则创建，文件存在则清空文件内容       |\n| 追加 | `a`    | 文件不存在则创建，文件存在则在文件末尾添加内容 |\n| 读写 | `r+`   |                                                |\n| 写读 | `w+`   |                                                |\n| 追加 | `a+`   |                                                |\n\n在python中，以什么样的方式出来文件是比较重要的，如果你\n**以只读的方式打开文件，那你就不能写操作**\n**以只写的方式打开文件，那你就不能读操作**\n**以追加的方式打开文件，也应该是不能进行读操作的**\n**<font color=red>操作完毕，不要忘记关闭文件</font>**\n\n### 1.1 以只读方式打开文件\n```\n>>> f = file('test','r')  #f为该文件对象\n>>> f.readline()\n'hello world\\n'\n>>> f.readline()\n'\\n'\n>>> f.readline()\n'this is the second line\\n'\n>>> f.readline()\n>>> f.close()\n\n```\n\n### 1.2 以只写方式打开文件\n**如果文件存在并且有内容，则会把文件之前的内容清除；如果文件不存在。则会创建文件**\n```\n>>> f = file('test','w')\n>>> f.read()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIOError: File not open for reading\n\n>>> f.readline()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIOError: File not open for reading\n\n>>> f.write('this is the newest line')\n>>> f.close()\n>>> f_read = file('test','r')\n>>> f_read.read()\n'this is the newest line'\n>>> f_read.read()\n''\n```\n\n### 1.3 以追加的方式打开文件\n```\n>>> f = file('test','a') \n>>> f.write('second line') \n>>> f.write('\\nthird line')\n>>>\n```\n这个时候，打开文件，刚才写入的内容并没有写入到文件里。\n```\n>>> f_read = file('test','r')\n>>> f_read.readline()\n'this is the newest line'\n```\n**文件在关闭的时候才会写入到文件里**或者**强制写入**\n```\n>>> f.flush()\n```\n追加模式也不可以读\n```\n>>> f.read()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIOError: File not open for reading\n\n```\n\n**拓展**\n1. 去掉换行符 \n`line.strip('换行符')`\n省略换行符默认为空格\n\n2. 把行分割 \n`line.split('分隔符')`\n\n## 2. 实例\n\n### 2.1 读取`/etc/passwd`的内容\n```\nf = file('/etc/passwd')\nfor line in f.readlines(): #循环文件的每一行 \n    line = line.strip('\\n').split(':') \n    print line\n```\n得到的结果如下**一个列表**：\n```\n['root', 'x', '0', '0', 'root', '/root', '/bin/bash']\n['daemon', 'x', '1', '1', 'daemon', '/usr/sbin', '/usr/sbin/nologin']\n['bin', 'x', '2', '2', 'bin', '/bin', '/usr/sbin/nologin']\n['sys', 'x', '3', '3', 'sys', '/dev', '/usr/sbin/nologin']\n['sync', 'x', '4', '65534', 'sync', '/bin', '/bin/sync']\n['games', 'x', '5', '60', 'games', '/usr/games', '/usr/sbin/nologin']\n['man', 'x', '6', '12', 'man', '/var/cache/man', '/usr/sbin/nologin']\n\n```\n打印第1列，第2列\n```\nprint line[0],line[1]\n```\n\n### 2.2 写文件\n语言本身不存在文件保护的设置，避免多个程序对同一个文件进行操作，需要自己来完成。\n```\n>>> f.closed\nFalse\n```\n**如果`f.closed`值为False,说明文件已经被打开**\n\n显示文件的字符集，默认为ASCII\n```\n>>> f.encoding\n>>> print f.encoding\nNone\n```\n\n```\n>>> f = file('test_coding','w') \n>>> f.write(u'测试文件编码') \nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-5: ordinal not in range(128)\n>>> f.write(u'测试文件编码'.encode('utf-8'))\n>>> f.flush()\n```\n\n读到末尾，`next()`会报错\n```\n>>> f = file('test_coding','r') \n>>> f.readline()\n''\n>>> f.next()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nStopIteration\n>>> \n```\n\n\n## 3. 文件操作相关方法\nreadline是通过next实现的\n\n| 方法            | 说明                           |\n| ---             | ---                            |\n| f.readlines()   | 以列表的形式读出文件           |\n| f.read()        | 以字符串的形式，一次性读出文件 |\n| f.seek()        | 跳到文件的指定位置             |\n| f.tell()        | 当前位置                       |\n| f.truncate(100) | 从头开始截断文件               |\n| f.writelines()  | 多行写                         |\n| f.xreadlines()  | 逐行读                         |\n\n","slug":"python文件处理","published":1,"updated":"2017-03-23T13:49:22.090Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j55001ozahicyol1f8h","content":"<h2 id=\"1-文件操作\"><a href=\"#1-文件操作\" class=\"headerlink\" title=\"1. 文件操作\"></a>1. 文件操作</h2><p>file(‘文件名’,’操作符’)<br><strong>省略操作符 默认为读</strong></p>\n<table>\n<thead>\n<tr>\n<th>模式</th>\n<th>操作符</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>只读</td>\n<td><code>r</code></td>\n<td>文件必须存在</td>\n</tr>\n<tr>\n<td>只写</td>\n<td><code>w</code></td>\n<td>文件不存在则创建，文件存在则清空文件内容</td>\n</tr>\n<tr>\n<td>追加</td>\n<td><code>a</code></td>\n<td>文件不存在则创建，文件存在则在文件末尾添加内容</td>\n</tr>\n<tr>\n<td>读写</td>\n<td><code>r+</code></td>\n<td></td>\n</tr>\n<tr>\n<td>写读</td>\n<td><code>w+</code></td>\n<td></td>\n</tr>\n<tr>\n<td>追加</td>\n<td><code>a+</code></td>\n</tr>\n</tbody>\n</table>\n<p>在python中，以什么样的方式出来文件是比较重要的，如果你<br><strong>以只读的方式打开文件，那你就不能写操作</strong><br><strong>以只写的方式打开文件，那你就不能读操作</strong><br><strong>以追加的方式打开文件，也应该是不能进行读操作的</strong><br><strong><font color=\"red\">操作完毕，不要忘记关闭文件</font></strong></p>\n<h3 id=\"1-1-以只读方式打开文件\"><a href=\"#1-1-以只读方式打开文件\" class=\"headerlink\" title=\"1.1 以只读方式打开文件\"></a>1.1 以只读方式打开文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test&apos;,&apos;r&apos;)  #f为该文件对象</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;hello world\\n&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;\\n&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;this is the second line\\n&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&gt;&gt;&gt; f.close()</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-以只写方式打开文件\"><a href=\"#1-2-以只写方式打开文件\" class=\"headerlink\" title=\"1.2 以只写方式打开文件\"></a>1.2 以只写方式打开文件</h3><p><strong>如果文件存在并且有内容，则会把文件之前的内容清除；如果文件不存在。则会创建文件</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test&apos;,&apos;w&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f.read()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">IOError: File not open for reading</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">IOError: File not open for reading</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; f.write(&apos;this is the newest line&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f.close()</span><br><span class=\"line\">&gt;&gt;&gt; f_read = file(&apos;test&apos;,&apos;r&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f_read.read()</span><br><span class=\"line\">&apos;this is the newest line&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f_read.read()</span><br><span class=\"line\">&apos;&apos;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"1-3-以追加的方式打开文件\"><a href=\"#1-3-以追加的方式打开文件\" class=\"headerlink\" title=\"1.3 以追加的方式打开文件\"></a>1.3 以追加的方式打开文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test&apos;,&apos;a&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.write(&apos;second line&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.write(&apos;\\nthird line&apos;)</span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>\n<p>这个时候，打开文件，刚才写入的内容并没有写入到文件里。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f_read = file(&apos;test&apos;,&apos;r&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f_read.readline()</span><br><span class=\"line\">&apos;this is the newest line&apos;</span><br></pre></td></tr></table></figure></p>\n<p><strong>文件在关闭的时候才会写入到文件里</strong>或者<strong>强制写入</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.flush()</span><br></pre></td></tr></table></figure></p>\n<p>追加模式也不可以读<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.read()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">IOError: File not open for reading</span><br></pre></td></tr></table></figure></p>\n<p><strong>拓展</strong></p>\n<ol>\n<li><p>去掉换行符<br><code>line.strip(&#39;换行符&#39;)</code><br>省略换行符默认为空格</p>\n</li>\n<li><p>把行分割<br><code>line.split(&#39;分隔符&#39;)</code></p>\n</li>\n</ol>\n<h2 id=\"2-实例\"><a href=\"#2-实例\" class=\"headerlink\" title=\"2. 实例\"></a>2. 实例</h2><h3 id=\"2-1-读取-etc-passwd的内容\"><a href=\"#2-1-读取-etc-passwd的内容\" class=\"headerlink\" title=\"2.1 读取/etc/passwd的内容\"></a>2.1 读取<code>/etc/passwd</code>的内容</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = file(&apos;/etc/passwd&apos;)</span><br><span class=\"line\">for line in f.readlines(): #循环文件的每一行 </span><br><span class=\"line\">    line = line.strip(&apos;\\n&apos;).split(&apos;:&apos;) </span><br><span class=\"line\">    print line</span><br></pre></td></tr></table></figure>\n<p>得到的结果如下<strong>一个列表</strong>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&apos;root&apos;, &apos;x&apos;, &apos;0&apos;, &apos;0&apos;, &apos;root&apos;, &apos;/root&apos;, &apos;/bin/bash&apos;]</span><br><span class=\"line\">[&apos;daemon&apos;, &apos;x&apos;, &apos;1&apos;, &apos;1&apos;, &apos;daemon&apos;, &apos;/usr/sbin&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;bin&apos;, &apos;x&apos;, &apos;2&apos;, &apos;2&apos;, &apos;bin&apos;, &apos;/bin&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;sys&apos;, &apos;x&apos;, &apos;3&apos;, &apos;3&apos;, &apos;sys&apos;, &apos;/dev&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;sync&apos;, &apos;x&apos;, &apos;4&apos;, &apos;65534&apos;, &apos;sync&apos;, &apos;/bin&apos;, &apos;/bin/sync&apos;]</span><br><span class=\"line\">[&apos;games&apos;, &apos;x&apos;, &apos;5&apos;, &apos;60&apos;, &apos;games&apos;, &apos;/usr/games&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;man&apos;, &apos;x&apos;, &apos;6&apos;, &apos;12&apos;, &apos;man&apos;, &apos;/var/cache/man&apos;, &apos;/usr/sbin/nologin&apos;]</span><br></pre></td></tr></table></figure></p>\n<p>打印第1列，第2列<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print line[0],line[1]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-写文件\"><a href=\"#2-2-写文件\" class=\"headerlink\" title=\"2.2 写文件\"></a>2.2 写文件</h3><p>语言本身不存在文件保护的设置，避免多个程序对同一个文件进行操作，需要自己来完成。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.closed</span><br><span class=\"line\">False</span><br></pre></td></tr></table></figure></p>\n<p><strong>如果<code>f.closed</code>值为False,说明文件已经被打开</strong></p>\n<p>显示文件的字符集，默认为ASCII<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.encoding</span><br><span class=\"line\">&gt;&gt;&gt; print f.encoding</span><br><span class=\"line\">None</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test_coding&apos;,&apos;w&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.write(u&apos;测试文件编码&apos;) </span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">UnicodeEncodeError: &apos;ascii&apos; codec can&apos;t encode characters in position 0-5: ordinal not in range(128)</span><br><span class=\"line\">&gt;&gt;&gt; f.write(u&apos;测试文件编码&apos;.encode(&apos;utf-8&apos;))</span><br><span class=\"line\">&gt;&gt;&gt; f.flush()</span><br></pre></td></tr></table></figure>\n<p>读到末尾，<code>next()</code>会报错<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test_coding&apos;,&apos;r&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.next()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">StopIteration</span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-文件操作相关方法\"><a href=\"#3-文件操作相关方法\" class=\"headerlink\" title=\"3. 文件操作相关方法\"></a>3. 文件操作相关方法</h2><p>readline是通过next实现的</p>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>f.readlines()</td>\n<td>以列表的形式读出文件</td>\n</tr>\n<tr>\n<td>f.read()</td>\n<td>以字符串的形式，一次性读出文件</td>\n</tr>\n<tr>\n<td>f.seek()</td>\n<td>跳到文件的指定位置</td>\n</tr>\n<tr>\n<td>f.tell()</td>\n<td>当前位置</td>\n</tr>\n<tr>\n<td>f.truncate(100)</td>\n<td>从头开始截断文件</td>\n</tr>\n<tr>\n<td>f.writelines()</td>\n<td>多行写</td>\n</tr>\n<tr>\n<td>f.xreadlines()</td>\n<td>逐行读</td>\n</tr>\n</tbody>\n</table>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-文件操作\"><a href=\"#1-文件操作\" class=\"headerlink\" title=\"1. 文件操作\"></a>1. 文件操作</h2><p>file(‘文件名’,’操作符’)<br><strong>省略操作符 默认为读</strong></p>\n<table>\n<thead>\n<tr>\n<th>模式</th>\n<th>操作符</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>只读</td>\n<td><code>r</code></td>\n<td>文件必须存在</td>\n</tr>\n<tr>\n<td>只写</td>\n<td><code>w</code></td>\n<td>文件不存在则创建，文件存在则清空文件内容</td>\n</tr>\n<tr>\n<td>追加</td>\n<td><code>a</code></td>\n<td>文件不存在则创建，文件存在则在文件末尾添加内容</td>\n</tr>\n<tr>\n<td>读写</td>\n<td><code>r+</code></td>\n<td></td>\n</tr>\n<tr>\n<td>写读</td>\n<td><code>w+</code></td>\n<td></td>\n</tr>\n<tr>\n<td>追加</td>\n<td><code>a+</code></td>\n</tr>\n</tbody>\n</table>\n<p>在python中，以什么样的方式出来文件是比较重要的，如果你<br><strong>以只读的方式打开文件，那你就不能写操作</strong><br><strong>以只写的方式打开文件，那你就不能读操作</strong><br><strong>以追加的方式打开文件，也应该是不能进行读操作的</strong><br><strong><font color=\"red\">操作完毕，不要忘记关闭文件</font></strong></p>\n<h3 id=\"1-1-以只读方式打开文件\"><a href=\"#1-1-以只读方式打开文件\" class=\"headerlink\" title=\"1.1 以只读方式打开文件\"></a>1.1 以只读方式打开文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test&apos;,&apos;r&apos;)  #f为该文件对象</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;hello world\\n&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;\\n&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;this is the second line\\n&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&gt;&gt;&gt; f.close()</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-以只写方式打开文件\"><a href=\"#1-2-以只写方式打开文件\" class=\"headerlink\" title=\"1.2 以只写方式打开文件\"></a>1.2 以只写方式打开文件</h3><p><strong>如果文件存在并且有内容，则会把文件之前的内容清除；如果文件不存在。则会创建文件</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test&apos;,&apos;w&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f.read()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">IOError: File not open for reading</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">IOError: File not open for reading</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;&gt; f.write(&apos;this is the newest line&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f.close()</span><br><span class=\"line\">&gt;&gt;&gt; f_read = file(&apos;test&apos;,&apos;r&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f_read.read()</span><br><span class=\"line\">&apos;this is the newest line&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f_read.read()</span><br><span class=\"line\">&apos;&apos;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"1-3-以追加的方式打开文件\"><a href=\"#1-3-以追加的方式打开文件\" class=\"headerlink\" title=\"1.3 以追加的方式打开文件\"></a>1.3 以追加的方式打开文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test&apos;,&apos;a&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.write(&apos;second line&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.write(&apos;\\nthird line&apos;)</span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>\n<p>这个时候，打开文件，刚才写入的内容并没有写入到文件里。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f_read = file(&apos;test&apos;,&apos;r&apos;)</span><br><span class=\"line\">&gt;&gt;&gt; f_read.readline()</span><br><span class=\"line\">&apos;this is the newest line&apos;</span><br></pre></td></tr></table></figure></p>\n<p><strong>文件在关闭的时候才会写入到文件里</strong>或者<strong>强制写入</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.flush()</span><br></pre></td></tr></table></figure></p>\n<p>追加模式也不可以读<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.read()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">IOError: File not open for reading</span><br></pre></td></tr></table></figure></p>\n<p><strong>拓展</strong></p>\n<ol>\n<li><p>去掉换行符<br><code>line.strip(&#39;换行符&#39;)</code><br>省略换行符默认为空格</p>\n</li>\n<li><p>把行分割<br><code>line.split(&#39;分隔符&#39;)</code></p>\n</li>\n</ol>\n<h2 id=\"2-实例\"><a href=\"#2-实例\" class=\"headerlink\" title=\"2. 实例\"></a>2. 实例</h2><h3 id=\"2-1-读取-etc-passwd的内容\"><a href=\"#2-1-读取-etc-passwd的内容\" class=\"headerlink\" title=\"2.1 读取/etc/passwd的内容\"></a>2.1 读取<code>/etc/passwd</code>的内容</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f = file(&apos;/etc/passwd&apos;)</span><br><span class=\"line\">for line in f.readlines(): #循环文件的每一行 </span><br><span class=\"line\">    line = line.strip(&apos;\\n&apos;).split(&apos;:&apos;) </span><br><span class=\"line\">    print line</span><br></pre></td></tr></table></figure>\n<p>得到的结果如下<strong>一个列表</strong>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&apos;root&apos;, &apos;x&apos;, &apos;0&apos;, &apos;0&apos;, &apos;root&apos;, &apos;/root&apos;, &apos;/bin/bash&apos;]</span><br><span class=\"line\">[&apos;daemon&apos;, &apos;x&apos;, &apos;1&apos;, &apos;1&apos;, &apos;daemon&apos;, &apos;/usr/sbin&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;bin&apos;, &apos;x&apos;, &apos;2&apos;, &apos;2&apos;, &apos;bin&apos;, &apos;/bin&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;sys&apos;, &apos;x&apos;, &apos;3&apos;, &apos;3&apos;, &apos;sys&apos;, &apos;/dev&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;sync&apos;, &apos;x&apos;, &apos;4&apos;, &apos;65534&apos;, &apos;sync&apos;, &apos;/bin&apos;, &apos;/bin/sync&apos;]</span><br><span class=\"line\">[&apos;games&apos;, &apos;x&apos;, &apos;5&apos;, &apos;60&apos;, &apos;games&apos;, &apos;/usr/games&apos;, &apos;/usr/sbin/nologin&apos;]</span><br><span class=\"line\">[&apos;man&apos;, &apos;x&apos;, &apos;6&apos;, &apos;12&apos;, &apos;man&apos;, &apos;/var/cache/man&apos;, &apos;/usr/sbin/nologin&apos;]</span><br></pre></td></tr></table></figure></p>\n<p>打印第1列，第2列<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print line[0],line[1]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-写文件\"><a href=\"#2-2-写文件\" class=\"headerlink\" title=\"2.2 写文件\"></a>2.2 写文件</h3><p>语言本身不存在文件保护的设置，避免多个程序对同一个文件进行操作，需要自己来完成。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.closed</span><br><span class=\"line\">False</span><br></pre></td></tr></table></figure></p>\n<p><strong>如果<code>f.closed</code>值为False,说明文件已经被打开</strong></p>\n<p>显示文件的字符集，默认为ASCII<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f.encoding</span><br><span class=\"line\">&gt;&gt;&gt; print f.encoding</span><br><span class=\"line\">None</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test_coding&apos;,&apos;w&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.write(u&apos;测试文件编码&apos;) </span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">UnicodeEncodeError: &apos;ascii&apos; codec can&apos;t encode characters in position 0-5: ordinal not in range(128)</span><br><span class=\"line\">&gt;&gt;&gt; f.write(u&apos;测试文件编码&apos;.encode(&apos;utf-8&apos;))</span><br><span class=\"line\">&gt;&gt;&gt; f.flush()</span><br></pre></td></tr></table></figure>\n<p>读到末尾，<code>next()</code>会报错<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; f = file(&apos;test_coding&apos;,&apos;r&apos;) </span><br><span class=\"line\">&gt;&gt;&gt; f.readline()</span><br><span class=\"line\">&apos;&apos;</span><br><span class=\"line\">&gt;&gt;&gt; f.next()</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class=\"line\">StopIteration</span><br><span class=\"line\">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-文件操作相关方法\"><a href=\"#3-文件操作相关方法\" class=\"headerlink\" title=\"3. 文件操作相关方法\"></a>3. 文件操作相关方法</h2><p>readline是通过next实现的</p>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>f.readlines()</td>\n<td>以列表的形式读出文件</td>\n</tr>\n<tr>\n<td>f.read()</td>\n<td>以字符串的形式，一次性读出文件</td>\n</tr>\n<tr>\n<td>f.seek()</td>\n<td>跳到文件的指定位置</td>\n</tr>\n<tr>\n<td>f.tell()</td>\n<td>当前位置</td>\n</tr>\n<tr>\n<td>f.truncate(100)</td>\n<td>从头开始截断文件</td>\n</tr>\n<tr>\n<td>f.writelines()</td>\n<td>多行写</td>\n</tr>\n<tr>\n<td>f.xreadlines()</td>\n<td>逐行读</td>\n</tr>\n</tbody>\n</table>\n"},{"title":"python用户交互","date":"2017-03-20T14:05:30.000Z","_content":"\n## 1. raw_input()\nraw_input() 从标准输入中读取一个字符串\n```\nraw_input(...)\n    raw_input([prompt]) -> string\n    \n    Read a string from standard input.  The trailing newline is stripped.\n    If the user hits EOF (Unix: Ctl-D, Windows: Ctl-Z+Return), raise EOFError.\n    On Unix, GNU readline is used if enabled.  The prompt string, if given,\n    is printed without a trailing newline before reading.\n```\n\n例：\n```\nname = raw_input('Please input your name:')\nage = raw_input('age:')\nprint \"name: \" % name\nprint \"age:\" % age\n```\n\n```\nname = raw_input('Please input your name:')\nage = raw_input('age:')\njob = raw_input('Job:')\nsalary = raw_input('Salary:')\n\nprint '''\nPersonal information of %s:\n   Name : %s\n   Age  : %s     d只能输入数字 f只能输入浮点型\n    Job : %s\n  Salary: %s\n''' %(name, name, age, job, salary)\n```\n\n\n## 2. input()\ninput()\t输入的是什么就是什么格式\n\n```\ninput(...)\n    input([prompt]) -> value\n    \n    Equivalent to eval(raw_input(prompt)).\n```\n\n```\n>>> info = \"This var will be printed out ...\"\n>>> age = input('age:')\nage:info\n>>> print age\nThis var will be printed out ...\n```\n","source":"_posts/python用户交互.md","raw":"---\ntitle: python用户交互\ndate: 2017-03-20 22:05:30\ntags: python\n---\n\n## 1. raw_input()\nraw_input() 从标准输入中读取一个字符串\n```\nraw_input(...)\n    raw_input([prompt]) -> string\n    \n    Read a string from standard input.  The trailing newline is stripped.\n    If the user hits EOF (Unix: Ctl-D, Windows: Ctl-Z+Return), raise EOFError.\n    On Unix, GNU readline is used if enabled.  The prompt string, if given,\n    is printed without a trailing newline before reading.\n```\n\n例：\n```\nname = raw_input('Please input your name:')\nage = raw_input('age:')\nprint \"name: \" % name\nprint \"age:\" % age\n```\n\n```\nname = raw_input('Please input your name:')\nage = raw_input('age:')\njob = raw_input('Job:')\nsalary = raw_input('Salary:')\n\nprint '''\nPersonal information of %s:\n   Name : %s\n   Age  : %s     d只能输入数字 f只能输入浮点型\n    Job : %s\n  Salary: %s\n''' %(name, name, age, job, salary)\n```\n\n\n## 2. input()\ninput()\t输入的是什么就是什么格式\n\n```\ninput(...)\n    input([prompt]) -> value\n    \n    Equivalent to eval(raw_input(prompt)).\n```\n\n```\n>>> info = \"This var will be printed out ...\"\n>>> age = input('age:')\nage:info\n>>> print age\nThis var will be printed out ...\n```\n","slug":"python用户交互","published":1,"updated":"2017-03-21T13:16:24.321Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j56001qzahixshgo80w","content":"<h2 id=\"1-raw-input\"><a href=\"#1-raw-input\" class=\"headerlink\" title=\"1. raw_input()\"></a>1. raw_input()</h2><p>raw_input() 从标准输入中读取一个字符串<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raw_input(...)</span><br><span class=\"line\">    raw_input([prompt]) -&gt; string</span><br><span class=\"line\">    </span><br><span class=\"line\">    Read a string from standard input.  The trailing newline is stripped.</span><br><span class=\"line\">    If the user hits EOF (Unix: Ctl-D, Windows: Ctl-Z+Return), raise EOFError.</span><br><span class=\"line\">    On Unix, GNU readline is used if enabled.  The prompt string, if given,</span><br><span class=\"line\">    is printed without a trailing newline before reading.</span><br></pre></td></tr></table></figure></p>\n<p>例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = raw_input(&apos;Please input your name:&apos;)</span><br><span class=\"line\">age = raw_input(&apos;age:&apos;)</span><br><span class=\"line\">print &quot;name: &quot; % name</span><br><span class=\"line\">print &quot;age:&quot; % age</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = raw_input(&apos;Please input your name:&apos;)</span><br><span class=\"line\">age = raw_input(&apos;age:&apos;)</span><br><span class=\"line\">job = raw_input(&apos;Job:&apos;)</span><br><span class=\"line\">salary = raw_input(&apos;Salary:&apos;)</span><br><span class=\"line\"></span><br><span class=\"line\">print &apos;&apos;&apos;</span><br><span class=\"line\">Personal information of %s:</span><br><span class=\"line\">   Name : %s</span><br><span class=\"line\">   Age  : %s     d只能输入数字 f只能输入浮点型</span><br><span class=\"line\">    Job : %s</span><br><span class=\"line\">  Salary: %s</span><br><span class=\"line\">&apos;&apos;&apos; %(name, name, age, job, salary)</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-input\"><a href=\"#2-input\" class=\"headerlink\" title=\"2. input()\"></a>2. input()</h2><p>input()    输入的是什么就是什么格式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input(...)</span><br><span class=\"line\">    input([prompt]) -&gt; value</span><br><span class=\"line\">    </span><br><span class=\"line\">    Equivalent to eval(raw_input(prompt)).</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; info = &quot;This var will be printed out ...&quot;</span><br><span class=\"line\">&gt;&gt;&gt; age = input(&apos;age:&apos;)</span><br><span class=\"line\">age:info</span><br><span class=\"line\">&gt;&gt;&gt; print age</span><br><span class=\"line\">This var will be printed out ...</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-raw-input\"><a href=\"#1-raw-input\" class=\"headerlink\" title=\"1. raw_input()\"></a>1. raw_input()</h2><p>raw_input() 从标准输入中读取一个字符串<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raw_input(...)</span><br><span class=\"line\">    raw_input([prompt]) -&gt; string</span><br><span class=\"line\">    </span><br><span class=\"line\">    Read a string from standard input.  The trailing newline is stripped.</span><br><span class=\"line\">    If the user hits EOF (Unix: Ctl-D, Windows: Ctl-Z+Return), raise EOFError.</span><br><span class=\"line\">    On Unix, GNU readline is used if enabled.  The prompt string, if given,</span><br><span class=\"line\">    is printed without a trailing newline before reading.</span><br></pre></td></tr></table></figure></p>\n<p>例：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = raw_input(&apos;Please input your name:&apos;)</span><br><span class=\"line\">age = raw_input(&apos;age:&apos;)</span><br><span class=\"line\">print &quot;name: &quot; % name</span><br><span class=\"line\">print &quot;age:&quot; % age</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = raw_input(&apos;Please input your name:&apos;)</span><br><span class=\"line\">age = raw_input(&apos;age:&apos;)</span><br><span class=\"line\">job = raw_input(&apos;Job:&apos;)</span><br><span class=\"line\">salary = raw_input(&apos;Salary:&apos;)</span><br><span class=\"line\"></span><br><span class=\"line\">print &apos;&apos;&apos;</span><br><span class=\"line\">Personal information of %s:</span><br><span class=\"line\">   Name : %s</span><br><span class=\"line\">   Age  : %s     d只能输入数字 f只能输入浮点型</span><br><span class=\"line\">    Job : %s</span><br><span class=\"line\">  Salary: %s</span><br><span class=\"line\">&apos;&apos;&apos; %(name, name, age, job, salary)</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-input\"><a href=\"#2-input\" class=\"headerlink\" title=\"2. input()\"></a>2. input()</h2><p>input()    输入的是什么就是什么格式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input(...)</span><br><span class=\"line\">    input([prompt]) -&gt; value</span><br><span class=\"line\">    </span><br><span class=\"line\">    Equivalent to eval(raw_input(prompt)).</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; info = &quot;This var will be printed out ...&quot;</span><br><span class=\"line\">&gt;&gt;&gt; age = input(&apos;age:&apos;)</span><br><span class=\"line\">age:info</span><br><span class=\"line\">&gt;&gt;&gt; print age</span><br><span class=\"line\">This var will be printed out ...</span><br></pre></td></tr></table></figure>\n"},{"title":"tmux安装配置使用","date":"2017-01-19T08:35:05.000Z","_content":"\n## 1.安装\n```\n# ubuntu\nsudo apt-get install tmux\n```\n或者  \n[点击下载tmux安装包](https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz)\n\n\n## 2.配置文件\n~/.tmux.conf\n如果文件不存在直接`touch`就可以。\n**下面是我的配置文件**\n```\nunbind C-b\nset -g prefix C-a\nbind C-a send-prefix\n\nbind r source-file ~/.tmux.conf \\; display \"tmux.conf reload!\"\n\nbind | split-window -h\nbind - split-window -v\n\nbind h select-pane -L\nbind j select-pane -D\nbind k select-pane -U\nbind l select-pane -R\n\n\n/*bind -n C-x setw synchronize-panes */\nbind C-e command-prompt -p \"session?,message?\" \"run-shell \\\"tmux list-windows -t %1 \\| cut -d: -f1\\|xargs -I\\{\\} tmux send-keys -t %1:\\{\\} %2\\\"\"\n\nset -g base-index 1\nset -g pane-base-index 1\n\nset -g status-fg white\nset -g status-bg black\n\nsetw -g window-status-fg cyan\nsetw -g window-status-bg default\nsetw -g window-status-attr dim\n\nsetw -g window-status-current-fg white\nsetw -g window-status-current-bg red\nsetw -g window-status-current-attr bright\n\nset -g message-fg green\nset -g message-bg black\nset -g message-attr bright\n\nset -g status-left \"#[fg=green]#S #[fg=yellow]#I #[fg=cyan]#P\"\nset -g status-left-length 40\nset -g status-left \"#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P\"\nset -g status-right \"#[fg=cyan]%d %b %R\"\nset -g status-utf8 on\n\nset -g status-interval 60\nset -g status-justify centre\n\nsetw -g monitor-activity on\nset -g visual-activity on\n\nsetw -g mode-keys vi\n```\n\n## 3.tmux部分快捷键\n| 按键           | 说明                                                     |\n| -------------- | -------------------------------------------------------- |\n| Ctrl+a ?       | 列出所有快捷键                                           |\n| Ctrl+a c       | 新建窗口                                                 |\n| Ctrl+a 数字    | 切换到对应的窗口                                         |\n| Ctrl+a n       | 切换到下一个窗口                                         |\n| Ctrl+a p       | 切换到上一个窗口                                         |\n| Ctrl+a w       | 列出所有窗口                                             |\n| Ctrl+a f       | 查找窗口                                                 |\n| Ctrl+a ,       | 修改该窗口的名字                                         |\n| Ctrl+a %/竖线  | 垂直分隔窗口                                             |\n| Ctrl+a \"/-     | 水平分隔窗口                                             |\n| Ctrl+a o       | 交换光标所在窗格                                         |\n| Ctrl+a x       | 关闭窗格                                                 |\n| Ctrl+a 空格    | 切换布局                                                 |\n| Ctrl+a q       | 显示每个窗格是第几个，当数字出现时按数字就选中第几个窗格 |\n| Ctrl+a {       | 与上一个窗格交换位置                                     |\n| Ctrl+a }       | 与下一个窗格交换位置                                     |\n| Ctrl+a z       | 切换当前窗格最大化/最小化                                |\n| Ctrl+a [       | 进入复制模式                                             |\n| Ctrl+a [ 空格  | 开始选择内容 回车复制                                    |\n| Ctrl+a ]       | 粘贴                                                     |\n\n","source":"_posts/tmux安装配置使用.md","raw":"---\ntitle: tmux安装配置使用\ndate: 2017-01-19 16:35:05\ntags: tmux\n---\n\n## 1.安装\n```\n# ubuntu\nsudo apt-get install tmux\n```\n或者  \n[点击下载tmux安装包](https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz)\n\n\n## 2.配置文件\n~/.tmux.conf\n如果文件不存在直接`touch`就可以。\n**下面是我的配置文件**\n```\nunbind C-b\nset -g prefix C-a\nbind C-a send-prefix\n\nbind r source-file ~/.tmux.conf \\; display \"tmux.conf reload!\"\n\nbind | split-window -h\nbind - split-window -v\n\nbind h select-pane -L\nbind j select-pane -D\nbind k select-pane -U\nbind l select-pane -R\n\n\n/*bind -n C-x setw synchronize-panes */\nbind C-e command-prompt -p \"session?,message?\" \"run-shell \\\"tmux list-windows -t %1 \\| cut -d: -f1\\|xargs -I\\{\\} tmux send-keys -t %1:\\{\\} %2\\\"\"\n\nset -g base-index 1\nset -g pane-base-index 1\n\nset -g status-fg white\nset -g status-bg black\n\nsetw -g window-status-fg cyan\nsetw -g window-status-bg default\nsetw -g window-status-attr dim\n\nsetw -g window-status-current-fg white\nsetw -g window-status-current-bg red\nsetw -g window-status-current-attr bright\n\nset -g message-fg green\nset -g message-bg black\nset -g message-attr bright\n\nset -g status-left \"#[fg=green]#S #[fg=yellow]#I #[fg=cyan]#P\"\nset -g status-left-length 40\nset -g status-left \"#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P\"\nset -g status-right \"#[fg=cyan]%d %b %R\"\nset -g status-utf8 on\n\nset -g status-interval 60\nset -g status-justify centre\n\nsetw -g monitor-activity on\nset -g visual-activity on\n\nsetw -g mode-keys vi\n```\n\n## 3.tmux部分快捷键\n| 按键           | 说明                                                     |\n| -------------- | -------------------------------------------------------- |\n| Ctrl+a ?       | 列出所有快捷键                                           |\n| Ctrl+a c       | 新建窗口                                                 |\n| Ctrl+a 数字    | 切换到对应的窗口                                         |\n| Ctrl+a n       | 切换到下一个窗口                                         |\n| Ctrl+a p       | 切换到上一个窗口                                         |\n| Ctrl+a w       | 列出所有窗口                                             |\n| Ctrl+a f       | 查找窗口                                                 |\n| Ctrl+a ,       | 修改该窗口的名字                                         |\n| Ctrl+a %/竖线  | 垂直分隔窗口                                             |\n| Ctrl+a \"/-     | 水平分隔窗口                                             |\n| Ctrl+a o       | 交换光标所在窗格                                         |\n| Ctrl+a x       | 关闭窗格                                                 |\n| Ctrl+a 空格    | 切换布局                                                 |\n| Ctrl+a q       | 显示每个窗格是第几个，当数字出现时按数字就选中第几个窗格 |\n| Ctrl+a {       | 与上一个窗格交换位置                                     |\n| Ctrl+a }       | 与下一个窗格交换位置                                     |\n| Ctrl+a z       | 切换当前窗格最大化/最小化                                |\n| Ctrl+a [       | 进入复制模式                                             |\n| Ctrl+a [ 空格  | 开始选择内容 回车复制                                    |\n| Ctrl+a ]       | 粘贴                                                     |\n\n","slug":"tmux安装配置使用","published":1,"updated":"2017-01-19T08:46:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j57001szahiq3gegduq","content":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1.安装\"></a>1.安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ubuntu</span><br><span class=\"line\">sudo apt-get install tmux</span><br></pre></td></tr></table></figure>\n<p>或者<br><a href=\"https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz\" target=\"_blank\" rel=\"noopener\">点击下载tmux安装包</a></p>\n<h2 id=\"2-配置文件\"><a href=\"#2-配置文件\" class=\"headerlink\" title=\"2.配置文件\"></a>2.配置文件</h2><p>~/.tmux.conf<br>如果文件不存在直接<code>touch</code>就可以。<br><strong>下面是我的配置文件</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unbind C-b</span><br><span class=\"line\">set -g prefix C-a</span><br><span class=\"line\">bind C-a send-prefix</span><br><span class=\"line\"></span><br><span class=\"line\">bind r source-file ~/.tmux.conf \\; display &quot;tmux.conf reload!&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">bind | split-window -h</span><br><span class=\"line\">bind - split-window -v</span><br><span class=\"line\"></span><br><span class=\"line\">bind h select-pane -L</span><br><span class=\"line\">bind j select-pane -D</span><br><span class=\"line\">bind k select-pane -U</span><br><span class=\"line\">bind l select-pane -R</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">/*bind -n C-x setw synchronize-panes */</span><br><span class=\"line\">bind C-e command-prompt -p &quot;session?,message?&quot; &quot;run-shell \\&quot;tmux list-windows -t %1 \\| cut -d: -f1\\|xargs -I\\&#123;\\&#125; tmux send-keys -t %1:\\&#123;\\&#125; %2\\&quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">set -g base-index 1</span><br><span class=\"line\">set -g pane-base-index 1</span><br><span class=\"line\"></span><br><span class=\"line\">set -g status-fg white</span><br><span class=\"line\">set -g status-bg black</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g window-status-fg cyan</span><br><span class=\"line\">setw -g window-status-bg default</span><br><span class=\"line\">setw -g window-status-attr dim</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g window-status-current-fg white</span><br><span class=\"line\">setw -g window-status-current-bg red</span><br><span class=\"line\">setw -g window-status-current-attr bright</span><br><span class=\"line\"></span><br><span class=\"line\">set -g message-fg green</span><br><span class=\"line\">set -g message-bg black</span><br><span class=\"line\">set -g message-attr bright</span><br><span class=\"line\"></span><br><span class=\"line\">set -g status-left &quot;#[fg=green]#S #[fg=yellow]#I #[fg=cyan]#P&quot;</span><br><span class=\"line\">set -g status-left-length 40</span><br><span class=\"line\">set -g status-left &quot;#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P&quot;</span><br><span class=\"line\">set -g status-right &quot;#[fg=cyan]%d %b %R&quot;</span><br><span class=\"line\">set -g status-utf8 on</span><br><span class=\"line\"></span><br><span class=\"line\">set -g status-interval 60</span><br><span class=\"line\">set -g status-justify centre</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g monitor-activity on</span><br><span class=\"line\">set -g visual-activity on</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g mode-keys vi</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-tmux部分快捷键\"><a href=\"#3-tmux部分快捷键\" class=\"headerlink\" title=\"3.tmux部分快捷键\"></a>3.tmux部分快捷键</h2><table>\n<thead>\n<tr>\n<th>按键</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Ctrl+a ?</td>\n<td>列出所有快捷键</td>\n</tr>\n<tr>\n<td>Ctrl+a c</td>\n<td>新建窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a 数字</td>\n<td>切换到对应的窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a n</td>\n<td>切换到下一个窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a p</td>\n<td>切换到上一个窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a w</td>\n<td>列出所有窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a f</td>\n<td>查找窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a ,</td>\n<td>修改该窗口的名字</td>\n</tr>\n<tr>\n<td>Ctrl+a %/竖线</td>\n<td>垂直分隔窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a “/-</td>\n<td>水平分隔窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a o</td>\n<td>交换光标所在窗格</td>\n</tr>\n<tr>\n<td>Ctrl+a x</td>\n<td>关闭窗格</td>\n</tr>\n<tr>\n<td>Ctrl+a 空格</td>\n<td>切换布局</td>\n</tr>\n<tr>\n<td>Ctrl+a q</td>\n<td>显示每个窗格是第几个，当数字出现时按数字就选中第几个窗格</td>\n</tr>\n<tr>\n<td>Ctrl+a {</td>\n<td>与上一个窗格交换位置</td>\n</tr>\n<tr>\n<td>Ctrl+a }</td>\n<td>与下一个窗格交换位置</td>\n</tr>\n<tr>\n<td>Ctrl+a z</td>\n<td>切换当前窗格最大化/最小化</td>\n</tr>\n<tr>\n<td>Ctrl+a [</td>\n<td>进入复制模式</td>\n</tr>\n<tr>\n<td>Ctrl+a [ 空格</td>\n<td>开始选择内容 回车复制</td>\n</tr>\n<tr>\n<td>Ctrl+a ]</td>\n<td>粘贴</td>\n</tr>\n</tbody>\n</table>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1.安装\"></a>1.安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ubuntu</span><br><span class=\"line\">sudo apt-get install tmux</span><br></pre></td></tr></table></figure>\n<p>或者<br><a href=\"https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz\" target=\"_blank\" rel=\"noopener\">点击下载tmux安装包</a></p>\n<h2 id=\"2-配置文件\"><a href=\"#2-配置文件\" class=\"headerlink\" title=\"2.配置文件\"></a>2.配置文件</h2><p>~/.tmux.conf<br>如果文件不存在直接<code>touch</code>就可以。<br><strong>下面是我的配置文件</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unbind C-b</span><br><span class=\"line\">set -g prefix C-a</span><br><span class=\"line\">bind C-a send-prefix</span><br><span class=\"line\"></span><br><span class=\"line\">bind r source-file ~/.tmux.conf \\; display &quot;tmux.conf reload!&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">bind | split-window -h</span><br><span class=\"line\">bind - split-window -v</span><br><span class=\"line\"></span><br><span class=\"line\">bind h select-pane -L</span><br><span class=\"line\">bind j select-pane -D</span><br><span class=\"line\">bind k select-pane -U</span><br><span class=\"line\">bind l select-pane -R</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">/*bind -n C-x setw synchronize-panes */</span><br><span class=\"line\">bind C-e command-prompt -p &quot;session?,message?&quot; &quot;run-shell \\&quot;tmux list-windows -t %1 \\| cut -d: -f1\\|xargs -I\\&#123;\\&#125; tmux send-keys -t %1:\\&#123;\\&#125; %2\\&quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">set -g base-index 1</span><br><span class=\"line\">set -g pane-base-index 1</span><br><span class=\"line\"></span><br><span class=\"line\">set -g status-fg white</span><br><span class=\"line\">set -g status-bg black</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g window-status-fg cyan</span><br><span class=\"line\">setw -g window-status-bg default</span><br><span class=\"line\">setw -g window-status-attr dim</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g window-status-current-fg white</span><br><span class=\"line\">setw -g window-status-current-bg red</span><br><span class=\"line\">setw -g window-status-current-attr bright</span><br><span class=\"line\"></span><br><span class=\"line\">set -g message-fg green</span><br><span class=\"line\">set -g message-bg black</span><br><span class=\"line\">set -g message-attr bright</span><br><span class=\"line\"></span><br><span class=\"line\">set -g status-left &quot;#[fg=green]#S #[fg=yellow]#I #[fg=cyan]#P&quot;</span><br><span class=\"line\">set -g status-left-length 40</span><br><span class=\"line\">set -g status-left &quot;#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P&quot;</span><br><span class=\"line\">set -g status-right &quot;#[fg=cyan]%d %b %R&quot;</span><br><span class=\"line\">set -g status-utf8 on</span><br><span class=\"line\"></span><br><span class=\"line\">set -g status-interval 60</span><br><span class=\"line\">set -g status-justify centre</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g monitor-activity on</span><br><span class=\"line\">set -g visual-activity on</span><br><span class=\"line\"></span><br><span class=\"line\">setw -g mode-keys vi</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-tmux部分快捷键\"><a href=\"#3-tmux部分快捷键\" class=\"headerlink\" title=\"3.tmux部分快捷键\"></a>3.tmux部分快捷键</h2><table>\n<thead>\n<tr>\n<th>按键</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Ctrl+a ?</td>\n<td>列出所有快捷键</td>\n</tr>\n<tr>\n<td>Ctrl+a c</td>\n<td>新建窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a 数字</td>\n<td>切换到对应的窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a n</td>\n<td>切换到下一个窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a p</td>\n<td>切换到上一个窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a w</td>\n<td>列出所有窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a f</td>\n<td>查找窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a ,</td>\n<td>修改该窗口的名字</td>\n</tr>\n<tr>\n<td>Ctrl+a %/竖线</td>\n<td>垂直分隔窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a “/-</td>\n<td>水平分隔窗口</td>\n</tr>\n<tr>\n<td>Ctrl+a o</td>\n<td>交换光标所在窗格</td>\n</tr>\n<tr>\n<td>Ctrl+a x</td>\n<td>关闭窗格</td>\n</tr>\n<tr>\n<td>Ctrl+a 空格</td>\n<td>切换布局</td>\n</tr>\n<tr>\n<td>Ctrl+a q</td>\n<td>显示每个窗格是第几个，当数字出现时按数字就选中第几个窗格</td>\n</tr>\n<tr>\n<td>Ctrl+a {</td>\n<td>与上一个窗格交换位置</td>\n</tr>\n<tr>\n<td>Ctrl+a }</td>\n<td>与下一个窗格交换位置</td>\n</tr>\n<tr>\n<td>Ctrl+a z</td>\n<td>切换当前窗格最大化/最小化</td>\n</tr>\n<tr>\n<td>Ctrl+a [</td>\n<td>进入复制模式</td>\n</tr>\n<tr>\n<td>Ctrl+a [ 空格</td>\n<td>开始选择内容 回车复制</td>\n</tr>\n<tr>\n<td>Ctrl+a ]</td>\n<td>粘贴</td>\n</tr>\n</tbody>\n</table>\n"},{"title":"ubuntu修改网卡名称","date":"2017-02-07T03:21:00.000Z","_content":"\n今天强迫症又犯了，想要把网卡的名称改为eth0和wlan0\n按照网上的方法试了几种，都没有成功，下面记录下我修改成功的方法。\n\n## 1. 修改配置文件\nOpen the file /etc/udev/rules.d/70-persistent-net.rules with your favorite editor.\nFind the rule matching your MAC address.\nChange the NAME value from eth1 to eth0 i.e. NAME=\"eth0\"\n\n```\n$ sudo vi /etc/udev/rules.d/70-persistent-net.rules\n```\n找到你要修改的网卡的MAC，修改对应的`NAME`值\n```\n# PCI device 0x10ec:0x8168 (r8169)\nSUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"50:7b:9d:55:47:2e\", ATTR{dev_id}==\"0x0\", ATTR{type}==\"1\", KERNEL==\"eth*\", NAME=\"eth0\"\n \n# PCI device 0x168c:0x0042 (ath10k_pci)\nSUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"30:52:cb:68:81:17\", ATTR{dev_id}==\"0x0\", ATTR{type}==\"1\", KERNEL==\"wlan*\", NAME=\"wlan0\"\n```\n\n## 2. 使修改生效\n```\n$ sudo udevadm trigger\n```\n运行`ifconfig`查看网卡名称是否已经修改过来，如果没成功，就重启一下吧。\n\n[From askubuntu](http://askubuntu.com/questions/637591/my-ethernet-interface-name-has-changed-from-eth0-to-eth1)\n\n\n\n","source":"_posts/ubuntu修改网卡名称.md","raw":"---\ntitle: ubuntu修改网卡名称\ndate: 2017-02-07 11:21:00\ntags: ubuntu\n---\n\n今天强迫症又犯了，想要把网卡的名称改为eth0和wlan0\n按照网上的方法试了几种，都没有成功，下面记录下我修改成功的方法。\n\n## 1. 修改配置文件\nOpen the file /etc/udev/rules.d/70-persistent-net.rules with your favorite editor.\nFind the rule matching your MAC address.\nChange the NAME value from eth1 to eth0 i.e. NAME=\"eth0\"\n\n```\n$ sudo vi /etc/udev/rules.d/70-persistent-net.rules\n```\n找到你要修改的网卡的MAC，修改对应的`NAME`值\n```\n# PCI device 0x10ec:0x8168 (r8169)\nSUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"50:7b:9d:55:47:2e\", ATTR{dev_id}==\"0x0\", ATTR{type}==\"1\", KERNEL==\"eth*\", NAME=\"eth0\"\n \n# PCI device 0x168c:0x0042 (ath10k_pci)\nSUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"30:52:cb:68:81:17\", ATTR{dev_id}==\"0x0\", ATTR{type}==\"1\", KERNEL==\"wlan*\", NAME=\"wlan0\"\n```\n\n## 2. 使修改生效\n```\n$ sudo udevadm trigger\n```\n运行`ifconfig`查看网卡名称是否已经修改过来，如果没成功，就重启一下吧。\n\n[From askubuntu](http://askubuntu.com/questions/637591/my-ethernet-interface-name-has-changed-from-eth0-to-eth1)\n\n\n\n","slug":"ubuntu修改网卡名称","published":1,"updated":"2017-02-07T05:11:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j57001uzahi37mjimhp","content":"<p>今天强迫症又犯了，想要把网卡的名称改为eth0和wlan0<br>按照网上的方法试了几种，都没有成功，下面记录下我修改成功的方法。</p>\n<h2 id=\"1-修改配置文件\"><a href=\"#1-修改配置文件\" class=\"headerlink\" title=\"1. 修改配置文件\"></a>1. 修改配置文件</h2><p>Open the file /etc/udev/rules.d/70-persistent-net.rules with your favorite editor.<br>Find the rule matching your MAC address.<br>Change the NAME value from eth1 to eth0 i.e. NAME=”eth0”</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vi /etc/udev/rules.d/70-persistent-net.rules</span><br></pre></td></tr></table></figure>\n<p>找到你要修改的网卡的MAC，修改对应的<code>NAME</code>值<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># PCI device 0x10ec:0x8168 (r8169)</span><br><span class=\"line\">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;50:7b:9d:55:47:2e&quot;, ATTR&#123;dev_id&#125;==&quot;0x0&quot;, ATTR&#123;type&#125;==&quot;1&quot;, KERNEL==&quot;eth*&quot;, NAME=&quot;eth0&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\"># PCI device 0x168c:0x0042 (ath10k_pci)</span><br><span class=\"line\">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;30:52:cb:68:81:17&quot;, ATTR&#123;dev_id&#125;==&quot;0x0&quot;, ATTR&#123;type&#125;==&quot;1&quot;, KERNEL==&quot;wlan*&quot;, NAME=&quot;wlan0&quot;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-使修改生效\"><a href=\"#2-使修改生效\" class=\"headerlink\" title=\"2. 使修改生效\"></a>2. 使修改生效</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo udevadm trigger</span><br></pre></td></tr></table></figure>\n<p>运行<code>ifconfig</code>查看网卡名称是否已经修改过来，如果没成功，就重启一下吧。</p>\n<p><a href=\"http://askubuntu.com/questions/637591/my-ethernet-interface-name-has-changed-from-eth0-to-eth1\" target=\"_blank\" rel=\"noopener\">From askubuntu</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>今天强迫症又犯了，想要把网卡的名称改为eth0和wlan0<br>按照网上的方法试了几种，都没有成功，下面记录下我修改成功的方法。</p>\n<h2 id=\"1-修改配置文件\"><a href=\"#1-修改配置文件\" class=\"headerlink\" title=\"1. 修改配置文件\"></a>1. 修改配置文件</h2><p>Open the file /etc/udev/rules.d/70-persistent-net.rules with your favorite editor.<br>Find the rule matching your MAC address.<br>Change the NAME value from eth1 to eth0 i.e. NAME=”eth0”</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vi /etc/udev/rules.d/70-persistent-net.rules</span><br></pre></td></tr></table></figure>\n<p>找到你要修改的网卡的MAC，修改对应的<code>NAME</code>值<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># PCI device 0x10ec:0x8168 (r8169)</span><br><span class=\"line\">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;50:7b:9d:55:47:2e&quot;, ATTR&#123;dev_id&#125;==&quot;0x0&quot;, ATTR&#123;type&#125;==&quot;1&quot;, KERNEL==&quot;eth*&quot;, NAME=&quot;eth0&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\"># PCI device 0x168c:0x0042 (ath10k_pci)</span><br><span class=\"line\">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR&#123;address&#125;==&quot;30:52:cb:68:81:17&quot;, ATTR&#123;dev_id&#125;==&quot;0x0&quot;, ATTR&#123;type&#125;==&quot;1&quot;, KERNEL==&quot;wlan*&quot;, NAME=&quot;wlan0&quot;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-使修改生效\"><a href=\"#2-使修改生效\" class=\"headerlink\" title=\"2. 使修改生效\"></a>2. 使修改生效</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo udevadm trigger</span><br></pre></td></tr></table></figure>\n<p>运行<code>ifconfig</code>查看网卡名称是否已经修改过来，如果没成功，就重启一下吧。</p>\n<p><a href=\"http://askubuntu.com/questions/637591/my-ethernet-interface-name-has-changed-from-eth0-to-eth1\" target=\"_blank\" rel=\"noopener\">From askubuntu</a></p>\n"},{"title":"shell style guide","date":"2017-01-12T06:06:39.000Z","_content":"\n# Shell Style Guide\n\n\n\n## <span id=\"contents\">Contents</span>\n\n1.[Shell Files and Interpreter Invocation](#a)\n\n- 1.1 File Extensions\n\n- 1.2 SUID/SGID  \n\n\n\n2.[Environment](#b) \n\n- 2.1 STDOUT vs STDERR  \n\n\n\n3.[Comments](#c)\n\n- 3.1 File Header \n\n- 3.2 Function Comments\n\n- 3.3 Implementation Comments\n\n- 3.4 TODO Comments  \n\n\n\n4.[Formatting](#d)\n\n- 4.1 Indentation \n\n- 4.2 Line Length and Long Strings\n\n- 4.3 Pipelines | Loops\n\n- 4.4 Case statement\n\n- 4.5 Variable expansion\n\n- 4.6 Quoting  \n\n\n\n5.[Features and Bugs](#e) \n\n- 5.1 Command Substitution\n\n- 5.2 Test, [ and [[ \n\n- 5.3 Testing Strings Wildcard Expansion of Filenames \n\n- 5.4 Eval\n\n- 5.5 Pipes to While  \n\n\n\n6.[Naming Conventions](#f)\n\n- 6.1 Function Names \n\n- 6.2 Variable Names \n\n- 6.3 Constants and Environment Variable Names \n\n- 6.4 Source Filenames \n\n- 6.5 Read-only Variables \n\n- 6.7 Use Local Variables \n\n- 6.8 Function Location \n\n- 6.9 main  \n\n\n\n7.[Calling Commands](#g)\n\n- 7.1 Checking Return Values \n\n- 7.2 Builtin Commands vs. External Commands  \n\n\n\n8.[Conclusion](#h)\n\n## Which Shell to Use\n\n**Bash** is the only shell scripting language permitted for executables.  \n\nExecutables must start with **#! /bin/bash** and a minimum number of flags.\n\nUse **set** to set shell options so that calling your script as **bash** ***script_name*** does not break its functionality.\n\n\n\nRestricting all executable shell scripts to bash gives us a consistent shell language that's installed on all our machines.\n\n\n\nThe only exception to this is where you're forced to by whatever you're coding for.\n\nOne example of this is Solaris SVR4 packages which require plain Bourne shell for any scripts.\n\n\n\n## When to use Shell\n\nShell should only be used for small utilities or simple wrapper scripts.  \n\nWhile shell scripting isn't a development language, it is used for writing various utility scripts throughout Google.   This style guide is more a recognition of its use rather than a suggestion that it be used for widespread deployment.\n\n\n\nSome guidelines:\n\n- If you're mostly calling other utilities and are doing relatively little data manipulation, shell is an acceptable choice for the task.\n\n- If performance matters, use something other than shell.\n\n- If you find you need to use arrays for anything more than assignment of **${PIPESTATUS}**, you should use Python.\n\n- If you are writing a script that is more than 100 lines long, you should probably be writing it in Python instead. Bear in mind that scripts grow. Rewrite your script in another language early to avoid a time-consuming rewrite at a later date.  \n\n\n\n**[Go Contents](#contents)**\n\n## 1.  <span id=\"a\">Shell Files and Interpreter Invocation</span>\n\n\n\n### 1.1 File Extensions\n\n\n\nExecutables should have no extension (strongly preferred) or a **.sh** extension. Libraries must have a **.sh** extension and should not be executable.\n\nIt is not necessary to know what language a program is written in when executing it and shell doesn't require an extension so we prefer not to use one for executables.\n\n\n\nHowever, for libraries it's important to know what language it is and sometimes there's a need to have similar libraries in different languages. This allows library files with identical purposes but different languages to be identically named except for the language-specific suffix.\n\n\n\n### 1.2 SUID/SGID\n\n\n\nSUID and SGID are forbidden on shell scripts.\n\nThere are too many security issues with shell that make it nearly impossible to secure sufficiently to allow SUID/SGID. While bash does make it difficult to run SUID, it's still possible on some platforms which is why we're being explicit about banning it.\n\n\n\nUse **sudo** to provide elevated access if you need it.\n\n**[Go Contents](#contents)**\n\n## 2. <span id=\"b\">Environment</span>\n\n\n\n### 2.1 STDOUT vs STDERR\n\n\n\nAll error messages should go to **STDERR**.\n\nThis makes it easier to separate normal status from actual issues.\n\nA function to print out error messages along with other status information is recommended.\n\n```\n\nerr() {\n\n  echo \"[$(date +'%Y-%m-%dT%H:%M:%S%z')]: $@\" >&2\n\n}\n\n\n\nif ! do_something; then\n\n  err \"Unable to do_something\"\n\n  exit \"${E_DID_NOTHING}\"\n\nfi\n\n```\n\n**[Go Contents](#contents)**\n\n## 3. <span id=\"c\">Comments</span>\n\n### 3.1 File Header\n\nStart each file with a description of its contents.\n\nEvery file must have a top-level comment including a brief overview of its contents. A copyright notice and author information are optional.\n\n\n\n***Example:***\n\n```\n\n#!/bin/bash\n\n#\n\n# Perform hot backups of Oracle databases.\n\n```\n\n\n\n### 3.2 Function Comments\n\n\n\nAny function that is not both obvious and short must be commented. Any function in a library must be commented regardless of length or complexity.\n\nIt should be possible for someone else to learn how to use your program or to use a function in your library by reading the comments (and self-help, if provided) without reading the code.\n\n\n\nAll function comments should contain:\n\n- Description of the function\n\n- Global variables used and modified\n\n- Arguments taken\n\n- Returned values other than the default exit status of the last command run\n\n\n\n***Example:***\n\n```\n\n#!/bin/bash\n\n#\n\n# Perform hot backups of Oracle databases.\n\n\n\nexport PATH='/usr/xpg4/bin:/usr/bin:/opt/csw/bin:/opt/goog/bin'\n\n\n\n#######################################\n\n# Cleanup files from the backup dir\n\n# Globals:\n\n#   BACKUP_DIR\n\n#   ORACLE_SID\n\n# Arguments:\n\n#   None\n\n# Returns:\n\n#   None\n\n#######################################\n\ncleanup() {\n\n  ...\n\n}\n\n```\n\n\n\n### 3.3 Implementation Comments\n\n\n\nComment tricky, non-obvious, interesting or important parts of your code.\n\nThis follows general Google coding comment practice. Don't comment everything. If there's a complex algorithm or you're doing something out of the ordinary, put a short comment in.\n\n\n\n### 3.4 TODO Comments\n\n\n\nUse **TODO** comments for code that is temporary, a short-term solution, or good-enough but not perfect.\n\nThis matches the convention in the **C++ Guide**.\n\n\n\n**TODOs** should include the string **TODO** in all caps, followed by your username in parentheses. A colon is optional. It's preferable to put a bug/ticket number next to the **TODO** item as well.\n\n\n\n***Examples:***\n\n```\n\n# TODO(mrmonkey): Handle the unlikely edge cases (bug ####)\n\n```\n\n**[Go Contents](#contents)**\n\n## 4. <span id=\"d\">Formatting</span>\n\nWhile you should follow the style that's already there for files that you're modifying, the following are required for any new code.\n\n\n\n### 4.1 Indentation\n\nIndent 2 spaces. No tabs.\n\nUse blank lines between blocks to improve readability. Indentation is two spaces. Whatever you do, don't use tabs. For existing files, stay faithful to the existing indentation.\n\n\n\n### 4.2 Line Length and Long Strings\n\nMaximum line length is 80 characters.\n\nIf you have to write strings that are longer than 80 characters, this should be done with a here document or an embedded newline if possible. Literal strings that have to be longer than 80 chars and can't sensibly be split are ok, but it's strongly preferred to find a way to make it shorter.\n\n```\n\n# DO use 'here document's\n\ncat <<END;\n\nI am an exceptionally long\n\nstring.\n\nEND\n\n\n\n# Embedded newlines are ok too\n\nlong_string=\"I am an exceptionally\n\n  long string.\"\n\n```\n\n### 4.3 Pipelines\n\n\n\nPipelines should be split one per line if they don't all fit on one line.\n\nIf a pipeline all fits on one line, it should be on one line.\n\nIf not, it should be split at one pipe segment per line with the pipe on the newline and a 2 space indent for the next section of the pipe. This applies to a chain of commands combined using '**|**' as well as to logical compounds using '**||**' and '**&&**'.\n\n```\n\n# All fits on one line\n\ncommand1 | command2\n\n\n\n# Long commands\n\ncommand1 \\\n\n  | command2 \\\n\n  | command3 \\\n\n  | command4\n\n```\n\n### 4.4 Loops\n\nPut **; do** and **; then** on the same line as the **while**, **for** or **if**.\n\nLoops in shell are a bit different, but we follow the same principles as with braces when declaring functions.\n\nThat is: **; then** and **; do** should be <font color=\"red\">on the same line</font> as the **if/for/while**.**else** should be on its own line and closing statements should be on their own line vertically aligned with the opening statement.\n\n\n\n***Example:***\n\n```\n\nfor dir in ${dirs_to_cleanup}; do\n\n  if [[ -d \"${dir}/${ORACLE_SID}\" ]]; then\n\n    log_date \"Cleaning up old files in ${dir}/${ORACLE_SID}\"\n\n    rm \"${dir}/${ORACLE_SID}/\"*\n\n    if [[ \"$?\" -ne 0 ]]; then\n\n      error_message\n\n    fi\n\n  else\n\n    mkdir -p \"${dir}/${ORACLE_SID}\"\n\n    if [[ \"$?\" -ne 0 ]]; then\n\n      error_message\n\n    fi\n\n  fi\n\ndone\n\n```\n\n### 4.5 Case statement\n\n- Indent alternatives by 2 spaces.\n\n- A one-line alternative needs a space after the close parenthesis of the pattern and before the **;;**.\n\n- Long or multi-command alternatives should be split over multiple lines with the pattern, actions, and **;;** on separate lines.\n\n\n\nThe matching expressions are indented one level from the '**case**' and '**esac**'. Multiline actions are indented another level. In general, there is no need to quote match expressions. Pattern expressions should not be preceded by an open parenthesis. Avoid the **;&** and **;;&** notations.\n\n```\n\ncase \"${expression}\" in\n\n  a)\n\n    variable=\"...\"\n\n    some_command \"${variable}\" \"${other_expr}\" ...\n\n    ;;\n\n  absolute)\n\n    actions=\"relative\"\n\n    another_command \"${actions}\" \"${other_expr}\" ...\n\n    ;;\n\n  *)\n\n    error \"Unexpected expression '${expression}'\"\n\n    ;;\n\nesac\n\n```\n\nSimple commands may be put on the same line as the pattern and **;;** as long as the expression remains readable. This is often appropriate for single-letter option processing. When the actions don't fit on a single line, put the pattern on a line on its own, then the actions, then **;;**; also <font color=\"red\"> on a line of its own</font>. When on the same line as the actions, use a space after the close parenthesis of the pattern and another before the **;;**.\n\n```\n\nverbose='false'\n\naflag=''\n\nbflag=''\n\nfiles=''\n\nwhile getopts 'abf:v' flag; do\n\n  case \"${flag}\" in\n\n    a) aflag='true' ;;\n\n    b) bflag='true' ;;\n\n    f) files=\"${OPTARG}\" ;;\n\n    v) verbose='true' ;;\n\n    *) error \"Unexpected option ${flag}\" ;;\n\n  esac\n\ndone\n\n```\n\n### 4.6 Variable expansion\n\nIn order of precedence: Stay consistent with what you find; quote your variables; prefer \"**${var}**\" over \"**$var**\", but see details.\n\nThese are meant to be guidelines, as the topic seems too controversial for a mandatory regulation.\n\nThey are listed in order of precedence.\n\n\n\n1. Stay consistent with what you find for existing code.\n\n1. Quote variables, see Quoting section below.\n\n1. Don't brace-quote single character shell specials / positional parameters, unless strictly necessary or avoiding deep confusion.\n\nPrefer brace-quoting all other variables.\n\n\n\n```\n\n# Section of recommended cases.\n\n# Preferred style for 'special' variables:\n\necho \"Positional: $1\" \"$5\" \"$3\"\n\necho \"Specials: !=$!, -=$-, _=$_. ?=$?, #=$# *=$* @=$@ \\$=$$ ...\"\n\n\n\n# Braces necessary:\n\necho \"many parameters: ${10}\"\n\n\n\n# Braces avoiding confusion:\n\n# Output is \"a0b0c0\"\n\nset -- a b c\n\necho \"${1}0${2}0${3}0\"\n\n\n\n# Preferred style for other variables:\n\necho \"PATH=${PATH}, PWD=${PWD}, mine=${some_var}\"\n\nwhile read f; do\n\n  echo \"file=${f}\"\n\ndone < <(ls -l /tmp)\n\n\n\n# Section of discouraged cases\n\n\n\n# Unquoted vars, unbraced vars, brace-quoted single letter\n\n# shell specials.\n\necho a=$avar \"b=$bvar\" \"PID=${$}\" \"${1}\"\n\n\n\n# Confusing use: this is expanded as \"${1}0${2}0${3}0\",\n\n# not \"${10}${20}${30}\n\nset -- a b c\n\necho \"$10$20$30\"\n\n```\n\n### 4.7 Quoting\n\n\n\n- Always quote strings containing variables, command substitutions, spaces or shell meta characters, unless careful unquoted expansion is required.\n\n- Prefer quoting strings that are \"words\" (as opposed to command options or path names).\n\n- Never quote ***literal*** integers.\n\n- Be aware of the quoting rules for pattern matches in [[.\n\n- Use \"**$@**\" unless you have a specific reason to use **$***.\n\n\n\n```\n\n# 'Single' quotes indicate that no substitution is desired.\n\n# \"Double\" quotes indicate that substitution is required/tolerated.\n\n\n\n# Simple examples\n\n# \"quote command substitutions\"\n\nflag=\"$(some_command and its args \"$@\" 'quoted separately')\"\n\n\n\n# \"quote variables\"\n\necho \"${flag}\"\n\n\n\n# \"never quote literal integers\"\n\nvalue=32\n\n# \"quote command substitutions\", even when you expect integers\n\nnumber=\"$(generate_number)\"\n\n\n\n# \"prefer quoting words\", not compulsory\n\nreadonly USE_INTEGER='true'\n\n\n\n# \"quote shell meta characters\"\n\necho 'Hello stranger, and well met. Earn lots of $$$'\n\necho \"Process $$: Done making \\$\\$\\$.\"\n\n\n\n# \"command options or path names\"\n\n# ($1 is assumed to contain a value here)\n\ngrep -li Hugo /dev/null \"$1\"\n\n\n\n# Less simple examples\n\n# \"quote variables, unless proven false\": ccs might be empty\n\ngit send-email --to \"${reviewers}\" ${ccs:+\"--cc\" \"${ccs}\"}\n\n\n\n# Positional parameter precautions: $1 might be unset\n\n# Single quotes leave regex as-is.\n\ngrep -cP '([Ss]pecial|\\|?characters*)$' ${1:+\"$1\"}\n\n\n\n# For passing on arguments,\n\n# \"$@\" is right almost everytime, and\n\n# $* is wrong almost everytime:\n\n#\n\n# * $* and $@ will split on spaces, clobbering up arguments\n\n#   that contain spaces and dropping empty strings;\n\n# * \"$@\" will retain arguments as-is, so no args\n\n#   provided will result in no args being passed on;\n\n#   This is in most cases what you want to use for passing\n\n#   on arguments.\n\n# * \"$*\" expands to one argument, with all args joined\n\n#   by (usually) spaces,\n\n#   so no args provided will result in one empty string\n\n#   being passed on.\n\n# (Consult 'man bash' for the nit-grits ;-)\n\n\n\nset -- 1 \"2 two\" \"3 three tres\"; echo $# ; set -- \"$*\"; echo \"$#, $@\")\n\nset -- 1 \"2 two\" \"3 three tres\"; echo $# ; set -- \"$@\"; echo \"$#, $@\")\n\n```\n\n**[Go Contents](#contents)**\n\n## 5. <span id=\"e\">Features and Bugs</span>\n\n\n\n### 5.1 Command Substitution\n\n\n\nUse **$(command)** instead of backticks.\n\nNested backticks require escaping the inner ones with **\\.** The **$(command)** format doesn't change when nested and is easier to read.\n\n\n\n***Example:***\n\n```\n\n# This is preferred:\n\nvar=\"$(command \"$(command1)\")\"\n\n\n\n# This is not:\n\nvar=\"`command \\`command1\\``\"\n\n```\n\n\n\n### 5.2 Test, [ and [[\n\n\n\n**[[ ... ]]** is preferred over **[**, **test** and **/usr/bin/[**.\n\n**[[ ... ]]** reduces errors as no pathname expansion or word splitting takes place between **[[ and ]]** and **[[ ... ]]** allows for regular expression matching where [ ... ] does not.\n\n\n\n```\n\n# This ensures the string on the left is made up of characters in the\n\n# alnum character class followed by the string name.\n\n# Note that the RHS should not be quoted here.\n\n# For the gory details, see\n\n# E14 at http://tiswww.case.edu/php/chet/bash/FAQ\n\nif [[ \"filename\" =~ ^[[:alnum:]]+name ]]; then\n\n  echo \"Match\"\n\nfi\n\n\n\n# This matches the exact pattern \"f*\" (Does not match in this case)\n\nif [[ \"filename\" == \"f*\" ]]; then\n\n  echo \"Match\"\n\nfi\n\n\n\n# This gives a \"too many arguments\" error as f* is expanded to the\n\n# contents of the current directory\n\nif [ \"filename\" == f* ]; then\n\n  echo \"Match\"\n\nfi\n\n```\n\n\n\n### 5.3 Testing Strings\n\n\n\nUse quotes rather than filler characters where possible.\n\nBash is smart enough to deal with an empty string in a test. So, given that the code is much easier to read, use tests for empty/non-empty strings or empty strings rather than filler characters.\n\n\n\n```\n\n# Do this:\n\nif [[ \"${my_var}\" = \"some_string\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# -z (string length is zero) and -n (string length is not zero) are\n\n# preferred over testing for an empty string\n\nif [[ -z \"${my_var}\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# This is OK (ensure quotes on the empty side), but not preferred:\n\nif [[ \"${my_var}\" = \"\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# Not this:\n\nif [[ \"${my_var}X\" = \"some_stringX\" ]]; then\n\n  do_something\n\nfi\n\n```\n\nTo avoid confusion about what you're testing for, explicitly use **-z** or **-n**.\n\n```\n\n# Use this\n\nif [[ -n \"${my_var}\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# Instead of this as errors can occur if ${my_var} expands to a test\n\n# flag\n\nif [[ \"${my_var}\" ]]; then\n\n  do_something\n\nfi\n\n```\n\n\n\n### 5.4 Wildcard Expansion of Filenames\n\n\n\nUse an explicit path when doing wildcard expansion of filenames.\n\nAs filenames can begin with a -, it's a lot safer to expand wildcards with ./* instead of * .\n\n\n\n```\n\n# Here's the contents of the directory:\n\n# -f  -r  somedir  somefile\n\n\n\n# This deletes almost everything in the directory by force\n\npsa@bilby$ rm -v *\n\nremoved directory: `somedir'\n\nremoved `somefile'\n\n\n\n# As opposed to:\n\npsa@bilby$ rm -v ./*\n\nremoved `./-f'\n\nremoved `./-r'\n\nrm: cannot remove `./somedir': Is a directory\n\nremoved `./somefile'\n\n```\n\n\n\n### 5.5 Eval\n\n**eval** should be avoided.  \n\nEval munges the input when used for assignment to variables and can set variables without making it possible to check what those variables were.\n\n```\n\n# What does this set?\n\n# Did it succeed? In part or whole?\n\neval $(set_my_variables)\n\n\n\n# What happens if one of the returned values has a space in it?\n\nvariable=\"$(eval some_function)\"\n\n```\n\n\n\n### 5.6 Pipes to While\n\n\n\nUse process substitution or for loops in preference to piping to while. Variables modified in a while loop do not propagate to the parent because the loop's commands run in a subshell.\n\nThe implicit subshell in a pipe to while can make it difficult to track down bugs.\n\n```\n\nlast_line='NULL'\n\nyour_command | while read line; do\n\n  last_line=\"${line}\"\n\ndone\n\n\n\n# This will output 'NULL'\n\necho \"${last_line}\"\n\n```\n\nUse a for loop if you are confident that the input will not contain spaces or special characters (usually, this means not user input).\n\n```\n\ntotal=0\n\n# Only do this if there are no spaces in return values.\n\nfor value in $(command); do\n\n  total+=\"${value}\"\n\ndone\n\n```\n\nUsing process substitution allows redirecting output but puts the commands in an explicit subshell rather than the implicit subshell that bash creates for the while loop.\n\n```\n\ntotal=0\n\nlast_file=\n\nwhile read count filename; do\n\n  total+=\"${count}\"\n\n  last_file=\"${filename}\"\n\ndone < <(your_command | uniq -c)\n\n\n\n# This will output the second field of the last line of output from\n\n# the command.\n\necho \"Total = ${total}\"\n\necho \"Last one = ${last_file}\"\n\n```\n\nUse while loops where it is not necessary to pass complex results to the parent shell - this is typically where some more complex \"parsing\" is required. Beware that simple examples are probably more easily done with a tool such as awk. This may also be useful where you specifically don't want to change the parent scope variables.\n\n```\n\n# Trivial implementation of awk expression:\n\n#   awk '$3 == \"nfs\" { print $2 \" maps to \" $1 }' /proc/mounts\n\ncat /proc/mounts | while read src dest type opts rest; do\n\n  if [[ ${type} == \"nfs\" ]]; then\n\n    echo \"NFS ${dest} maps to ${src}\"\n\n  fi\n\ndone\n\n```\n\n**[Go Contents](#contents)**\n\n## 6. <span id=\"f\">Naming Conventions</span>\n\n\n\n### 6.1 Function Names\n\nLower-case, with underscores to separate words. Separate libraries with **::**. Parentheses are required after the function name. The keyword ***function*** is optional, but must be used consistently throughout a project.\n\nIf you're writing single functions, use lowercase and separate words with underscore. If you're writing a package, separate package names with **::**. Braces must be on the same line as the function name (as with other languages at Google) and no space between the function name and the parenthesis.\n\n```\n\n# Single function\n\nmy_func() {\n\n  ...\n\n}\n\n\n\n# Part of a package\n\nmypackage::my_func() {\n\n  ...\n\n}\n\n```\n\n\n\nThe **function** keyword is extraneous when \"()\" is present after the function name, but enhances quick identification of functions.\n\n\n\n### 6.2 Variable Names\n\n\n\nAs for function names.\n\nVariables names for loops should be similarly named for any variable you're looping through.\n\n```\n\nfor zone in ${zones}; do\n\n  something_with \"${zone}\"\n\ndone\n\n```\n\n\n\n### 6.3 Constants and Environment Variable Names\n\n\n\nAll caps, separated with underscores, declared at the top of the file.\n\nConstants and anything exported to the environment should be capitalized.  \n\n```\n\n# Constant\n\nreadonly PATH_TO_FILES='/some/path'  \n\n\n\n# Both constant and environment\n\ndeclare -xr ORACLE_SID='PROD'\n\n```\n\n\n\nSome things become constant at their first setting (for example, via getopts). Thus, it's OK to set a constant in getopts or based on a condition, but it should be made readonly immediately afterwards. Note that **declare** doesn't operate on global variables within functions, so **readonly** or **export** is recommended instead.\n\n```\n\nVERBOSE='false'\n\nwhile getopts 'v' flag; do\n\n  case \"${flag}\" in\n\n    v) VERBOSE='true' ;;\n\n  esac\n\ndone\n\nreadonly VERBOSE\n\n```\n\n### 6.4 Source Filenames\n\n\n\nLowercase, with underscores to separate words if desired.\n\nThis is for consistency with other code styles in Google: **maketemplate** or **make_template** but <font color=\"red\">not</font> **make-template**.\n\n\n\n### 6.5 Read-only Variables\n\n\n\nUse **readonly** or **declare -r** to ensure they're read only.\n\nAs globals are widely used in shell, it's important to catch errors when working with them. When you declare a variable that is meant to be read-only, make this explicit.\n\n```\n\nzip_version=\"$(dpkg --status zip | grep Version: | cut -d ' ' -f 2)\"\n\nif [[ -z \"${zip_version}\" ]]; then\n\n  error_message\n\nelse\n\n  readonly zip_version\n\nfi\n\n```\n\n### 6.6 Use Local Variables\n\n\n\nDeclare function-specific variables with **local**. Declaration and assignment should be on different lines.\n\nEnsure that local variables are only seen inside a function and its children by using **local** when declaring them. This avoids polluting the global name space and inadvertently setting variables that may have significance outside the function.\n\n\n\nDeclaration and assignment must be separate statements when the assignment value is provided by a command substitution; as the 'local' builtin does not propagate the exit code from the command substitution.\n\n```\n\nmy_func2() {\n\n  local name=\"$1\"\n\n\n\n  # Separate lines for declaration and assignment:\n\n  local my_var\n\n  my_var=\"$(my_func)\" || return\n\n\n\n  # DO NOT do this: $? contains the exit code of 'local', not my_func\n\n  local my_var=\"$(my_func)\"\n\n  [[ $? -eq 0 ]] || return\n\n\n\n  ...\n\n}  \n\n\n\n```\n\n### 6.7 Function Location\n\nPut all functions together in the file just below constants. Don't hide executable code between functions.\n\nIf you've got functions, put them all together near the top of the file. Only includes, **set** statements and setting constants may be done before declaring functions.\n\n\n\nDon't hide executable code between functions. Doing so makes the code difficult to follow and results in nasty surprises when debugging.\n\n\n\n### 6.8 main\n\n\n\nA function called ***main*** is required for scripts long enough to contain at least one other function.\n\nIn order to easily find the start of the program, put the main program in a function called **main** as the bottom most function. This provides consistency with the rest of the code base as well as allowing you to define more variables as **local** (which can't be done if the main code is not a function). The last non-comment line in the file should be a call to **main**:\n\n```\n\nmain \"$@\"\n\n```\n\n\n\nObviously, for short scripts where it's just a linear flow, **main** is overkill and so is not required.\n\n\n\n## 7. <span id=\"g\">Calling Commands</span>\n\n\n\n### 7.1 Checking Return Values\n\nAlways check return values and give informative return values.\n\nFor unpiped commands, use **$?** or check directly via an **if** statement to keep it simple.\n\n\n\nExample:\n\n```\n\nif ! mv \"${file_list}\" \"${dest_dir}/\" ; then\n\n  echo \"Unable to move ${file_list} to ${dest_dir}\" >&2\n\n  exit \"${E_BAD_MOVE}\"\n\nfi\n\n\n\n# Or\n\nmv \"${file_list}\" \"${dest_dir}/\"\n\nif [[ \"$?\" -ne 0 ]]; then\n\n  echo \"Unable to move ${file_list} to ${dest_dir}\" >&2\n\n  exit \"${E_BAD_MOVE}\"\n\nfi\n\n```\n\nBash also has the **PIPESTATUS** variable that allows checking of the return code from all parts of a pipe. If it's only necessary to check success or failure of the whole pipe, then the following is acceptable:\n\n```\n\ntar -cf - ./* | ( cd \"${dir}\" && tar -xf - )\n\nif [[ \"${PIPESTATUS[0]}\" -ne 0 || \"${PIPESTATUS[1]}\" -ne 0 ]]; then\n\n  echo \"Unable to tar files to ${dir}\" >&2\n\nfi\n\n```\n\nHowever, as **PIPESTATUS** will be overwritten as soon as you do any other command, if you need to act differently on errors based on where it happened in the pipe, you'll need to assign **PIPESTATUS** to another variable immediately after running the command (don't forget that [ is a command and will wipe out **PIPESTATUS**).\n\n```\n\ntar -cf - ./* | ( cd \"${DIR}\" && tar -xf - )\n\nreturn_codes=(${PIPESTATUS[*]})\n\nif [[ \"${return_codes[0]}\" -ne 0 ]]; then\n\n  do_something\n\nfi\n\nif [[ \"${return_codes[1]}\" -ne 0 ]]; then\n\n  do_something_else\n\nfi\n\n\n\n```\n\n\n\n### 7.2 Builtin Commands vs. External Commands\n\n\n\nGiven the choice between invoking a shell builtin and invoking a separate process, choose the builtin.\n\nWe prefer the use of builtins such as the Parameter Expansion functions in **bash(1)** as it's more robust and portable (especially when compared to things like sed).  \n\n\n\n ***Example:***\n\n```\n\n# Prefer this:\n\naddition=$((${X} + ${Y}))\n\nsubstitution=\"${string/#foo/bar}\"\n\n\n\n# Instead of this:\n\naddition=\"$(expr ${X} + ${Y})\"\n\nsubstitution=\"$(echo \"${string}\" | sed -e 's/^foo/bar/')\"\n\n```\n\n**[Go Contents](#contents)**\n\n## 8. <span id=\"h\">Conclusion</span>\n\nUse common sense and **BE CONSISTENT**.\n\nPlease take a few minutes to read the Parting Words section at the bottom of the **C++ Guide**.\n\n\n\n**[Go Contents](#contents)**\n","source":"_posts/shell-style-guide.md","raw":"---\ntitle: shell style guide\ndate: 2017-01-12 14:06:39\ncategories: shell\ntags: shell\n---\n\n# Shell Style Guide\n\n\n\n## <span id=\"contents\">Contents</span>\n\n1.[Shell Files and Interpreter Invocation](#a)\n\n- 1.1 File Extensions\n\n- 1.2 SUID/SGID  \n\n\n\n2.[Environment](#b) \n\n- 2.1 STDOUT vs STDERR  \n\n\n\n3.[Comments](#c)\n\n- 3.1 File Header \n\n- 3.2 Function Comments\n\n- 3.3 Implementation Comments\n\n- 3.4 TODO Comments  \n\n\n\n4.[Formatting](#d)\n\n- 4.1 Indentation \n\n- 4.2 Line Length and Long Strings\n\n- 4.3 Pipelines | Loops\n\n- 4.4 Case statement\n\n- 4.5 Variable expansion\n\n- 4.6 Quoting  \n\n\n\n5.[Features and Bugs](#e) \n\n- 5.1 Command Substitution\n\n- 5.2 Test, [ and [[ \n\n- 5.3 Testing Strings Wildcard Expansion of Filenames \n\n- 5.4 Eval\n\n- 5.5 Pipes to While  \n\n\n\n6.[Naming Conventions](#f)\n\n- 6.1 Function Names \n\n- 6.2 Variable Names \n\n- 6.3 Constants and Environment Variable Names \n\n- 6.4 Source Filenames \n\n- 6.5 Read-only Variables \n\n- 6.7 Use Local Variables \n\n- 6.8 Function Location \n\n- 6.9 main  \n\n\n\n7.[Calling Commands](#g)\n\n- 7.1 Checking Return Values \n\n- 7.2 Builtin Commands vs. External Commands  \n\n\n\n8.[Conclusion](#h)\n\n## Which Shell to Use\n\n**Bash** is the only shell scripting language permitted for executables.  \n\nExecutables must start with **#! /bin/bash** and a minimum number of flags.\n\nUse **set** to set shell options so that calling your script as **bash** ***script_name*** does not break its functionality.\n\n\n\nRestricting all executable shell scripts to bash gives us a consistent shell language that's installed on all our machines.\n\n\n\nThe only exception to this is where you're forced to by whatever you're coding for.\n\nOne example of this is Solaris SVR4 packages which require plain Bourne shell for any scripts.\n\n\n\n## When to use Shell\n\nShell should only be used for small utilities or simple wrapper scripts.  \n\nWhile shell scripting isn't a development language, it is used for writing various utility scripts throughout Google.   This style guide is more a recognition of its use rather than a suggestion that it be used for widespread deployment.\n\n\n\nSome guidelines:\n\n- If you're mostly calling other utilities and are doing relatively little data manipulation, shell is an acceptable choice for the task.\n\n- If performance matters, use something other than shell.\n\n- If you find you need to use arrays for anything more than assignment of **${PIPESTATUS}**, you should use Python.\n\n- If you are writing a script that is more than 100 lines long, you should probably be writing it in Python instead. Bear in mind that scripts grow. Rewrite your script in another language early to avoid a time-consuming rewrite at a later date.  \n\n\n\n**[Go Contents](#contents)**\n\n## 1.  <span id=\"a\">Shell Files and Interpreter Invocation</span>\n\n\n\n### 1.1 File Extensions\n\n\n\nExecutables should have no extension (strongly preferred) or a **.sh** extension. Libraries must have a **.sh** extension and should not be executable.\n\nIt is not necessary to know what language a program is written in when executing it and shell doesn't require an extension so we prefer not to use one for executables.\n\n\n\nHowever, for libraries it's important to know what language it is and sometimes there's a need to have similar libraries in different languages. This allows library files with identical purposes but different languages to be identically named except for the language-specific suffix.\n\n\n\n### 1.2 SUID/SGID\n\n\n\nSUID and SGID are forbidden on shell scripts.\n\nThere are too many security issues with shell that make it nearly impossible to secure sufficiently to allow SUID/SGID. While bash does make it difficult to run SUID, it's still possible on some platforms which is why we're being explicit about banning it.\n\n\n\nUse **sudo** to provide elevated access if you need it.\n\n**[Go Contents](#contents)**\n\n## 2. <span id=\"b\">Environment</span>\n\n\n\n### 2.1 STDOUT vs STDERR\n\n\n\nAll error messages should go to **STDERR**.\n\nThis makes it easier to separate normal status from actual issues.\n\nA function to print out error messages along with other status information is recommended.\n\n```\n\nerr() {\n\n  echo \"[$(date +'%Y-%m-%dT%H:%M:%S%z')]: $@\" >&2\n\n}\n\n\n\nif ! do_something; then\n\n  err \"Unable to do_something\"\n\n  exit \"${E_DID_NOTHING}\"\n\nfi\n\n```\n\n**[Go Contents](#contents)**\n\n## 3. <span id=\"c\">Comments</span>\n\n### 3.1 File Header\n\nStart each file with a description of its contents.\n\nEvery file must have a top-level comment including a brief overview of its contents. A copyright notice and author information are optional.\n\n\n\n***Example:***\n\n```\n\n#!/bin/bash\n\n#\n\n# Perform hot backups of Oracle databases.\n\n```\n\n\n\n### 3.2 Function Comments\n\n\n\nAny function that is not both obvious and short must be commented. Any function in a library must be commented regardless of length or complexity.\n\nIt should be possible for someone else to learn how to use your program or to use a function in your library by reading the comments (and self-help, if provided) without reading the code.\n\n\n\nAll function comments should contain:\n\n- Description of the function\n\n- Global variables used and modified\n\n- Arguments taken\n\n- Returned values other than the default exit status of the last command run\n\n\n\n***Example:***\n\n```\n\n#!/bin/bash\n\n#\n\n# Perform hot backups of Oracle databases.\n\n\n\nexport PATH='/usr/xpg4/bin:/usr/bin:/opt/csw/bin:/opt/goog/bin'\n\n\n\n#######################################\n\n# Cleanup files from the backup dir\n\n# Globals:\n\n#   BACKUP_DIR\n\n#   ORACLE_SID\n\n# Arguments:\n\n#   None\n\n# Returns:\n\n#   None\n\n#######################################\n\ncleanup() {\n\n  ...\n\n}\n\n```\n\n\n\n### 3.3 Implementation Comments\n\n\n\nComment tricky, non-obvious, interesting or important parts of your code.\n\nThis follows general Google coding comment practice. Don't comment everything. If there's a complex algorithm or you're doing something out of the ordinary, put a short comment in.\n\n\n\n### 3.4 TODO Comments\n\n\n\nUse **TODO** comments for code that is temporary, a short-term solution, or good-enough but not perfect.\n\nThis matches the convention in the **C++ Guide**.\n\n\n\n**TODOs** should include the string **TODO** in all caps, followed by your username in parentheses. A colon is optional. It's preferable to put a bug/ticket number next to the **TODO** item as well.\n\n\n\n***Examples:***\n\n```\n\n# TODO(mrmonkey): Handle the unlikely edge cases (bug ####)\n\n```\n\n**[Go Contents](#contents)**\n\n## 4. <span id=\"d\">Formatting</span>\n\nWhile you should follow the style that's already there for files that you're modifying, the following are required for any new code.\n\n\n\n### 4.1 Indentation\n\nIndent 2 spaces. No tabs.\n\nUse blank lines between blocks to improve readability. Indentation is two spaces. Whatever you do, don't use tabs. For existing files, stay faithful to the existing indentation.\n\n\n\n### 4.2 Line Length and Long Strings\n\nMaximum line length is 80 characters.\n\nIf you have to write strings that are longer than 80 characters, this should be done with a here document or an embedded newline if possible. Literal strings that have to be longer than 80 chars and can't sensibly be split are ok, but it's strongly preferred to find a way to make it shorter.\n\n```\n\n# DO use 'here document's\n\ncat <<END;\n\nI am an exceptionally long\n\nstring.\n\nEND\n\n\n\n# Embedded newlines are ok too\n\nlong_string=\"I am an exceptionally\n\n  long string.\"\n\n```\n\n### 4.3 Pipelines\n\n\n\nPipelines should be split one per line if they don't all fit on one line.\n\nIf a pipeline all fits on one line, it should be on one line.\n\nIf not, it should be split at one pipe segment per line with the pipe on the newline and a 2 space indent for the next section of the pipe. This applies to a chain of commands combined using '**|**' as well as to logical compounds using '**||**' and '**&&**'.\n\n```\n\n# All fits on one line\n\ncommand1 | command2\n\n\n\n# Long commands\n\ncommand1 \\\n\n  | command2 \\\n\n  | command3 \\\n\n  | command4\n\n```\n\n### 4.4 Loops\n\nPut **; do** and **; then** on the same line as the **while**, **for** or **if**.\n\nLoops in shell are a bit different, but we follow the same principles as with braces when declaring functions.\n\nThat is: **; then** and **; do** should be <font color=\"red\">on the same line</font> as the **if/for/while**.**else** should be on its own line and closing statements should be on their own line vertically aligned with the opening statement.\n\n\n\n***Example:***\n\n```\n\nfor dir in ${dirs_to_cleanup}; do\n\n  if [[ -d \"${dir}/${ORACLE_SID}\" ]]; then\n\n    log_date \"Cleaning up old files in ${dir}/${ORACLE_SID}\"\n\n    rm \"${dir}/${ORACLE_SID}/\"*\n\n    if [[ \"$?\" -ne 0 ]]; then\n\n      error_message\n\n    fi\n\n  else\n\n    mkdir -p \"${dir}/${ORACLE_SID}\"\n\n    if [[ \"$?\" -ne 0 ]]; then\n\n      error_message\n\n    fi\n\n  fi\n\ndone\n\n```\n\n### 4.5 Case statement\n\n- Indent alternatives by 2 spaces.\n\n- A one-line alternative needs a space after the close parenthesis of the pattern and before the **;;**.\n\n- Long or multi-command alternatives should be split over multiple lines with the pattern, actions, and **;;** on separate lines.\n\n\n\nThe matching expressions are indented one level from the '**case**' and '**esac**'. Multiline actions are indented another level. In general, there is no need to quote match expressions. Pattern expressions should not be preceded by an open parenthesis. Avoid the **;&** and **;;&** notations.\n\n```\n\ncase \"${expression}\" in\n\n  a)\n\n    variable=\"...\"\n\n    some_command \"${variable}\" \"${other_expr}\" ...\n\n    ;;\n\n  absolute)\n\n    actions=\"relative\"\n\n    another_command \"${actions}\" \"${other_expr}\" ...\n\n    ;;\n\n  *)\n\n    error \"Unexpected expression '${expression}'\"\n\n    ;;\n\nesac\n\n```\n\nSimple commands may be put on the same line as the pattern and **;;** as long as the expression remains readable. This is often appropriate for single-letter option processing. When the actions don't fit on a single line, put the pattern on a line on its own, then the actions, then **;;**; also <font color=\"red\"> on a line of its own</font>. When on the same line as the actions, use a space after the close parenthesis of the pattern and another before the **;;**.\n\n```\n\nverbose='false'\n\naflag=''\n\nbflag=''\n\nfiles=''\n\nwhile getopts 'abf:v' flag; do\n\n  case \"${flag}\" in\n\n    a) aflag='true' ;;\n\n    b) bflag='true' ;;\n\n    f) files=\"${OPTARG}\" ;;\n\n    v) verbose='true' ;;\n\n    *) error \"Unexpected option ${flag}\" ;;\n\n  esac\n\ndone\n\n```\n\n### 4.6 Variable expansion\n\nIn order of precedence: Stay consistent with what you find; quote your variables; prefer \"**${var}**\" over \"**$var**\", but see details.\n\nThese are meant to be guidelines, as the topic seems too controversial for a mandatory regulation.\n\nThey are listed in order of precedence.\n\n\n\n1. Stay consistent with what you find for existing code.\n\n1. Quote variables, see Quoting section below.\n\n1. Don't brace-quote single character shell specials / positional parameters, unless strictly necessary or avoiding deep confusion.\n\nPrefer brace-quoting all other variables.\n\n\n\n```\n\n# Section of recommended cases.\n\n# Preferred style for 'special' variables:\n\necho \"Positional: $1\" \"$5\" \"$3\"\n\necho \"Specials: !=$!, -=$-, _=$_. ?=$?, #=$# *=$* @=$@ \\$=$$ ...\"\n\n\n\n# Braces necessary:\n\necho \"many parameters: ${10}\"\n\n\n\n# Braces avoiding confusion:\n\n# Output is \"a0b0c0\"\n\nset -- a b c\n\necho \"${1}0${2}0${3}0\"\n\n\n\n# Preferred style for other variables:\n\necho \"PATH=${PATH}, PWD=${PWD}, mine=${some_var}\"\n\nwhile read f; do\n\n  echo \"file=${f}\"\n\ndone < <(ls -l /tmp)\n\n\n\n# Section of discouraged cases\n\n\n\n# Unquoted vars, unbraced vars, brace-quoted single letter\n\n# shell specials.\n\necho a=$avar \"b=$bvar\" \"PID=${$}\" \"${1}\"\n\n\n\n# Confusing use: this is expanded as \"${1}0${2}0${3}0\",\n\n# not \"${10}${20}${30}\n\nset -- a b c\n\necho \"$10$20$30\"\n\n```\n\n### 4.7 Quoting\n\n\n\n- Always quote strings containing variables, command substitutions, spaces or shell meta characters, unless careful unquoted expansion is required.\n\n- Prefer quoting strings that are \"words\" (as opposed to command options or path names).\n\n- Never quote ***literal*** integers.\n\n- Be aware of the quoting rules for pattern matches in [[.\n\n- Use \"**$@**\" unless you have a specific reason to use **$***.\n\n\n\n```\n\n# 'Single' quotes indicate that no substitution is desired.\n\n# \"Double\" quotes indicate that substitution is required/tolerated.\n\n\n\n# Simple examples\n\n# \"quote command substitutions\"\n\nflag=\"$(some_command and its args \"$@\" 'quoted separately')\"\n\n\n\n# \"quote variables\"\n\necho \"${flag}\"\n\n\n\n# \"never quote literal integers\"\n\nvalue=32\n\n# \"quote command substitutions\", even when you expect integers\n\nnumber=\"$(generate_number)\"\n\n\n\n# \"prefer quoting words\", not compulsory\n\nreadonly USE_INTEGER='true'\n\n\n\n# \"quote shell meta characters\"\n\necho 'Hello stranger, and well met. Earn lots of $$$'\n\necho \"Process $$: Done making \\$\\$\\$.\"\n\n\n\n# \"command options or path names\"\n\n# ($1 is assumed to contain a value here)\n\ngrep -li Hugo /dev/null \"$1\"\n\n\n\n# Less simple examples\n\n# \"quote variables, unless proven false\": ccs might be empty\n\ngit send-email --to \"${reviewers}\" ${ccs:+\"--cc\" \"${ccs}\"}\n\n\n\n# Positional parameter precautions: $1 might be unset\n\n# Single quotes leave regex as-is.\n\ngrep -cP '([Ss]pecial|\\|?characters*)$' ${1:+\"$1\"}\n\n\n\n# For passing on arguments,\n\n# \"$@\" is right almost everytime, and\n\n# $* is wrong almost everytime:\n\n#\n\n# * $* and $@ will split on spaces, clobbering up arguments\n\n#   that contain spaces and dropping empty strings;\n\n# * \"$@\" will retain arguments as-is, so no args\n\n#   provided will result in no args being passed on;\n\n#   This is in most cases what you want to use for passing\n\n#   on arguments.\n\n# * \"$*\" expands to one argument, with all args joined\n\n#   by (usually) spaces,\n\n#   so no args provided will result in one empty string\n\n#   being passed on.\n\n# (Consult 'man bash' for the nit-grits ;-)\n\n\n\nset -- 1 \"2 two\" \"3 three tres\"; echo $# ; set -- \"$*\"; echo \"$#, $@\")\n\nset -- 1 \"2 two\" \"3 three tres\"; echo $# ; set -- \"$@\"; echo \"$#, $@\")\n\n```\n\n**[Go Contents](#contents)**\n\n## 5. <span id=\"e\">Features and Bugs</span>\n\n\n\n### 5.1 Command Substitution\n\n\n\nUse **$(command)** instead of backticks.\n\nNested backticks require escaping the inner ones with **\\.** The **$(command)** format doesn't change when nested and is easier to read.\n\n\n\n***Example:***\n\n```\n\n# This is preferred:\n\nvar=\"$(command \"$(command1)\")\"\n\n\n\n# This is not:\n\nvar=\"`command \\`command1\\``\"\n\n```\n\n\n\n### 5.2 Test, [ and [[\n\n\n\n**[[ ... ]]** is preferred over **[**, **test** and **/usr/bin/[**.\n\n**[[ ... ]]** reduces errors as no pathname expansion or word splitting takes place between **[[ and ]]** and **[[ ... ]]** allows for regular expression matching where [ ... ] does not.\n\n\n\n```\n\n# This ensures the string on the left is made up of characters in the\n\n# alnum character class followed by the string name.\n\n# Note that the RHS should not be quoted here.\n\n# For the gory details, see\n\n# E14 at http://tiswww.case.edu/php/chet/bash/FAQ\n\nif [[ \"filename\" =~ ^[[:alnum:]]+name ]]; then\n\n  echo \"Match\"\n\nfi\n\n\n\n# This matches the exact pattern \"f*\" (Does not match in this case)\n\nif [[ \"filename\" == \"f*\" ]]; then\n\n  echo \"Match\"\n\nfi\n\n\n\n# This gives a \"too many arguments\" error as f* is expanded to the\n\n# contents of the current directory\n\nif [ \"filename\" == f* ]; then\n\n  echo \"Match\"\n\nfi\n\n```\n\n\n\n### 5.3 Testing Strings\n\n\n\nUse quotes rather than filler characters where possible.\n\nBash is smart enough to deal with an empty string in a test. So, given that the code is much easier to read, use tests for empty/non-empty strings or empty strings rather than filler characters.\n\n\n\n```\n\n# Do this:\n\nif [[ \"${my_var}\" = \"some_string\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# -z (string length is zero) and -n (string length is not zero) are\n\n# preferred over testing for an empty string\n\nif [[ -z \"${my_var}\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# This is OK (ensure quotes on the empty side), but not preferred:\n\nif [[ \"${my_var}\" = \"\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# Not this:\n\nif [[ \"${my_var}X\" = \"some_stringX\" ]]; then\n\n  do_something\n\nfi\n\n```\n\nTo avoid confusion about what you're testing for, explicitly use **-z** or **-n**.\n\n```\n\n# Use this\n\nif [[ -n \"${my_var}\" ]]; then\n\n  do_something\n\nfi\n\n\n\n# Instead of this as errors can occur if ${my_var} expands to a test\n\n# flag\n\nif [[ \"${my_var}\" ]]; then\n\n  do_something\n\nfi\n\n```\n\n\n\n### 5.4 Wildcard Expansion of Filenames\n\n\n\nUse an explicit path when doing wildcard expansion of filenames.\n\nAs filenames can begin with a -, it's a lot safer to expand wildcards with ./* instead of * .\n\n\n\n```\n\n# Here's the contents of the directory:\n\n# -f  -r  somedir  somefile\n\n\n\n# This deletes almost everything in the directory by force\n\npsa@bilby$ rm -v *\n\nremoved directory: `somedir'\n\nremoved `somefile'\n\n\n\n# As opposed to:\n\npsa@bilby$ rm -v ./*\n\nremoved `./-f'\n\nremoved `./-r'\n\nrm: cannot remove `./somedir': Is a directory\n\nremoved `./somefile'\n\n```\n\n\n\n### 5.5 Eval\n\n**eval** should be avoided.  \n\nEval munges the input when used for assignment to variables and can set variables without making it possible to check what those variables were.\n\n```\n\n# What does this set?\n\n# Did it succeed? In part or whole?\n\neval $(set_my_variables)\n\n\n\n# What happens if one of the returned values has a space in it?\n\nvariable=\"$(eval some_function)\"\n\n```\n\n\n\n### 5.6 Pipes to While\n\n\n\nUse process substitution or for loops in preference to piping to while. Variables modified in a while loop do not propagate to the parent because the loop's commands run in a subshell.\n\nThe implicit subshell in a pipe to while can make it difficult to track down bugs.\n\n```\n\nlast_line='NULL'\n\nyour_command | while read line; do\n\n  last_line=\"${line}\"\n\ndone\n\n\n\n# This will output 'NULL'\n\necho \"${last_line}\"\n\n```\n\nUse a for loop if you are confident that the input will not contain spaces or special characters (usually, this means not user input).\n\n```\n\ntotal=0\n\n# Only do this if there are no spaces in return values.\n\nfor value in $(command); do\n\n  total+=\"${value}\"\n\ndone\n\n```\n\nUsing process substitution allows redirecting output but puts the commands in an explicit subshell rather than the implicit subshell that bash creates for the while loop.\n\n```\n\ntotal=0\n\nlast_file=\n\nwhile read count filename; do\n\n  total+=\"${count}\"\n\n  last_file=\"${filename}\"\n\ndone < <(your_command | uniq -c)\n\n\n\n# This will output the second field of the last line of output from\n\n# the command.\n\necho \"Total = ${total}\"\n\necho \"Last one = ${last_file}\"\n\n```\n\nUse while loops where it is not necessary to pass complex results to the parent shell - this is typically where some more complex \"parsing\" is required. Beware that simple examples are probably more easily done with a tool such as awk. This may also be useful where you specifically don't want to change the parent scope variables.\n\n```\n\n# Trivial implementation of awk expression:\n\n#   awk '$3 == \"nfs\" { print $2 \" maps to \" $1 }' /proc/mounts\n\ncat /proc/mounts | while read src dest type opts rest; do\n\n  if [[ ${type} == \"nfs\" ]]; then\n\n    echo \"NFS ${dest} maps to ${src}\"\n\n  fi\n\ndone\n\n```\n\n**[Go Contents](#contents)**\n\n## 6. <span id=\"f\">Naming Conventions</span>\n\n\n\n### 6.1 Function Names\n\nLower-case, with underscores to separate words. Separate libraries with **::**. Parentheses are required after the function name. The keyword ***function*** is optional, but must be used consistently throughout a project.\n\nIf you're writing single functions, use lowercase and separate words with underscore. If you're writing a package, separate package names with **::**. Braces must be on the same line as the function name (as with other languages at Google) and no space between the function name and the parenthesis.\n\n```\n\n# Single function\n\nmy_func() {\n\n  ...\n\n}\n\n\n\n# Part of a package\n\nmypackage::my_func() {\n\n  ...\n\n}\n\n```\n\n\n\nThe **function** keyword is extraneous when \"()\" is present after the function name, but enhances quick identification of functions.\n\n\n\n### 6.2 Variable Names\n\n\n\nAs for function names.\n\nVariables names for loops should be similarly named for any variable you're looping through.\n\n```\n\nfor zone in ${zones}; do\n\n  something_with \"${zone}\"\n\ndone\n\n```\n\n\n\n### 6.3 Constants and Environment Variable Names\n\n\n\nAll caps, separated with underscores, declared at the top of the file.\n\nConstants and anything exported to the environment should be capitalized.  \n\n```\n\n# Constant\n\nreadonly PATH_TO_FILES='/some/path'  \n\n\n\n# Both constant and environment\n\ndeclare -xr ORACLE_SID='PROD'\n\n```\n\n\n\nSome things become constant at their first setting (for example, via getopts). Thus, it's OK to set a constant in getopts or based on a condition, but it should be made readonly immediately afterwards. Note that **declare** doesn't operate on global variables within functions, so **readonly** or **export** is recommended instead.\n\n```\n\nVERBOSE='false'\n\nwhile getopts 'v' flag; do\n\n  case \"${flag}\" in\n\n    v) VERBOSE='true' ;;\n\n  esac\n\ndone\n\nreadonly VERBOSE\n\n```\n\n### 6.4 Source Filenames\n\n\n\nLowercase, with underscores to separate words if desired.\n\nThis is for consistency with other code styles in Google: **maketemplate** or **make_template** but <font color=\"red\">not</font> **make-template**.\n\n\n\n### 6.5 Read-only Variables\n\n\n\nUse **readonly** or **declare -r** to ensure they're read only.\n\nAs globals are widely used in shell, it's important to catch errors when working with them. When you declare a variable that is meant to be read-only, make this explicit.\n\n```\n\nzip_version=\"$(dpkg --status zip | grep Version: | cut -d ' ' -f 2)\"\n\nif [[ -z \"${zip_version}\" ]]; then\n\n  error_message\n\nelse\n\n  readonly zip_version\n\nfi\n\n```\n\n### 6.6 Use Local Variables\n\n\n\nDeclare function-specific variables with **local**. Declaration and assignment should be on different lines.\n\nEnsure that local variables are only seen inside a function and its children by using **local** when declaring them. This avoids polluting the global name space and inadvertently setting variables that may have significance outside the function.\n\n\n\nDeclaration and assignment must be separate statements when the assignment value is provided by a command substitution; as the 'local' builtin does not propagate the exit code from the command substitution.\n\n```\n\nmy_func2() {\n\n  local name=\"$1\"\n\n\n\n  # Separate lines for declaration and assignment:\n\n  local my_var\n\n  my_var=\"$(my_func)\" || return\n\n\n\n  # DO NOT do this: $? contains the exit code of 'local', not my_func\n\n  local my_var=\"$(my_func)\"\n\n  [[ $? -eq 0 ]] || return\n\n\n\n  ...\n\n}  \n\n\n\n```\n\n### 6.7 Function Location\n\nPut all functions together in the file just below constants. Don't hide executable code between functions.\n\nIf you've got functions, put them all together near the top of the file. Only includes, **set** statements and setting constants may be done before declaring functions.\n\n\n\nDon't hide executable code between functions. Doing so makes the code difficult to follow and results in nasty surprises when debugging.\n\n\n\n### 6.8 main\n\n\n\nA function called ***main*** is required for scripts long enough to contain at least one other function.\n\nIn order to easily find the start of the program, put the main program in a function called **main** as the bottom most function. This provides consistency with the rest of the code base as well as allowing you to define more variables as **local** (which can't be done if the main code is not a function). The last non-comment line in the file should be a call to **main**:\n\n```\n\nmain \"$@\"\n\n```\n\n\n\nObviously, for short scripts where it's just a linear flow, **main** is overkill and so is not required.\n\n\n\n## 7. <span id=\"g\">Calling Commands</span>\n\n\n\n### 7.1 Checking Return Values\n\nAlways check return values and give informative return values.\n\nFor unpiped commands, use **$?** or check directly via an **if** statement to keep it simple.\n\n\n\nExample:\n\n```\n\nif ! mv \"${file_list}\" \"${dest_dir}/\" ; then\n\n  echo \"Unable to move ${file_list} to ${dest_dir}\" >&2\n\n  exit \"${E_BAD_MOVE}\"\n\nfi\n\n\n\n# Or\n\nmv \"${file_list}\" \"${dest_dir}/\"\n\nif [[ \"$?\" -ne 0 ]]; then\n\n  echo \"Unable to move ${file_list} to ${dest_dir}\" >&2\n\n  exit \"${E_BAD_MOVE}\"\n\nfi\n\n```\n\nBash also has the **PIPESTATUS** variable that allows checking of the return code from all parts of a pipe. If it's only necessary to check success or failure of the whole pipe, then the following is acceptable:\n\n```\n\ntar -cf - ./* | ( cd \"${dir}\" && tar -xf - )\n\nif [[ \"${PIPESTATUS[0]}\" -ne 0 || \"${PIPESTATUS[1]}\" -ne 0 ]]; then\n\n  echo \"Unable to tar files to ${dir}\" >&2\n\nfi\n\n```\n\nHowever, as **PIPESTATUS** will be overwritten as soon as you do any other command, if you need to act differently on errors based on where it happened in the pipe, you'll need to assign **PIPESTATUS** to another variable immediately after running the command (don't forget that [ is a command and will wipe out **PIPESTATUS**).\n\n```\n\ntar -cf - ./* | ( cd \"${DIR}\" && tar -xf - )\n\nreturn_codes=(${PIPESTATUS[*]})\n\nif [[ \"${return_codes[0]}\" -ne 0 ]]; then\n\n  do_something\n\nfi\n\nif [[ \"${return_codes[1]}\" -ne 0 ]]; then\n\n  do_something_else\n\nfi\n\n\n\n```\n\n\n\n### 7.2 Builtin Commands vs. External Commands\n\n\n\nGiven the choice between invoking a shell builtin and invoking a separate process, choose the builtin.\n\nWe prefer the use of builtins such as the Parameter Expansion functions in **bash(1)** as it's more robust and portable (especially when compared to things like sed).  \n\n\n\n ***Example:***\n\n```\n\n# Prefer this:\n\naddition=$((${X} + ${Y}))\n\nsubstitution=\"${string/#foo/bar}\"\n\n\n\n# Instead of this:\n\naddition=\"$(expr ${X} + ${Y})\"\n\nsubstitution=\"$(echo \"${string}\" | sed -e 's/^foo/bar/')\"\n\n```\n\n**[Go Contents](#contents)**\n\n## 8. <span id=\"h\">Conclusion</span>\n\nUse common sense and **BE CONSISTENT**.\n\nPlease take a few minutes to read the Parting Words section at the bottom of the **C++ Guide**.\n\n\n\n**[Go Contents](#contents)**\n","slug":"shell-style-guide","published":1,"updated":"2017-01-12T06:09:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j58001wzahib7fgngz1","content":"<h1 id=\"Shell-Style-Guide\"><a href=\"#Shell-Style-Guide\" class=\"headerlink\" title=\"Shell Style Guide\"></a>Shell Style Guide</h1><h2 id=\"Contents\"><a href=\"#Contents\" class=\"headerlink\" title=\"Contents\"></a><span id=\"contents\">Contents</span></h2><p>1.<a href=\"#a\">Shell Files and Interpreter Invocation</a></p>\n<ul>\n<li><p>1.1 File Extensions</p>\n</li>\n<li><p>1.2 SUID/SGID  </p>\n</li>\n</ul>\n<p>2.<a href=\"#b\">Environment</a> </p>\n<ul>\n<li>2.1 STDOUT vs STDERR  </li>\n</ul>\n<p>3.<a href=\"#c\">Comments</a></p>\n<ul>\n<li><p>3.1 File Header </p>\n</li>\n<li><p>3.2 Function Comments</p>\n</li>\n<li><p>3.3 Implementation Comments</p>\n</li>\n<li><p>3.4 TODO Comments  </p>\n</li>\n</ul>\n<p>4.<a href=\"#d\">Formatting</a></p>\n<ul>\n<li><p>4.1 Indentation </p>\n</li>\n<li><p>4.2 Line Length and Long Strings</p>\n</li>\n<li><p>4.3 Pipelines | Loops</p>\n</li>\n<li><p>4.4 Case statement</p>\n</li>\n<li><p>4.5 Variable expansion</p>\n</li>\n<li><p>4.6 Quoting  </p>\n</li>\n</ul>\n<p>5.<a href=\"#e\">Features and Bugs</a> </p>\n<ul>\n<li><p>5.1 Command Substitution</p>\n</li>\n<li><p>5.2 Test, [ and [[ </p>\n</li>\n<li><p>5.3 Testing Strings Wildcard Expansion of Filenames </p>\n</li>\n<li><p>5.4 Eval</p>\n</li>\n<li><p>5.5 Pipes to While  </p>\n</li>\n</ul>\n<p>6.<a href=\"#f\">Naming Conventions</a></p>\n<ul>\n<li><p>6.1 Function Names </p>\n</li>\n<li><p>6.2 Variable Names </p>\n</li>\n<li><p>6.3 Constants and Environment Variable Names </p>\n</li>\n<li><p>6.4 Source Filenames </p>\n</li>\n<li><p>6.5 Read-only Variables </p>\n</li>\n<li><p>6.7 Use Local Variables </p>\n</li>\n<li><p>6.8 Function Location </p>\n</li>\n<li><p>6.9 main  </p>\n</li>\n</ul>\n<p>7.<a href=\"#g\">Calling Commands</a></p>\n<ul>\n<li><p>7.1 Checking Return Values </p>\n</li>\n<li><p>7.2 Builtin Commands vs. External Commands  </p>\n</li>\n</ul>\n<p>8.<a href=\"#h\">Conclusion</a></p>\n<h2 id=\"Which-Shell-to-Use\"><a href=\"#Which-Shell-to-Use\" class=\"headerlink\" title=\"Which Shell to Use\"></a>Which Shell to Use</h2><p><strong>Bash</strong> is the only shell scripting language permitted for executables.  </p>\n<p>Executables must start with <strong>#! /bin/bash</strong> and a minimum number of flags.</p>\n<p>Use <strong>set</strong> to set shell options so that calling your script as <strong>bash</strong> <strong><em>script_name</em></strong> does not break its functionality.</p>\n<p>Restricting all executable shell scripts to bash gives us a consistent shell language that’s installed on all our machines.</p>\n<p>The only exception to this is where you’re forced to by whatever you’re coding for.</p>\n<p>One example of this is Solaris SVR4 packages which require plain Bourne shell for any scripts.</p>\n<h2 id=\"When-to-use-Shell\"><a href=\"#When-to-use-Shell\" class=\"headerlink\" title=\"When to use Shell\"></a>When to use Shell</h2><p>Shell should only be used for small utilities or simple wrapper scripts.  </p>\n<p>While shell scripting isn’t a development language, it is used for writing various utility scripts throughout Google.   This style guide is more a recognition of its use rather than a suggestion that it be used for widespread deployment.</p>\n<p>Some guidelines:</p>\n<ul>\n<li><p>If you’re mostly calling other utilities and are doing relatively little data manipulation, shell is an acceptable choice for the task.</p>\n</li>\n<li><p>If performance matters, use something other than shell.</p>\n</li>\n<li><p>If you find you need to use arrays for anything more than assignment of <strong>${PIPESTATUS}</strong>, you should use Python.</p>\n</li>\n<li><p>If you are writing a script that is more than 100 lines long, you should probably be writing it in Python instead. Bear in mind that scripts grow. Rewrite your script in another language early to avoid a time-consuming rewrite at a later date.  </p>\n</li>\n</ul>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"1-Shell-Files-and-Interpreter-Invocation\"><a href=\"#1-Shell-Files-and-Interpreter-Invocation\" class=\"headerlink\" title=\"1.  Shell Files and Interpreter Invocation\"></a>1.  <span id=\"a\">Shell Files and Interpreter Invocation</span></h2><h3 id=\"1-1-File-Extensions\"><a href=\"#1-1-File-Extensions\" class=\"headerlink\" title=\"1.1 File Extensions\"></a>1.1 File Extensions</h3><p>Executables should have no extension (strongly preferred) or a <strong>.sh</strong> extension. Libraries must have a <strong>.sh</strong> extension and should not be executable.</p>\n<p>It is not necessary to know what language a program is written in when executing it and shell doesn’t require an extension so we prefer not to use one for executables.</p>\n<p>However, for libraries it’s important to know what language it is and sometimes there’s a need to have similar libraries in different languages. This allows library files with identical purposes but different languages to be identically named except for the language-specific suffix.</p>\n<h3 id=\"1-2-SUID-SGID\"><a href=\"#1-2-SUID-SGID\" class=\"headerlink\" title=\"1.2 SUID/SGID\"></a>1.2 SUID/SGID</h3><p>SUID and SGID are forbidden on shell scripts.</p>\n<p>There are too many security issues with shell that make it nearly impossible to secure sufficiently to allow SUID/SGID. While bash does make it difficult to run SUID, it’s still possible on some platforms which is why we’re being explicit about banning it.</p>\n<p>Use <strong>sudo</strong> to provide elevated access if you need it.</p>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"2-Environment\"><a href=\"#2-Environment\" class=\"headerlink\" title=\"2. Environment\"></a>2. <span id=\"b\">Environment</span></h2><h3 id=\"2-1-STDOUT-vs-STDERR\"><a href=\"#2-1-STDOUT-vs-STDERR\" class=\"headerlink\" title=\"2.1 STDOUT vs STDERR\"></a>2.1 STDOUT vs STDERR</h3><p>All error messages should go to <strong>STDERR</strong>.</p>\n<p>This makes it easier to separate normal status from actual issues.</p>\n<p>A function to print out error messages along with other status information is recommended.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">err() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;[$(date +&apos;%Y-%m-%dT%H:%M:%S%z&apos;)]: $@&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if ! do_something; then</span><br><span class=\"line\"></span><br><span class=\"line\">  err &quot;Unable to do_something&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  exit &quot;$&#123;E_DID_NOTHING&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"3-Comments\"><a href=\"#3-Comments\" class=\"headerlink\" title=\"3. Comments\"></a>3. <span id=\"c\">Comments</span></h2><h3 id=\"3-1-File-Header\"><a href=\"#3-1-File-Header\" class=\"headerlink\" title=\"3.1 File Header\"></a>3.1 File Header</h3><p>Start each file with a description of its contents.</p>\n<p>Every file must have a top-level comment including a brief overview of its contents. A copyright notice and author information are optional.</p>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Perform hot backups of Oracle databases.</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-Function-Comments\"><a href=\"#3-2-Function-Comments\" class=\"headerlink\" title=\"3.2 Function Comments\"></a>3.2 Function Comments</h3><p>Any function that is not both obvious and short must be commented. Any function in a library must be commented regardless of length or complexity.</p>\n<p>It should be possible for someone else to learn how to use your program or to use a function in your library by reading the comments (and self-help, if provided) without reading the code.</p>\n<p>All function comments should contain:</p>\n<ul>\n<li><p>Description of the function</p>\n</li>\n<li><p>Global variables used and modified</p>\n</li>\n<li><p>Arguments taken</p>\n</li>\n<li><p>Returned values other than the default exit status of the last command run</p>\n</li>\n</ul>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Perform hot backups of Oracle databases.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">export PATH=&apos;/usr/xpg4/bin:/usr/bin:/opt/csw/bin:/opt/goog/bin&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#######################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Cleanup files from the backup dir</span><br><span class=\"line\"></span><br><span class=\"line\"># Globals:</span><br><span class=\"line\"></span><br><span class=\"line\">#   BACKUP_DIR</span><br><span class=\"line\"></span><br><span class=\"line\">#   ORACLE_SID</span><br><span class=\"line\"></span><br><span class=\"line\"># Arguments:</span><br><span class=\"line\"></span><br><span class=\"line\">#   None</span><br><span class=\"line\"></span><br><span class=\"line\"># Returns:</span><br><span class=\"line\"></span><br><span class=\"line\">#   None</span><br><span class=\"line\"></span><br><span class=\"line\">#######################################</span><br><span class=\"line\"></span><br><span class=\"line\">cleanup() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-Implementation-Comments\"><a href=\"#3-3-Implementation-Comments\" class=\"headerlink\" title=\"3.3 Implementation Comments\"></a>3.3 Implementation Comments</h3><p>Comment tricky, non-obvious, interesting or important parts of your code.</p>\n<p>This follows general Google coding comment practice. Don’t comment everything. If there’s a complex algorithm or you’re doing something out of the ordinary, put a short comment in.</p>\n<h3 id=\"3-4-TODO-Comments\"><a href=\"#3-4-TODO-Comments\" class=\"headerlink\" title=\"3.4 TODO Comments\"></a>3.4 TODO Comments</h3><p>Use <strong>TODO</strong> comments for code that is temporary, a short-term solution, or good-enough but not perfect.</p>\n<p>This matches the convention in the <strong>C++ Guide</strong>.</p>\n<p><strong>TODOs</strong> should include the string <strong>TODO</strong> in all caps, followed by your username in parentheses. A colon is optional. It’s preferable to put a bug/ticket number next to the <strong>TODO</strong> item as well.</p>\n<p><strong><em>Examples:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># TODO(mrmonkey): Handle the unlikely edge cases (bug ####)</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"4-Formatting\"><a href=\"#4-Formatting\" class=\"headerlink\" title=\"4. Formatting\"></a>4. <span id=\"d\">Formatting</span></h2><p>While you should follow the style that’s already there for files that you’re modifying, the following are required for any new code.</p>\n<h3 id=\"4-1-Indentation\"><a href=\"#4-1-Indentation\" class=\"headerlink\" title=\"4.1 Indentation\"></a>4.1 Indentation</h3><p>Indent 2 spaces. No tabs.</p>\n<p>Use blank lines between blocks to improve readability. Indentation is two spaces. Whatever you do, don’t use tabs. For existing files, stay faithful to the existing indentation.</p>\n<h3 id=\"4-2-Line-Length-and-Long-Strings\"><a href=\"#4-2-Line-Length-and-Long-Strings\" class=\"headerlink\" title=\"4.2 Line Length and Long Strings\"></a>4.2 Line Length and Long Strings</h3><p>Maximum line length is 80 characters.</p>\n<p>If you have to write strings that are longer than 80 characters, this should be done with a here document or an embedded newline if possible. Literal strings that have to be longer than 80 chars and can’t sensibly be split are ok, but it’s strongly preferred to find a way to make it shorter.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># DO use &apos;here document&apos;s</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt;END;</span><br><span class=\"line\"></span><br><span class=\"line\">I am an exceptionally long</span><br><span class=\"line\"></span><br><span class=\"line\">string.</span><br><span class=\"line\"></span><br><span class=\"line\">END</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Embedded newlines are ok too</span><br><span class=\"line\"></span><br><span class=\"line\">long_string=&quot;I am an exceptionally</span><br><span class=\"line\"></span><br><span class=\"line\">  long string.&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-Pipelines\"><a href=\"#4-3-Pipelines\" class=\"headerlink\" title=\"4.3 Pipelines\"></a>4.3 Pipelines</h3><p>Pipelines should be split one per line if they don’t all fit on one line.</p>\n<p>If a pipeline all fits on one line, it should be on one line.</p>\n<p>If not, it should be split at one pipe segment per line with the pipe on the newline and a 2 space indent for the next section of the pipe. This applies to a chain of commands combined using ‘<strong>|</strong>‘ as well as to logical compounds using ‘<strong>||</strong>‘ and ‘<strong>&amp;&amp;</strong>‘.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># All fits on one line</span><br><span class=\"line\"></span><br><span class=\"line\">command1 | command2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Long commands</span><br><span class=\"line\"></span><br><span class=\"line\">command1 \\</span><br><span class=\"line\"></span><br><span class=\"line\">  | command2 \\</span><br><span class=\"line\"></span><br><span class=\"line\">  | command3 \\</span><br><span class=\"line\"></span><br><span class=\"line\">  | command4</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-4-Loops\"><a href=\"#4-4-Loops\" class=\"headerlink\" title=\"4.4 Loops\"></a>4.4 Loops</h3><p>Put <strong>; do</strong> and <strong>; then</strong> on the same line as the <strong>while</strong>, <strong>for</strong> or <strong>if</strong>.</p>\n<p>Loops in shell are a bit different, but we follow the same principles as with braces when declaring functions.</p>\n<p>That is: <strong>; then</strong> and <strong>; do</strong> should be <font color=\"red\">on the same line</font> as the <strong>if/for/while</strong>.<strong>else</strong> should be on its own line and closing statements should be on their own line vertically aligned with the opening statement.</p>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">for dir in $&#123;dirs_to_cleanup&#125;; do</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -d &quot;$&#123;dir&#125;/$&#123;ORACLE_SID&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">    log_date &quot;Cleaning up old files in $&#123;dir&#125;/$&#123;ORACLE_SID&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    rm &quot;$&#123;dir&#125;/$&#123;ORACLE_SID&#125;/&quot;*</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ &quot;$?&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">      error_message</span><br><span class=\"line\"></span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">  else</span><br><span class=\"line\"></span><br><span class=\"line\">    mkdir -p &quot;$&#123;dir&#125;/$&#123;ORACLE_SID&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ &quot;$?&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">      error_message</span><br><span class=\"line\"></span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-5-Case-statement\"><a href=\"#4-5-Case-statement\" class=\"headerlink\" title=\"4.5 Case statement\"></a>4.5 Case statement</h3><ul>\n<li><p>Indent alternatives by 2 spaces.</p>\n</li>\n<li><p>A one-line alternative needs a space after the close parenthesis of the pattern and before the <strong>;;</strong>.</p>\n</li>\n<li><p>Long or multi-command alternatives should be split over multiple lines with the pattern, actions, and <strong>;;</strong> on separate lines.</p>\n</li>\n</ul>\n<p>The matching expressions are indented one level from the ‘<strong>case</strong>‘ and ‘<strong>esac</strong>‘. Multiline actions are indented another level. In general, there is no need to quote match expressions. Pattern expressions should not be preceded by an open parenthesis. Avoid the <strong>;&amp;</strong> and <strong>;;&amp;</strong> notations.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">case &quot;$&#123;expression&#125;&quot; in</span><br><span class=\"line\"></span><br><span class=\"line\">  a)</span><br><span class=\"line\"></span><br><span class=\"line\">    variable=&quot;...&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    some_command &quot;$&#123;variable&#125;&quot; &quot;$&#123;other_expr&#125;&quot; ...</span><br><span class=\"line\"></span><br><span class=\"line\">    ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  absolute)</span><br><span class=\"line\"></span><br><span class=\"line\">    actions=&quot;relative&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    another_command &quot;$&#123;actions&#125;&quot; &quot;$&#123;other_expr&#125;&quot; ...</span><br><span class=\"line\"></span><br><span class=\"line\">    ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  *)</span><br><span class=\"line\"></span><br><span class=\"line\">    error &quot;Unexpected expression &apos;$&#123;expression&#125;&apos;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    ;;</span><br><span class=\"line\"></span><br><span class=\"line\">esac</span><br></pre></td></tr></table></figure>\n<p>Simple commands may be put on the same line as the pattern and <strong>;;</strong> as long as the expression remains readable. This is often appropriate for single-letter option processing. When the actions don’t fit on a single line, put the pattern on a line on its own, then the actions, then <strong>;;</strong>; also <font color=\"red\"> on a line of its own</font>. When on the same line as the actions, use a space after the close parenthesis of the pattern and another before the <strong>;;</strong>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">verbose=&apos;false&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">aflag=&apos;&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">bflag=&apos;&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">files=&apos;&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">while getopts &apos;abf:v&apos; flag; do</span><br><span class=\"line\"></span><br><span class=\"line\">  case &quot;$&#123;flag&#125;&quot; in</span><br><span class=\"line\"></span><br><span class=\"line\">    a) aflag=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    b) bflag=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    f) files=&quot;$&#123;OPTARG&#125;&quot; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    v) verbose=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    *) error &quot;Unexpected option $&#123;flag&#125;&quot; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  esac</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-6-Variable-expansion\"><a href=\"#4-6-Variable-expansion\" class=\"headerlink\" title=\"4.6 Variable expansion\"></a>4.6 Variable expansion</h3><p>In order of precedence: Stay consistent with what you find; quote your variables; prefer “<strong>${var}</strong>“ over “<strong>$var</strong>“, but see details.</p>\n<p>These are meant to be guidelines, as the topic seems too controversial for a mandatory regulation.</p>\n<p>They are listed in order of precedence.</p>\n<ol>\n<li><p>Stay consistent with what you find for existing code.</p>\n</li>\n<li><p>Quote variables, see Quoting section below.</p>\n</li>\n<li><p>Don’t brace-quote single character shell specials / positional parameters, unless strictly necessary or avoiding deep confusion.</p>\n</li>\n</ol>\n<p>Prefer brace-quoting all other variables.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Section of recommended cases.</span><br><span class=\"line\"></span><br><span class=\"line\"># Preferred style for &apos;special&apos; variables:</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Positional: $1&quot; &quot;$5&quot; &quot;$3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Specials: !=$!, -=$-, _=$_. ?=$?, #=$# *=$* @=$@ \\$=$$ ...&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Braces necessary:</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;many parameters: $&#123;10&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Braces avoiding confusion:</span><br><span class=\"line\"></span><br><span class=\"line\"># Output is &quot;a0b0c0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">set -- a b c</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$&#123;1&#125;0$&#123;2&#125;0$&#123;3&#125;0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Preferred style for other variables:</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;PATH=$&#123;PATH&#125;, PWD=$&#123;PWD&#125;, mine=$&#123;some_var&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">while read f; do</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;file=$&#123;f&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done &lt; &lt;(ls -l /tmp)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Section of discouraged cases</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Unquoted vars, unbraced vars, brace-quoted single letter</span><br><span class=\"line\"></span><br><span class=\"line\"># shell specials.</span><br><span class=\"line\"></span><br><span class=\"line\">echo a=$avar &quot;b=$bvar&quot; &quot;PID=$&#123;$&#125;&quot; &quot;$&#123;1&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Confusing use: this is expanded as &quot;$&#123;1&#125;0$&#123;2&#125;0$&#123;3&#125;0&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\"># not &quot;$&#123;10&#125;$&#123;20&#125;$&#123;30&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">set -- a b c</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$10$20$30&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-7-Quoting\"><a href=\"#4-7-Quoting\" class=\"headerlink\" title=\"4.7 Quoting\"></a>4.7 Quoting</h3><ul>\n<li><p>Always quote strings containing variables, command substitutions, spaces or shell meta characters, unless careful unquoted expansion is required.</p>\n</li>\n<li><p>Prefer quoting strings that are “words” (as opposed to command options or path names).</p>\n</li>\n<li><p>Never quote <strong><em>literal</em></strong> integers.</p>\n</li>\n<li><p>Be aware of the quoting rules for pattern matches in [[.</p>\n</li>\n<li><p>Use “<strong>$@</strong>“ unless you have a specific reason to use <strong>$*</strong>.</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># &apos;Single&apos; quotes indicate that no substitution is desired.</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;Double&quot; quotes indicate that substitution is required/tolerated.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Simple examples</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote command substitutions&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">flag=&quot;$(some_command and its args &quot;$@&quot; &apos;quoted separately&apos;)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote variables&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$&#123;flag&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;never quote literal integers&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">value=32</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote command substitutions&quot;, even when you expect integers</span><br><span class=\"line\"></span><br><span class=\"line\">number=&quot;$(generate_number)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;prefer quoting words&quot;, not compulsory</span><br><span class=\"line\"></span><br><span class=\"line\">readonly USE_INTEGER=&apos;true&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote shell meta characters&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &apos;Hello stranger, and well met. Earn lots of $$$&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Process $$: Done making \\$\\$\\$.&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;command options or path names&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># ($1 is assumed to contain a value here)</span><br><span class=\"line\"></span><br><span class=\"line\">grep -li Hugo /dev/null &quot;$1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Less simple examples</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote variables, unless proven false&quot;: ccs might be empty</span><br><span class=\"line\"></span><br><span class=\"line\">git send-email --to &quot;$&#123;reviewers&#125;&quot; $&#123;ccs:+&quot;--cc&quot; &quot;$&#123;ccs&#125;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Positional parameter precautions: $1 might be unset</span><br><span class=\"line\"></span><br><span class=\"line\"># Single quotes leave regex as-is.</span><br><span class=\"line\"></span><br><span class=\"line\">grep -cP &apos;([Ss]pecial|\\|?characters*)$&apos; $&#123;1:+&quot;$1&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># For passing on arguments,</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;$@&quot; is right almost everytime, and</span><br><span class=\"line\"></span><br><span class=\"line\"># $* is wrong almost everytime:</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># * $* and $@ will split on spaces, clobbering up arguments</span><br><span class=\"line\"></span><br><span class=\"line\">#   that contain spaces and dropping empty strings;</span><br><span class=\"line\"></span><br><span class=\"line\"># * &quot;$@&quot; will retain arguments as-is, so no args</span><br><span class=\"line\"></span><br><span class=\"line\">#   provided will result in no args being passed on;</span><br><span class=\"line\"></span><br><span class=\"line\">#   This is in most cases what you want to use for passing</span><br><span class=\"line\"></span><br><span class=\"line\">#   on arguments.</span><br><span class=\"line\"></span><br><span class=\"line\"># * &quot;$*&quot; expands to one argument, with all args joined</span><br><span class=\"line\"></span><br><span class=\"line\">#   by (usually) spaces,</span><br><span class=\"line\"></span><br><span class=\"line\">#   so no args provided will result in one empty string</span><br><span class=\"line\"></span><br><span class=\"line\">#   being passed on.</span><br><span class=\"line\"></span><br><span class=\"line\"># (Consult &apos;man bash&apos; for the nit-grits ;-)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">set -- 1 &quot;2 two&quot; &quot;3 three tres&quot;; echo $# ; set -- &quot;$*&quot;; echo &quot;$#, $@&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">set -- 1 &quot;2 two&quot; &quot;3 three tres&quot;; echo $# ; set -- &quot;$@&quot;; echo &quot;$#, $@&quot;)</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"5-Features-and-Bugs\"><a href=\"#5-Features-and-Bugs\" class=\"headerlink\" title=\"5. Features and Bugs\"></a>5. <span id=\"e\">Features and Bugs</span></h2><h3 id=\"5-1-Command-Substitution\"><a href=\"#5-1-Command-Substitution\" class=\"headerlink\" title=\"5.1 Command Substitution\"></a>5.1 Command Substitution</h3><p>Use <strong>$(command)</strong> instead of backticks.</p>\n<p>Nested backticks require escaping the inner ones with <strong>.</strong> The <strong>$(command)</strong> format doesn’t change when nested and is easier to read.</p>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># This is preferred:</span><br><span class=\"line\"></span><br><span class=\"line\">var=&quot;$(command &quot;$(command1)&quot;)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This is not:</span><br><span class=\"line\"></span><br><span class=\"line\">var=&quot;`command \\`command1\\``&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-2-Test-and\"><a href=\"#5-2-Test-and\" class=\"headerlink\" title=\"5.2 Test, [ and [[\"></a>5.2 Test, [ and [[</h3><p><strong>[[ … ]]</strong> is preferred over <strong>[</strong>, <strong>test</strong> and <strong>/usr/bin/[</strong>.</p>\n<p><strong>[[ … ]]</strong> reduces errors as no pathname expansion or word splitting takes place between <strong>[[ and ]]</strong> and <strong>[[ … ]]</strong> allows for regular expression matching where [ … ] does not.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># This ensures the string on the left is made up of characters in the</span><br><span class=\"line\"></span><br><span class=\"line\"># alnum character class followed by the string name.</span><br><span class=\"line\"></span><br><span class=\"line\"># Note that the RHS should not be quoted here.</span><br><span class=\"line\"></span><br><span class=\"line\"># For the gory details, see</span><br><span class=\"line\"></span><br><span class=\"line\"># E14 at http://tiswww.case.edu/php/chet/bash/FAQ</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;filename&quot; =~ ^[[:alnum:]]+name ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Match&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This matches the exact pattern &quot;f*&quot; (Does not match in this case)</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;filename&quot; == &quot;f*&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Match&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This gives a &quot;too many arguments&quot; error as f* is expanded to the</span><br><span class=\"line\"></span><br><span class=\"line\"># contents of the current directory</span><br><span class=\"line\"></span><br><span class=\"line\">if [ &quot;filename&quot; == f* ]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Match&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-3-Testing-Strings\"><a href=\"#5-3-Testing-Strings\" class=\"headerlink\" title=\"5.3 Testing Strings\"></a>5.3 Testing Strings</h3><p>Use quotes rather than filler characters where possible.</p>\n<p>Bash is smart enough to deal with an empty string in a test. So, given that the code is much easier to read, use tests for empty/non-empty strings or empty strings rather than filler characters.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Do this:</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;&quot; = &quot;some_string&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># -z (string length is zero) and -n (string length is not zero) are</span><br><span class=\"line\"></span><br><span class=\"line\"># preferred over testing for an empty string</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z &quot;$&#123;my_var&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This is OK (ensure quotes on the empty side), but not preferred:</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;&quot; = &quot;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Not this:</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;X&quot; = &quot;some_stringX&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>To avoid confusion about what you’re testing for, explicitly use <strong>-z</strong> or <strong>-n</strong>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Use this</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n &quot;$&#123;my_var&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Instead of this as errors can occur if $&#123;my_var&#125; expands to a test</span><br><span class=\"line\"></span><br><span class=\"line\"># flag</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-4-Wildcard-Expansion-of-Filenames\"><a href=\"#5-4-Wildcard-Expansion-of-Filenames\" class=\"headerlink\" title=\"5.4 Wildcard Expansion of Filenames\"></a>5.4 Wildcard Expansion of Filenames</h3><p>Use an explicit path when doing wildcard expansion of filenames.</p>\n<p>As filenames can begin with a -, it’s a lot safer to expand wildcards with ./<em> instead of </em> .</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Here&apos;s the contents of the directory:</span><br><span class=\"line\"></span><br><span class=\"line\"># -f  -r  somedir  somefile</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This deletes almost everything in the directory by force</span><br><span class=\"line\"></span><br><span class=\"line\">psa@bilby$ rm -v *</span><br><span class=\"line\"></span><br><span class=\"line\">removed directory: `somedir&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">removed `somefile&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># As opposed to:</span><br><span class=\"line\"></span><br><span class=\"line\">psa@bilby$ rm -v ./*</span><br><span class=\"line\"></span><br><span class=\"line\">removed `./-f&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">removed `./-r&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">rm: cannot remove `./somedir&apos;: Is a directory</span><br><span class=\"line\"></span><br><span class=\"line\">removed `./somefile&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-5-Eval\"><a href=\"#5-5-Eval\" class=\"headerlink\" title=\"5.5 Eval\"></a>5.5 Eval</h3><p><strong>eval</strong> should be avoided.  </p>\n<p>Eval munges the input when used for assignment to variables and can set variables without making it possible to check what those variables were.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># What does this set?</span><br><span class=\"line\"></span><br><span class=\"line\"># Did it succeed? In part or whole?</span><br><span class=\"line\"></span><br><span class=\"line\">eval $(set_my_variables)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># What happens if one of the returned values has a space in it?</span><br><span class=\"line\"></span><br><span class=\"line\">variable=&quot;$(eval some_function)&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-6-Pipes-to-While\"><a href=\"#5-6-Pipes-to-While\" class=\"headerlink\" title=\"5.6 Pipes to While\"></a>5.6 Pipes to While</h3><p>Use process substitution or for loops in preference to piping to while. Variables modified in a while loop do not propagate to the parent because the loop’s commands run in a subshell.</p>\n<p>The implicit subshell in a pipe to while can make it difficult to track down bugs.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">last_line=&apos;NULL&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">your_command | while read line; do</span><br><span class=\"line\"></span><br><span class=\"line\">  last_line=&quot;$&#123;line&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This will output &apos;NULL&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$&#123;last_line&#125;&quot;</span><br></pre></td></tr></table></figure>\n<p>Use a for loop if you are confident that the input will not contain spaces or special characters (usually, this means not user input).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">total=0</span><br><span class=\"line\"></span><br><span class=\"line\"># Only do this if there are no spaces in return values.</span><br><span class=\"line\"></span><br><span class=\"line\">for value in $(command); do</span><br><span class=\"line\"></span><br><span class=\"line\">  total+=&quot;$&#123;value&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<p>Using process substitution allows redirecting output but puts the commands in an explicit subshell rather than the implicit subshell that bash creates for the while loop.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">total=0</span><br><span class=\"line\"></span><br><span class=\"line\">last_file=</span><br><span class=\"line\"></span><br><span class=\"line\">while read count filename; do</span><br><span class=\"line\"></span><br><span class=\"line\">  total+=&quot;$&#123;count&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  last_file=&quot;$&#123;filename&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done &lt; &lt;(your_command | uniq -c)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This will output the second field of the last line of output from</span><br><span class=\"line\"></span><br><span class=\"line\"># the command.</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Total = $&#123;total&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Last one = $&#123;last_file&#125;&quot;</span><br></pre></td></tr></table></figure>\n<p>Use while loops where it is not necessary to pass complex results to the parent shell - this is typically where some more complex “parsing” is required. Beware that simple examples are probably more easily done with a tool such as awk. This may also be useful where you specifically don’t want to change the parent scope variables.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Trivial implementation of awk expression:</span><br><span class=\"line\"></span><br><span class=\"line\">#   awk &apos;$3 == &quot;nfs&quot; &#123; print $2 &quot; maps to &quot; $1 &#125;&apos; /proc/mounts</span><br><span class=\"line\"></span><br><span class=\"line\">cat /proc/mounts | while read src dest type opts rest; do</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ $&#123;type&#125; == &quot;nfs&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;NFS $&#123;dest&#125; maps to $&#123;src&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"6-Naming-Conventions\"><a href=\"#6-Naming-Conventions\" class=\"headerlink\" title=\"6. Naming Conventions\"></a>6. <span id=\"f\">Naming Conventions</span></h2><h3 id=\"6-1-Function-Names\"><a href=\"#6-1-Function-Names\" class=\"headerlink\" title=\"6.1 Function Names\"></a>6.1 Function Names</h3><p>Lower-case, with underscores to separate words. Separate libraries with <strong>::</strong>. Parentheses are required after the function name. The keyword <strong><em>function</em></strong> is optional, but must be used consistently throughout a project.</p>\n<p>If you’re writing single functions, use lowercase and separate words with underscore. If you’re writing a package, separate package names with <strong>::</strong>. Braces must be on the same line as the function name (as with other languages at Google) and no space between the function name and the parenthesis.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Single function</span><br><span class=\"line\"></span><br><span class=\"line\">my_func() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Part of a package</span><br><span class=\"line\"></span><br><span class=\"line\">mypackage::my_func() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The <strong>function</strong> keyword is extraneous when “()” is present after the function name, but enhances quick identification of functions.</p>\n<h3 id=\"6-2-Variable-Names\"><a href=\"#6-2-Variable-Names\" class=\"headerlink\" title=\"6.2 Variable Names\"></a>6.2 Variable Names</h3><p>As for function names.</p>\n<p>Variables names for loops should be similarly named for any variable you’re looping through.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">for zone in $&#123;zones&#125;; do</span><br><span class=\"line\"></span><br><span class=\"line\">  something_with &quot;$&#123;zone&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-3-Constants-and-Environment-Variable-Names\"><a href=\"#6-3-Constants-and-Environment-Variable-Names\" class=\"headerlink\" title=\"6.3 Constants and Environment Variable Names\"></a>6.3 Constants and Environment Variable Names</h3><p>All caps, separated with underscores, declared at the top of the file.</p>\n<p>Constants and anything exported to the environment should be capitalized.  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Constant</span><br><span class=\"line\"></span><br><span class=\"line\">readonly PATH_TO_FILES=&apos;/some/path&apos;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Both constant and environment</span><br><span class=\"line\"></span><br><span class=\"line\">declare -xr ORACLE_SID=&apos;PROD&apos;</span><br></pre></td></tr></table></figure>\n<p>Some things become constant at their first setting (for example, via getopts). Thus, it’s OK to set a constant in getopts or based on a condition, but it should be made readonly immediately afterwards. Note that <strong>declare</strong> doesn’t operate on global variables within functions, so <strong>readonly</strong> or <strong>export</strong> is recommended instead.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">VERBOSE=&apos;false&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">while getopts &apos;v&apos; flag; do</span><br><span class=\"line\"></span><br><span class=\"line\">  case &quot;$&#123;flag&#125;&quot; in</span><br><span class=\"line\"></span><br><span class=\"line\">    v) VERBOSE=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  esac</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\">readonly VERBOSE</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-4-Source-Filenames\"><a href=\"#6-4-Source-Filenames\" class=\"headerlink\" title=\"6.4 Source Filenames\"></a>6.4 Source Filenames</h3><p>Lowercase, with underscores to separate words if desired.</p>\n<p>This is for consistency with other code styles in Google: <strong>maketemplate</strong> or <strong>make_template</strong> but <font color=\"red\">not</font> <strong>make-template</strong>.</p>\n<h3 id=\"6-5-Read-only-Variables\"><a href=\"#6-5-Read-only-Variables\" class=\"headerlink\" title=\"6.5 Read-only Variables\"></a>6.5 Read-only Variables</h3><p>Use <strong>readonly</strong> or <strong>declare -r</strong> to ensure they’re read only.</p>\n<p>As globals are widely used in shell, it’s important to catch errors when working with them. When you declare a variable that is meant to be read-only, make this explicit.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">zip_version=&quot;$(dpkg --status zip | grep Version: | cut -d &apos; &apos; -f 2)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z &quot;$&#123;zip_version&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  error_message</span><br><span class=\"line\"></span><br><span class=\"line\">else</span><br><span class=\"line\"></span><br><span class=\"line\">  readonly zip_version</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-6-Use-Local-Variables\"><a href=\"#6-6-Use-Local-Variables\" class=\"headerlink\" title=\"6.6 Use Local Variables\"></a>6.6 Use Local Variables</h3><p>Declare function-specific variables with <strong>local</strong>. Declaration and assignment should be on different lines.</p>\n<p>Ensure that local variables are only seen inside a function and its children by using <strong>local</strong> when declaring them. This avoids polluting the global name space and inadvertently setting variables that may have significance outside the function.</p>\n<p>Declaration and assignment must be separate statements when the assignment value is provided by a command substitution; as the ‘local’ builtin does not propagate the exit code from the command substitution.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">my_func2() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  local name=&quot;$1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  # Separate lines for declaration and assignment:</span><br><span class=\"line\"></span><br><span class=\"line\">  local my_var</span><br><span class=\"line\"></span><br><span class=\"line\">  my_var=&quot;$(my_func)&quot; || return</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  # DO NOT do this: $? contains the exit code of &apos;local&apos;, not my_func</span><br><span class=\"line\"></span><br><span class=\"line\">  local my_var=&quot;$(my_func)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  [[ $? -eq 0 ]] || return</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-7-Function-Location\"><a href=\"#6-7-Function-Location\" class=\"headerlink\" title=\"6.7 Function Location\"></a>6.7 Function Location</h3><p>Put all functions together in the file just below constants. Don’t hide executable code between functions.</p>\n<p>If you’ve got functions, put them all together near the top of the file. Only includes, <strong>set</strong> statements and setting constants may be done before declaring functions.</p>\n<p>Don’t hide executable code between functions. Doing so makes the code difficult to follow and results in nasty surprises when debugging.</p>\n<h3 id=\"6-8-main\"><a href=\"#6-8-main\" class=\"headerlink\" title=\"6.8 main\"></a>6.8 main</h3><p>A function called <strong><em>main</em></strong> is required for scripts long enough to contain at least one other function.</p>\n<p>In order to easily find the start of the program, put the main program in a function called <strong>main</strong> as the bottom most function. This provides consistency with the rest of the code base as well as allowing you to define more variables as <strong>local</strong> (which can’t be done if the main code is not a function). The last non-comment line in the file should be a call to <strong>main</strong>:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">main &quot;$@&quot;</span><br></pre></td></tr></table></figure>\n<p>Obviously, for short scripts where it’s just a linear flow, <strong>main</strong> is overkill and so is not required.</p>\n<h2 id=\"7-Calling-Commands\"><a href=\"#7-Calling-Commands\" class=\"headerlink\" title=\"7. Calling Commands\"></a>7. <span id=\"g\">Calling Commands</span></h2><h3 id=\"7-1-Checking-Return-Values\"><a href=\"#7-1-Checking-Return-Values\" class=\"headerlink\" title=\"7.1 Checking Return Values\"></a>7.1 Checking Return Values</h3><p>Always check return values and give informative return values.</p>\n<p>For unpiped commands, use <strong>$?</strong> or check directly via an <strong>if</strong> statement to keep it simple.</p>\n<p>Example:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">if ! mv &quot;$&#123;file_list&#125;&quot; &quot;$&#123;dest_dir&#125;/&quot; ; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Unable to move $&#123;file_list&#125; to $&#123;dest_dir&#125;&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">  exit &quot;$&#123;E_BAD_MOVE&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Or</span><br><span class=\"line\"></span><br><span class=\"line\">mv &quot;$&#123;file_list&#125;&quot; &quot;$&#123;dest_dir&#125;/&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$?&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Unable to move $&#123;file_list&#125; to $&#123;dest_dir&#125;&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">  exit &quot;$&#123;E_BAD_MOVE&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>Bash also has the <strong>PIPESTATUS</strong> variable that allows checking of the return code from all parts of a pipe. If it’s only necessary to check success or failure of the whole pipe, then the following is acceptable:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">tar -cf - ./* | ( cd &quot;$&#123;dir&#125;&quot; &amp;&amp; tar -xf - )</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;PIPESTATUS[0]&#125;&quot; -ne 0 || &quot;$&#123;PIPESTATUS[1]&#125;&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Unable to tar files to $&#123;dir&#125;&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>However, as <strong>PIPESTATUS</strong> will be overwritten as soon as you do any other command, if you need to act differently on errors based on where it happened in the pipe, you’ll need to assign <strong>PIPESTATUS</strong> to another variable immediately after running the command (don’t forget that [ is a command and will wipe out <strong>PIPESTATUS</strong>).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">tar -cf - ./* | ( cd &quot;$&#123;DIR&#125;&quot; &amp;&amp; tar -xf - )</span><br><span class=\"line\"></span><br><span class=\"line\">return_codes=($&#123;PIPESTATUS[*]&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;return_codes[0]&#125;&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;return_codes[1]&#125;&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something_else</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"7-2-Builtin-Commands-vs-External-Commands\"><a href=\"#7-2-Builtin-Commands-vs-External-Commands\" class=\"headerlink\" title=\"7.2 Builtin Commands vs. External Commands\"></a>7.2 Builtin Commands vs. External Commands</h3><p>Given the choice between invoking a shell builtin and invoking a separate process, choose the builtin.</p>\n<p>We prefer the use of builtins such as the Parameter Expansion functions in <strong>bash(1)</strong> as it’s more robust and portable (especially when compared to things like sed).  </p>\n<p> <strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Prefer this:</span><br><span class=\"line\"></span><br><span class=\"line\">addition=$(($&#123;X&#125; + $&#123;Y&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">substitution=&quot;$&#123;string/#foo/bar&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Instead of this:</span><br><span class=\"line\"></span><br><span class=\"line\">addition=&quot;$(expr $&#123;X&#125; + $&#123;Y&#125;)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">substitution=&quot;$(echo &quot;$&#123;string&#125;&quot; | sed -e &apos;s/^foo/bar/&apos;)&quot;</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"8-Conclusion\"><a href=\"#8-Conclusion\" class=\"headerlink\" title=\"8. Conclusion\"></a>8. <span id=\"h\">Conclusion</span></h2><p>Use common sense and <strong>BE CONSISTENT</strong>.</p>\n<p>Please take a few minutes to read the Parting Words section at the bottom of the <strong>C++ Guide</strong>.</p>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Shell-Style-Guide\"><a href=\"#Shell-Style-Guide\" class=\"headerlink\" title=\"Shell Style Guide\"></a>Shell Style Guide</h1><h2 id=\"Contents\"><a href=\"#Contents\" class=\"headerlink\" title=\"Contents\"></a><span id=\"contents\">Contents</span></h2><p>1.<a href=\"#a\">Shell Files and Interpreter Invocation</a></p>\n<ul>\n<li><p>1.1 File Extensions</p>\n</li>\n<li><p>1.2 SUID/SGID  </p>\n</li>\n</ul>\n<p>2.<a href=\"#b\">Environment</a> </p>\n<ul>\n<li>2.1 STDOUT vs STDERR  </li>\n</ul>\n<p>3.<a href=\"#c\">Comments</a></p>\n<ul>\n<li><p>3.1 File Header </p>\n</li>\n<li><p>3.2 Function Comments</p>\n</li>\n<li><p>3.3 Implementation Comments</p>\n</li>\n<li><p>3.4 TODO Comments  </p>\n</li>\n</ul>\n<p>4.<a href=\"#d\">Formatting</a></p>\n<ul>\n<li><p>4.1 Indentation </p>\n</li>\n<li><p>4.2 Line Length and Long Strings</p>\n</li>\n<li><p>4.3 Pipelines | Loops</p>\n</li>\n<li><p>4.4 Case statement</p>\n</li>\n<li><p>4.5 Variable expansion</p>\n</li>\n<li><p>4.6 Quoting  </p>\n</li>\n</ul>\n<p>5.<a href=\"#e\">Features and Bugs</a> </p>\n<ul>\n<li><p>5.1 Command Substitution</p>\n</li>\n<li><p>5.2 Test, [ and [[ </p>\n</li>\n<li><p>5.3 Testing Strings Wildcard Expansion of Filenames </p>\n</li>\n<li><p>5.4 Eval</p>\n</li>\n<li><p>5.5 Pipes to While  </p>\n</li>\n</ul>\n<p>6.<a href=\"#f\">Naming Conventions</a></p>\n<ul>\n<li><p>6.1 Function Names </p>\n</li>\n<li><p>6.2 Variable Names </p>\n</li>\n<li><p>6.3 Constants and Environment Variable Names </p>\n</li>\n<li><p>6.4 Source Filenames </p>\n</li>\n<li><p>6.5 Read-only Variables </p>\n</li>\n<li><p>6.7 Use Local Variables </p>\n</li>\n<li><p>6.8 Function Location </p>\n</li>\n<li><p>6.9 main  </p>\n</li>\n</ul>\n<p>7.<a href=\"#g\">Calling Commands</a></p>\n<ul>\n<li><p>7.1 Checking Return Values </p>\n</li>\n<li><p>7.2 Builtin Commands vs. External Commands  </p>\n</li>\n</ul>\n<p>8.<a href=\"#h\">Conclusion</a></p>\n<h2 id=\"Which-Shell-to-Use\"><a href=\"#Which-Shell-to-Use\" class=\"headerlink\" title=\"Which Shell to Use\"></a>Which Shell to Use</h2><p><strong>Bash</strong> is the only shell scripting language permitted for executables.  </p>\n<p>Executables must start with <strong>#! /bin/bash</strong> and a minimum number of flags.</p>\n<p>Use <strong>set</strong> to set shell options so that calling your script as <strong>bash</strong> <strong><em>script_name</em></strong> does not break its functionality.</p>\n<p>Restricting all executable shell scripts to bash gives us a consistent shell language that’s installed on all our machines.</p>\n<p>The only exception to this is where you’re forced to by whatever you’re coding for.</p>\n<p>One example of this is Solaris SVR4 packages which require plain Bourne shell for any scripts.</p>\n<h2 id=\"When-to-use-Shell\"><a href=\"#When-to-use-Shell\" class=\"headerlink\" title=\"When to use Shell\"></a>When to use Shell</h2><p>Shell should only be used for small utilities or simple wrapper scripts.  </p>\n<p>While shell scripting isn’t a development language, it is used for writing various utility scripts throughout Google.   This style guide is more a recognition of its use rather than a suggestion that it be used for widespread deployment.</p>\n<p>Some guidelines:</p>\n<ul>\n<li><p>If you’re mostly calling other utilities and are doing relatively little data manipulation, shell is an acceptable choice for the task.</p>\n</li>\n<li><p>If performance matters, use something other than shell.</p>\n</li>\n<li><p>If you find you need to use arrays for anything more than assignment of <strong>${PIPESTATUS}</strong>, you should use Python.</p>\n</li>\n<li><p>If you are writing a script that is more than 100 lines long, you should probably be writing it in Python instead. Bear in mind that scripts grow. Rewrite your script in another language early to avoid a time-consuming rewrite at a later date.  </p>\n</li>\n</ul>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"1-Shell-Files-and-Interpreter-Invocation\"><a href=\"#1-Shell-Files-and-Interpreter-Invocation\" class=\"headerlink\" title=\"1.  Shell Files and Interpreter Invocation\"></a>1.  <span id=\"a\">Shell Files and Interpreter Invocation</span></h2><h3 id=\"1-1-File-Extensions\"><a href=\"#1-1-File-Extensions\" class=\"headerlink\" title=\"1.1 File Extensions\"></a>1.1 File Extensions</h3><p>Executables should have no extension (strongly preferred) or a <strong>.sh</strong> extension. Libraries must have a <strong>.sh</strong> extension and should not be executable.</p>\n<p>It is not necessary to know what language a program is written in when executing it and shell doesn’t require an extension so we prefer not to use one for executables.</p>\n<p>However, for libraries it’s important to know what language it is and sometimes there’s a need to have similar libraries in different languages. This allows library files with identical purposes but different languages to be identically named except for the language-specific suffix.</p>\n<h3 id=\"1-2-SUID-SGID\"><a href=\"#1-2-SUID-SGID\" class=\"headerlink\" title=\"1.2 SUID/SGID\"></a>1.2 SUID/SGID</h3><p>SUID and SGID are forbidden on shell scripts.</p>\n<p>There are too many security issues with shell that make it nearly impossible to secure sufficiently to allow SUID/SGID. While bash does make it difficult to run SUID, it’s still possible on some platforms which is why we’re being explicit about banning it.</p>\n<p>Use <strong>sudo</strong> to provide elevated access if you need it.</p>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"2-Environment\"><a href=\"#2-Environment\" class=\"headerlink\" title=\"2. Environment\"></a>2. <span id=\"b\">Environment</span></h2><h3 id=\"2-1-STDOUT-vs-STDERR\"><a href=\"#2-1-STDOUT-vs-STDERR\" class=\"headerlink\" title=\"2.1 STDOUT vs STDERR\"></a>2.1 STDOUT vs STDERR</h3><p>All error messages should go to <strong>STDERR</strong>.</p>\n<p>This makes it easier to separate normal status from actual issues.</p>\n<p>A function to print out error messages along with other status information is recommended.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">err() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;[$(date +&apos;%Y-%m-%dT%H:%M:%S%z&apos;)]: $@&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if ! do_something; then</span><br><span class=\"line\"></span><br><span class=\"line\">  err &quot;Unable to do_something&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  exit &quot;$&#123;E_DID_NOTHING&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"3-Comments\"><a href=\"#3-Comments\" class=\"headerlink\" title=\"3. Comments\"></a>3. <span id=\"c\">Comments</span></h2><h3 id=\"3-1-File-Header\"><a href=\"#3-1-File-Header\" class=\"headerlink\" title=\"3.1 File Header\"></a>3.1 File Header</h3><p>Start each file with a description of its contents.</p>\n<p>Every file must have a top-level comment including a brief overview of its contents. A copyright notice and author information are optional.</p>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Perform hot backups of Oracle databases.</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-Function-Comments\"><a href=\"#3-2-Function-Comments\" class=\"headerlink\" title=\"3.2 Function Comments\"></a>3.2 Function Comments</h3><p>Any function that is not both obvious and short must be commented. Any function in a library must be commented regardless of length or complexity.</p>\n<p>It should be possible for someone else to learn how to use your program or to use a function in your library by reading the comments (and self-help, if provided) without reading the code.</p>\n<p>All function comments should contain:</p>\n<ul>\n<li><p>Description of the function</p>\n</li>\n<li><p>Global variables used and modified</p>\n</li>\n<li><p>Arguments taken</p>\n</li>\n<li><p>Returned values other than the default exit status of the last command run</p>\n</li>\n</ul>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># Perform hot backups of Oracle databases.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">export PATH=&apos;/usr/xpg4/bin:/usr/bin:/opt/csw/bin:/opt/goog/bin&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#######################################</span><br><span class=\"line\"></span><br><span class=\"line\"># Cleanup files from the backup dir</span><br><span class=\"line\"></span><br><span class=\"line\"># Globals:</span><br><span class=\"line\"></span><br><span class=\"line\">#   BACKUP_DIR</span><br><span class=\"line\"></span><br><span class=\"line\">#   ORACLE_SID</span><br><span class=\"line\"></span><br><span class=\"line\"># Arguments:</span><br><span class=\"line\"></span><br><span class=\"line\">#   None</span><br><span class=\"line\"></span><br><span class=\"line\"># Returns:</span><br><span class=\"line\"></span><br><span class=\"line\">#   None</span><br><span class=\"line\"></span><br><span class=\"line\">#######################################</span><br><span class=\"line\"></span><br><span class=\"line\">cleanup() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-Implementation-Comments\"><a href=\"#3-3-Implementation-Comments\" class=\"headerlink\" title=\"3.3 Implementation Comments\"></a>3.3 Implementation Comments</h3><p>Comment tricky, non-obvious, interesting or important parts of your code.</p>\n<p>This follows general Google coding comment practice. Don’t comment everything. If there’s a complex algorithm or you’re doing something out of the ordinary, put a short comment in.</p>\n<h3 id=\"3-4-TODO-Comments\"><a href=\"#3-4-TODO-Comments\" class=\"headerlink\" title=\"3.4 TODO Comments\"></a>3.4 TODO Comments</h3><p>Use <strong>TODO</strong> comments for code that is temporary, a short-term solution, or good-enough but not perfect.</p>\n<p>This matches the convention in the <strong>C++ Guide</strong>.</p>\n<p><strong>TODOs</strong> should include the string <strong>TODO</strong> in all caps, followed by your username in parentheses. A colon is optional. It’s preferable to put a bug/ticket number next to the <strong>TODO</strong> item as well.</p>\n<p><strong><em>Examples:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># TODO(mrmonkey): Handle the unlikely edge cases (bug ####)</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"4-Formatting\"><a href=\"#4-Formatting\" class=\"headerlink\" title=\"4. Formatting\"></a>4. <span id=\"d\">Formatting</span></h2><p>While you should follow the style that’s already there for files that you’re modifying, the following are required for any new code.</p>\n<h3 id=\"4-1-Indentation\"><a href=\"#4-1-Indentation\" class=\"headerlink\" title=\"4.1 Indentation\"></a>4.1 Indentation</h3><p>Indent 2 spaces. No tabs.</p>\n<p>Use blank lines between blocks to improve readability. Indentation is two spaces. Whatever you do, don’t use tabs. For existing files, stay faithful to the existing indentation.</p>\n<h3 id=\"4-2-Line-Length-and-Long-Strings\"><a href=\"#4-2-Line-Length-and-Long-Strings\" class=\"headerlink\" title=\"4.2 Line Length and Long Strings\"></a>4.2 Line Length and Long Strings</h3><p>Maximum line length is 80 characters.</p>\n<p>If you have to write strings that are longer than 80 characters, this should be done with a here document or an embedded newline if possible. Literal strings that have to be longer than 80 chars and can’t sensibly be split are ok, but it’s strongly preferred to find a way to make it shorter.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># DO use &apos;here document&apos;s</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt;END;</span><br><span class=\"line\"></span><br><span class=\"line\">I am an exceptionally long</span><br><span class=\"line\"></span><br><span class=\"line\">string.</span><br><span class=\"line\"></span><br><span class=\"line\">END</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Embedded newlines are ok too</span><br><span class=\"line\"></span><br><span class=\"line\">long_string=&quot;I am an exceptionally</span><br><span class=\"line\"></span><br><span class=\"line\">  long string.&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-Pipelines\"><a href=\"#4-3-Pipelines\" class=\"headerlink\" title=\"4.3 Pipelines\"></a>4.3 Pipelines</h3><p>Pipelines should be split one per line if they don’t all fit on one line.</p>\n<p>If a pipeline all fits on one line, it should be on one line.</p>\n<p>If not, it should be split at one pipe segment per line with the pipe on the newline and a 2 space indent for the next section of the pipe. This applies to a chain of commands combined using ‘<strong>|</strong>‘ as well as to logical compounds using ‘<strong>||</strong>‘ and ‘<strong>&amp;&amp;</strong>‘.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># All fits on one line</span><br><span class=\"line\"></span><br><span class=\"line\">command1 | command2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Long commands</span><br><span class=\"line\"></span><br><span class=\"line\">command1 \\</span><br><span class=\"line\"></span><br><span class=\"line\">  | command2 \\</span><br><span class=\"line\"></span><br><span class=\"line\">  | command3 \\</span><br><span class=\"line\"></span><br><span class=\"line\">  | command4</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-4-Loops\"><a href=\"#4-4-Loops\" class=\"headerlink\" title=\"4.4 Loops\"></a>4.4 Loops</h3><p>Put <strong>; do</strong> and <strong>; then</strong> on the same line as the <strong>while</strong>, <strong>for</strong> or <strong>if</strong>.</p>\n<p>Loops in shell are a bit different, but we follow the same principles as with braces when declaring functions.</p>\n<p>That is: <strong>; then</strong> and <strong>; do</strong> should be <font color=\"red\">on the same line</font> as the <strong>if/for/while</strong>.<strong>else</strong> should be on its own line and closing statements should be on their own line vertically aligned with the opening statement.</p>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">for dir in $&#123;dirs_to_cleanup&#125;; do</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ -d &quot;$&#123;dir&#125;/$&#123;ORACLE_SID&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">    log_date &quot;Cleaning up old files in $&#123;dir&#125;/$&#123;ORACLE_SID&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    rm &quot;$&#123;dir&#125;/$&#123;ORACLE_SID&#125;/&quot;*</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ &quot;$?&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">      error_message</span><br><span class=\"line\"></span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">  else</span><br><span class=\"line\"></span><br><span class=\"line\">    mkdir -p &quot;$&#123;dir&#125;/$&#123;ORACLE_SID&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    if [[ &quot;$?&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">      error_message</span><br><span class=\"line\"></span><br><span class=\"line\">    fi</span><br><span class=\"line\"></span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-5-Case-statement\"><a href=\"#4-5-Case-statement\" class=\"headerlink\" title=\"4.5 Case statement\"></a>4.5 Case statement</h3><ul>\n<li><p>Indent alternatives by 2 spaces.</p>\n</li>\n<li><p>A one-line alternative needs a space after the close parenthesis of the pattern and before the <strong>;;</strong>.</p>\n</li>\n<li><p>Long or multi-command alternatives should be split over multiple lines with the pattern, actions, and <strong>;;</strong> on separate lines.</p>\n</li>\n</ul>\n<p>The matching expressions are indented one level from the ‘<strong>case</strong>‘ and ‘<strong>esac</strong>‘. Multiline actions are indented another level. In general, there is no need to quote match expressions. Pattern expressions should not be preceded by an open parenthesis. Avoid the <strong>;&amp;</strong> and <strong>;;&amp;</strong> notations.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">case &quot;$&#123;expression&#125;&quot; in</span><br><span class=\"line\"></span><br><span class=\"line\">  a)</span><br><span class=\"line\"></span><br><span class=\"line\">    variable=&quot;...&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    some_command &quot;$&#123;variable&#125;&quot; &quot;$&#123;other_expr&#125;&quot; ...</span><br><span class=\"line\"></span><br><span class=\"line\">    ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  absolute)</span><br><span class=\"line\"></span><br><span class=\"line\">    actions=&quot;relative&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    another_command &quot;$&#123;actions&#125;&quot; &quot;$&#123;other_expr&#125;&quot; ...</span><br><span class=\"line\"></span><br><span class=\"line\">    ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  *)</span><br><span class=\"line\"></span><br><span class=\"line\">    error &quot;Unexpected expression &apos;$&#123;expression&#125;&apos;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    ;;</span><br><span class=\"line\"></span><br><span class=\"line\">esac</span><br></pre></td></tr></table></figure>\n<p>Simple commands may be put on the same line as the pattern and <strong>;;</strong> as long as the expression remains readable. This is often appropriate for single-letter option processing. When the actions don’t fit on a single line, put the pattern on a line on its own, then the actions, then <strong>;;</strong>; also <font color=\"red\"> on a line of its own</font>. When on the same line as the actions, use a space after the close parenthesis of the pattern and another before the <strong>;;</strong>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">verbose=&apos;false&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">aflag=&apos;&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">bflag=&apos;&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">files=&apos;&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">while getopts &apos;abf:v&apos; flag; do</span><br><span class=\"line\"></span><br><span class=\"line\">  case &quot;$&#123;flag&#125;&quot; in</span><br><span class=\"line\"></span><br><span class=\"line\">    a) aflag=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    b) bflag=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    f) files=&quot;$&#123;OPTARG&#125;&quot; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    v) verbose=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">    *) error &quot;Unexpected option $&#123;flag&#125;&quot; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  esac</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-6-Variable-expansion\"><a href=\"#4-6-Variable-expansion\" class=\"headerlink\" title=\"4.6 Variable expansion\"></a>4.6 Variable expansion</h3><p>In order of precedence: Stay consistent with what you find; quote your variables; prefer “<strong>${var}</strong>“ over “<strong>$var</strong>“, but see details.</p>\n<p>These are meant to be guidelines, as the topic seems too controversial for a mandatory regulation.</p>\n<p>They are listed in order of precedence.</p>\n<ol>\n<li><p>Stay consistent with what you find for existing code.</p>\n</li>\n<li><p>Quote variables, see Quoting section below.</p>\n</li>\n<li><p>Don’t brace-quote single character shell specials / positional parameters, unless strictly necessary or avoiding deep confusion.</p>\n</li>\n</ol>\n<p>Prefer brace-quoting all other variables.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Section of recommended cases.</span><br><span class=\"line\"></span><br><span class=\"line\"># Preferred style for &apos;special&apos; variables:</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Positional: $1&quot; &quot;$5&quot; &quot;$3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Specials: !=$!, -=$-, _=$_. ?=$?, #=$# *=$* @=$@ \\$=$$ ...&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Braces necessary:</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;many parameters: $&#123;10&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Braces avoiding confusion:</span><br><span class=\"line\"></span><br><span class=\"line\"># Output is &quot;a0b0c0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">set -- a b c</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$&#123;1&#125;0$&#123;2&#125;0$&#123;3&#125;0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Preferred style for other variables:</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;PATH=$&#123;PATH&#125;, PWD=$&#123;PWD&#125;, mine=$&#123;some_var&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">while read f; do</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;file=$&#123;f&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done &lt; &lt;(ls -l /tmp)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Section of discouraged cases</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Unquoted vars, unbraced vars, brace-quoted single letter</span><br><span class=\"line\"></span><br><span class=\"line\"># shell specials.</span><br><span class=\"line\"></span><br><span class=\"line\">echo a=$avar &quot;b=$bvar&quot; &quot;PID=$&#123;$&#125;&quot; &quot;$&#123;1&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Confusing use: this is expanded as &quot;$&#123;1&#125;0$&#123;2&#125;0$&#123;3&#125;0&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\"># not &quot;$&#123;10&#125;$&#123;20&#125;$&#123;30&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">set -- a b c</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$10$20$30&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-7-Quoting\"><a href=\"#4-7-Quoting\" class=\"headerlink\" title=\"4.7 Quoting\"></a>4.7 Quoting</h3><ul>\n<li><p>Always quote strings containing variables, command substitutions, spaces or shell meta characters, unless careful unquoted expansion is required.</p>\n</li>\n<li><p>Prefer quoting strings that are “words” (as opposed to command options or path names).</p>\n</li>\n<li><p>Never quote <strong><em>literal</em></strong> integers.</p>\n</li>\n<li><p>Be aware of the quoting rules for pattern matches in [[.</p>\n</li>\n<li><p>Use “<strong>$@</strong>“ unless you have a specific reason to use <strong>$*</strong>.</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># &apos;Single&apos; quotes indicate that no substitution is desired.</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;Double&quot; quotes indicate that substitution is required/tolerated.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Simple examples</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote command substitutions&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">flag=&quot;$(some_command and its args &quot;$@&quot; &apos;quoted separately&apos;)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote variables&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$&#123;flag&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;never quote literal integers&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">value=32</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote command substitutions&quot;, even when you expect integers</span><br><span class=\"line\"></span><br><span class=\"line\">number=&quot;$(generate_number)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;prefer quoting words&quot;, not compulsory</span><br><span class=\"line\"></span><br><span class=\"line\">readonly USE_INTEGER=&apos;true&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote shell meta characters&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &apos;Hello stranger, and well met. Earn lots of $$$&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Process $$: Done making \\$\\$\\$.&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;command options or path names&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># ($1 is assumed to contain a value here)</span><br><span class=\"line\"></span><br><span class=\"line\">grep -li Hugo /dev/null &quot;$1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Less simple examples</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;quote variables, unless proven false&quot;: ccs might be empty</span><br><span class=\"line\"></span><br><span class=\"line\">git send-email --to &quot;$&#123;reviewers&#125;&quot; $&#123;ccs:+&quot;--cc&quot; &quot;$&#123;ccs&#125;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Positional parameter precautions: $1 might be unset</span><br><span class=\"line\"></span><br><span class=\"line\"># Single quotes leave regex as-is.</span><br><span class=\"line\"></span><br><span class=\"line\">grep -cP &apos;([Ss]pecial|\\|?characters*)$&apos; $&#123;1:+&quot;$1&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># For passing on arguments,</span><br><span class=\"line\"></span><br><span class=\"line\"># &quot;$@&quot; is right almost everytime, and</span><br><span class=\"line\"></span><br><span class=\"line\"># $* is wrong almost everytime:</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># * $* and $@ will split on spaces, clobbering up arguments</span><br><span class=\"line\"></span><br><span class=\"line\">#   that contain spaces and dropping empty strings;</span><br><span class=\"line\"></span><br><span class=\"line\"># * &quot;$@&quot; will retain arguments as-is, so no args</span><br><span class=\"line\"></span><br><span class=\"line\">#   provided will result in no args being passed on;</span><br><span class=\"line\"></span><br><span class=\"line\">#   This is in most cases what you want to use for passing</span><br><span class=\"line\"></span><br><span class=\"line\">#   on arguments.</span><br><span class=\"line\"></span><br><span class=\"line\"># * &quot;$*&quot; expands to one argument, with all args joined</span><br><span class=\"line\"></span><br><span class=\"line\">#   by (usually) spaces,</span><br><span class=\"line\"></span><br><span class=\"line\">#   so no args provided will result in one empty string</span><br><span class=\"line\"></span><br><span class=\"line\">#   being passed on.</span><br><span class=\"line\"></span><br><span class=\"line\"># (Consult &apos;man bash&apos; for the nit-grits ;-)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">set -- 1 &quot;2 two&quot; &quot;3 three tres&quot;; echo $# ; set -- &quot;$*&quot;; echo &quot;$#, $@&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">set -- 1 &quot;2 two&quot; &quot;3 three tres&quot;; echo $# ; set -- &quot;$@&quot;; echo &quot;$#, $@&quot;)</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"5-Features-and-Bugs\"><a href=\"#5-Features-and-Bugs\" class=\"headerlink\" title=\"5. Features and Bugs\"></a>5. <span id=\"e\">Features and Bugs</span></h2><h3 id=\"5-1-Command-Substitution\"><a href=\"#5-1-Command-Substitution\" class=\"headerlink\" title=\"5.1 Command Substitution\"></a>5.1 Command Substitution</h3><p>Use <strong>$(command)</strong> instead of backticks.</p>\n<p>Nested backticks require escaping the inner ones with <strong>.</strong> The <strong>$(command)</strong> format doesn’t change when nested and is easier to read.</p>\n<p><strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># This is preferred:</span><br><span class=\"line\"></span><br><span class=\"line\">var=&quot;$(command &quot;$(command1)&quot;)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This is not:</span><br><span class=\"line\"></span><br><span class=\"line\">var=&quot;`command \\`command1\\``&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-2-Test-and\"><a href=\"#5-2-Test-and\" class=\"headerlink\" title=\"5.2 Test, [ and [[\"></a>5.2 Test, [ and [[</h3><p><strong>[[ … ]]</strong> is preferred over <strong>[</strong>, <strong>test</strong> and <strong>/usr/bin/[</strong>.</p>\n<p><strong>[[ … ]]</strong> reduces errors as no pathname expansion or word splitting takes place between <strong>[[ and ]]</strong> and <strong>[[ … ]]</strong> allows for regular expression matching where [ … ] does not.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># This ensures the string on the left is made up of characters in the</span><br><span class=\"line\"></span><br><span class=\"line\"># alnum character class followed by the string name.</span><br><span class=\"line\"></span><br><span class=\"line\"># Note that the RHS should not be quoted here.</span><br><span class=\"line\"></span><br><span class=\"line\"># For the gory details, see</span><br><span class=\"line\"></span><br><span class=\"line\"># E14 at http://tiswww.case.edu/php/chet/bash/FAQ</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;filename&quot; =~ ^[[:alnum:]]+name ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Match&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This matches the exact pattern &quot;f*&quot; (Does not match in this case)</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;filename&quot; == &quot;f*&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Match&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This gives a &quot;too many arguments&quot; error as f* is expanded to the</span><br><span class=\"line\"></span><br><span class=\"line\"># contents of the current directory</span><br><span class=\"line\"></span><br><span class=\"line\">if [ &quot;filename&quot; == f* ]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Match&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-3-Testing-Strings\"><a href=\"#5-3-Testing-Strings\" class=\"headerlink\" title=\"5.3 Testing Strings\"></a>5.3 Testing Strings</h3><p>Use quotes rather than filler characters where possible.</p>\n<p>Bash is smart enough to deal with an empty string in a test. So, given that the code is much easier to read, use tests for empty/non-empty strings or empty strings rather than filler characters.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Do this:</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;&quot; = &quot;some_string&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># -z (string length is zero) and -n (string length is not zero) are</span><br><span class=\"line\"></span><br><span class=\"line\"># preferred over testing for an empty string</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z &quot;$&#123;my_var&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This is OK (ensure quotes on the empty side), but not preferred:</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;&quot; = &quot;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Not this:</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;X&quot; = &quot;some_stringX&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>To avoid confusion about what you’re testing for, explicitly use <strong>-z</strong> or <strong>-n</strong>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Use this</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -n &quot;$&#123;my_var&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Instead of this as errors can occur if $&#123;my_var&#125; expands to a test</span><br><span class=\"line\"></span><br><span class=\"line\"># flag</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;my_var&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-4-Wildcard-Expansion-of-Filenames\"><a href=\"#5-4-Wildcard-Expansion-of-Filenames\" class=\"headerlink\" title=\"5.4 Wildcard Expansion of Filenames\"></a>5.4 Wildcard Expansion of Filenames</h3><p>Use an explicit path when doing wildcard expansion of filenames.</p>\n<p>As filenames can begin with a -, it’s a lot safer to expand wildcards with ./<em> instead of </em> .</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Here&apos;s the contents of the directory:</span><br><span class=\"line\"></span><br><span class=\"line\"># -f  -r  somedir  somefile</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This deletes almost everything in the directory by force</span><br><span class=\"line\"></span><br><span class=\"line\">psa@bilby$ rm -v *</span><br><span class=\"line\"></span><br><span class=\"line\">removed directory: `somedir&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">removed `somefile&apos;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># As opposed to:</span><br><span class=\"line\"></span><br><span class=\"line\">psa@bilby$ rm -v ./*</span><br><span class=\"line\"></span><br><span class=\"line\">removed `./-f&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">removed `./-r&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">rm: cannot remove `./somedir&apos;: Is a directory</span><br><span class=\"line\"></span><br><span class=\"line\">removed `./somefile&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-5-Eval\"><a href=\"#5-5-Eval\" class=\"headerlink\" title=\"5.5 Eval\"></a>5.5 Eval</h3><p><strong>eval</strong> should be avoided.  </p>\n<p>Eval munges the input when used for assignment to variables and can set variables without making it possible to check what those variables were.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># What does this set?</span><br><span class=\"line\"></span><br><span class=\"line\"># Did it succeed? In part or whole?</span><br><span class=\"line\"></span><br><span class=\"line\">eval $(set_my_variables)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># What happens if one of the returned values has a space in it?</span><br><span class=\"line\"></span><br><span class=\"line\">variable=&quot;$(eval some_function)&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-6-Pipes-to-While\"><a href=\"#5-6-Pipes-to-While\" class=\"headerlink\" title=\"5.6 Pipes to While\"></a>5.6 Pipes to While</h3><p>Use process substitution or for loops in preference to piping to while. Variables modified in a while loop do not propagate to the parent because the loop’s commands run in a subshell.</p>\n<p>The implicit subshell in a pipe to while can make it difficult to track down bugs.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">last_line=&apos;NULL&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">your_command | while read line; do</span><br><span class=\"line\"></span><br><span class=\"line\">  last_line=&quot;$&#123;line&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This will output &apos;NULL&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;$&#123;last_line&#125;&quot;</span><br></pre></td></tr></table></figure>\n<p>Use a for loop if you are confident that the input will not contain spaces or special characters (usually, this means not user input).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">total=0</span><br><span class=\"line\"></span><br><span class=\"line\"># Only do this if there are no spaces in return values.</span><br><span class=\"line\"></span><br><span class=\"line\">for value in $(command); do</span><br><span class=\"line\"></span><br><span class=\"line\">  total+=&quot;$&#123;value&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<p>Using process substitution allows redirecting output but puts the commands in an explicit subshell rather than the implicit subshell that bash creates for the while loop.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">total=0</span><br><span class=\"line\"></span><br><span class=\"line\">last_file=</span><br><span class=\"line\"></span><br><span class=\"line\">while read count filename; do</span><br><span class=\"line\"></span><br><span class=\"line\">  total+=&quot;$&#123;count&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  last_file=&quot;$&#123;filename&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done &lt; &lt;(your_command | uniq -c)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># This will output the second field of the last line of output from</span><br><span class=\"line\"></span><br><span class=\"line\"># the command.</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Total = $&#123;total&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Last one = $&#123;last_file&#125;&quot;</span><br></pre></td></tr></table></figure>\n<p>Use while loops where it is not necessary to pass complex results to the parent shell - this is typically where some more complex “parsing” is required. Beware that simple examples are probably more easily done with a tool such as awk. This may also be useful where you specifically don’t want to change the parent scope variables.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Trivial implementation of awk expression:</span><br><span class=\"line\"></span><br><span class=\"line\">#   awk &apos;$3 == &quot;nfs&quot; &#123; print $2 &quot; maps to &quot; $1 &#125;&apos; /proc/mounts</span><br><span class=\"line\"></span><br><span class=\"line\">cat /proc/mounts | while read src dest type opts rest; do</span><br><span class=\"line\"></span><br><span class=\"line\">  if [[ $&#123;type&#125; == &quot;nfs&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;NFS $&#123;dest&#125; maps to $&#123;src&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"6-Naming-Conventions\"><a href=\"#6-Naming-Conventions\" class=\"headerlink\" title=\"6. Naming Conventions\"></a>6. <span id=\"f\">Naming Conventions</span></h2><h3 id=\"6-1-Function-Names\"><a href=\"#6-1-Function-Names\" class=\"headerlink\" title=\"6.1 Function Names\"></a>6.1 Function Names</h3><p>Lower-case, with underscores to separate words. Separate libraries with <strong>::</strong>. Parentheses are required after the function name. The keyword <strong><em>function</em></strong> is optional, but must be used consistently throughout a project.</p>\n<p>If you’re writing single functions, use lowercase and separate words with underscore. If you’re writing a package, separate package names with <strong>::</strong>. Braces must be on the same line as the function name (as with other languages at Google) and no space between the function name and the parenthesis.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Single function</span><br><span class=\"line\"></span><br><span class=\"line\">my_func() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Part of a package</span><br><span class=\"line\"></span><br><span class=\"line\">mypackage::my_func() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The <strong>function</strong> keyword is extraneous when “()” is present after the function name, but enhances quick identification of functions.</p>\n<h3 id=\"6-2-Variable-Names\"><a href=\"#6-2-Variable-Names\" class=\"headerlink\" title=\"6.2 Variable Names\"></a>6.2 Variable Names</h3><p>As for function names.</p>\n<p>Variables names for loops should be similarly named for any variable you’re looping through.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">for zone in $&#123;zones&#125;; do</span><br><span class=\"line\"></span><br><span class=\"line\">  something_with &quot;$&#123;zone&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-3-Constants-and-Environment-Variable-Names\"><a href=\"#6-3-Constants-and-Environment-Variable-Names\" class=\"headerlink\" title=\"6.3 Constants and Environment Variable Names\"></a>6.3 Constants and Environment Variable Names</h3><p>All caps, separated with underscores, declared at the top of the file.</p>\n<p>Constants and anything exported to the environment should be capitalized.  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Constant</span><br><span class=\"line\"></span><br><span class=\"line\">readonly PATH_TO_FILES=&apos;/some/path&apos;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Both constant and environment</span><br><span class=\"line\"></span><br><span class=\"line\">declare -xr ORACLE_SID=&apos;PROD&apos;</span><br></pre></td></tr></table></figure>\n<p>Some things become constant at their first setting (for example, via getopts). Thus, it’s OK to set a constant in getopts or based on a condition, but it should be made readonly immediately afterwards. Note that <strong>declare</strong> doesn’t operate on global variables within functions, so <strong>readonly</strong> or <strong>export</strong> is recommended instead.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">VERBOSE=&apos;false&apos;</span><br><span class=\"line\"></span><br><span class=\"line\">while getopts &apos;v&apos; flag; do</span><br><span class=\"line\"></span><br><span class=\"line\">  case &quot;$&#123;flag&#125;&quot; in</span><br><span class=\"line\"></span><br><span class=\"line\">    v) VERBOSE=&apos;true&apos; ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  esac</span><br><span class=\"line\"></span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\">readonly VERBOSE</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-4-Source-Filenames\"><a href=\"#6-4-Source-Filenames\" class=\"headerlink\" title=\"6.4 Source Filenames\"></a>6.4 Source Filenames</h3><p>Lowercase, with underscores to separate words if desired.</p>\n<p>This is for consistency with other code styles in Google: <strong>maketemplate</strong> or <strong>make_template</strong> but <font color=\"red\">not</font> <strong>make-template</strong>.</p>\n<h3 id=\"6-5-Read-only-Variables\"><a href=\"#6-5-Read-only-Variables\" class=\"headerlink\" title=\"6.5 Read-only Variables\"></a>6.5 Read-only Variables</h3><p>Use <strong>readonly</strong> or <strong>declare -r</strong> to ensure they’re read only.</p>\n<p>As globals are widely used in shell, it’s important to catch errors when working with them. When you declare a variable that is meant to be read-only, make this explicit.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">zip_version=&quot;$(dpkg --status zip | grep Version: | cut -d &apos; &apos; -f 2)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ -z &quot;$&#123;zip_version&#125;&quot; ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  error_message</span><br><span class=\"line\"></span><br><span class=\"line\">else</span><br><span class=\"line\"></span><br><span class=\"line\">  readonly zip_version</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-6-Use-Local-Variables\"><a href=\"#6-6-Use-Local-Variables\" class=\"headerlink\" title=\"6.6 Use Local Variables\"></a>6.6 Use Local Variables</h3><p>Declare function-specific variables with <strong>local</strong>. Declaration and assignment should be on different lines.</p>\n<p>Ensure that local variables are only seen inside a function and its children by using <strong>local</strong> when declaring them. This avoids polluting the global name space and inadvertently setting variables that may have significance outside the function.</p>\n<p>Declaration and assignment must be separate statements when the assignment value is provided by a command substitution; as the ‘local’ builtin does not propagate the exit code from the command substitution.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">my_func2() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  local name=&quot;$1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  # Separate lines for declaration and assignment:</span><br><span class=\"line\"></span><br><span class=\"line\">  local my_var</span><br><span class=\"line\"></span><br><span class=\"line\">  my_var=&quot;$(my_func)&quot; || return</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  # DO NOT do this: $? contains the exit code of &apos;local&apos;, not my_func</span><br><span class=\"line\"></span><br><span class=\"line\">  local my_var=&quot;$(my_func)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">  [[ $? -eq 0 ]] || return</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-7-Function-Location\"><a href=\"#6-7-Function-Location\" class=\"headerlink\" title=\"6.7 Function Location\"></a>6.7 Function Location</h3><p>Put all functions together in the file just below constants. Don’t hide executable code between functions.</p>\n<p>If you’ve got functions, put them all together near the top of the file. Only includes, <strong>set</strong> statements and setting constants may be done before declaring functions.</p>\n<p>Don’t hide executable code between functions. Doing so makes the code difficult to follow and results in nasty surprises when debugging.</p>\n<h3 id=\"6-8-main\"><a href=\"#6-8-main\" class=\"headerlink\" title=\"6.8 main\"></a>6.8 main</h3><p>A function called <strong><em>main</em></strong> is required for scripts long enough to contain at least one other function.</p>\n<p>In order to easily find the start of the program, put the main program in a function called <strong>main</strong> as the bottom most function. This provides consistency with the rest of the code base as well as allowing you to define more variables as <strong>local</strong> (which can’t be done if the main code is not a function). The last non-comment line in the file should be a call to <strong>main</strong>:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">main &quot;$@&quot;</span><br></pre></td></tr></table></figure>\n<p>Obviously, for short scripts where it’s just a linear flow, <strong>main</strong> is overkill and so is not required.</p>\n<h2 id=\"7-Calling-Commands\"><a href=\"#7-Calling-Commands\" class=\"headerlink\" title=\"7. Calling Commands\"></a>7. <span id=\"g\">Calling Commands</span></h2><h3 id=\"7-1-Checking-Return-Values\"><a href=\"#7-1-Checking-Return-Values\" class=\"headerlink\" title=\"7.1 Checking Return Values\"></a>7.1 Checking Return Values</h3><p>Always check return values and give informative return values.</p>\n<p>For unpiped commands, use <strong>$?</strong> or check directly via an <strong>if</strong> statement to keep it simple.</p>\n<p>Example:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">if ! mv &quot;$&#123;file_list&#125;&quot; &quot;$&#123;dest_dir&#125;/&quot; ; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Unable to move $&#123;file_list&#125; to $&#123;dest_dir&#125;&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">  exit &quot;$&#123;E_BAD_MOVE&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Or</span><br><span class=\"line\"></span><br><span class=\"line\">mv &quot;$&#123;file_list&#125;&quot; &quot;$&#123;dest_dir&#125;/&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$?&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Unable to move $&#123;file_list&#125; to $&#123;dest_dir&#125;&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">  exit &quot;$&#123;E_BAD_MOVE&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>Bash also has the <strong>PIPESTATUS</strong> variable that allows checking of the return code from all parts of a pipe. If it’s only necessary to check success or failure of the whole pipe, then the following is acceptable:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">tar -cf - ./* | ( cd &quot;$&#123;dir&#125;&quot; &amp;&amp; tar -xf - )</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;PIPESTATUS[0]&#125;&quot; -ne 0 || &quot;$&#123;PIPESTATUS[1]&#125;&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  echo &quot;Unable to tar files to $&#123;dir&#125;&quot; &gt;&amp;2</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>However, as <strong>PIPESTATUS</strong> will be overwritten as soon as you do any other command, if you need to act differently on errors based on where it happened in the pipe, you’ll need to assign <strong>PIPESTATUS</strong> to another variable immediately after running the command (don’t forget that [ is a command and will wipe out <strong>PIPESTATUS</strong>).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">tar -cf - ./* | ( cd &quot;$&#123;DIR&#125;&quot; &amp;&amp; tar -xf - )</span><br><span class=\"line\"></span><br><span class=\"line\">return_codes=($&#123;PIPESTATUS[*]&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;return_codes[0]&#125;&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ &quot;$&#123;return_codes[1]&#125;&quot; -ne 0 ]]; then</span><br><span class=\"line\"></span><br><span class=\"line\">  do_something_else</span><br><span class=\"line\"></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h3 id=\"7-2-Builtin-Commands-vs-External-Commands\"><a href=\"#7-2-Builtin-Commands-vs-External-Commands\" class=\"headerlink\" title=\"7.2 Builtin Commands vs. External Commands\"></a>7.2 Builtin Commands vs. External Commands</h3><p>Given the choice between invoking a shell builtin and invoking a separate process, choose the builtin.</p>\n<p>We prefer the use of builtins such as the Parameter Expansion functions in <strong>bash(1)</strong> as it’s more robust and portable (especially when compared to things like sed).  </p>\n<p> <strong><em>Example:</em></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Prefer this:</span><br><span class=\"line\"></span><br><span class=\"line\">addition=$(($&#123;X&#125; + $&#123;Y&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">substitution=&quot;$&#123;string/#foo/bar&#125;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Instead of this:</span><br><span class=\"line\"></span><br><span class=\"line\">addition=&quot;$(expr $&#123;X&#125; + $&#123;Y&#125;)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">substitution=&quot;$(echo &quot;$&#123;string&#125;&quot; | sed -e &apos;s/^foo/bar/&apos;)&quot;</span><br></pre></td></tr></table></figure>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n<h2 id=\"8-Conclusion\"><a href=\"#8-Conclusion\" class=\"headerlink\" title=\"8. Conclusion\"></a>8. <span id=\"h\">Conclusion</span></h2><p>Use common sense and <strong>BE CONSISTENT</strong>.</p>\n<p>Please take a few minutes to read the Parting Words section at the bottom of the <strong>C++ Guide</strong>.</p>\n<p><strong><a href=\"#contents\">Go Contents</a></strong></p>\n"},{"title":"ubuntu安装为知笔记","date":"2017-01-20T07:38:17.000Z","_content":"\n今天在ubunu上重新安装wiznote时，发现[官方](http://www.wiz.cn/wiznote-linux.html)提供的方法只能编译安装，无奈步骤繁琐。接着我尝试了之前的安装方法，发现会报错。\n\n## 1.添加软件源来安装\nubuntu下可以通过软件源来进行安装，命令如下\n```\n$ sudo add-apt-repository ppa:wiznote-team\n$ sudo apt-get update\n$ sudo apt-get install wiznote\n```\n在更新时，会报`Hash Sum mismatch`\n```\nW: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-amd64/Packages  Hash Sum mismatch\nW: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-i386/Packages  Hash Sum mismatch\nW: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/i18n/Translation-en  Hash Sum mismatch\n```\n所以再执行install命令也会失败！！\n\n## 2.直接从软件源上下载安装包\n\n### 2.1 下载\n执行如下命令时\n```\n$ sudo add-apt-repository ppa:wiznote-team\n```\n会输出如下日志\n```\n The code is hosted here: https://github.com/WizTeam/WizQTClient\nvisit our homepage for detailed info: http://www.wiznote.cn/\nAny questions and bugs report to: <email address hidden>\nThe binary name is WizNote. Please use WizNote to start program in cmd.\n More info: https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa\nPress [ENTER] to continue or ctrl-c to cancel adding it\n```\n\n打开[最后一个链接](https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa)之后，点击 [View package details](https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages) 就会跳转到如下页面\nhttps://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages  点击其中的版本，下载相应的deb包。\n\n### 2.2安装方法\n\n- 方法1\n双击下载文件，使用软件中心安装  \n- 方法2\n```\ndpkg -i xxx.deb\n```\n\n","source":"_posts/ubuntu安装为知笔记.md","raw":"---\ntitle: ubuntu安装为知笔记\ndate: 2017-01-20 15:38:17\ntags: ubuntu\n---\n\n今天在ubunu上重新安装wiznote时，发现[官方](http://www.wiz.cn/wiznote-linux.html)提供的方法只能编译安装，无奈步骤繁琐。接着我尝试了之前的安装方法，发现会报错。\n\n## 1.添加软件源来安装\nubuntu下可以通过软件源来进行安装，命令如下\n```\n$ sudo add-apt-repository ppa:wiznote-team\n$ sudo apt-get update\n$ sudo apt-get install wiznote\n```\n在更新时，会报`Hash Sum mismatch`\n```\nW: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-amd64/Packages  Hash Sum mismatch\nW: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-i386/Packages  Hash Sum mismatch\nW: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/i18n/Translation-en  Hash Sum mismatch\n```\n所以再执行install命令也会失败！！\n\n## 2.直接从软件源上下载安装包\n\n### 2.1 下载\n执行如下命令时\n```\n$ sudo add-apt-repository ppa:wiznote-team\n```\n会输出如下日志\n```\n The code is hosted here: https://github.com/WizTeam/WizQTClient\nvisit our homepage for detailed info: http://www.wiznote.cn/\nAny questions and bugs report to: <email address hidden>\nThe binary name is WizNote. Please use WizNote to start program in cmd.\n More info: https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa\nPress [ENTER] to continue or ctrl-c to cancel adding it\n```\n\n打开[最后一个链接](https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa)之后，点击 [View package details](https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages) 就会跳转到如下页面\nhttps://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages  点击其中的版本，下载相应的deb包。\n\n### 2.2安装方法\n\n- 方法1\n双击下载文件，使用软件中心安装  \n- 方法2\n```\ndpkg -i xxx.deb\n```\n\n","slug":"ubuntu安装为知笔记","published":1,"updated":"2017-01-20T08:00:27.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j59001xzahiwmn5v1pz","content":"<p>今天在ubunu上重新安装wiznote时，发现<a href=\"http://www.wiz.cn/wiznote-linux.html\" target=\"_blank\" rel=\"noopener\">官方</a>提供的方法只能编译安装，无奈步骤繁琐。接着我尝试了之前的安装方法，发现会报错。</p>\n<h2 id=\"1-添加软件源来安装\"><a href=\"#1-添加软件源来安装\" class=\"headerlink\" title=\"1.添加软件源来安装\"></a>1.添加软件源来安装</h2><p>ubuntu下可以通过软件源来进行安装，命令如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository ppa:wiznote-team</span><br><span class=\"line\">$ sudo apt-get update</span><br><span class=\"line\">$ sudo apt-get install wiznote</span><br></pre></td></tr></table></figure></p>\n<p>在更新时，会报<code>Hash Sum mismatch</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-amd64/Packages  Hash Sum mismatch</span><br><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-i386/Packages  Hash Sum mismatch</span><br><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/i18n/Translation-en  Hash Sum mismatch</span><br></pre></td></tr></table></figure></p>\n<p>所以再执行install命令也会失败！！</p>\n<h2 id=\"2-直接从软件源上下载安装包\"><a href=\"#2-直接从软件源上下载安装包\" class=\"headerlink\" title=\"2.直接从软件源上下载安装包\"></a>2.直接从软件源上下载安装包</h2><h3 id=\"2-1-下载\"><a href=\"#2-1-下载\" class=\"headerlink\" title=\"2.1 下载\"></a>2.1 下载</h3><p>执行如下命令时<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository ppa:wiznote-team</span><br></pre></td></tr></table></figure></p>\n<p>会输出如下日志<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> The code is hosted here: https://github.com/WizTeam/WizQTClient</span><br><span class=\"line\">visit our homepage for detailed info: http://www.wiznote.cn/</span><br><span class=\"line\">Any questions and bugs report to: &lt;email address hidden&gt;</span><br><span class=\"line\">The binary name is WizNote. Please use WizNote to start program in cmd.</span><br><span class=\"line\"> More info: https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa</span><br><span class=\"line\">Press [ENTER] to continue or ctrl-c to cancel adding it</span><br></pre></td></tr></table></figure></p>\n<p>打开<a href=\"https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa\" target=\"_blank\" rel=\"noopener\">最后一个链接</a>之后，点击 <a href=\"https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages\" target=\"_blank\" rel=\"noopener\">View package details</a> 就会跳转到如下页面<br><a href=\"https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages\" target=\"_blank\" rel=\"noopener\">https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages</a>  点击其中的版本，下载相应的deb包。</p>\n<h3 id=\"2-2安装方法\"><a href=\"#2-2安装方法\" class=\"headerlink\" title=\"2.2安装方法\"></a>2.2安装方法</h3><ul>\n<li>方法1<br>双击下载文件，使用软件中心安装  </li>\n<li>方法2<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg -i xxx.deb</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>今天在ubunu上重新安装wiznote时，发现<a href=\"http://www.wiz.cn/wiznote-linux.html\" target=\"_blank\" rel=\"noopener\">官方</a>提供的方法只能编译安装，无奈步骤繁琐。接着我尝试了之前的安装方法，发现会报错。</p>\n<h2 id=\"1-添加软件源来安装\"><a href=\"#1-添加软件源来安装\" class=\"headerlink\" title=\"1.添加软件源来安装\"></a>1.添加软件源来安装</h2><p>ubuntu下可以通过软件源来进行安装，命令如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository ppa:wiznote-team</span><br><span class=\"line\">$ sudo apt-get update</span><br><span class=\"line\">$ sudo apt-get install wiznote</span><br></pre></td></tr></table></figure></p>\n<p>在更新时，会报<code>Hash Sum mismatch</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-amd64/Packages  Hash Sum mismatch</span><br><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/binary-i386/Packages  Hash Sum mismatch</span><br><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/wiznote-team/ppa/ubuntu/dists/trusty/main/i18n/Translation-en  Hash Sum mismatch</span><br></pre></td></tr></table></figure></p>\n<p>所以再执行install命令也会失败！！</p>\n<h2 id=\"2-直接从软件源上下载安装包\"><a href=\"#2-直接从软件源上下载安装包\" class=\"headerlink\" title=\"2.直接从软件源上下载安装包\"></a>2.直接从软件源上下载安装包</h2><h3 id=\"2-1-下载\"><a href=\"#2-1-下载\" class=\"headerlink\" title=\"2.1 下载\"></a>2.1 下载</h3><p>执行如下命令时<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository ppa:wiznote-team</span><br></pre></td></tr></table></figure></p>\n<p>会输出如下日志<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> The code is hosted here: https://github.com/WizTeam/WizQTClient</span><br><span class=\"line\">visit our homepage for detailed info: http://www.wiznote.cn/</span><br><span class=\"line\">Any questions and bugs report to: &lt;email address hidden&gt;</span><br><span class=\"line\">The binary name is WizNote. Please use WizNote to start program in cmd.</span><br><span class=\"line\"> More info: https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa</span><br><span class=\"line\">Press [ENTER] to continue or ctrl-c to cancel adding it</span><br></pre></td></tr></table></figure></p>\n<p>打开<a href=\"https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa\" target=\"_blank\" rel=\"noopener\">最后一个链接</a>之后，点击 <a href=\"https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages\" target=\"_blank\" rel=\"noopener\">View package details</a> 就会跳转到如下页面<br><a href=\"https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages\" target=\"_blank\" rel=\"noopener\">https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages</a>  点击其中的版本，下载相应的deb包。</p>\n<h3 id=\"2-2安装方法\"><a href=\"#2-2安装方法\" class=\"headerlink\" title=\"2.2安装方法\"></a>2.2安装方法</h3><ul>\n<li>方法1<br>双击下载文件，使用软件中心安装  </li>\n<li>方法2<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg -i xxx.deb</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n"},{"title":"ubuntu发送邮件","date":"2017-05-16T13:23:23.000Z","_content":"\n## 1. 安装\n```\nsudo apt-get install msmtp\nsudo apt-get install mutt\n```\n\n## 2. 配置\n\n### 2.1 配置mutt\n```\nvi ~/.muttrc \n```\n或 \n```\nsudo vi /etc/Muttrc\n```\n添加如下内容：\n```\nset sendmail=\"/usr/bin/msmtp\"\nset use_from=yes\nset realname=\"username\"\nset from=username@xxx.cn\nset envelope_from=yes\n\nset folder=\"/var/mail\"    # Contains all the mailboxes\nset record=\"+username\"\n```\n确认文件权限\n```\nll /etc/Muttrc\n-rw-r--r-- 1 root root 125 May 16 11:13 /etc/Muttrc\n```\n\n\n\n### 2.2 配置msmtp\n```\nvi ~/.msmtprc \n```\n或 \n```\nsudo vi /etc/msmtprc\n```\n添加如下内容\n```\naccount default\nhost    smtp.ym.163.com  # 邮件服务器地址\nuser    username@xxx.cn\nfrom    username@xxx.cn \npassword    ***********\nauth    plain\ntls     off\nlogfile /var/log/username/msmtp.log  # 日志位置 或 logfile ~/.msmtp.log\n```\n\n\n### 2.3 设置msmtp配置文件权限\n\n由于密码是明文，所以修改文件的权限，只允许自己可以访问该文件\n```\nchmod 600 ~/.msmtprc\n```\n或者\n```\nsudo chown username:username /etc/msmtprc\nchmod 600 /etc/msmtprc\n```\n确认文件权限\n```\nll /etc/msmtprc \n-rw------- 1 username username 190 May 16 11:09 /etc/msmtprc\n```\n\n### 2.4 创建日志文件\n```\ntouch ~/.msmtp.log\n```\n## 3. 验证\n```\nmsmtp --host=smtp.ym.163.com --serverinfo\n\nSMTP server at smtp.ym.163.com ([223.252.213.139]), port 25:\n    mr213139.mail.yeah.net ESMTP HMail (1.0)\nCapabilities:\n    SIZE 71680000:\n        Maximum message size is 71680000 bytes = 68.36 MiB\n    PIPELINING:\n        Support for command grouping for faster transmission\n    ETRN:\n        Support for RMQS (Remote Message Queue Starting)\n    STARTTLS:\n        Support for TLS encryption via the STARTTLS command\n    AUTH:\n        Supported authentication methods:\n        PLAIN LOGIN \nThis server might advertise more or other capabilities when TLS is active.\n```\n\n\n## 4. 使用\n```\necho \"hello world\" | mutt -s \"title\" 目标邮箱\n```\n\n```\nmutt -s \"测试\" username@xxx.cn < gotty \n```\n\n\n\n","source":"_posts/ubuntu发送邮件.md","raw":"---\ntitle: ubuntu发送邮件\ndate: 2017-05-16 21:23:23\ntags:\n---\n\n## 1. 安装\n```\nsudo apt-get install msmtp\nsudo apt-get install mutt\n```\n\n## 2. 配置\n\n### 2.1 配置mutt\n```\nvi ~/.muttrc \n```\n或 \n```\nsudo vi /etc/Muttrc\n```\n添加如下内容：\n```\nset sendmail=\"/usr/bin/msmtp\"\nset use_from=yes\nset realname=\"username\"\nset from=username@xxx.cn\nset envelope_from=yes\n\nset folder=\"/var/mail\"    # Contains all the mailboxes\nset record=\"+username\"\n```\n确认文件权限\n```\nll /etc/Muttrc\n-rw-r--r-- 1 root root 125 May 16 11:13 /etc/Muttrc\n```\n\n\n\n### 2.2 配置msmtp\n```\nvi ~/.msmtprc \n```\n或 \n```\nsudo vi /etc/msmtprc\n```\n添加如下内容\n```\naccount default\nhost    smtp.ym.163.com  # 邮件服务器地址\nuser    username@xxx.cn\nfrom    username@xxx.cn \npassword    ***********\nauth    plain\ntls     off\nlogfile /var/log/username/msmtp.log  # 日志位置 或 logfile ~/.msmtp.log\n```\n\n\n### 2.3 设置msmtp配置文件权限\n\n由于密码是明文，所以修改文件的权限，只允许自己可以访问该文件\n```\nchmod 600 ~/.msmtprc\n```\n或者\n```\nsudo chown username:username /etc/msmtprc\nchmod 600 /etc/msmtprc\n```\n确认文件权限\n```\nll /etc/msmtprc \n-rw------- 1 username username 190 May 16 11:09 /etc/msmtprc\n```\n\n### 2.4 创建日志文件\n```\ntouch ~/.msmtp.log\n```\n## 3. 验证\n```\nmsmtp --host=smtp.ym.163.com --serverinfo\n\nSMTP server at smtp.ym.163.com ([223.252.213.139]), port 25:\n    mr213139.mail.yeah.net ESMTP HMail (1.0)\nCapabilities:\n    SIZE 71680000:\n        Maximum message size is 71680000 bytes = 68.36 MiB\n    PIPELINING:\n        Support for command grouping for faster transmission\n    ETRN:\n        Support for RMQS (Remote Message Queue Starting)\n    STARTTLS:\n        Support for TLS encryption via the STARTTLS command\n    AUTH:\n        Supported authentication methods:\n        PLAIN LOGIN \nThis server might advertise more or other capabilities when TLS is active.\n```\n\n\n## 4. 使用\n```\necho \"hello world\" | mutt -s \"title\" 目标邮箱\n```\n\n```\nmutt -s \"测试\" username@xxx.cn < gotty \n```\n\n\n\n","slug":"ubuntu发送邮件","published":1,"updated":"2018-12-10T08:32:56.275Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5a0021zahilpgzjxzf","content":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install msmtp</span><br><span class=\"line\">sudo apt-get install mutt</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2. 配置\"></a>2. 配置</h2><h3 id=\"2-1-配置mutt\"><a href=\"#2-1-配置mutt\" class=\"headerlink\" title=\"2.1 配置mutt\"></a>2.1 配置mutt</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi ~/.muttrc</span><br></pre></td></tr></table></figure>\n<p>或<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/Muttrc</span><br></pre></td></tr></table></figure></p>\n<p>添加如下内容：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set sendmail=&quot;/usr/bin/msmtp&quot;</span><br><span class=\"line\">set use_from=yes</span><br><span class=\"line\">set realname=&quot;username&quot;</span><br><span class=\"line\">set from=username@xxx.cn</span><br><span class=\"line\">set envelope_from=yes</span><br><span class=\"line\"></span><br><span class=\"line\">set folder=&quot;/var/mail&quot;    # Contains all the mailboxes</span><br><span class=\"line\">set record=&quot;+username&quot;</span><br></pre></td></tr></table></figure></p>\n<p>确认文件权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /etc/Muttrc</span><br><span class=\"line\">-rw-r--r-- 1 root root 125 May 16 11:13 /etc/Muttrc</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-配置msmtp\"><a href=\"#2-2-配置msmtp\" class=\"headerlink\" title=\"2.2 配置msmtp\"></a>2.2 配置msmtp</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi ~/.msmtprc</span><br></pre></td></tr></table></figure>\n<p>或<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/msmtprc</span><br></pre></td></tr></table></figure></p>\n<p>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account default</span><br><span class=\"line\">host    smtp.ym.163.com  # 邮件服务器地址</span><br><span class=\"line\">user    username@xxx.cn</span><br><span class=\"line\">from    username@xxx.cn </span><br><span class=\"line\">password    ***********</span><br><span class=\"line\">auth    plain</span><br><span class=\"line\">tls     off</span><br><span class=\"line\">logfile /var/log/username/msmtp.log  # 日志位置 或 logfile ~/.msmtp.log</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-设置msmtp配置文件权限\"><a href=\"#2-3-设置msmtp配置文件权限\" class=\"headerlink\" title=\"2.3 设置msmtp配置文件权限\"></a>2.3 设置msmtp配置文件权限</h3><p>由于密码是明文，所以修改文件的权限，只允许自己可以访问该文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 600 ~/.msmtprc</span><br></pre></td></tr></table></figure></p>\n<p>或者<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chown username:username /etc/msmtprc</span><br><span class=\"line\">chmod 600 /etc/msmtprc</span><br></pre></td></tr></table></figure></p>\n<p>确认文件权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /etc/msmtprc </span><br><span class=\"line\">-rw------- 1 username username 190 May 16 11:09 /etc/msmtprc</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-4-创建日志文件\"><a href=\"#2-4-创建日志文件\" class=\"headerlink\" title=\"2.4 创建日志文件\"></a>2.4 创建日志文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch ~/.msmtp.log</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-验证\"><a href=\"#3-验证\" class=\"headerlink\" title=\"3. 验证\"></a>3. 验证</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msmtp --host=smtp.ym.163.com --serverinfo</span><br><span class=\"line\"></span><br><span class=\"line\">SMTP server at smtp.ym.163.com ([223.252.213.139]), port 25:</span><br><span class=\"line\">    mr213139.mail.yeah.net ESMTP HMail (1.0)</span><br><span class=\"line\">Capabilities:</span><br><span class=\"line\">    SIZE 71680000:</span><br><span class=\"line\">        Maximum message size is 71680000 bytes = 68.36 MiB</span><br><span class=\"line\">    PIPELINING:</span><br><span class=\"line\">        Support for command grouping for faster transmission</span><br><span class=\"line\">    ETRN:</span><br><span class=\"line\">        Support for RMQS (Remote Message Queue Starting)</span><br><span class=\"line\">    STARTTLS:</span><br><span class=\"line\">        Support for TLS encryption via the STARTTLS command</span><br><span class=\"line\">    AUTH:</span><br><span class=\"line\">        Supported authentication methods:</span><br><span class=\"line\">        PLAIN LOGIN </span><br><span class=\"line\">This server might advertise more or other capabilities when TLS is active.</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-使用\"><a href=\"#4-使用\" class=\"headerlink\" title=\"4. 使用\"></a>4. 使用</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;hello world&quot; | mutt -s &quot;title&quot; 目标邮箱</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutt -s &quot;测试&quot; username@xxx.cn &lt; gotty</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install msmtp</span><br><span class=\"line\">sudo apt-get install mutt</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2. 配置\"></a>2. 配置</h2><h3 id=\"2-1-配置mutt\"><a href=\"#2-1-配置mutt\" class=\"headerlink\" title=\"2.1 配置mutt\"></a>2.1 配置mutt</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi ~/.muttrc</span><br></pre></td></tr></table></figure>\n<p>或<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/Muttrc</span><br></pre></td></tr></table></figure></p>\n<p>添加如下内容：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set sendmail=&quot;/usr/bin/msmtp&quot;</span><br><span class=\"line\">set use_from=yes</span><br><span class=\"line\">set realname=&quot;username&quot;</span><br><span class=\"line\">set from=username@xxx.cn</span><br><span class=\"line\">set envelope_from=yes</span><br><span class=\"line\"></span><br><span class=\"line\">set folder=&quot;/var/mail&quot;    # Contains all the mailboxes</span><br><span class=\"line\">set record=&quot;+username&quot;</span><br></pre></td></tr></table></figure></p>\n<p>确认文件权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /etc/Muttrc</span><br><span class=\"line\">-rw-r--r-- 1 root root 125 May 16 11:13 /etc/Muttrc</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-配置msmtp\"><a href=\"#2-2-配置msmtp\" class=\"headerlink\" title=\"2.2 配置msmtp\"></a>2.2 配置msmtp</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi ~/.msmtprc</span><br></pre></td></tr></table></figure>\n<p>或<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/msmtprc</span><br></pre></td></tr></table></figure></p>\n<p>添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account default</span><br><span class=\"line\">host    smtp.ym.163.com  # 邮件服务器地址</span><br><span class=\"line\">user    username@xxx.cn</span><br><span class=\"line\">from    username@xxx.cn </span><br><span class=\"line\">password    ***********</span><br><span class=\"line\">auth    plain</span><br><span class=\"line\">tls     off</span><br><span class=\"line\">logfile /var/log/username/msmtp.log  # 日志位置 或 logfile ~/.msmtp.log</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-设置msmtp配置文件权限\"><a href=\"#2-3-设置msmtp配置文件权限\" class=\"headerlink\" title=\"2.3 设置msmtp配置文件权限\"></a>2.3 设置msmtp配置文件权限</h3><p>由于密码是明文，所以修改文件的权限，只允许自己可以访问该文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 600 ~/.msmtprc</span><br></pre></td></tr></table></figure></p>\n<p>或者<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chown username:username /etc/msmtprc</span><br><span class=\"line\">chmod 600 /etc/msmtprc</span><br></pre></td></tr></table></figure></p>\n<p>确认文件权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /etc/msmtprc </span><br><span class=\"line\">-rw------- 1 username username 190 May 16 11:09 /etc/msmtprc</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-4-创建日志文件\"><a href=\"#2-4-创建日志文件\" class=\"headerlink\" title=\"2.4 创建日志文件\"></a>2.4 创建日志文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch ~/.msmtp.log</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-验证\"><a href=\"#3-验证\" class=\"headerlink\" title=\"3. 验证\"></a>3. 验证</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msmtp --host=smtp.ym.163.com --serverinfo</span><br><span class=\"line\"></span><br><span class=\"line\">SMTP server at smtp.ym.163.com ([223.252.213.139]), port 25:</span><br><span class=\"line\">    mr213139.mail.yeah.net ESMTP HMail (1.0)</span><br><span class=\"line\">Capabilities:</span><br><span class=\"line\">    SIZE 71680000:</span><br><span class=\"line\">        Maximum message size is 71680000 bytes = 68.36 MiB</span><br><span class=\"line\">    PIPELINING:</span><br><span class=\"line\">        Support for command grouping for faster transmission</span><br><span class=\"line\">    ETRN:</span><br><span class=\"line\">        Support for RMQS (Remote Message Queue Starting)</span><br><span class=\"line\">    STARTTLS:</span><br><span class=\"line\">        Support for TLS encryption via the STARTTLS command</span><br><span class=\"line\">    AUTH:</span><br><span class=\"line\">        Supported authentication methods:</span><br><span class=\"line\">        PLAIN LOGIN </span><br><span class=\"line\">This server might advertise more or other capabilities when TLS is active.</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-使用\"><a href=\"#4-使用\" class=\"headerlink\" title=\"4. 使用\"></a>4. 使用</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;hello world&quot; | mutt -s &quot;title&quot; 目标邮箱</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutt -s &quot;测试&quot; username@xxx.cn &lt; gotty</span><br></pre></td></tr></table></figure>\n"},{"title":"ubuntu安装powerline字体","date":"2017-01-22T06:25:10.000Z","_content":"\n## 1.下载powerline字体和配置文件\n```\n$ wget https://github.com/powerline/powerline/raw/develop/font/PowerlineSymbols.otf\n$ wget https://github.com/powerline/powerline/raw/develop/font/10-powerline-symbols.conf\n```\n\n## 2.将字体放到字体目录中\n```\n$ sudo mv ./PowerlineSymbols.otf /usr/local/share/fonts\n```\n\n## 3.更新字体缓存\n```\n$ fc-cache -vf /usr/share/fonts/\n```\n\n## 4.添加字体配置文件\n```\n$ sudo mv 10-powerline-symbols.conf /etc/fonts/conf.d/\n```\n\n这样vim中的powerline字体就能够正确显示了。\n","source":"_posts/ubuntu安装powerline字体.md","raw":"---\ntitle: ubuntu安装powerline字体\ndate: 2017-01-22 14:25:10\ntags: vim插件\n---\n\n## 1.下载powerline字体和配置文件\n```\n$ wget https://github.com/powerline/powerline/raw/develop/font/PowerlineSymbols.otf\n$ wget https://github.com/powerline/powerline/raw/develop/font/10-powerline-symbols.conf\n```\n\n## 2.将字体放到字体目录中\n```\n$ sudo mv ./PowerlineSymbols.otf /usr/local/share/fonts\n```\n\n## 3.更新字体缓存\n```\n$ fc-cache -vf /usr/share/fonts/\n```\n\n## 4.添加字体配置文件\n```\n$ sudo mv 10-powerline-symbols.conf /etc/fonts/conf.d/\n```\n\n这样vim中的powerline字体就能够正确显示了。\n","slug":"ubuntu安装powerline字体","published":1,"updated":"2017-01-24T08:15:33.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5a0022zahi8d8vhi4d","content":"<h2 id=\"1-下载powerline字体和配置文件\"><a href=\"#1-下载powerline字体和配置文件\" class=\"headerlink\" title=\"1.下载powerline字体和配置文件\"></a>1.下载powerline字体和配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://github.com/powerline/powerline/raw/develop/font/PowerlineSymbols.otf</span><br><span class=\"line\">$ wget https://github.com/powerline/powerline/raw/develop/font/10-powerline-symbols.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-将字体放到字体目录中\"><a href=\"#2-将字体放到字体目录中\" class=\"headerlink\" title=\"2.将字体放到字体目录中\"></a>2.将字体放到字体目录中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mv ./PowerlineSymbols.otf /usr/local/share/fonts</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-更新字体缓存\"><a href=\"#3-更新字体缓存\" class=\"headerlink\" title=\"3.更新字体缓存\"></a>3.更新字体缓存</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ fc-cache -vf /usr/share/fonts/</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-添加字体配置文件\"><a href=\"#4-添加字体配置文件\" class=\"headerlink\" title=\"4.添加字体配置文件\"></a>4.添加字体配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mv 10-powerline-symbols.conf /etc/fonts/conf.d/</span><br></pre></td></tr></table></figure>\n<p>这样vim中的powerline字体就能够正确显示了。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-下载powerline字体和配置文件\"><a href=\"#1-下载powerline字体和配置文件\" class=\"headerlink\" title=\"1.下载powerline字体和配置文件\"></a>1.下载powerline字体和配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://github.com/powerline/powerline/raw/develop/font/PowerlineSymbols.otf</span><br><span class=\"line\">$ wget https://github.com/powerline/powerline/raw/develop/font/10-powerline-symbols.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-将字体放到字体目录中\"><a href=\"#2-将字体放到字体目录中\" class=\"headerlink\" title=\"2.将字体放到字体目录中\"></a>2.将字体放到字体目录中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mv ./PowerlineSymbols.otf /usr/local/share/fonts</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-更新字体缓存\"><a href=\"#3-更新字体缓存\" class=\"headerlink\" title=\"3.更新字体缓存\"></a>3.更新字体缓存</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ fc-cache -vf /usr/share/fonts/</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-添加字体配置文件\"><a href=\"#4-添加字体配置文件\" class=\"headerlink\" title=\"4.添加字体配置文件\"></a>4.添加字体配置文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mv 10-powerline-symbols.conf /etc/fonts/conf.d/</span><br></pre></td></tr></table></figure>\n<p>这样vim中的powerline字体就能够正确显示了。</p>\n"},{"title":"ubuntu指定默认编辑器","date":"2017-02-07T05:28:17.000Z","_content":"\nubuntu默认的编辑器为nano，例如执行如下命令时就会使用nano来打开\n`sudo visudo`或者`git commit --amend`\n\n如果想要设置成默认使用自己习惯的vi，可以执行如下命令进行选择\n\n```\n$ sudo update-alternatives --config editor \nThere are 4 choices for the alternative editor (providing /usr/bin/editor).\n  Selection    Path                Priority   Status\n------------------------------------------------------------\n* 0            /bin/nano            40        auto mode\n  1            /bin/ed             -100       manual mode\n  2            /bin/nano            40        manual mode\n  3            /usr/bin/vim.basic   30        manual mode\n  4            /usr/bin/vim.tiny    10        manual mode\nPress enter to keep the current choice[*], or type selection number:\n\n```\n输入`3`就可以了。","source":"_posts/ubuntu指定默认编辑器.md","raw":"---\ntitle: ubuntu指定默认编辑器\ndate: 2017-02-07 13:28:17\ncategories: \ntags: ubuntu\n---\n\nubuntu默认的编辑器为nano，例如执行如下命令时就会使用nano来打开\n`sudo visudo`或者`git commit --amend`\n\n如果想要设置成默认使用自己习惯的vi，可以执行如下命令进行选择\n\n```\n$ sudo update-alternatives --config editor \nThere are 4 choices for the alternative editor (providing /usr/bin/editor).\n  Selection    Path                Priority   Status\n------------------------------------------------------------\n* 0            /bin/nano            40        auto mode\n  1            /bin/ed             -100       manual mode\n  2            /bin/nano            40        manual mode\n  3            /usr/bin/vim.basic   30        manual mode\n  4            /usr/bin/vim.tiny    10        manual mode\nPress enter to keep the current choice[*], or type selection number:\n\n```\n输入`3`就可以了。","slug":"ubuntu指定默认编辑器","published":1,"updated":"2017-02-07T05:37:05.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5b0024zahi25p7rrvx","content":"<p>ubuntu默认的编辑器为nano，例如执行如下命令时就会使用nano来打开<br><code>sudo visudo</code>或者<code>git commit --amend</code></p>\n<p>如果想要设置成默认使用自己习惯的vi，可以执行如下命令进行选择</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo update-alternatives --config editor </span><br><span class=\"line\">There are 4 choices for the alternative editor (providing /usr/bin/editor).</span><br><span class=\"line\">  Selection    Path                Priority   Status</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">* 0            /bin/nano            40        auto mode</span><br><span class=\"line\">  1            /bin/ed             -100       manual mode</span><br><span class=\"line\">  2            /bin/nano            40        manual mode</span><br><span class=\"line\">  3            /usr/bin/vim.basic   30        manual mode</span><br><span class=\"line\">  4            /usr/bin/vim.tiny    10        manual mode</span><br><span class=\"line\">Press enter to keep the current choice[*], or type selection number:</span><br></pre></td></tr></table></figure>\n<p>输入<code>3</code>就可以了。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>ubuntu默认的编辑器为nano，例如执行如下命令时就会使用nano来打开<br><code>sudo visudo</code>或者<code>git commit --amend</code></p>\n<p>如果想要设置成默认使用自己习惯的vi，可以执行如下命令进行选择</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo update-alternatives --config editor </span><br><span class=\"line\">There are 4 choices for the alternative editor (providing /usr/bin/editor).</span><br><span class=\"line\">  Selection    Path                Priority   Status</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">* 0            /bin/nano            40        auto mode</span><br><span class=\"line\">  1            /bin/ed             -100       manual mode</span><br><span class=\"line\">  2            /bin/nano            40        manual mode</span><br><span class=\"line\">  3            /usr/bin/vim.basic   30        manual mode</span><br><span class=\"line\">  4            /usr/bin/vim.tiny    10        manual mode</span><br><span class=\"line\">Press enter to keep the current choice[*], or type selection number:</span><br></pre></td></tr></table></figure>\n<p>输入<code>3</code>就可以了。</p>\n"},{"title":"vim-surround插件","date":"2017-01-12T05:08:49.000Z","_content":"\nSurround.vim is all about \"surroundings\": parentheses, brackets, quotes, XML tags, and more. The plugin provides mappings to easily delete, change and add such surroundings in pairs.\n\n# 1. 修改 cs原符号要修改的符号\n\n## 1.1 修改双引号为单引号 `cs\"'`\n\nIt's easiest to explain with examples. Press `cs\"'` inside\n\n```\n\"Hello world!\"\n```\nto change it to\n\n```\n'Hello world!'\n```\n\n## 1.2 修改单引号为html配对标签 `cs'<q>` 或者 `cs'<head>`\n\nNow press cs'<q> to change it to\n\n```\n<q>Hello world!</q>\n\n```\n\n## 1.3 修改配对标签为其他字符 `cst要改成的字符`\n\nTo go full circle, press cst\" to get\n```\n\"hello world!\"\n\n```\n\n\n\n# 2. 删除符号 `ds要删除的符号`\n\nTo remove the delimiters entirely, press ds\".\n```\nHello world!\n\n```\n\n# 3. 在文字的两侧添加字符 `ysiw要添加的字符`\n\nNow with the cursor on \"Hello\", press ysiw] (iw is a text object).\n\n```\n[Hello] world!\n\n```\nLet's make that braces and add some space (use } instead of { for no space): cs]{\n\nysiw{ 有空格    cs]{ 有空格\nysiw} 无空格    cs]} 无空格\n```\n{ Hello } world!\n\n```\n\n# 4. 对整行操作 `yss`\n\nNow wrap the entire line in parentheses with yssb or yss).\n\n```\n({ Hello } world!)\n\n```\n\n# 5. 删除符号 `ds删除的符号`\n\nRevert to the original text: ds{ds)\n```\nhello world!\n\n```\nEmphasize hello: ysiw<em>\n\n```\n<em>Hello</em> world!\n\n```\n\nFinally, let's try out visual mode. Press a capital V (for linewise visual mode) followed by `S<p class=\"important\">`.\n\n```\n<p class=\"important\">\n  <em>Hello</em> world!\n</p>\n\n```\n\nThis plugin is very powerful for HTML and XML editing, a niche which currently seems underfilled in Vim land. (As opposed to HTML/XML inserting, for which many plugins are available). Adding, changing, and removing pairs of tags simultaneously is a breeze.\n\nThe . command will work with ds, cs, and yss if you install repeat.vim.\n","source":"_posts/vim-surround插件.md","raw":"---\ntitle: vim-surround插件\ndate: 2017-01-12 13:08:49\ncategories: vim\ntags: vim插件 \n---\n\nSurround.vim is all about \"surroundings\": parentheses, brackets, quotes, XML tags, and more. The plugin provides mappings to easily delete, change and add such surroundings in pairs.\n\n# 1. 修改 cs原符号要修改的符号\n\n## 1.1 修改双引号为单引号 `cs\"'`\n\nIt's easiest to explain with examples. Press `cs\"'` inside\n\n```\n\"Hello world!\"\n```\nto change it to\n\n```\n'Hello world!'\n```\n\n## 1.2 修改单引号为html配对标签 `cs'<q>` 或者 `cs'<head>`\n\nNow press cs'<q> to change it to\n\n```\n<q>Hello world!</q>\n\n```\n\n## 1.3 修改配对标签为其他字符 `cst要改成的字符`\n\nTo go full circle, press cst\" to get\n```\n\"hello world!\"\n\n```\n\n\n\n# 2. 删除符号 `ds要删除的符号`\n\nTo remove the delimiters entirely, press ds\".\n```\nHello world!\n\n```\n\n# 3. 在文字的两侧添加字符 `ysiw要添加的字符`\n\nNow with the cursor on \"Hello\", press ysiw] (iw is a text object).\n\n```\n[Hello] world!\n\n```\nLet's make that braces and add some space (use } instead of { for no space): cs]{\n\nysiw{ 有空格    cs]{ 有空格\nysiw} 无空格    cs]} 无空格\n```\n{ Hello } world!\n\n```\n\n# 4. 对整行操作 `yss`\n\nNow wrap the entire line in parentheses with yssb or yss).\n\n```\n({ Hello } world!)\n\n```\n\n# 5. 删除符号 `ds删除的符号`\n\nRevert to the original text: ds{ds)\n```\nhello world!\n\n```\nEmphasize hello: ysiw<em>\n\n```\n<em>Hello</em> world!\n\n```\n\nFinally, let's try out visual mode. Press a capital V (for linewise visual mode) followed by `S<p class=\"important\">`.\n\n```\n<p class=\"important\">\n  <em>Hello</em> world!\n</p>\n\n```\n\nThis plugin is very powerful for HTML and XML editing, a niche which currently seems underfilled in Vim land. (As opposed to HTML/XML inserting, for which many plugins are available). Adding, changing, and removing pairs of tags simultaneously is a breeze.\n\nThe . command will work with ds, cs, and yss if you install repeat.vim.\n","slug":"vim-surround插件","published":1,"updated":"2017-01-12T05:25:25.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5c0026zahiuukffzfy","content":"<p>Surround.vim is all about “surroundings”: parentheses, brackets, quotes, XML tags, and more. The plugin provides mappings to easily delete, change and add such surroundings in pairs.</p>\n<h1 id=\"1-修改-cs原符号要修改的符号\"><a href=\"#1-修改-cs原符号要修改的符号\" class=\"headerlink\" title=\"1. 修改 cs原符号要修改的符号\"></a>1. 修改 cs原符号要修改的符号</h1><h2 id=\"1-1-修改双引号为单引号-cs-quot-39\"><a href=\"#1-1-修改双引号为单引号-cs-quot-39\" class=\"headerlink\" title=\"1.1 修改双引号为单引号 cs&quot;&#39;\"></a>1.1 修改双引号为单引号 <code>cs&quot;&#39;</code></h2><p>It’s easiest to explain with examples. Press <code>cs&quot;&#39;</code> inside</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;Hello world!&quot;</span><br></pre></td></tr></table></figure>\n<p>to change it to</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&apos;Hello world!&apos;</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-2-修改单引号为html配对标签-cs-39-lt-q-gt-或者-cs-39-lt-head-gt\"><a href=\"#1-2-修改单引号为html配对标签-cs-39-lt-q-gt-或者-cs-39-lt-head-gt\" class=\"headerlink\" title=\"1.2 修改单引号为html配对标签 cs&#39;&lt;q&gt; 或者 cs&#39;&lt;head&gt;\"></a>1.2 修改单引号为html配对标签 <code>cs&#39;&lt;q&gt;</code> 或者 <code>cs&#39;&lt;head&gt;</code></h2><p>Now press cs’<q> to change it to</q></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;q&gt;Hello world!&lt;/q&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-3-修改配对标签为其他字符-cst要改成的字符\"><a href=\"#1-3-修改配对标签为其他字符-cst要改成的字符\" class=\"headerlink\" title=\"1.3 修改配对标签为其他字符 cst要改成的字符\"></a>1.3 修改配对标签为其他字符 <code>cst要改成的字符</code></h2><p>To go full circle, press cst” to get<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;hello world!&quot;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"2-删除符号-ds要删除的符号\"><a href=\"#2-删除符号-ds要删除的符号\" class=\"headerlink\" title=\"2. 删除符号 ds要删除的符号\"></a>2. 删除符号 <code>ds要删除的符号</code></h1><p>To remove the delimiters entirely, press ds”.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello world!</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"3-在文字的两侧添加字符-ysiw要添加的字符\"><a href=\"#3-在文字的两侧添加字符-ysiw要添加的字符\" class=\"headerlink\" title=\"3. 在文字的两侧添加字符 ysiw要添加的字符\"></a>3. 在文字的两侧添加字符 <code>ysiw要添加的字符</code></h1><p>Now with the cursor on “Hello”, press ysiw] (iw is a text object).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Hello] world!</span><br></pre></td></tr></table></figure>\n<p>Let’s make that braces and add some space (use } instead of { for no space): cs]{</p>\n<p>ysiw{ 有空格    cs]{ 有空格<br>ysiw} 无空格    cs]} 无空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; Hello &#125; world!</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"4-对整行操作-yss\"><a href=\"#4-对整行操作-yss\" class=\"headerlink\" title=\"4. 对整行操作 yss\"></a>4. 对整行操作 <code>yss</code></h1><p>Now wrap the entire line in parentheses with yssb or yss).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(&#123; Hello &#125; world!)</span><br></pre></td></tr></table></figure>\n<h1 id=\"5-删除符号-ds删除的符号\"><a href=\"#5-删除符号-ds删除的符号\" class=\"headerlink\" title=\"5. 删除符号 ds删除的符号\"></a>5. 删除符号 <code>ds删除的符号</code></h1><p>Revert to the original text: ds{ds)<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello world!</span><br></pre></td></tr></table></figure></p>\n<p>Emphasize hello: ysiw<em></em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;em&gt;Hello&lt;/em&gt; world!</span><br></pre></td></tr></table></figure>\n<p>Finally, let’s try out visual mode. Press a capital V (for linewise visual mode) followed by <code>S&lt;p class=&quot;important&quot;&gt;</code>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;p class=&quot;important&quot;&gt;</span><br><span class=\"line\">  &lt;em&gt;Hello&lt;/em&gt; world!</span><br><span class=\"line\">&lt;/p&gt;</span><br></pre></td></tr></table></figure>\n<p>This plugin is very powerful for HTML and XML editing, a niche which currently seems underfilled in Vim land. (As opposed to HTML/XML inserting, for which many plugins are available). Adding, changing, and removing pairs of tags simultaneously is a breeze.</p>\n<p>The . command will work with ds, cs, and yss if you install repeat.vim.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Surround.vim is all about “surroundings”: parentheses, brackets, quotes, XML tags, and more. The plugin provides mappings to easily delete, change and add such surroundings in pairs.</p>\n<h1 id=\"1-修改-cs原符号要修改的符号\"><a href=\"#1-修改-cs原符号要修改的符号\" class=\"headerlink\" title=\"1. 修改 cs原符号要修改的符号\"></a>1. 修改 cs原符号要修改的符号</h1><h2 id=\"1-1-修改双引号为单引号-cs-quot-39\"><a href=\"#1-1-修改双引号为单引号-cs-quot-39\" class=\"headerlink\" title=\"1.1 修改双引号为单引号 cs&quot;&#39;\"></a>1.1 修改双引号为单引号 <code>cs&quot;&#39;</code></h2><p>It’s easiest to explain with examples. Press <code>cs&quot;&#39;</code> inside</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;Hello world!&quot;</span><br></pre></td></tr></table></figure>\n<p>to change it to</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&apos;Hello world!&apos;</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-2-修改单引号为html配对标签-cs-39-lt-q-gt-或者-cs-39-lt-head-gt\"><a href=\"#1-2-修改单引号为html配对标签-cs-39-lt-q-gt-或者-cs-39-lt-head-gt\" class=\"headerlink\" title=\"1.2 修改单引号为html配对标签 cs&#39;&lt;q&gt; 或者 cs&#39;&lt;head&gt;\"></a>1.2 修改单引号为html配对标签 <code>cs&#39;&lt;q&gt;</code> 或者 <code>cs&#39;&lt;head&gt;</code></h2><p>Now press cs’<q> to change it to</q></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;q&gt;Hello world!&lt;/q&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-3-修改配对标签为其他字符-cst要改成的字符\"><a href=\"#1-3-修改配对标签为其他字符-cst要改成的字符\" class=\"headerlink\" title=\"1.3 修改配对标签为其他字符 cst要改成的字符\"></a>1.3 修改配对标签为其他字符 <code>cst要改成的字符</code></h2><p>To go full circle, press cst” to get<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;hello world!&quot;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"2-删除符号-ds要删除的符号\"><a href=\"#2-删除符号-ds要删除的符号\" class=\"headerlink\" title=\"2. 删除符号 ds要删除的符号\"></a>2. 删除符号 <code>ds要删除的符号</code></h1><p>To remove the delimiters entirely, press ds”.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Hello world!</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"3-在文字的两侧添加字符-ysiw要添加的字符\"><a href=\"#3-在文字的两侧添加字符-ysiw要添加的字符\" class=\"headerlink\" title=\"3. 在文字的两侧添加字符 ysiw要添加的字符\"></a>3. 在文字的两侧添加字符 <code>ysiw要添加的字符</code></h1><p>Now with the cursor on “Hello”, press ysiw] (iw is a text object).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Hello] world!</span><br></pre></td></tr></table></figure>\n<p>Let’s make that braces and add some space (use } instead of { for no space): cs]{</p>\n<p>ysiw{ 有空格    cs]{ 有空格<br>ysiw} 无空格    cs]} 无空格<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; Hello &#125; world!</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"4-对整行操作-yss\"><a href=\"#4-对整行操作-yss\" class=\"headerlink\" title=\"4. 对整行操作 yss\"></a>4. 对整行操作 <code>yss</code></h1><p>Now wrap the entire line in parentheses with yssb or yss).</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(&#123; Hello &#125; world!)</span><br></pre></td></tr></table></figure>\n<h1 id=\"5-删除符号-ds删除的符号\"><a href=\"#5-删除符号-ds删除的符号\" class=\"headerlink\" title=\"5. 删除符号 ds删除的符号\"></a>5. 删除符号 <code>ds删除的符号</code></h1><p>Revert to the original text: ds{ds)<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello world!</span><br></pre></td></tr></table></figure></p>\n<p>Emphasize hello: ysiw<em></em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;em&gt;Hello&lt;/em&gt; world!</span><br></pre></td></tr></table></figure>\n<p>Finally, let’s try out visual mode. Press a capital V (for linewise visual mode) followed by <code>S&lt;p class=&quot;important&quot;&gt;</code>.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;p class=&quot;important&quot;&gt;</span><br><span class=\"line\">  &lt;em&gt;Hello&lt;/em&gt; world!</span><br><span class=\"line\">&lt;/p&gt;</span><br></pre></td></tr></table></figure>\n<p>This plugin is very powerful for HTML and XML editing, a niche which currently seems underfilled in Vim land. (As opposed to HTML/XML inserting, for which many plugins are available). Adding, changing, and removing pairs of tags simultaneously is a breeze.</p>\n<p>The . command will work with ds, cs, and yss if you install repeat.vim.</p>\n"},{"title":"修改最后一次commit","date":"2017-01-11T13:42:43.000Z","_content":"\n## 命令\n\n对于已经修改提交过的注释，如果需要修改，可以使用`git commit --amend`。\n\n## example\n\n在operation/bin里最新的提交就是 resolving the problem，我现在需要将其改为 resolving the problem for some errors\n\n在framework/base下输入git commit –amend,就会进入一个文本编辑界面（如下）\n```\n     resolving the problem\n     Change-Id: I7e7daffd2e8a5e65130629dc1c56dee5f5c4b5f7\n# Please enter the commit message for your changes. Lines starting\n# with '#' will be ignored, and an empty message aborts the commit.\n# On branch shuai.lu_branch\n# Changes to be committed:\n#   (use \"git reset HEAD^1 <file>...\" to unstage)\n#\n#       modified:   operation/bin/alert\n#\n```\n修改commit描述，然后保存退出，这样注释就修改了，再重新push就可以了。\n","source":"_posts/修改最后一次commit.md","raw":"---\ntitle: 修改最后一次commit\ndate: 2017-01-11 21:42:43\ntags:\n---\n\n## 命令\n\n对于已经修改提交过的注释，如果需要修改，可以使用`git commit --amend`。\n\n## example\n\n在operation/bin里最新的提交就是 resolving the problem，我现在需要将其改为 resolving the problem for some errors\n\n在framework/base下输入git commit –amend,就会进入一个文本编辑界面（如下）\n```\n     resolving the problem\n     Change-Id: I7e7daffd2e8a5e65130629dc1c56dee5f5c4b5f7\n# Please enter the commit message for your changes. Lines starting\n# with '#' will be ignored, and an empty message aborts the commit.\n# On branch shuai.lu_branch\n# Changes to be committed:\n#   (use \"git reset HEAD^1 <file>...\" to unstage)\n#\n#       modified:   operation/bin/alert\n#\n```\n修改commit描述，然后保存退出，这样注释就修改了，再重新push就可以了。\n","slug":"修改最后一次commit","published":1,"updated":"2017-01-12T01:18:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5c0028zahiten50ikg","content":"<h2 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h2><p>对于已经修改提交过的注释，如果需要修改，可以使用<code>git commit --amend</code>。</p>\n<h2 id=\"example\"><a href=\"#example\" class=\"headerlink\" title=\"example\"></a>example</h2><p>在operation/bin里最新的提交就是 resolving the problem，我现在需要将其改为 resolving the problem for some errors</p>\n<p>在framework/base下输入git commit –amend,就会进入一个文本编辑界面（如下）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">     resolving the problem</span><br><span class=\"line\">     Change-Id: I7e7daffd2e8a5e65130629dc1c56dee5f5c4b5f7</span><br><span class=\"line\"># Please enter the commit message for your changes. Lines starting</span><br><span class=\"line\"># with &apos;#&apos; will be ignored, and an empty message aborts the commit.</span><br><span class=\"line\"># On branch shuai.lu_branch</span><br><span class=\"line\"># Changes to be committed:</span><br><span class=\"line\">#   (use &quot;git reset HEAD^1 &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\">#</span><br><span class=\"line\">#       modified:   operation/bin/alert</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure></p>\n<p>修改commit描述，然后保存退出，这样注释就修改了，再重新push就可以了。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h2><p>对于已经修改提交过的注释，如果需要修改，可以使用<code>git commit --amend</code>。</p>\n<h2 id=\"example\"><a href=\"#example\" class=\"headerlink\" title=\"example\"></a>example</h2><p>在operation/bin里最新的提交就是 resolving the problem，我现在需要将其改为 resolving the problem for some errors</p>\n<p>在framework/base下输入git commit –amend,就会进入一个文本编辑界面（如下）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">     resolving the problem</span><br><span class=\"line\">     Change-Id: I7e7daffd2e8a5e65130629dc1c56dee5f5c4b5f7</span><br><span class=\"line\"># Please enter the commit message for your changes. Lines starting</span><br><span class=\"line\"># with &apos;#&apos; will be ignored, and an empty message aborts the commit.</span><br><span class=\"line\"># On branch shuai.lu_branch</span><br><span class=\"line\"># Changes to be committed:</span><br><span class=\"line\">#   (use &quot;git reset HEAD^1 &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\">#</span><br><span class=\"line\">#       modified:   operation/bin/alert</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure></p>\n<p>修改commit描述，然后保存退出，这样注释就修改了，再重新push就可以了。</p>\n"},{"title":"启用ssl","date":"2017-08-09T12:33:10.000Z","_content":"\n## 1. nginx启用ssl\n网站启用ssl需要nginx ssl模块的支持\n\n### 1.1 查看nginx是否编译了ssl模块\n```\nnginx -V\n```\n\n### 1.2 编译ssl模块\n```\ncd nginx/src/dir\n./configure --with-http_ssl_module\nmake && make install\n```\n\n## 2. 启用ssl\n\n### 2.1 生成证书\n```\nsudo openssl genrsa -des3 -out server.key 2048\nsudo openssl req -new -key server.key -out server.csr\nsudo cp server.key server.key.org\nsudo openssl rsa -in server.key.org -out server.key\nsudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt\n```\n\n### 2.2 在server区域，指定证书位置\n``` \nssl_certificate /path/server.crt;\nssl_certificate_key /path/server.key;\n```\n\n### 2.3 启用ssl\n修改nginx配置，启用ssl\n```\nlisten       443 ssl; \nserver_name  ssl.test.cn; \n```\n\n### 2.4 将http的访问redirect到https\n在http区域添加如下内容\n```\nserver {\n       listen       80;\n       server_name  ssl.test.cn;;\n       return 301 https://ssl.test.cn:443$request_uri;\n}\n```\n\n## 3. 生效配置\n重启或者`reload` nginx\n\n## 4. 测试\n浏览器访问http://ssl.test.cn，测试验证。","source":"_posts/启用ssl.md","raw":"---\ntitle: 启用ssl\ndate: 2017-08-09 20:33:10\ntags: [nginx,ssl]\n---\n\n## 1. nginx启用ssl\n网站启用ssl需要nginx ssl模块的支持\n\n### 1.1 查看nginx是否编译了ssl模块\n```\nnginx -V\n```\n\n### 1.2 编译ssl模块\n```\ncd nginx/src/dir\n./configure --with-http_ssl_module\nmake && make install\n```\n\n## 2. 启用ssl\n\n### 2.1 生成证书\n```\nsudo openssl genrsa -des3 -out server.key 2048\nsudo openssl req -new -key server.key -out server.csr\nsudo cp server.key server.key.org\nsudo openssl rsa -in server.key.org -out server.key\nsudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt\n```\n\n### 2.2 在server区域，指定证书位置\n``` \nssl_certificate /path/server.crt;\nssl_certificate_key /path/server.key;\n```\n\n### 2.3 启用ssl\n修改nginx配置，启用ssl\n```\nlisten       443 ssl; \nserver_name  ssl.test.cn; \n```\n\n### 2.4 将http的访问redirect到https\n在http区域添加如下内容\n```\nserver {\n       listen       80;\n       server_name  ssl.test.cn;;\n       return 301 https://ssl.test.cn:443$request_uri;\n}\n```\n\n## 3. 生效配置\n重启或者`reload` nginx\n\n## 4. 测试\n浏览器访问http://ssl.test.cn，测试验证。","slug":"启用ssl","published":1,"updated":"2018-12-09T05:33:45.165Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5d002czahim5lkxfh0","content":"<h2 id=\"1-nginx启用ssl\"><a href=\"#1-nginx启用ssl\" class=\"headerlink\" title=\"1. nginx启用ssl\"></a>1. nginx启用ssl</h2><p>网站启用ssl需要nginx ssl模块的支持</p>\n<h3 id=\"1-1-查看nginx是否编译了ssl模块\"><a href=\"#1-1-查看nginx是否编译了ssl模块\" class=\"headerlink\" title=\"1.1 查看nginx是否编译了ssl模块\"></a>1.1 查看nginx是否编译了ssl模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -V</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-编译ssl模块\"><a href=\"#1-2-编译ssl模块\" class=\"headerlink\" title=\"1.2 编译ssl模块\"></a>1.2 编译ssl模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd nginx/src/dir</span><br><span class=\"line\">./configure --with-http_ssl_module</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-启用ssl\"><a href=\"#2-启用ssl\" class=\"headerlink\" title=\"2. 启用ssl\"></a>2. 启用ssl</h2><h3 id=\"2-1-生成证书\"><a href=\"#2-1-生成证书\" class=\"headerlink\" title=\"2.1 生成证书\"></a>2.1 生成证书</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo openssl genrsa -des3 -out server.key 2048</span><br><span class=\"line\">sudo openssl req -new -key server.key -out server.csr</span><br><span class=\"line\">sudo cp server.key server.key.org</span><br><span class=\"line\">sudo openssl rsa -in server.key.org -out server.key</span><br><span class=\"line\">sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-在server区域，指定证书位置\"><a href=\"#2-2-在server区域，指定证书位置\" class=\"headerlink\" title=\"2.2 在server区域，指定证书位置\"></a>2.2 在server区域，指定证书位置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssl_certificate /path/server.crt;</span><br><span class=\"line\">ssl_certificate_key /path/server.key;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-启用ssl\"><a href=\"#2-3-启用ssl\" class=\"headerlink\" title=\"2.3 启用ssl\"></a>2.3 启用ssl</h3><p>修改nginx配置，启用ssl<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listen       443 ssl; </span><br><span class=\"line\">server_name  ssl.test.cn;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-4-将http的访问redirect到https\"><a href=\"#2-4-将http的访问redirect到https\" class=\"headerlink\" title=\"2.4 将http的访问redirect到https\"></a>2.4 将http的访问redirect到https</h3><p>在http区域添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">       listen       80;</span><br><span class=\"line\">       server_name  ssl.test.cn;;</span><br><span class=\"line\">       return 301 https://ssl.test.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-生效配置\"><a href=\"#3-生效配置\" class=\"headerlink\" title=\"3. 生效配置\"></a>3. 生效配置</h2><p>重启或者<code>reload</code> nginx</p>\n<h2 id=\"4-测试\"><a href=\"#4-测试\" class=\"headerlink\" title=\"4. 测试\"></a>4. 测试</h2><p>浏览器访问<a href=\"http://ssl.test.cn，测试验证。\" target=\"_blank\" rel=\"noopener\">http://ssl.test.cn，测试验证。</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-nginx启用ssl\"><a href=\"#1-nginx启用ssl\" class=\"headerlink\" title=\"1. nginx启用ssl\"></a>1. nginx启用ssl</h2><p>网站启用ssl需要nginx ssl模块的支持</p>\n<h3 id=\"1-1-查看nginx是否编译了ssl模块\"><a href=\"#1-1-查看nginx是否编译了ssl模块\" class=\"headerlink\" title=\"1.1 查看nginx是否编译了ssl模块\"></a>1.1 查看nginx是否编译了ssl模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -V</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-编译ssl模块\"><a href=\"#1-2-编译ssl模块\" class=\"headerlink\" title=\"1.2 编译ssl模块\"></a>1.2 编译ssl模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd nginx/src/dir</span><br><span class=\"line\">./configure --with-http_ssl_module</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-启用ssl\"><a href=\"#2-启用ssl\" class=\"headerlink\" title=\"2. 启用ssl\"></a>2. 启用ssl</h2><h3 id=\"2-1-生成证书\"><a href=\"#2-1-生成证书\" class=\"headerlink\" title=\"2.1 生成证书\"></a>2.1 生成证书</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo openssl genrsa -des3 -out server.key 2048</span><br><span class=\"line\">sudo openssl req -new -key server.key -out server.csr</span><br><span class=\"line\">sudo cp server.key server.key.org</span><br><span class=\"line\">sudo openssl rsa -in server.key.org -out server.key</span><br><span class=\"line\">sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-在server区域，指定证书位置\"><a href=\"#2-2-在server区域，指定证书位置\" class=\"headerlink\" title=\"2.2 在server区域，指定证书位置\"></a>2.2 在server区域，指定证书位置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssl_certificate /path/server.crt;</span><br><span class=\"line\">ssl_certificate_key /path/server.key;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-启用ssl\"><a href=\"#2-3-启用ssl\" class=\"headerlink\" title=\"2.3 启用ssl\"></a>2.3 启用ssl</h3><p>修改nginx配置，启用ssl<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listen       443 ssl; </span><br><span class=\"line\">server_name  ssl.test.cn;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-4-将http的访问redirect到https\"><a href=\"#2-4-将http的访问redirect到https\" class=\"headerlink\" title=\"2.4 将http的访问redirect到https\"></a>2.4 将http的访问redirect到https</h3><p>在http区域添加如下内容<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">       listen       80;</span><br><span class=\"line\">       server_name  ssl.test.cn;;</span><br><span class=\"line\">       return 301 https://ssl.test.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3-生效配置\"><a href=\"#3-生效配置\" class=\"headerlink\" title=\"3. 生效配置\"></a>3. 生效配置</h2><p>重启或者<code>reload</code> nginx</p>\n<h2 id=\"4-测试\"><a href=\"#4-测试\" class=\"headerlink\" title=\"4. 测试\"></a>4. 测试</h2><p>浏览器访问<a href=\"http://ssl.test.cn，测试验证。\" target=\"_blank\" rel=\"noopener\">http://ssl.test.cn，测试验证。</a></p>\n"},{"title":"安装配置gitlab","date":"2017-08-02T13:51:17.000Z","_content":"\n## 1. 安装\n### 1.1 安装依赖\n```\nsudo apt-get install curl openssh-server ca-certificates postfix -y\n```\n### 1.2 下载安装包\n[安装包下载地址](https://packages.gitlab.com/gitlab/gitlab-ce)\n\n### 1.3 安装\n```\nsudo dpkg -i gitlab-ce_***.deb\n```\n至此，gitlab已经安装成功了。\n\n## 2. 配置\n### 2.1 修改配置文件\n配置文件为`/etc/gitlab/gitlab.rb`\n根据自己的需要修改该文件并保存。\n\n### 2.2 生效配置\n```\nsudo gitlab-ctl reconfigure\n```\n\n### 2.3 测试\n通过浏览器访问刚才配置的地址进行测试。  \n至此，通过gitlab自带的nginx已经可以访问gitlab了。\n\n---\n如果我们服务器上已有`nginx`，那么我们想要让所有访问都通过已有的`nginx`作为总的出入口。  \n## 3. 使用已有的nginx\n[setting-the-nginx-listen-port](https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#setting-the-nginx-listen-port)\n\n### 3.1 修改gitlab配置\n修改如下内容\n\n```\nexternal_url 'https://gitlab.xxx.cn' # 将http修改为https\nnginx['listen_addresses'] = ['127.0.0.1'] #这里修改为127.0.0.1\nnginx['listen_port'] = 28080 \n\nnginx['listen_https'] = false\nnginx['proxy_set_headers'] = { \n  \"X-Forwarded-Proto\" => \"https\",\n  \"X-Forwarded-Ssl\" => \"on\"\n}\n```\n\n生效配置\n```\nsudo gitlab-ctl reconfigure\n```\n\n### 3.2 配置已有的nginx\n#### 3.2.1 添加配置文件\n```\ncd opt/nginx-1.9/conf\nvi nginx.conf\n```\n内容如下\n```\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nupstream gitlab.hosts {\n    server 127.0.0.1:28080;\n}\n\nserver {\n    listen  80;\n    server_name  gitlab.xxx.cn;\n    return 301 https://gitlab.xxx.cn:443$request_uri;\n}\n\nserver {\n        #listen 80;\n        listen 443 ssl;\n        server_name gitlab.xxx.cn;\n        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/server.crt;\n        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/server.key;\n\n        proxy_read_timeout      3600;\n        proxy_connect_timeout   300;\n        proxy_redirect          off;\n        proxy_http_version 1.1;\n\n        proxy_set_header Host $http_host_with_default;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n        proxy_set_header X-Forwarded-Proto https;\n        proxy_set_header X-Forwarded-Ssl on;\n\n        location / {\n                proxy_redirect off;\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_pass http://gitlab.hosts;\n        }\n    }\n```\n\n#### 3.2.2 启动nginx\n```\ncd opt/nginx-1.9/\nsudo sbin/nginx -s reload\n```\n\n### 3.3 访问测试\n通过浏览器访问`gitlab.xxx.cn`，就可以访问使用了。  \n以上我们已经完成了`gitlab`的部署，并且配置了使用已有的`nginx`作为总的出入口。\n\n---\n如果我们之前已经有了`gitlab`，我们可能想要把之前的数据迁移进新的`gitlab`。  \n## 4. 迁移数据\n### 4.1 备份\n在原有gitlab服务器上执行如下命令，备份gitlab\n```\n# 以下两条命令可以防止在备份的过程中有人提交代码，不能将整个gitlab停止，因为备份数据需要用到某些服务\nsudo gitlab-ctl stop unicorn\nsudo gitlab-ctl stop sidekiq\n# 验证\nsudo gitlab-ctl status\n# 通过自带命令备份数据\nsudo gitlab-rake gitlab:backup:create\n# 备份之后将整个gitlab服务停止\nsudo gitlab-ctl stop\n# 将备份文件从gitlab/backups目录拷贝出来\ncd /mnt/data/gitlab\nsudo -s\ncd backups\nmv 1501564513_2017_08_01_gitlab_backup.tar /mnt/data\ncd /mnt/data\n\n# 修改用户属主属组\nsudo chown USERNAME:USERNAME 1501564513_2017_08_01_gitlab_backup.tar\n```\n\n### 4.2 导入\n\n#### 4.2.1 拷贝文件并修改权限\n将上一步备份的数据放到新的服务器的`gitlab/backups`目录下\n```\n# 修改文件的属主属组\nsudo chown git:git 1501564513_2017_08_01_gitlab_backup.tar\n修改gitlab目录的属主属组\nsudo chown git:git /mnt/data/gitlab\n```\n\n#### 4.2.2 导入数据\n```\n# 停掉如下两个服务\nsudo gitlab-ctl stop unicorn\nsudo gitlab-ctl stop sidekiq\n# 验证\nsudo gitlab-ctl status\n# 导入数据\nsudo gitlab-rake gitlab:backup:restore BACKUP=11501564513_2017_08_01\n```\n\n### 4.3 启动gitlab\n```\nsudo gitlab-ctl start\n```\n### 4.4 测试\n之前的数据已经导入到新的`gitlab`服务器。  \n现在可以通过原有的账号信息进行登陆验证。\n\n\n\n\n\n","source":"_posts/安装配置gitlab.md","raw":"---\ntitle: 安装配置gitlab\ndate: 2017-08-02 21:51:17\ntags: gitlab\n---\n\n## 1. 安装\n### 1.1 安装依赖\n```\nsudo apt-get install curl openssh-server ca-certificates postfix -y\n```\n### 1.2 下载安装包\n[安装包下载地址](https://packages.gitlab.com/gitlab/gitlab-ce)\n\n### 1.3 安装\n```\nsudo dpkg -i gitlab-ce_***.deb\n```\n至此，gitlab已经安装成功了。\n\n## 2. 配置\n### 2.1 修改配置文件\n配置文件为`/etc/gitlab/gitlab.rb`\n根据自己的需要修改该文件并保存。\n\n### 2.2 生效配置\n```\nsudo gitlab-ctl reconfigure\n```\n\n### 2.3 测试\n通过浏览器访问刚才配置的地址进行测试。  \n至此，通过gitlab自带的nginx已经可以访问gitlab了。\n\n---\n如果我们服务器上已有`nginx`，那么我们想要让所有访问都通过已有的`nginx`作为总的出入口。  \n## 3. 使用已有的nginx\n[setting-the-nginx-listen-port](https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#setting-the-nginx-listen-port)\n\n### 3.1 修改gitlab配置\n修改如下内容\n\n```\nexternal_url 'https://gitlab.xxx.cn' # 将http修改为https\nnginx['listen_addresses'] = ['127.0.0.1'] #这里修改为127.0.0.1\nnginx['listen_port'] = 28080 \n\nnginx['listen_https'] = false\nnginx['proxy_set_headers'] = { \n  \"X-Forwarded-Proto\" => \"https\",\n  \"X-Forwarded-Ssl\" => \"on\"\n}\n```\n\n生效配置\n```\nsudo gitlab-ctl reconfigure\n```\n\n### 3.2 配置已有的nginx\n#### 3.2.1 添加配置文件\n```\ncd opt/nginx-1.9/conf\nvi nginx.conf\n```\n内容如下\n```\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    ''      close;\n}\n\nupstream gitlab.hosts {\n    server 127.0.0.1:28080;\n}\n\nserver {\n    listen  80;\n    server_name  gitlab.xxx.cn;\n    return 301 https://gitlab.xxx.cn:443$request_uri;\n}\n\nserver {\n        #listen 80;\n        listen 443 ssl;\n        server_name gitlab.xxx.cn;\n        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/server.crt;\n        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/server.key;\n\n        proxy_read_timeout      3600;\n        proxy_connect_timeout   300;\n        proxy_redirect          off;\n        proxy_http_version 1.1;\n\n        proxy_set_header Host $http_host_with_default;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n        proxy_set_header X-Forwarded-Proto https;\n        proxy_set_header X-Forwarded-Ssl on;\n\n        location / {\n                proxy_redirect off;\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_pass http://gitlab.hosts;\n        }\n    }\n```\n\n#### 3.2.2 启动nginx\n```\ncd opt/nginx-1.9/\nsudo sbin/nginx -s reload\n```\n\n### 3.3 访问测试\n通过浏览器访问`gitlab.xxx.cn`，就可以访问使用了。  \n以上我们已经完成了`gitlab`的部署，并且配置了使用已有的`nginx`作为总的出入口。\n\n---\n如果我们之前已经有了`gitlab`，我们可能想要把之前的数据迁移进新的`gitlab`。  \n## 4. 迁移数据\n### 4.1 备份\n在原有gitlab服务器上执行如下命令，备份gitlab\n```\n# 以下两条命令可以防止在备份的过程中有人提交代码，不能将整个gitlab停止，因为备份数据需要用到某些服务\nsudo gitlab-ctl stop unicorn\nsudo gitlab-ctl stop sidekiq\n# 验证\nsudo gitlab-ctl status\n# 通过自带命令备份数据\nsudo gitlab-rake gitlab:backup:create\n# 备份之后将整个gitlab服务停止\nsudo gitlab-ctl stop\n# 将备份文件从gitlab/backups目录拷贝出来\ncd /mnt/data/gitlab\nsudo -s\ncd backups\nmv 1501564513_2017_08_01_gitlab_backup.tar /mnt/data\ncd /mnt/data\n\n# 修改用户属主属组\nsudo chown USERNAME:USERNAME 1501564513_2017_08_01_gitlab_backup.tar\n```\n\n### 4.2 导入\n\n#### 4.2.1 拷贝文件并修改权限\n将上一步备份的数据放到新的服务器的`gitlab/backups`目录下\n```\n# 修改文件的属主属组\nsudo chown git:git 1501564513_2017_08_01_gitlab_backup.tar\n修改gitlab目录的属主属组\nsudo chown git:git /mnt/data/gitlab\n```\n\n#### 4.2.2 导入数据\n```\n# 停掉如下两个服务\nsudo gitlab-ctl stop unicorn\nsudo gitlab-ctl stop sidekiq\n# 验证\nsudo gitlab-ctl status\n# 导入数据\nsudo gitlab-rake gitlab:backup:restore BACKUP=11501564513_2017_08_01\n```\n\n### 4.3 启动gitlab\n```\nsudo gitlab-ctl start\n```\n### 4.4 测试\n之前的数据已经导入到新的`gitlab`服务器。  \n现在可以通过原有的账号信息进行登陆验证。\n\n\n\n\n\n","slug":"安装配置gitlab","published":1,"updated":"2018-12-09T02:27:37.781Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5e002ezahiz3sp6dfd","content":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><h3 id=\"1-1-安装依赖\"><a href=\"#1-1-安装依赖\" class=\"headerlink\" title=\"1.1 安装依赖\"></a>1.1 安装依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install curl openssh-server ca-certificates postfix -y</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-下载安装包\"><a href=\"#1-2-下载安装包\" class=\"headerlink\" title=\"1.2 下载安装包\"></a>1.2 下载安装包</h3><p><a href=\"https://packages.gitlab.com/gitlab/gitlab-ce\" target=\"_blank\" rel=\"noopener\">安装包下载地址</a></p>\n<h3 id=\"1-3-安装\"><a href=\"#1-3-安装\" class=\"headerlink\" title=\"1.3 安装\"></a>1.3 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -i gitlab-ce_***.deb</span><br></pre></td></tr></table></figure>\n<p>至此，gitlab已经安装成功了。</p>\n<h2 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2. 配置\"></a>2. 配置</h2><h3 id=\"2-1-修改配置文件\"><a href=\"#2-1-修改配置文件\" class=\"headerlink\" title=\"2.1 修改配置文件\"></a>2.1 修改配置文件</h3><p>配置文件为<code>/etc/gitlab/gitlab.rb</code><br>根据自己的需要修改该文件并保存。</p>\n<h3 id=\"2-2-生效配置\"><a href=\"#2-2-生效配置\" class=\"headerlink\" title=\"2.2 生效配置\"></a>2.2 生效配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-测试\"><a href=\"#2-3-测试\" class=\"headerlink\" title=\"2.3 测试\"></a>2.3 测试</h3><p>通过浏览器访问刚才配置的地址进行测试。<br>至此，通过gitlab自带的nginx已经可以访问gitlab了。</p>\n<hr>\n<p>如果我们服务器上已有<code>nginx</code>，那么我们想要让所有访问都通过已有的<code>nginx</code>作为总的出入口。  </p>\n<h2 id=\"3-使用已有的nginx\"><a href=\"#3-使用已有的nginx\" class=\"headerlink\" title=\"3. 使用已有的nginx\"></a>3. 使用已有的nginx</h2><p><a href=\"https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#setting-the-nginx-listen-port\" target=\"_blank\" rel=\"noopener\">setting-the-nginx-listen-port</a></p>\n<h3 id=\"3-1-修改gitlab配置\"><a href=\"#3-1-修改gitlab配置\" class=\"headerlink\" title=\"3.1 修改gitlab配置\"></a>3.1 修改gitlab配置</h3><p>修改如下内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">external_url &apos;https://gitlab.xxx.cn&apos; # 将http修改为https</span><br><span class=\"line\">nginx[&apos;listen_addresses&apos;] = [&apos;127.0.0.1&apos;] #这里修改为127.0.0.1</span><br><span class=\"line\">nginx[&apos;listen_port&apos;] = 28080 </span><br><span class=\"line\"></span><br><span class=\"line\">nginx[&apos;listen_https&apos;] = false</span><br><span class=\"line\">nginx[&apos;proxy_set_headers&apos;] = &#123; </span><br><span class=\"line\">  &quot;X-Forwarded-Proto&quot; =&gt; &quot;https&quot;,</span><br><span class=\"line\">  &quot;X-Forwarded-Ssl&quot; =&gt; &quot;on&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>生效配置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-2-配置已有的nginx\"><a href=\"#3-2-配置已有的nginx\" class=\"headerlink\" title=\"3.2 配置已有的nginx\"></a>3.2 配置已有的nginx</h3><h4 id=\"3-2-1-添加配置文件\"><a href=\"#3-2-1-添加配置文件\" class=\"headerlink\" title=\"3.2.1 添加配置文件\"></a>3.2.1 添加配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd opt/nginx-1.9/conf</span><br><span class=\"line\">vi nginx.conf</span><br></pre></td></tr></table></figure>\n<p>内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map $http_upgrade $connection_upgrade &#123;</span><br><span class=\"line\">    default upgrade;</span><br><span class=\"line\">    &apos;&apos;      close;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">upstream gitlab.hosts &#123;</span><br><span class=\"line\">    server 127.0.0.1:28080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen  80;</span><br><span class=\"line\">    server_name  gitlab.xxx.cn;</span><br><span class=\"line\">    return 301 https://gitlab.xxx.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        #listen 80;</span><br><span class=\"line\">        listen 443 ssl;</span><br><span class=\"line\">        server_name gitlab.xxx.cn;</span><br><span class=\"line\">        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/server.crt;</span><br><span class=\"line\">        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/server.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        proxy_read_timeout      3600;</span><br><span class=\"line\">        proxy_connect_timeout   300;</span><br><span class=\"line\">        proxy_redirect          off;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\"></span><br><span class=\"line\">        proxy_set_header Host $http_host_with_default;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection $connection_upgrade;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto https;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Ssl on;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                proxy_redirect off;</span><br><span class=\"line\">                proxy_set_header Host $host;</span><br><span class=\"line\">                proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">                proxy_pass http://gitlab.hosts;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"3-2-2-启动nginx\"><a href=\"#3-2-2-启动nginx\" class=\"headerlink\" title=\"3.2.2 启动nginx\"></a>3.2.2 启动nginx</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd opt/nginx-1.9/</span><br><span class=\"line\">sudo sbin/nginx -s reload</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-访问测试\"><a href=\"#3-3-访问测试\" class=\"headerlink\" title=\"3.3 访问测试\"></a>3.3 访问测试</h3><p>通过浏览器访问<code>gitlab.xxx.cn</code>，就可以访问使用了。<br>以上我们已经完成了<code>gitlab</code>的部署，并且配置了使用已有的<code>nginx</code>作为总的出入口。</p>\n<hr>\n<p>如果我们之前已经有了<code>gitlab</code>，我们可能想要把之前的数据迁移进新的<code>gitlab</code>。  </p>\n<h2 id=\"4-迁移数据\"><a href=\"#4-迁移数据\" class=\"headerlink\" title=\"4. 迁移数据\"></a>4. 迁移数据</h2><h3 id=\"4-1-备份\"><a href=\"#4-1-备份\" class=\"headerlink\" title=\"4.1 备份\"></a>4.1 备份</h3><p>在原有gitlab服务器上执行如下命令，备份gitlab<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 以下两条命令可以防止在备份的过程中有人提交代码，不能将整个gitlab停止，因为备份数据需要用到某些服务</span><br><span class=\"line\">sudo gitlab-ctl stop unicorn</span><br><span class=\"line\">sudo gitlab-ctl stop sidekiq</span><br><span class=\"line\"># 验证</span><br><span class=\"line\">sudo gitlab-ctl status</span><br><span class=\"line\"># 通过自带命令备份数据</span><br><span class=\"line\">sudo gitlab-rake gitlab:backup:create</span><br><span class=\"line\"># 备份之后将整个gitlab服务停止</span><br><span class=\"line\">sudo gitlab-ctl stop</span><br><span class=\"line\"># 将备份文件从gitlab/backups目录拷贝出来</span><br><span class=\"line\">cd /mnt/data/gitlab</span><br><span class=\"line\">sudo -s</span><br><span class=\"line\">cd backups</span><br><span class=\"line\">mv 1501564513_2017_08_01_gitlab_backup.tar /mnt/data</span><br><span class=\"line\">cd /mnt/data</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改用户属主属组</span><br><span class=\"line\">sudo chown USERNAME:USERNAME 1501564513_2017_08_01_gitlab_backup.tar</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"4-2-导入\"><a href=\"#4-2-导入\" class=\"headerlink\" title=\"4.2 导入\"></a>4.2 导入</h3><h4 id=\"4-2-1-拷贝文件并修改权限\"><a href=\"#4-2-1-拷贝文件并修改权限\" class=\"headerlink\" title=\"4.2.1 拷贝文件并修改权限\"></a>4.2.1 拷贝文件并修改权限</h4><p>将上一步备份的数据放到新的服务器的<code>gitlab/backups</code>目录下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改文件的属主属组</span><br><span class=\"line\">sudo chown git:git 1501564513_2017_08_01_gitlab_backup.tar</span><br><span class=\"line\">修改gitlab目录的属主属组</span><br><span class=\"line\">sudo chown git:git /mnt/data/gitlab</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"4-2-2-导入数据\"><a href=\"#4-2-2-导入数据\" class=\"headerlink\" title=\"4.2.2 导入数据\"></a>4.2.2 导入数据</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 停掉如下两个服务</span><br><span class=\"line\">sudo gitlab-ctl stop unicorn</span><br><span class=\"line\">sudo gitlab-ctl stop sidekiq</span><br><span class=\"line\"># 验证</span><br><span class=\"line\">sudo gitlab-ctl status</span><br><span class=\"line\"># 导入数据</span><br><span class=\"line\">sudo gitlab-rake gitlab:backup:restore BACKUP=11501564513_2017_08_01</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-启动gitlab\"><a href=\"#4-3-启动gitlab\" class=\"headerlink\" title=\"4.3 启动gitlab\"></a>4.3 启动gitlab</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gitlab-ctl start</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-4-测试\"><a href=\"#4-4-测试\" class=\"headerlink\" title=\"4.4 测试\"></a>4.4 测试</h3><p>之前的数据已经导入到新的<code>gitlab</code>服务器。<br>现在可以通过原有的账号信息进行登陆验证。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><h3 id=\"1-1-安装依赖\"><a href=\"#1-1-安装依赖\" class=\"headerlink\" title=\"1.1 安装依赖\"></a>1.1 安装依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install curl openssh-server ca-certificates postfix -y</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-2-下载安装包\"><a href=\"#1-2-下载安装包\" class=\"headerlink\" title=\"1.2 下载安装包\"></a>1.2 下载安装包</h3><p><a href=\"https://packages.gitlab.com/gitlab/gitlab-ce\" target=\"_blank\" rel=\"noopener\">安装包下载地址</a></p>\n<h3 id=\"1-3-安装\"><a href=\"#1-3-安装\" class=\"headerlink\" title=\"1.3 安装\"></a>1.3 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -i gitlab-ce_***.deb</span><br></pre></td></tr></table></figure>\n<p>至此，gitlab已经安装成功了。</p>\n<h2 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2. 配置\"></a>2. 配置</h2><h3 id=\"2-1-修改配置文件\"><a href=\"#2-1-修改配置文件\" class=\"headerlink\" title=\"2.1 修改配置文件\"></a>2.1 修改配置文件</h3><p>配置文件为<code>/etc/gitlab/gitlab.rb</code><br>根据自己的需要修改该文件并保存。</p>\n<h3 id=\"2-2-生效配置\"><a href=\"#2-2-生效配置\" class=\"headerlink\" title=\"2.2 生效配置\"></a>2.2 生效配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-3-测试\"><a href=\"#2-3-测试\" class=\"headerlink\" title=\"2.3 测试\"></a>2.3 测试</h3><p>通过浏览器访问刚才配置的地址进行测试。<br>至此，通过gitlab自带的nginx已经可以访问gitlab了。</p>\n<hr>\n<p>如果我们服务器上已有<code>nginx</code>，那么我们想要让所有访问都通过已有的<code>nginx</code>作为总的出入口。  </p>\n<h2 id=\"3-使用已有的nginx\"><a href=\"#3-使用已有的nginx\" class=\"headerlink\" title=\"3. 使用已有的nginx\"></a>3. 使用已有的nginx</h2><p><a href=\"https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md#setting-the-nginx-listen-port\" target=\"_blank\" rel=\"noopener\">setting-the-nginx-listen-port</a></p>\n<h3 id=\"3-1-修改gitlab配置\"><a href=\"#3-1-修改gitlab配置\" class=\"headerlink\" title=\"3.1 修改gitlab配置\"></a>3.1 修改gitlab配置</h3><p>修改如下内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">external_url &apos;https://gitlab.xxx.cn&apos; # 将http修改为https</span><br><span class=\"line\">nginx[&apos;listen_addresses&apos;] = [&apos;127.0.0.1&apos;] #这里修改为127.0.0.1</span><br><span class=\"line\">nginx[&apos;listen_port&apos;] = 28080 </span><br><span class=\"line\"></span><br><span class=\"line\">nginx[&apos;listen_https&apos;] = false</span><br><span class=\"line\">nginx[&apos;proxy_set_headers&apos;] = &#123; </span><br><span class=\"line\">  &quot;X-Forwarded-Proto&quot; =&gt; &quot;https&quot;,</span><br><span class=\"line\">  &quot;X-Forwarded-Ssl&quot; =&gt; &quot;on&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>生效配置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"3-2-配置已有的nginx\"><a href=\"#3-2-配置已有的nginx\" class=\"headerlink\" title=\"3.2 配置已有的nginx\"></a>3.2 配置已有的nginx</h3><h4 id=\"3-2-1-添加配置文件\"><a href=\"#3-2-1-添加配置文件\" class=\"headerlink\" title=\"3.2.1 添加配置文件\"></a>3.2.1 添加配置文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd opt/nginx-1.9/conf</span><br><span class=\"line\">vi nginx.conf</span><br></pre></td></tr></table></figure>\n<p>内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map $http_upgrade $connection_upgrade &#123;</span><br><span class=\"line\">    default upgrade;</span><br><span class=\"line\">    &apos;&apos;      close;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">upstream gitlab.hosts &#123;</span><br><span class=\"line\">    server 127.0.0.1:28080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen  80;</span><br><span class=\"line\">    server_name  gitlab.xxx.cn;</span><br><span class=\"line\">    return 301 https://gitlab.xxx.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        #listen 80;</span><br><span class=\"line\">        listen 443 ssl;</span><br><span class=\"line\">        server_name gitlab.xxx.cn;</span><br><span class=\"line\">        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/server.crt;</span><br><span class=\"line\">        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/server.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        proxy_read_timeout      3600;</span><br><span class=\"line\">        proxy_connect_timeout   300;</span><br><span class=\"line\">        proxy_redirect          off;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\"></span><br><span class=\"line\">        proxy_set_header Host $http_host_with_default;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection $connection_upgrade;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto https;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Ssl on;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                proxy_redirect off;</span><br><span class=\"line\">                proxy_set_header Host $host;</span><br><span class=\"line\">                proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">                proxy_pass http://gitlab.hosts;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"3-2-2-启动nginx\"><a href=\"#3-2-2-启动nginx\" class=\"headerlink\" title=\"3.2.2 启动nginx\"></a>3.2.2 启动nginx</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd opt/nginx-1.9/</span><br><span class=\"line\">sudo sbin/nginx -s reload</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-访问测试\"><a href=\"#3-3-访问测试\" class=\"headerlink\" title=\"3.3 访问测试\"></a>3.3 访问测试</h3><p>通过浏览器访问<code>gitlab.xxx.cn</code>，就可以访问使用了。<br>以上我们已经完成了<code>gitlab</code>的部署，并且配置了使用已有的<code>nginx</code>作为总的出入口。</p>\n<hr>\n<p>如果我们之前已经有了<code>gitlab</code>，我们可能想要把之前的数据迁移进新的<code>gitlab</code>。  </p>\n<h2 id=\"4-迁移数据\"><a href=\"#4-迁移数据\" class=\"headerlink\" title=\"4. 迁移数据\"></a>4. 迁移数据</h2><h3 id=\"4-1-备份\"><a href=\"#4-1-备份\" class=\"headerlink\" title=\"4.1 备份\"></a>4.1 备份</h3><p>在原有gitlab服务器上执行如下命令，备份gitlab<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 以下两条命令可以防止在备份的过程中有人提交代码，不能将整个gitlab停止，因为备份数据需要用到某些服务</span><br><span class=\"line\">sudo gitlab-ctl stop unicorn</span><br><span class=\"line\">sudo gitlab-ctl stop sidekiq</span><br><span class=\"line\"># 验证</span><br><span class=\"line\">sudo gitlab-ctl status</span><br><span class=\"line\"># 通过自带命令备份数据</span><br><span class=\"line\">sudo gitlab-rake gitlab:backup:create</span><br><span class=\"line\"># 备份之后将整个gitlab服务停止</span><br><span class=\"line\">sudo gitlab-ctl stop</span><br><span class=\"line\"># 将备份文件从gitlab/backups目录拷贝出来</span><br><span class=\"line\">cd /mnt/data/gitlab</span><br><span class=\"line\">sudo -s</span><br><span class=\"line\">cd backups</span><br><span class=\"line\">mv 1501564513_2017_08_01_gitlab_backup.tar /mnt/data</span><br><span class=\"line\">cd /mnt/data</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改用户属主属组</span><br><span class=\"line\">sudo chown USERNAME:USERNAME 1501564513_2017_08_01_gitlab_backup.tar</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"4-2-导入\"><a href=\"#4-2-导入\" class=\"headerlink\" title=\"4.2 导入\"></a>4.2 导入</h3><h4 id=\"4-2-1-拷贝文件并修改权限\"><a href=\"#4-2-1-拷贝文件并修改权限\" class=\"headerlink\" title=\"4.2.1 拷贝文件并修改权限\"></a>4.2.1 拷贝文件并修改权限</h4><p>将上一步备份的数据放到新的服务器的<code>gitlab/backups</code>目录下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改文件的属主属组</span><br><span class=\"line\">sudo chown git:git 1501564513_2017_08_01_gitlab_backup.tar</span><br><span class=\"line\">修改gitlab目录的属主属组</span><br><span class=\"line\">sudo chown git:git /mnt/data/gitlab</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"4-2-2-导入数据\"><a href=\"#4-2-2-导入数据\" class=\"headerlink\" title=\"4.2.2 导入数据\"></a>4.2.2 导入数据</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 停掉如下两个服务</span><br><span class=\"line\">sudo gitlab-ctl stop unicorn</span><br><span class=\"line\">sudo gitlab-ctl stop sidekiq</span><br><span class=\"line\"># 验证</span><br><span class=\"line\">sudo gitlab-ctl status</span><br><span class=\"line\"># 导入数据</span><br><span class=\"line\">sudo gitlab-rake gitlab:backup:restore BACKUP=11501564513_2017_08_01</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-启动gitlab\"><a href=\"#4-3-启动gitlab\" class=\"headerlink\" title=\"4.3 启动gitlab\"></a>4.3 启动gitlab</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gitlab-ctl start</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-4-测试\"><a href=\"#4-4-测试\" class=\"headerlink\" title=\"4.4 测试\"></a>4.4 测试</h3><p>之前的数据已经导入到新的<code>gitlab</code>服务器。<br>现在可以通过原有的账号信息进行登陆验证。</p>\n"},{"title":"开源项目管理系统-zentao","date":"2017-08-18T13:38:11.000Z","_content":"## 1.下载zentao的安装包并解压\n\n禅道的安装方式跟上一篇`《mediawiki》`安装方式类似。\n禅道官网在[这里](https://www.zentao.net/)\n```\nmv mediawiki-1.27.3.tar.gz /mnt/data/\ncd /mnt/data\nunzip ZenTaoPMS.8.1.stable.zip\n```\n## 2. 进行域名解析\n将要使用的域名(例如`zentao.xxx.cn`)解析到该服务器。\n\n## 3. 配置nginx\n```\nserver {\n    listen  80;\n    server_name  zentao.xxx.cn;\n    return 301 https://zentao.xxx.cn:443$request_uri;\n}\n\nserver {\n        listen       443 ssl;\n        server_name  zentao.xxx.cn;\n\n        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.crt;\n        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.key;\n\n        root    /mnt/data/zentaopms;\n        index index.php index.html index.htm;\n        location ~ \\.php$ {\n             root   /mnt/data/zentaopms/www;\n             fastcgi_pass 127.0.0.1:9000;\n             fastcgi_index index.php;\n             fastcgi_param  SCRIPT_FILENAME /scripts$fastcgi_script_name;\n             include fastcgi.conf;\n        }\n\n        location / {\n             root               /mnt/data/zentaopms/www;\n             index index.php;\n        }\n}\n```\n\n## 4. 安装\n通过浏览器访问`http://zentao.xxx.cn`，配置安装`zentao`即可。\n确保mysql的账户密码信息正确。\n\n\n\n","source":"_posts/开源项目管理系统-zentao.md","raw":"---\ntitle: 开源项目管理系统-zentao\ndate: 2017-08-18 21:38:11\ntags:\n---\n## 1.下载zentao的安装包并解压\n\n禅道的安装方式跟上一篇`《mediawiki》`安装方式类似。\n禅道官网在[这里](https://www.zentao.net/)\n```\nmv mediawiki-1.27.3.tar.gz /mnt/data/\ncd /mnt/data\nunzip ZenTaoPMS.8.1.stable.zip\n```\n## 2. 进行域名解析\n将要使用的域名(例如`zentao.xxx.cn`)解析到该服务器。\n\n## 3. 配置nginx\n```\nserver {\n    listen  80;\n    server_name  zentao.xxx.cn;\n    return 301 https://zentao.xxx.cn:443$request_uri;\n}\n\nserver {\n        listen       443 ssl;\n        server_name  zentao.xxx.cn;\n\n        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.crt;\n        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.key;\n\n        root    /mnt/data/zentaopms;\n        index index.php index.html index.htm;\n        location ~ \\.php$ {\n             root   /mnt/data/zentaopms/www;\n             fastcgi_pass 127.0.0.1:9000;\n             fastcgi_index index.php;\n             fastcgi_param  SCRIPT_FILENAME /scripts$fastcgi_script_name;\n             include fastcgi.conf;\n        }\n\n        location / {\n             root               /mnt/data/zentaopms/www;\n             index index.php;\n        }\n}\n```\n\n## 4. 安装\n通过浏览器访问`http://zentao.xxx.cn`，配置安装`zentao`即可。\n确保mysql的账户密码信息正确。\n\n\n\n","slug":"开源项目管理系统-zentao","published":1,"updated":"2018-12-08T09:51:16.655Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5e002gzahis197mrno","content":"<h2 id=\"1-下载zentao的安装包并解压\"><a href=\"#1-下载zentao的安装包并解压\" class=\"headerlink\" title=\"1.下载zentao的安装包并解压\"></a>1.下载zentao的安装包并解压</h2><p>禅道的安装方式跟上一篇<code>《mediawiki》</code>安装方式类似。<br>禅道官网在<a href=\"https://www.zentao.net/\" target=\"_blank\" rel=\"noopener\">这里</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv mediawiki-1.27.3.tar.gz /mnt/data/</span><br><span class=\"line\">cd /mnt/data</span><br><span class=\"line\">unzip ZenTaoPMS.8.1.stable.zip</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-进行域名解析\"><a href=\"#2-进行域名解析\" class=\"headerlink\" title=\"2. 进行域名解析\"></a>2. 进行域名解析</h2><p>将要使用的域名(例如<code>zentao.xxx.cn</code>)解析到该服务器。</p>\n<h2 id=\"3-配置nginx\"><a href=\"#3-配置nginx\" class=\"headerlink\" title=\"3. 配置nginx\"></a>3. 配置nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen  80;</span><br><span class=\"line\">    server_name  zentao.xxx.cn;</span><br><span class=\"line\">    return 301 https://zentao.xxx.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       443 ssl;</span><br><span class=\"line\">        server_name  zentao.xxx.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.crt;</span><br><span class=\"line\">        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        root    /mnt/data/zentaopms;</span><br><span class=\"line\">        index index.php index.html index.htm;</span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">             root   /mnt/data/zentaopms/www;</span><br><span class=\"line\">             fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">             fastcgi_index index.php;</span><br><span class=\"line\">             fastcgi_param  SCRIPT_FILENAME /scripts$fastcgi_script_name;</span><br><span class=\"line\">             include fastcgi.conf;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">             root               /mnt/data/zentaopms/www;</span><br><span class=\"line\">             index index.php;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-安装\"><a href=\"#4-安装\" class=\"headerlink\" title=\"4. 安装\"></a>4. 安装</h2><p>通过浏览器访问<code>http://zentao.xxx.cn</code>，配置安装<code>zentao</code>即可。<br>确保mysql的账户密码信息正确。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-下载zentao的安装包并解压\"><a href=\"#1-下载zentao的安装包并解压\" class=\"headerlink\" title=\"1.下载zentao的安装包并解压\"></a>1.下载zentao的安装包并解压</h2><p>禅道的安装方式跟上一篇<code>《mediawiki》</code>安装方式类似。<br>禅道官网在<a href=\"https://www.zentao.net/\" target=\"_blank\" rel=\"noopener\">这里</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv mediawiki-1.27.3.tar.gz /mnt/data/</span><br><span class=\"line\">cd /mnt/data</span><br><span class=\"line\">unzip ZenTaoPMS.8.1.stable.zip</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"2-进行域名解析\"><a href=\"#2-进行域名解析\" class=\"headerlink\" title=\"2. 进行域名解析\"></a>2. 进行域名解析</h2><p>将要使用的域名(例如<code>zentao.xxx.cn</code>)解析到该服务器。</p>\n<h2 id=\"3-配置nginx\"><a href=\"#3-配置nginx\" class=\"headerlink\" title=\"3. 配置nginx\"></a>3. 配置nginx</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen  80;</span><br><span class=\"line\">    server_name  zentao.xxx.cn;</span><br><span class=\"line\">    return 301 https://zentao.xxx.cn:443$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">        listen       443 ssl;</span><br><span class=\"line\">        server_name  zentao.xxx.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.crt;</span><br><span class=\"line\">        ssl_certificate_key /home/USERNAME/opt/nginx-1.9/conf/etc/zentao-server.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        root    /mnt/data/zentaopms;</span><br><span class=\"line\">        index index.php index.html index.htm;</span><br><span class=\"line\">        location ~ \\.php$ &#123;</span><br><span class=\"line\">             root   /mnt/data/zentaopms/www;</span><br><span class=\"line\">             fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">             fastcgi_index index.php;</span><br><span class=\"line\">             fastcgi_param  SCRIPT_FILENAME /scripts$fastcgi_script_name;</span><br><span class=\"line\">             include fastcgi.conf;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">             root               /mnt/data/zentaopms/www;</span><br><span class=\"line\">             index index.php;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-安装\"><a href=\"#4-安装\" class=\"headerlink\" title=\"4. 安装\"></a>4. 安装</h2><p>通过浏览器访问<code>http://zentao.xxx.cn</code>，配置安装<code>zentao</code>即可。<br>确保mysql的账户密码信息正确。</p>\n"},{"title":"更换linux系统的home磁盘","date":"2017-04-01T12:50:55.000Z","_content":"\n## 1. 源由\n由于大量项目放到`/home`里且初期规划不合理导致磁盘空间严重不足，故需要择机对该磁盘进行更换，重新挂载到一块容量比较大的磁盘上，以满足日益增长的业务需求。\n\n\n## 2. 添加磁盘并挂载\n添加完磁盘，首先需要对磁盘进行分区格式化  \n\n**部分常用`fdisk`命令如下**  \n\n| command     | action     |\n|:---------|:-----------|  \n| l       | list known partition types |  \n| n       | add a new partition     |\n| p       | print the partition     |\n| d       | delete a partition      |\n| q       | quit without saving changes     |\n| w       |  write table to disk and exit     |    \n\n### 2.1 分区\n<font color=red>分区时，要注意先通过`fdisk -l`命令，确定接下来要进行操作的设备文件名。  \n之下的步骤，每一步都要格外仔细，一不小心就会造成数据丢失！</font>  \n例如：我确认我新添的磁盘为`/dev/vdbc`，那进行分区的命令如下\n```\nsudo fdisk /dev/xvdc\n```\n\n### 2.2 格式化\n通过`-t`指定磁盘要格式化成的类型，这里我要格式化成`ext4`\n```\nsudo mkfs -t ext4 /dev/xvdc1\n```\n\n### 2.3 创建临时挂载目录\n```\nsudo mkdir /mnt/tmp-home\n```\n\n### 2.4 挂载磁盘\n```\nsudo mount /dev/xvdc1 /mnt/tmp-home\n```\n至此，新添的磁盘已经进行了分区，格式化，挂载操作。  \n接下来进行数据迁移，把之前的数据迁移到新磁盘上。\n\n## 3. 同步数据\n```\nrsync -avzrt --delete-after /home/USERNAME /mnt/tmp-home/\n```\n\n## 4. 重命名之前的home目录\n```\nsudo mv /home/USERNAME /home/USERNAME-orig\n```\n\n## 5. 对比数据  \n对比原来的`home`目录和新`home`目录的数据。  \n例如：通过`du`命令来对比大小。\n```\ndu -sh /home/USERNAME-orig\ndu -sh /mnt/tmp-home\n```\n\n## 6. 备份源数据\n数据迁移完成后，可以将`USERNAME-orig`迁移到`/`下进行备份。\n\n## 7. 自动挂载\n```\nsudo vi /etc/fstab\n# 写入如下内容\n/dev/xvdc1    /home    ext4      defaults    0  0\n```\n\n## 8. 重启服务器\n```\nsudo shutdown -r now\n```\n\n## 9. 验证\n待服务器重启后，验证各个服务是否能够正常启动，尤其时`/home/USERNAME`下的项目能否正常运行。\n\n\n## 10. 清除备份文件\n验证各个服务和项目，在迁移到新的`/home`运行正常且稳定一段时间后，可以择机对原备份文件进行清理。\n\n\n\n","source":"_posts/更换linux系统的home磁盘.md","raw":"---\ntitle: 更换linux系统的home磁盘\ndate: 2017-04-01 20:50:55\ntags: linux\n---\n\n## 1. 源由\n由于大量项目放到`/home`里且初期规划不合理导致磁盘空间严重不足，故需要择机对该磁盘进行更换，重新挂载到一块容量比较大的磁盘上，以满足日益增长的业务需求。\n\n\n## 2. 添加磁盘并挂载\n添加完磁盘，首先需要对磁盘进行分区格式化  \n\n**部分常用`fdisk`命令如下**  \n\n| command     | action     |\n|:---------|:-----------|  \n| l       | list known partition types |  \n| n       | add a new partition     |\n| p       | print the partition     |\n| d       | delete a partition      |\n| q       | quit without saving changes     |\n| w       |  write table to disk and exit     |    \n\n### 2.1 分区\n<font color=red>分区时，要注意先通过`fdisk -l`命令，确定接下来要进行操作的设备文件名。  \n之下的步骤，每一步都要格外仔细，一不小心就会造成数据丢失！</font>  \n例如：我确认我新添的磁盘为`/dev/vdbc`，那进行分区的命令如下\n```\nsudo fdisk /dev/xvdc\n```\n\n### 2.2 格式化\n通过`-t`指定磁盘要格式化成的类型，这里我要格式化成`ext4`\n```\nsudo mkfs -t ext4 /dev/xvdc1\n```\n\n### 2.3 创建临时挂载目录\n```\nsudo mkdir /mnt/tmp-home\n```\n\n### 2.4 挂载磁盘\n```\nsudo mount /dev/xvdc1 /mnt/tmp-home\n```\n至此，新添的磁盘已经进行了分区，格式化，挂载操作。  \n接下来进行数据迁移，把之前的数据迁移到新磁盘上。\n\n## 3. 同步数据\n```\nrsync -avzrt --delete-after /home/USERNAME /mnt/tmp-home/\n```\n\n## 4. 重命名之前的home目录\n```\nsudo mv /home/USERNAME /home/USERNAME-orig\n```\n\n## 5. 对比数据  \n对比原来的`home`目录和新`home`目录的数据。  \n例如：通过`du`命令来对比大小。\n```\ndu -sh /home/USERNAME-orig\ndu -sh /mnt/tmp-home\n```\n\n## 6. 备份源数据\n数据迁移完成后，可以将`USERNAME-orig`迁移到`/`下进行备份。\n\n## 7. 自动挂载\n```\nsudo vi /etc/fstab\n# 写入如下内容\n/dev/xvdc1    /home    ext4      defaults    0  0\n```\n\n## 8. 重启服务器\n```\nsudo shutdown -r now\n```\n\n## 9. 验证\n待服务器重启后，验证各个服务是否能够正常启动，尤其时`/home/USERNAME`下的项目能否正常运行。\n\n\n## 10. 清除备份文件\n验证各个服务和项目，在迁移到新的`/home`运行正常且稳定一段时间后，可以择机对原备份文件进行清理。\n\n\n\n","slug":"更换linux系统的home磁盘","published":1,"updated":"2018-12-08T08:31:12.262Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5f002izahi6m9fsrlx","content":"<h2 id=\"1-源由\"><a href=\"#1-源由\" class=\"headerlink\" title=\"1. 源由\"></a>1. 源由</h2><p>由于大量项目放到<code>/home</code>里且初期规划不合理导致磁盘空间严重不足，故需要择机对该磁盘进行更换，重新挂载到一块容量比较大的磁盘上，以满足日益增长的业务需求。</p>\n<h2 id=\"2-添加磁盘并挂载\"><a href=\"#2-添加磁盘并挂载\" class=\"headerlink\" title=\"2. 添加磁盘并挂载\"></a>2. 添加磁盘并挂载</h2><p>添加完磁盘，首先需要对磁盘进行分区格式化  </p>\n<p><strong>部分常用<code>fdisk</code>命令如下</strong>  </p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">command</th>\n<th style=\"text-align:left\">action</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">l</td>\n<td style=\"text-align:left\">list known partition types</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">n</td>\n<td style=\"text-align:left\">add a new partition</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">p</td>\n<td style=\"text-align:left\">print the partition</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">d</td>\n<td style=\"text-align:left\">delete a partition</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">q</td>\n<td style=\"text-align:left\">quit without saving changes</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">w</td>\n<td style=\"text-align:left\">write table to disk and exit</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-1-分区\"><a href=\"#2-1-分区\" class=\"headerlink\" title=\"2.1 分区\"></a>2.1 分区</h3><p><font color=\"red\">分区时，要注意先通过<code>fdisk -l</code>命令，确定接下来要进行操作的设备文件名。<br>之下的步骤，每一步都要格外仔细，一不小心就会造成数据丢失！</font><br>例如：我确认我新添的磁盘为<code>/dev/vdbc</code>，那进行分区的命令如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo fdisk /dev/xvdc</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-格式化\"><a href=\"#2-2-格式化\" class=\"headerlink\" title=\"2.2 格式化\"></a>2.2 格式化</h3><p>通过<code>-t</code>指定磁盘要格式化成的类型，这里我要格式化成<code>ext4</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkfs -t ext4 /dev/xvdc1</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-创建临时挂载目录\"><a href=\"#2-3-创建临时挂载目录\" class=\"headerlink\" title=\"2.3 创建临时挂载目录\"></a>2.3 创建临时挂载目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir /mnt/tmp-home</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-挂载磁盘\"><a href=\"#2-4-挂载磁盘\" class=\"headerlink\" title=\"2.4 挂载磁盘\"></a>2.4 挂载磁盘</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mount /dev/xvdc1 /mnt/tmp-home</span><br></pre></td></tr></table></figure>\n<p>至此，新添的磁盘已经进行了分区，格式化，挂载操作。<br>接下来进行数据迁移，把之前的数据迁移到新磁盘上。</p>\n<h2 id=\"3-同步数据\"><a href=\"#3-同步数据\" class=\"headerlink\" title=\"3. 同步数据\"></a>3. 同步数据</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rsync -avzrt --delete-after /home/USERNAME /mnt/tmp-home/</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-重命名之前的home目录\"><a href=\"#4-重命名之前的home目录\" class=\"headerlink\" title=\"4. 重命名之前的home目录\"></a>4. 重命名之前的home目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mv /home/USERNAME /home/USERNAME-orig</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-对比数据\"><a href=\"#5-对比数据\" class=\"headerlink\" title=\"5. 对比数据\"></a>5. 对比数据</h2><p>对比原来的<code>home</code>目录和新<code>home</code>目录的数据。<br>例如：通过<code>du</code>命令来对比大小。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">du -sh /home/USERNAME-orig</span><br><span class=\"line\">du -sh /mnt/tmp-home</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"6-备份源数据\"><a href=\"#6-备份源数据\" class=\"headerlink\" title=\"6. 备份源数据\"></a>6. 备份源数据</h2><p>数据迁移完成后，可以将<code>USERNAME-orig</code>迁移到<code>/</code>下进行备份。</p>\n<h2 id=\"7-自动挂载\"><a href=\"#7-自动挂载\" class=\"headerlink\" title=\"7. 自动挂载\"></a>7. 自动挂载</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/fstab</span><br><span class=\"line\"># 写入如下内容</span><br><span class=\"line\">/dev/xvdc1    /home    ext4      defaults    0  0</span><br></pre></td></tr></table></figure>\n<h2 id=\"8-重启服务器\"><a href=\"#8-重启服务器\" class=\"headerlink\" title=\"8. 重启服务器\"></a>8. 重启服务器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo shutdown -r now</span><br></pre></td></tr></table></figure>\n<h2 id=\"9-验证\"><a href=\"#9-验证\" class=\"headerlink\" title=\"9. 验证\"></a>9. 验证</h2><p>待服务器重启后，验证各个服务是否能够正常启动，尤其时<code>/home/USERNAME</code>下的项目能否正常运行。</p>\n<h2 id=\"10-清除备份文件\"><a href=\"#10-清除备份文件\" class=\"headerlink\" title=\"10. 清除备份文件\"></a>10. 清除备份文件</h2><p>验证各个服务和项目，在迁移到新的<code>/home</code>运行正常且稳定一段时间后，可以择机对原备份文件进行清理。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-源由\"><a href=\"#1-源由\" class=\"headerlink\" title=\"1. 源由\"></a>1. 源由</h2><p>由于大量项目放到<code>/home</code>里且初期规划不合理导致磁盘空间严重不足，故需要择机对该磁盘进行更换，重新挂载到一块容量比较大的磁盘上，以满足日益增长的业务需求。</p>\n<h2 id=\"2-添加磁盘并挂载\"><a href=\"#2-添加磁盘并挂载\" class=\"headerlink\" title=\"2. 添加磁盘并挂载\"></a>2. 添加磁盘并挂载</h2><p>添加完磁盘，首先需要对磁盘进行分区格式化  </p>\n<p><strong>部分常用<code>fdisk</code>命令如下</strong>  </p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">command</th>\n<th style=\"text-align:left\">action</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">l</td>\n<td style=\"text-align:left\">list known partition types</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">n</td>\n<td style=\"text-align:left\">add a new partition</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">p</td>\n<td style=\"text-align:left\">print the partition</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">d</td>\n<td style=\"text-align:left\">delete a partition</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">q</td>\n<td style=\"text-align:left\">quit without saving changes</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">w</td>\n<td style=\"text-align:left\">write table to disk and exit</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2-1-分区\"><a href=\"#2-1-分区\" class=\"headerlink\" title=\"2.1 分区\"></a>2.1 分区</h3><p><font color=\"red\">分区时，要注意先通过<code>fdisk -l</code>命令，确定接下来要进行操作的设备文件名。<br>之下的步骤，每一步都要格外仔细，一不小心就会造成数据丢失！</font><br>例如：我确认我新添的磁盘为<code>/dev/vdbc</code>，那进行分区的命令如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo fdisk /dev/xvdc</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-格式化\"><a href=\"#2-2-格式化\" class=\"headerlink\" title=\"2.2 格式化\"></a>2.2 格式化</h3><p>通过<code>-t</code>指定磁盘要格式化成的类型，这里我要格式化成<code>ext4</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkfs -t ext4 /dev/xvdc1</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-3-创建临时挂载目录\"><a href=\"#2-3-创建临时挂载目录\" class=\"headerlink\" title=\"2.3 创建临时挂载目录\"></a>2.3 创建临时挂载目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir /mnt/tmp-home</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-4-挂载磁盘\"><a href=\"#2-4-挂载磁盘\" class=\"headerlink\" title=\"2.4 挂载磁盘\"></a>2.4 挂载磁盘</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mount /dev/xvdc1 /mnt/tmp-home</span><br></pre></td></tr></table></figure>\n<p>至此，新添的磁盘已经进行了分区，格式化，挂载操作。<br>接下来进行数据迁移，把之前的数据迁移到新磁盘上。</p>\n<h2 id=\"3-同步数据\"><a href=\"#3-同步数据\" class=\"headerlink\" title=\"3. 同步数据\"></a>3. 同步数据</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rsync -avzrt --delete-after /home/USERNAME /mnt/tmp-home/</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-重命名之前的home目录\"><a href=\"#4-重命名之前的home目录\" class=\"headerlink\" title=\"4. 重命名之前的home目录\"></a>4. 重命名之前的home目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mv /home/USERNAME /home/USERNAME-orig</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-对比数据\"><a href=\"#5-对比数据\" class=\"headerlink\" title=\"5. 对比数据\"></a>5. 对比数据</h2><p>对比原来的<code>home</code>目录和新<code>home</code>目录的数据。<br>例如：通过<code>du</code>命令来对比大小。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">du -sh /home/USERNAME-orig</span><br><span class=\"line\">du -sh /mnt/tmp-home</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"6-备份源数据\"><a href=\"#6-备份源数据\" class=\"headerlink\" title=\"6. 备份源数据\"></a>6. 备份源数据</h2><p>数据迁移完成后，可以将<code>USERNAME-orig</code>迁移到<code>/</code>下进行备份。</p>\n<h2 id=\"7-自动挂载\"><a href=\"#7-自动挂载\" class=\"headerlink\" title=\"7. 自动挂载\"></a>7. 自动挂载</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/fstab</span><br><span class=\"line\"># 写入如下内容</span><br><span class=\"line\">/dev/xvdc1    /home    ext4      defaults    0  0</span><br></pre></td></tr></table></figure>\n<h2 id=\"8-重启服务器\"><a href=\"#8-重启服务器\" class=\"headerlink\" title=\"8. 重启服务器\"></a>8. 重启服务器</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo shutdown -r now</span><br></pre></td></tr></table></figure>\n<h2 id=\"9-验证\"><a href=\"#9-验证\" class=\"headerlink\" title=\"9. 验证\"></a>9. 验证</h2><p>待服务器重启后，验证各个服务是否能够正常启动，尤其时<code>/home/USERNAME</code>下的项目能否正常运行。</p>\n<h2 id=\"10-清除备份文件\"><a href=\"#10-清除备份文件\" class=\"headerlink\" title=\"10. 清除备份文件\"></a>10. 清除备份文件</h2><p>验证各个服务和项目，在迁移到新的<code>/home</code>运行正常且稳定一段时间后，可以择机对原备份文件进行清理。</p>\n"},{"title":"通过supervisor管理服务","date":"2018-05-09T12:54:10.000Z","_content":"\n## 1. 简介\n[supervisor](http://supervisord.org)是一个用Python写的进程管理工具，可以很方便的用来启动、重启、关闭进程。不仅可以控制单个进程，还可以同时启动、关闭多个进程。\n\n## 2. 安装\n```\npip install --upgrade pip\npip install supervisor\n```\n\n## 3. 配置\n配置文件为`/etc/supervisord.conf`\n\n### 3.1 生成配置文件\n```\nsudo echo_supervisord_conf > /etc/supervisor/supervisord.conf\n```\n### 3.2 配置项\n```\n; supervisor config file                                                                                                                                                                                        \n\n[unix_http_server]\nfile=/var/run/supervisor.sock   ; (the path to the socket file)\nchmod=0700                       ; sockef file mode (default 0700)\n \n[supervisord]\nlogfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)\npidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)\nchildlogdir=/var/log/supervisor            ; ('AUTO' child log dir, default $TEMP)\n\nminfds=2000000\n \n; the below section must remain in the config file for RPC \n; (supervisorctl/web interface) to work, additional interfaces may be\n; added by defining them in separate rpcinterface: sections\n[rpcinterface:supervisor]\nsupervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface\n \n[supervisorctl]\nserverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket\n \n; The [include] section can just contain the \"files\" setting.  This\n; setting can list multiple files (separated by whitespace or\n; newlines).  It can also contain wildcards.  The filenames are \n; interpreted as relative to this file.  Included files *cannot*\n; include files themselves.\n \n[include]\nfiles = /etc/supervisor/conf.d/*.conf\n```\n### 3.3 创建目录\n```\nsudo mkdir /var/log/supervisor\nsudo mkdir /etc/supervisor/conf.d\n```\n\n## 4. 启动\n```\nsudo supervirsord\n```\n如果有报错，修改刚才创建的目录权限\n```\nsudo chmod 777 /var/run/\nsudo chmod 777 /var/log/supervisor\n```\n\n## 5. 添加管理项\n待服务启动后，就可以添加需要`supervisor`管理的服务\n\n### 5.1 创建服务配置文件\n将需要被管理的配置文件放到`/etc/supervisor/conf.d/`下  \n**需要用到的环境变量通过`environment`来设置即可，多个环境变量用`,`分割**  \n例如：创建`consul.conf`文件内容如下\n```\n[program:consul]                                                                                                                                                                                                \nuser=USERNAME\nenvironment=GOMAXPROCS=4\ncommand=/home/USERNAME/opt/consul/bin/consul agent -domain \"test.\" -config-file /home/USERNAME/opt/consul/conf/consul.json\nautostart=true\nautorestart=true\nstdout_logfile=/mnt/data/logs/supervisor/consul-out.log\nstdout_logfile_maxbytes=1MB\nstdout_logfile_backups=10\nstdout_capture_maxbytes=1MB\nstderr_logfile=/mnt/data/logs/supervisor/consul-err.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nstderr_capture_maxbytes=1MB\n```\n\n### 5.2 reload配置文件\n\n``` \nsudo supervisorctl reread\n```\n\n### 5.3 更新配置文件\n更新配置文件后，服务会自动添加到`supervisor`列表里，并自动把服务器管理起来。\n```\nsudo supervisorctl update consul\n```\n\n### 5.4 测试\n`consul`启动后，人为`kill`掉`consul`，测试`supervisord`是否会自动将`consul`重启。\n\n## 6. 其他相关命令\n\n### 6.1 重启supervisord\n```\nsudo supervisorctl reload\n```\n\n### 6.2 更新配置文件\n`PROGRAM-NAME`为可选参数，不指定为所有。\n```\nsudo supervisorctl reread\nsudo supervisorctl update [PROGRAM-NAME]\n```\n\n### 6.3 管理服务\n`PROGRAM-NAME`为可选参数，不指定为所有。\n```\nsudo supervisorctl start [PROGRAM-NAME]\nsudo supervisorctl stop [PROGRAM-NAME]\nsudo supervisorctl restart [PROGRAM-NAME]\n```\n\n### 6.4 查询所有服务状态\n```\nsudo supervisorctl status\n```","source":"_posts/通过supervisor管理服务.md","raw":"---\ntitle: 通过supervisor管理服务\ndate: 2018-05-09 20:54:10\ntags: supervisor\n---\n\n## 1. 简介\n[supervisor](http://supervisord.org)是一个用Python写的进程管理工具，可以很方便的用来启动、重启、关闭进程。不仅可以控制单个进程，还可以同时启动、关闭多个进程。\n\n## 2. 安装\n```\npip install --upgrade pip\npip install supervisor\n```\n\n## 3. 配置\n配置文件为`/etc/supervisord.conf`\n\n### 3.1 生成配置文件\n```\nsudo echo_supervisord_conf > /etc/supervisor/supervisord.conf\n```\n### 3.2 配置项\n```\n; supervisor config file                                                                                                                                                                                        \n\n[unix_http_server]\nfile=/var/run/supervisor.sock   ; (the path to the socket file)\nchmod=0700                       ; sockef file mode (default 0700)\n \n[supervisord]\nlogfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)\npidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)\nchildlogdir=/var/log/supervisor            ; ('AUTO' child log dir, default $TEMP)\n\nminfds=2000000\n \n; the below section must remain in the config file for RPC \n; (supervisorctl/web interface) to work, additional interfaces may be\n; added by defining them in separate rpcinterface: sections\n[rpcinterface:supervisor]\nsupervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface\n \n[supervisorctl]\nserverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket\n \n; The [include] section can just contain the \"files\" setting.  This\n; setting can list multiple files (separated by whitespace or\n; newlines).  It can also contain wildcards.  The filenames are \n; interpreted as relative to this file.  Included files *cannot*\n; include files themselves.\n \n[include]\nfiles = /etc/supervisor/conf.d/*.conf\n```\n### 3.3 创建目录\n```\nsudo mkdir /var/log/supervisor\nsudo mkdir /etc/supervisor/conf.d\n```\n\n## 4. 启动\n```\nsudo supervirsord\n```\n如果有报错，修改刚才创建的目录权限\n```\nsudo chmod 777 /var/run/\nsudo chmod 777 /var/log/supervisor\n```\n\n## 5. 添加管理项\n待服务启动后，就可以添加需要`supervisor`管理的服务\n\n### 5.1 创建服务配置文件\n将需要被管理的配置文件放到`/etc/supervisor/conf.d/`下  \n**需要用到的环境变量通过`environment`来设置即可，多个环境变量用`,`分割**  \n例如：创建`consul.conf`文件内容如下\n```\n[program:consul]                                                                                                                                                                                                \nuser=USERNAME\nenvironment=GOMAXPROCS=4\ncommand=/home/USERNAME/opt/consul/bin/consul agent -domain \"test.\" -config-file /home/USERNAME/opt/consul/conf/consul.json\nautostart=true\nautorestart=true\nstdout_logfile=/mnt/data/logs/supervisor/consul-out.log\nstdout_logfile_maxbytes=1MB\nstdout_logfile_backups=10\nstdout_capture_maxbytes=1MB\nstderr_logfile=/mnt/data/logs/supervisor/consul-err.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nstderr_capture_maxbytes=1MB\n```\n\n### 5.2 reload配置文件\n\n``` \nsudo supervisorctl reread\n```\n\n### 5.3 更新配置文件\n更新配置文件后，服务会自动添加到`supervisor`列表里，并自动把服务器管理起来。\n```\nsudo supervisorctl update consul\n```\n\n### 5.4 测试\n`consul`启动后，人为`kill`掉`consul`，测试`supervisord`是否会自动将`consul`重启。\n\n## 6. 其他相关命令\n\n### 6.1 重启supervisord\n```\nsudo supervisorctl reload\n```\n\n### 6.2 更新配置文件\n`PROGRAM-NAME`为可选参数，不指定为所有。\n```\nsudo supervisorctl reread\nsudo supervisorctl update [PROGRAM-NAME]\n```\n\n### 6.3 管理服务\n`PROGRAM-NAME`为可选参数，不指定为所有。\n```\nsudo supervisorctl start [PROGRAM-NAME]\nsudo supervisorctl stop [PROGRAM-NAME]\nsudo supervisorctl restart [PROGRAM-NAME]\n```\n\n### 6.4 查询所有服务状态\n```\nsudo supervisorctl status\n```","slug":"通过supervisor管理服务","published":1,"updated":"2018-12-12T04:57:59.938Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjqce5j5g002kzahio9drhdc5","content":"<h2 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1. 简介\"></a>1. 简介</h2><p><a href=\"http://supervisord.org\" target=\"_blank\" rel=\"noopener\">supervisor</a>是一个用Python写的进程管理工具，可以很方便的用来启动、重启、关闭进程。不仅可以控制单个进程，还可以同时启动、关闭多个进程。</p>\n<h2 id=\"2-安装\"><a href=\"#2-安装\" class=\"headerlink\" title=\"2. 安装\"></a>2. 安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install --upgrade pip</span><br><span class=\"line\">pip install supervisor</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-配置\"><a href=\"#3-配置\" class=\"headerlink\" title=\"3. 配置\"></a>3. 配置</h2><p>配置文件为<code>/etc/supervisord.conf</code></p>\n<h3 id=\"3-1-生成配置文件\"><a href=\"#3-1-生成配置文件\" class=\"headerlink\" title=\"3.1 生成配置文件\"></a>3.1 生成配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo echo_supervisord_conf &gt; /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-配置项\"><a href=\"#3-2-配置项\" class=\"headerlink\" title=\"3.2 配置项\"></a>3.2 配置项</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; supervisor config file                                                                                                                                                                                        </span><br><span class=\"line\"></span><br><span class=\"line\">[unix_http_server]</span><br><span class=\"line\">file=/var/run/supervisor.sock   ; (the path to the socket file)</span><br><span class=\"line\">chmod=0700                       ; sockef file mode (default 0700)</span><br><span class=\"line\"> </span><br><span class=\"line\">[supervisord]</span><br><span class=\"line\">logfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)</span><br><span class=\"line\">pidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span><br><span class=\"line\">childlogdir=/var/log/supervisor            ; (&apos;AUTO&apos; child log dir, default $TEMP)</span><br><span class=\"line\"></span><br><span class=\"line\">minfds=2000000</span><br><span class=\"line\"> </span><br><span class=\"line\">; the below section must remain in the config file for RPC </span><br><span class=\"line\">; (supervisorctl/web interface) to work, additional interfaces may be</span><br><span class=\"line\">; added by defining them in separate rpcinterface: sections</span><br><span class=\"line\">[rpcinterface:supervisor]</span><br><span class=\"line\">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class=\"line\"> </span><br><span class=\"line\">[supervisorctl]</span><br><span class=\"line\">serverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket</span><br><span class=\"line\"> </span><br><span class=\"line\">; The [include] section can just contain the &quot;files&quot; setting.  This</span><br><span class=\"line\">; setting can list multiple files (separated by whitespace or</span><br><span class=\"line\">; newlines).  It can also contain wildcards.  The filenames are </span><br><span class=\"line\">; interpreted as relative to this file.  Included files *cannot*</span><br><span class=\"line\">; include files themselves.</span><br><span class=\"line\"> </span><br><span class=\"line\">[include]</span><br><span class=\"line\">files = /etc/supervisor/conf.d/*.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-创建目录\"><a href=\"#3-3-创建目录\" class=\"headerlink\" title=\"3.3 创建目录\"></a>3.3 创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir /var/log/supervisor</span><br><span class=\"line\">sudo mkdir /etc/supervisor/conf.d</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-启动\"><a href=\"#4-启动\" class=\"headerlink\" title=\"4. 启动\"></a>4. 启动</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervirsord</span><br></pre></td></tr></table></figure>\n<p>如果有报错，修改刚才创建的目录权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod 777 /var/run/</span><br><span class=\"line\">sudo chmod 777 /var/log/supervisor</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"5-添加管理项\"><a href=\"#5-添加管理项\" class=\"headerlink\" title=\"5. 添加管理项\"></a>5. 添加管理项</h2><p>待服务启动后，就可以添加需要<code>supervisor</code>管理的服务</p>\n<h3 id=\"5-1-创建服务配置文件\"><a href=\"#5-1-创建服务配置文件\" class=\"headerlink\" title=\"5.1 创建服务配置文件\"></a>5.1 创建服务配置文件</h3><p>将需要被管理的配置文件放到<code>/etc/supervisor/conf.d/</code>下<br><strong>需要用到的环境变量通过<code>environment</code>来设置即可，多个环境变量用<code>,</code>分割</strong><br>例如：创建<code>consul.conf</code>文件内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:consul]                                                                                                                                                                                                </span><br><span class=\"line\">user=USERNAME</span><br><span class=\"line\">environment=GOMAXPROCS=4</span><br><span class=\"line\">command=/home/USERNAME/opt/consul/bin/consul agent -domain &quot;test.&quot; -config-file /home/USERNAME/opt/consul/conf/consul.json</span><br><span class=\"line\">autostart=true</span><br><span class=\"line\">autorestart=true</span><br><span class=\"line\">stdout_logfile=/mnt/data/logs/supervisor/consul-out.log</span><br><span class=\"line\">stdout_logfile_maxbytes=1MB</span><br><span class=\"line\">stdout_logfile_backups=10</span><br><span class=\"line\">stdout_capture_maxbytes=1MB</span><br><span class=\"line\">stderr_logfile=/mnt/data/logs/supervisor/consul-err.log</span><br><span class=\"line\">stderr_logfile_maxbytes=1MB</span><br><span class=\"line\">stderr_logfile_backups=10</span><br><span class=\"line\">stderr_capture_maxbytes=1MB</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"5-2-reload配置文件\"><a href=\"#5-2-reload配置文件\" class=\"headerlink\" title=\"5.2 reload配置文件\"></a>5.2 reload配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl reread</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-3-更新配置文件\"><a href=\"#5-3-更新配置文件\" class=\"headerlink\" title=\"5.3 更新配置文件\"></a>5.3 更新配置文件</h3><p>更新配置文件后，服务会自动添加到<code>supervisor</code>列表里，并自动把服务器管理起来。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl update consul</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"5-4-测试\"><a href=\"#5-4-测试\" class=\"headerlink\" title=\"5.4 测试\"></a>5.4 测试</h3><p><code>consul</code>启动后，人为<code>kill</code>掉<code>consul</code>，测试<code>supervisord</code>是否会自动将<code>consul</code>重启。</p>\n<h2 id=\"6-其他相关命令\"><a href=\"#6-其他相关命令\" class=\"headerlink\" title=\"6. 其他相关命令\"></a>6. 其他相关命令</h2><h3 id=\"6-1-重启supervisord\"><a href=\"#6-1-重启supervisord\" class=\"headerlink\" title=\"6.1 重启supervisord\"></a>6.1 重启supervisord</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl reload</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-2-更新配置文件\"><a href=\"#6-2-更新配置文件\" class=\"headerlink\" title=\"6.2 更新配置文件\"></a>6.2 更新配置文件</h3><p><code>PROGRAM-NAME</code>为可选参数，不指定为所有。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl reread</span><br><span class=\"line\">sudo supervisorctl update [PROGRAM-NAME]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"6-3-管理服务\"><a href=\"#6-3-管理服务\" class=\"headerlink\" title=\"6.3 管理服务\"></a>6.3 管理服务</h3><p><code>PROGRAM-NAME</code>为可选参数，不指定为所有。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl start [PROGRAM-NAME]</span><br><span class=\"line\">sudo supervisorctl stop [PROGRAM-NAME]</span><br><span class=\"line\">sudo supervisorctl restart [PROGRAM-NAME]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"6-4-查询所有服务状态\"><a href=\"#6-4-查询所有服务状态\" class=\"headerlink\" title=\"6.4 查询所有服务状态\"></a>6.4 查询所有服务状态</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl status</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1. 简介\"></a>1. 简介</h2><p><a href=\"http://supervisord.org\" target=\"_blank\" rel=\"noopener\">supervisor</a>是一个用Python写的进程管理工具，可以很方便的用来启动、重启、关闭进程。不仅可以控制单个进程，还可以同时启动、关闭多个进程。</p>\n<h2 id=\"2-安装\"><a href=\"#2-安装\" class=\"headerlink\" title=\"2. 安装\"></a>2. 安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install --upgrade pip</span><br><span class=\"line\">pip install supervisor</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-配置\"><a href=\"#3-配置\" class=\"headerlink\" title=\"3. 配置\"></a>3. 配置</h2><p>配置文件为<code>/etc/supervisord.conf</code></p>\n<h3 id=\"3-1-生成配置文件\"><a href=\"#3-1-生成配置文件\" class=\"headerlink\" title=\"3.1 生成配置文件\"></a>3.1 生成配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo echo_supervisord_conf &gt; /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-2-配置项\"><a href=\"#3-2-配置项\" class=\"headerlink\" title=\"3.2 配置项\"></a>3.2 配置项</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; supervisor config file                                                                                                                                                                                        </span><br><span class=\"line\"></span><br><span class=\"line\">[unix_http_server]</span><br><span class=\"line\">file=/var/run/supervisor.sock   ; (the path to the socket file)</span><br><span class=\"line\">chmod=0700                       ; sockef file mode (default 0700)</span><br><span class=\"line\"> </span><br><span class=\"line\">[supervisord]</span><br><span class=\"line\">logfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)</span><br><span class=\"line\">pidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span><br><span class=\"line\">childlogdir=/var/log/supervisor            ; (&apos;AUTO&apos; child log dir, default $TEMP)</span><br><span class=\"line\"></span><br><span class=\"line\">minfds=2000000</span><br><span class=\"line\"> </span><br><span class=\"line\">; the below section must remain in the config file for RPC </span><br><span class=\"line\">; (supervisorctl/web interface) to work, additional interfaces may be</span><br><span class=\"line\">; added by defining them in separate rpcinterface: sections</span><br><span class=\"line\">[rpcinterface:supervisor]</span><br><span class=\"line\">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class=\"line\"> </span><br><span class=\"line\">[supervisorctl]</span><br><span class=\"line\">serverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket</span><br><span class=\"line\"> </span><br><span class=\"line\">; The [include] section can just contain the &quot;files&quot; setting.  This</span><br><span class=\"line\">; setting can list multiple files (separated by whitespace or</span><br><span class=\"line\">; newlines).  It can also contain wildcards.  The filenames are </span><br><span class=\"line\">; interpreted as relative to this file.  Included files *cannot*</span><br><span class=\"line\">; include files themselves.</span><br><span class=\"line\"> </span><br><span class=\"line\">[include]</span><br><span class=\"line\">files = /etc/supervisor/conf.d/*.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-3-创建目录\"><a href=\"#3-3-创建目录\" class=\"headerlink\" title=\"3.3 创建目录\"></a>3.3 创建目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir /var/log/supervisor</span><br><span class=\"line\">sudo mkdir /etc/supervisor/conf.d</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-启动\"><a href=\"#4-启动\" class=\"headerlink\" title=\"4. 启动\"></a>4. 启动</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervirsord</span><br></pre></td></tr></table></figure>\n<p>如果有报错，修改刚才创建的目录权限<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod 777 /var/run/</span><br><span class=\"line\">sudo chmod 777 /var/log/supervisor</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"5-添加管理项\"><a href=\"#5-添加管理项\" class=\"headerlink\" title=\"5. 添加管理项\"></a>5. 添加管理项</h2><p>待服务启动后，就可以添加需要<code>supervisor</code>管理的服务</p>\n<h3 id=\"5-1-创建服务配置文件\"><a href=\"#5-1-创建服务配置文件\" class=\"headerlink\" title=\"5.1 创建服务配置文件\"></a>5.1 创建服务配置文件</h3><p>将需要被管理的配置文件放到<code>/etc/supervisor/conf.d/</code>下<br><strong>需要用到的环境变量通过<code>environment</code>来设置即可，多个环境变量用<code>,</code>分割</strong><br>例如：创建<code>consul.conf</code>文件内容如下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:consul]                                                                                                                                                                                                </span><br><span class=\"line\">user=USERNAME</span><br><span class=\"line\">environment=GOMAXPROCS=4</span><br><span class=\"line\">command=/home/USERNAME/opt/consul/bin/consul agent -domain &quot;test.&quot; -config-file /home/USERNAME/opt/consul/conf/consul.json</span><br><span class=\"line\">autostart=true</span><br><span class=\"line\">autorestart=true</span><br><span class=\"line\">stdout_logfile=/mnt/data/logs/supervisor/consul-out.log</span><br><span class=\"line\">stdout_logfile_maxbytes=1MB</span><br><span class=\"line\">stdout_logfile_backups=10</span><br><span class=\"line\">stdout_capture_maxbytes=1MB</span><br><span class=\"line\">stderr_logfile=/mnt/data/logs/supervisor/consul-err.log</span><br><span class=\"line\">stderr_logfile_maxbytes=1MB</span><br><span class=\"line\">stderr_logfile_backups=10</span><br><span class=\"line\">stderr_capture_maxbytes=1MB</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"5-2-reload配置文件\"><a href=\"#5-2-reload配置文件\" class=\"headerlink\" title=\"5.2 reload配置文件\"></a>5.2 reload配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl reread</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-3-更新配置文件\"><a href=\"#5-3-更新配置文件\" class=\"headerlink\" title=\"5.3 更新配置文件\"></a>5.3 更新配置文件</h3><p>更新配置文件后，服务会自动添加到<code>supervisor</code>列表里，并自动把服务器管理起来。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl update consul</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"5-4-测试\"><a href=\"#5-4-测试\" class=\"headerlink\" title=\"5.4 测试\"></a>5.4 测试</h3><p><code>consul</code>启动后，人为<code>kill</code>掉<code>consul</code>，测试<code>supervisord</code>是否会自动将<code>consul</code>重启。</p>\n<h2 id=\"6-其他相关命令\"><a href=\"#6-其他相关命令\" class=\"headerlink\" title=\"6. 其他相关命令\"></a>6. 其他相关命令</h2><h3 id=\"6-1-重启supervisord\"><a href=\"#6-1-重启supervisord\" class=\"headerlink\" title=\"6.1 重启supervisord\"></a>6.1 重启supervisord</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl reload</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-2-更新配置文件\"><a href=\"#6-2-更新配置文件\" class=\"headerlink\" title=\"6.2 更新配置文件\"></a>6.2 更新配置文件</h3><p><code>PROGRAM-NAME</code>为可选参数，不指定为所有。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl reread</span><br><span class=\"line\">sudo supervisorctl update [PROGRAM-NAME]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"6-3-管理服务\"><a href=\"#6-3-管理服务\" class=\"headerlink\" title=\"6.3 管理服务\"></a>6.3 管理服务</h3><p><code>PROGRAM-NAME</code>为可选参数，不指定为所有。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl start [PROGRAM-NAME]</span><br><span class=\"line\">sudo supervisorctl stop [PROGRAM-NAME]</span><br><span class=\"line\">sudo supervisorctl restart [PROGRAM-NAME]</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"6-4-查询所有服务状态\"><a href=\"#6-4-查询所有服务状态\" class=\"headerlink\" title=\"6.4 查询所有服务状态\"></a>6.4 查询所有服务状态</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo supervisorctl status</span><br></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjqce5j4l000azahivo2ocfjz","category_id":"cjqce5j4m000czahi75wtzw1e","_id":"cjqce5j4r000mzahiyughn1lh"},{"post_id":"cjqce5j4q000lzahibujf21jc","category_id":"cjqce5j4s000qzahii20ck74e","_id":"cjqce5j4w0012zahi23yqc7e3"},{"post_id":"cjqce5j4r000ozahikvv5pjb3","category_id":"cjqce5j4s000qzahii20ck74e","_id":"cjqce5j4y0017zahihctb2ga6"},{"post_id":"cjqce5j4s000rzahithhuhlel","category_id":"cjqce5j4s000qzahii20ck74e","_id":"cjqce5j50001czahin8ezu2yk"},{"post_id":"cjqce5j58001wzahib7fgngz1","category_id":"cjqce5j59001zzahi50bsal3u","_id":"cjqce5j5d0029zahifbzvccuk"},{"post_id":"cjqce5j5c0026zahiuukffzfy","category_id":"cjqce5j5d002bzahiiz6cjbj5","_id":"cjqce5j5g002lzahi8bx64ig3"}],"PostTag":[{"post_id":"cjqce5j4b0000zahik44qqs11","tag_id":"cjqce5j4h0004zahi8src4adb","_id":"cjqce5j4k0009zahirkhbirwi"},{"post_id":"cjqce5j4j0006zahiltwf7xez","tag_id":"cjqce5j4k0008zahicc78soqb","_id":"cjqce5j4o000fzahij3e0zodi"},{"post_id":"cjqce5j4j0007zahiqq61z1kh","tag_id":"cjqce5j4k0008zahicc78soqb","_id":"cjqce5j4q000jzahidz9b3a71"},{"post_id":"cjqce5j4l000azahivo2ocfjz","tag_id":"cjqce5j4p000izahi1c7d8bqa","_id":"cjqce5j4s000pzahil28vx2zi"},{"post_id":"cjqce5j4l000bzahiy33s6mun","tag_id":"cjqce5j4r000nzahise32pg85","_id":"cjqce5j4u000uzahijxrc8m9l"},{"post_id":"cjqce5j4m000dzahijsex47ih","tag_id":"cjqce5j4r000nzahise32pg85","_id":"cjqce5j4w000zzahi34qkafyu"},{"post_id":"cjqce5j4o000gzahi8koiwtcy","tag_id":"cjqce5j4r000nzahise32pg85","_id":"cjqce5j4y0015zahia4escuzu"},{"post_id":"cjqce5j4p000hzahioqqebm91","tag_id":"cjqce5j4r000nzahise32pg85","_id":"cjqce5j4z001azahizurmekqw"},{"post_id":"cjqce5j4q000kzahiwx94eqc7","tag_id":"cjqce5j4y0018zahi8zqdi9uv","_id":"cjqce5j51001fzahi7a2u40ir"},{"post_id":"cjqce5j4q000lzahibujf21jc","tag_id":"cjqce5j4y0018zahi8zqdi9uv","_id":"cjqce5j53001jzahiz5muwveb"},{"post_id":"cjqce5j4r000ozahikvv5pjb3","tag_id":"cjqce5j4y0018zahi8zqdi9uv","_id":"cjqce5j55001nzahikcqgudvy"},{"post_id":"cjqce5j4s000rzahithhuhlel","tag_id":"cjqce5j4y0018zahi8zqdi9uv","_id":"cjqce5j56001rzahi9m3xyyo4"},{"post_id":"cjqce5j4t000tzahip5fa1qoc","tag_id":"cjqce5j4y0018zahi8zqdi9uv","_id":"cjqce5j58001vzahidr908ia1"},{"post_id":"cjqce5j4v000yzahiemf9o3lx","tag_id":"cjqce5j57001tzahi6linyvfi","_id":"cjqce5j5a0020zahivrak70gp"},{"post_id":"cjqce5j4x0014zahiwo2ifdgr","tag_id":"cjqce5j59001yzahiujnwthm5","_id":"cjqce5j5b0025zahi6xcdwok7"},{"post_id":"cjqce5j4y0016zahi6ax7jx37","tag_id":"cjqce5j57001tzahi6linyvfi","_id":"cjqce5j5d002azahiatoltn97"},{"post_id":"cjqce5j4z0019zahi1en1i1x2","tag_id":"cjqce5j5c0027zahiaefp3unn","_id":"cjqce5j5e002fzahizda3fed8"},{"post_id":"cjqce5j4z001bzahihevn0kox","tag_id":"cjqce5j5e002dzahi8rwst6fs","_id":"cjqce5j5f002jzahi2tt9o1fs"},{"post_id":"cjqce5j5f002izahi6m9fsrlx","tag_id":"cjqce5j57001tzahi6linyvfi","_id":"cjqce5j5g002mzahi06b9wd13"},{"post_id":"cjqce5j50001ezahi957lxkzv","tag_id":"cjqce5j5f002hzahiq2si7h2c","_id":"cjqce5j5h002ozahi7p94ietn"},{"post_id":"cjqce5j51001gzahirjssj5wx","tag_id":"cjqce5j5f002hzahiq2si7h2c","_id":"cjqce5j5h002qzahi9l41rlv9"},{"post_id":"cjqce5j53001izahira316h2k","tag_id":"cjqce5j5f002hzahiq2si7h2c","_id":"cjqce5j5i002szahi1i8w594g"},{"post_id":"cjqce5j54001kzahiuxgjb2l8","tag_id":"cjqce5j5f002hzahiq2si7h2c","_id":"cjqce5j5i002uzahib0ukx240"},{"post_id":"cjqce5j54001mzahijyk99kf2","tag_id":"cjqce5j5f002hzahiq2si7h2c","_id":"cjqce5j5i002wzahiyy4ejnzc"},{"post_id":"cjqce5j55001ozahicyol1f8h","tag_id":"cjqce5j5f002hzahiq2si7h2c","_id":"cjqce5j5j002yzahi6ksdjt3q"},{"post_id":"cjqce5j56001qzahixshgo80w","tag_id":"cjqce5j5f002hzahiq2si7h2c","_id":"cjqce5j5j0030zahiw6tmv1ng"},{"post_id":"cjqce5j57001szahiq3gegduq","tag_id":"cjqce5j5j002zzahipcrw4u5i","_id":"cjqce5j5j0032zahiasocqjxa"},{"post_id":"cjqce5j57001uzahi37mjimhp","tag_id":"cjqce5j5j0031zahiv5zzu8v9","_id":"cjqce5j5k0034zahi0kd0fzro"},{"post_id":"cjqce5j58001wzahib7fgngz1","tag_id":"cjqce5j5k0033zahilpym1i1f","_id":"cjqce5j5k0036zahiaqh2zuz2"},{"post_id":"cjqce5j59001xzahiwmn5v1pz","tag_id":"cjqce5j5j0031zahiv5zzu8v9","_id":"cjqce5j5l0038zahipvm9211l"},{"post_id":"cjqce5j5a0022zahi8d8vhi4d","tag_id":"cjqce5j5k0037zahiz0xr31wd","_id":"cjqce5j5l003azahii1lt7idn"},{"post_id":"cjqce5j5b0024zahi25p7rrvx","tag_id":"cjqce5j5j0031zahiv5zzu8v9","_id":"cjqce5j5l003czahirfquslqh"},{"post_id":"cjqce5j5c0026zahiuukffzfy","tag_id":"cjqce5j5k0037zahiz0xr31wd","_id":"cjqce5j5m003ezahicd1xekpi"},{"post_id":"cjqce5j5d002czahim5lkxfh0","tag_id":"cjqce5j5e002dzahi8rwst6fs","_id":"cjqce5j5m003hzahiind6ggj9"},{"post_id":"cjqce5j5d002czahim5lkxfh0","tag_id":"cjqce5j5m003fzahiroyg0rrn","_id":"cjqce5j5m003izahi5gsh563n"},{"post_id":"cjqce5j5e002ezahiz3sp6dfd","tag_id":"cjqce5j5m003gzahi1exw5cu8","_id":"cjqce5j5m003kzahi1dynoekk"},{"post_id":"cjqce5j5g002kzahio9drhdc5","tag_id":"cjqce5j5m003jzahijc2vao68","_id":"cjqce5j5n003lzahiawfv7qat"}],"Tag":[{"name":"android","_id":"cjqce5j4h0004zahi8src4adb"},{"name":"Redis","_id":"cjqce5j4k0008zahicc78soqb"},{"name":"ceph","_id":"cjqce5j4p000izahi1c7d8bqa"},{"name":"docker","_id":"cjqce5j4r000nzahise32pg85"},{"name":"git","_id":"cjqce5j4y0018zahi8zqdi9uv"},{"name":"linux","_id":"cjqce5j57001tzahi6linyvfi"},{"name":"模拟","_id":"cjqce5j59001yzahiujnwthm5"},{"name":"mysql","_id":"cjqce5j5c0027zahiaefp3unn"},{"name":"nginx","_id":"cjqce5j5e002dzahi8rwst6fs"},{"name":"python","_id":"cjqce5j5f002hzahiq2si7h2c"},{"name":"tmux","_id":"cjqce5j5j002zzahipcrw4u5i"},{"name":"ubuntu","_id":"cjqce5j5j0031zahiv5zzu8v9"},{"name":"shell","_id":"cjqce5j5k0033zahilpym1i1f"},{"name":"vim插件","_id":"cjqce5j5k0037zahiz0xr31wd"},{"name":"ssl","_id":"cjqce5j5m003fzahiroyg0rrn"},{"name":"gitlab","_id":"cjqce5j5m003gzahi1exw5cu8"},{"name":"supervisor","_id":"cjqce5j5m003jzahijc2vao68"}]}}